(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6248],{50018:function(e){e.exports=(()=>{var e={477:e=>{function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},811:(e,t,r)=>{var i=r(470),n=r(751);function a(t,r,s){return n()?(e.exports=a=Reflect.construct,e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=a=function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&i(a,r.prototype),a},e.exports.default=e.exports,e.exports.__esModule=!0),a.apply(null,arguments)}e.exports=a,e.exports.default=e.exports,e.exports.__esModule=!0},723:e=>{function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,t.apply(this,arguments)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},324:(e,t,r)=>{var i=r(470);function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},743:(e,t,r)=>{var i=r(470);function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},751:e=>{function t(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},470:e=>{function t(r,i){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(r,i)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0},480:(e,t,r)=>{"use strict";var i=r(697),n=function(e,t){return void 0===t&&(t=!1),function(r,n,s){if(r)e(r);else if(n.statusCode>=400&&n.statusCode<=599){var o=s;if(t)if(i.TextDecoder){var l=a(n.headers&&n.headers["content-type"]);try{o=new TextDecoder(l).decode(s)}catch(u){}}else o=String.fromCharCode.apply(null,new Uint8Array(s));e({cause:o})}else e(null,s)}};function a(e){return void 0===e&&(e=""),e.toLowerCase().split(";").reduce((function(e,t){var r=t.split("="),i=r[0],n=r[1];return"charset"===i.trim()?n.trim():e}),"utf-8")}e.exports=n},424:(e,t,r)=>{"use strict";var i=r(697),n=r(723),a=r(988);c.httpHandler=r(480);var s=function(e){var t={};return e&&e.trim().split("\n").forEach((function(e){var r=e.indexOf(":"),i=e.slice(0,r).trim().toLowerCase(),n=e.slice(r+1).trim();"undefined"==typeof t[i]?t[i]=n:Array.isArray(t[i])?t[i].push(n):t[i]=[t[i],n]})),t};function o(e,t){for(var r=0;r<e.length;r++)t(e[r])}function l(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e,t,r){var i=e;return a(t)?(r=t,"string"==typeof e&&(i={uri:e})):i=n({},t,{uri:e}),i.callback=r,i}function c(e,t,r){return d(t=u(e,t,r))}function d(e){if("undefined"==typeof e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,i,n){t||(t=!0,e.callback(r,i,n))};function i(){4===u.readyState&&setTimeout(o,0)}function n(){var e=void 0;if(e=u.response?u.response:u.responseText||h(u),T)try{e=JSON.parse(e)}catch(t){}return e}function a(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,b)}function o(){if(!f){var t;clearTimeout(p),t=e.useXDR&&void 0===u.status?200:1223===u.status?204:u.status;var i=b,a=null;return 0!==t?(i={body:n(),statusCode:t,method:g,headers:{},url:v,rawRequest:u},u.getAllResponseHeaders&&(i.headers=s(u.getAllResponseHeaders()))):a=new Error("Internal XMLHttpRequest Error"),r(a,i,i.body)}}var u=e.xhr||null;u||(u=e.cors||e.useXDR?new c.XDomainRequest:new c.XMLHttpRequest);var d,f,p,v=u.url=e.uri||e.url,g=u.method=e.method||"GET",m=e.body||e.data,y=u.headers=e.headers||{},_=!!e.sync,T=!1,b={body:void 0,headers:{},statusCode:0,method:g,url:v,rawRequest:u};if("json"in e&&!1!==e.json&&(T=!0,y.accept||y.Accept||(y.Accept="application/json"),"GET"!==g&&"HEAD"!==g&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),m=JSON.stringify(!0===e.json?m:e.json))),u.onreadystatechange=i,u.onload=o,u.onerror=a,u.onprogress=function(){},u.onabort=function(){f=!0},u.ontimeout=a,u.open(g,v,!_,e.username,e.password),_||(u.withCredentials=!!e.withCredentials),!_&&e.timeout>0&&(p=setTimeout((function(){if(!f){f=!0,u.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",a(e)}}),e.timeout)),u.setRequestHeader)for(d in y)y.hasOwnProperty(d)&&u.setRequestHeader(d,y[d]);else if(e.headers&&!l(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(u.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(u),u.send(m||null),u}function h(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(r){}return null}function f(){}e.exports=c,e.exports.default=c,c.XMLHttpRequest=i.XMLHttpRequest||f,c.XDomainRequest="withCredentials"in new c.XMLHttpRequest?c.XMLHttpRequest:i.XDomainRequest,o(["get","put","post","patch","head","delete"],(function(e){c["delete"===e?"del":e]=function(t,r,i){return(r=u(t,r,i)).method=e.toUpperCase(),d(r)}}))},675:(e,t,r)=>{var i,n="undefined"!=typeof r.g?r.g:"undefined"!=typeof window?window:{},a=r(893);"undefined"!=typeof document?i=document:(i=n["__GLOBAL_DOCUMENT_CACHE@4"])||(i=n["__GLOBAL_DOCUMENT_CACHE@4"]=a),e.exports=i},697:(e,t,r)=>{var i;i="undefined"!=typeof window?window:"undefined"!=typeof r.g?r.g:"undefined"!=typeof self?self:{},e.exports=i},199:function(e){var t;"undefined"!=typeof window&&(t=function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,n="~";function a(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,i,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var o=new s(r,i||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)i.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=new Array(a);i<a;i++)s[i]=r[i].fn;return s},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,i,a,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn===t&&(!i||s.once)&&(!r||s.context===r)&&l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||i&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,e.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){!function(t){var r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=s.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(d)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s}()},"./node_modules/webworkify-webpack/index.js":function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var n="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e){return!isNaN(1*e)}function l(e,t,i){var l={};l[i]=[];var u=t.toString(),c=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return l;for(var d,h=c[1],f=new RegExp("(\\\\n|\\W)"+s(h)+a,"g");d=f.exec(u);)"dll-reference"!==d[3]&&l[i].push(d[3]);for(f=new RegExp("\\("+s(h)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+a,"g");d=f.exec(u);)e[d[2]]||(l[i].push(d[1]),e[d[2]]=r(d[1]).m),l[d[2]]=l[d[2]]||[],l[d[2]].push(d[4]);for(var p=Object.keys(l),v=0;v<p.length;v++)for(var g=0;g<l[p[v]].length;g++)o(l[p[v]][g])&&(l[p[v]][g]=1*l[p[v]][g]);return l}function u(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}function c(e,t){for(var r={main:[t]},i={main:[]},n={main:{}};u(r);)for(var a=Object.keys(r),s=0;s<a.length;s++){var o=a[s],c=r[o].pop();if(n[o]=n[o]||{},!n[o][c]&&e[o][c]){n[o][c]=!0,i[o]=i[o]||[],i[o].push(c);for(var d=l(e,e[o][c],o),h=Object.keys(d),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(d[h[f]])}}return i}e.exports=function(e,t){t=t||{};var n={main:r.m},a=t.all?{main:Object.keys(n.main)}:c(n,e),s="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var o=new window.Blob([s],{type:"text/javascript"});if(t.bare)return o;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(o),u=new window.Worker(l);return u.objectURL=l,u}},"./src/config.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"hlsDefaultConfig",(function(){return S})),r.d(t,"mergeConfig",(function(){return C})),r.d(t,"enableStreamingMode",(function(){return w}));var i=r("./src/controller/abr-controller.ts"),n=r("./src/controller/audio-stream-controller.ts"),a=r("./src/controller/audio-track-controller.ts"),s=r("./src/controller/subtitle-stream-controller.ts"),o=r("./src/controller/subtitle-track-controller.ts"),l=r("./src/controller/buffer-controller.ts"),u=r("./src/controller/timeline-controller.ts"),c=r("./src/controller/cap-level-controller.ts"),d=r("./src/controller/fps-controller.ts"),h=r("./src/controller/eme-controller.ts"),f=r("./src/controller/cmcd-controller.ts"),p=r("./src/utils/xhr-loader.ts"),v=r("./src/utils/fetch-loader.ts"),g=r("./src/utils/cues.ts"),m=r("./src/utils/mediakeys-helper.ts"),y=r("./src/utils/logger.ts");function _(){return _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},_.apply(this,arguments)}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var S=b(b({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:i.default,bufferController:l.default,capLevelController:c.default,fpsController:d.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},k()),{},{subtitleStreamController:s.SubtitleStreamController,subtitleTrackController:o.default,timelineController:u.TimelineController,audioStreamController:n.default,audioTrackController:a.default,emeController:h.default,cmcdController:f.default});function k(){return{cueHandler:g.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function C(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return _({},e,t)}function w(e){var t=e.loader;t!==v.default&&t!==p.default?(y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):Object(v.fetchSupported)()&&(e.loader=v.default,e.progressive=!0,e.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/polyfills/number.ts"),n=r("./src/utils/ewma-bandwidth-estimator.ts"),a=r("./src/events.ts"),s=r("./src/utils/buffer-helper.ts"),o=r("./src/errors.ts"),l=r("./src/types/loader.ts"),u=r("./src/utils/logger.ts");function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,r){return t&&c(e.prototype,t),r&&c(e,r),e}var h=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new n.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(a.Events.FRAG_LOADING,this.onFragLoading,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(a.Events.FRAG_LOADING,this.onFragLoading,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(e,t){var r,i=t.frag;i.type!==l.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=i,this.partCurrent=null!=(r=t.part)?r:null,this.timer=self.setInterval(this.onCheck,100))},t.onLevelLoaded=function(e,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.autoLevelEnabled,o=r.config,l=r.media;if(e&&l){var c=t?t.stats:e.stats,d=t?t.duration:e.duration;if(c.aborted)return u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!l.paused&&l.playbackRate&&l.readyState){var h=performance.now()-c.loading.start,f=Math.abs(l.playbackRate);if(!(h<=500*d/f)){var p=r.levels,v=r.minAutoLevel,g=p[e.level],m=c.total||Math.max(c.loaded,Math.round(d*g.maxBitrate/8)),y=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/h),_=(m-c.loaded)/y,T=l.currentTime,b=(s.BufferHelper.bufferInfo(l,T,o.maxBufferHole).end-T)/f;if(!(b>=2*d/f||_<=b)){var E,S=Number.POSITIVE_INFINITY;for(E=e.level-1;E>v&&!((S=d*p[E].maxBitrate/(6.4*y))<b);E--);if(!(S>=_)){var k=this.bwEstimator.getEstimate();u.logger.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+E+"\n      Current BW estimate: "+(Object(i.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+_.toFixed(3)+" s\n      Estimated load time for the next fragment: "+S.toFixed(3)+" s\n      Time to underbuffer: "+b.toFixed(3)+" s"),r.nextLoadLevel=E,this.bwEstimator.sample(h,c.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),r.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:c})}}}}}},t.onFragLoaded=function(e,t){var r=t.frag,n=t.part;if(r.type===l.PlaylistLevelType.MAIN&&Object(i.isFiniteNumber)(r.sn)){var s=n?n.stats:r.stats,o=n?n.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var u=this.hls.levels[r.level],c=(u.loaded?u.loaded.bytes:0)+s.loaded,d=(u.loaded?u.loaded.duration:0)+o;u.loaded={bytes:c,duration:d},u.realBitrate=Math.round(8*c/d)}if(r.bitrateTest){var h={stats:s,frag:r,part:n,id:r.type};this.onFragBuffered(a.Events.FRAG_BUFFERED,h),r.bitrateTest=!1}}},t.onFragBuffered=function(e,t){var r=t.frag,i=t.part,n=i?i.stats:r.stats;if(!n.aborted&&r.type===l.PlaylistLevelType.MAIN&&"initSegment"!==r.sn){var a=n.parsing.end-n.loading.start;this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},t.onError=function(e,t){switch(t.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},t.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},t.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,a=r.minAutoLevel,o=r.media,l=t?t.duration:e?e.duration:0,c=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=(s.BufferHelper.bufferInfo(o,c,n.maxBufferHole).end-c)/d,p=this.findBestLevel(h,a,i,f,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(p>=0)return p;u.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay,g=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!f){var y=this.bitrateTestDelay;y&&(v=(l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay)-y,u.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=m=1)}return p=this.findBestLevel(h,a,i,f+v,g,m),Math.max(p,0)},t.findBestLevel=function(e,t,r,i,n,a){for(var s,o=this.fragCurrent,l=this.partCurrent,c=this.lastLoadedFragLevel,d=this.hls.levels,h=d[c],f=!(null==h||null===(s=h.details)||void 0===s||!s.live),p=null==h?void 0:h.codecSet,v=l?l.duration:o?o.duration:0,g=r;g>=t;g--){var m=d[g];if(m&&(!p||m.codecSet===p)){var y=m.details,_=(l?null==y?void 0:y.partTarget:null==y?void 0:y.averagetargetduration)||v,T=void 0;T=g<=c?n*e:a*e;var b=d[g].maxBitrate,E=b*_/T;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(T)+"/"+b+"/"+_+"/"+i+"/"+E),T>b&&(!E||f&&!this.bitrateTestDelay||E<i))return g}}return-1},d(e,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&(!t||!t.canEstimate()))return e;var r=this.getNextABRAutoLevel();return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),e}();t.default=h},"./src/controller/audio-stream-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/polyfills/number.ts"),n=r("./src/controller/base-stream-controller.ts"),a=r("./src/events.ts"),s=r("./src/utils/buffer-helper.ts"),o=r("./src/controller/fragment-tracker.ts"),l=r("./src/types/level.ts"),u=r("./src/types/loader.ts"),c=r("./src/loader/fragment.ts"),d=r("./src/demux/chunk-cache.ts"),h=r("./src/demux/transmuxer-interface.ts"),f=r("./src/types/transmuxer.ts"),p=r("./src/controller/fragment-finders.ts"),v=r("./src/utils/discontinuities.ts"),g=r("./src/errors.ts"),m=r("./src/utils/logger.ts");function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},y.apply(this,arguments)}function _(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,T(e,t)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=100,E=function(e){function t(t,r){var i;return(i=e.call(this,t,r,"[audio-stream-controller]")||this).videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i._registerListeners(),i}_(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var e=this.hls;e.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(a.Events.ERROR,this.onError,this),e.on(a.Events.BUFFER_RESET,this.onBufferReset,this),e.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var e=this.hls;e.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(a.Events.ERROR,this.onError,this),e.off(a.Events.BUFFER_RESET,this.onBufferReset,this),e.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(e,t){var r=t.frag,i=t.id,a=t.initPTS;if("main"===i){var s=r.cc;this.initPTS[r.cc]=a,this.log("InitPTS for cc: "+s+" found from main: "+a),this.videoTrackCC=s,this.state===n.State.WAITING_INIT_PTS&&this.tick()}},r.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=n.State.STOPPED);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(b),this.fragLoadError=0,t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=n.State.IDLE):(this.loadedmetadata=!1,this.state=n.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},r.doTick=function(){switch(this.state){case n.State.IDLE:this.doTickIdle();break;case n.State.WAITING_TRACK:var t,r=this.levels,i=this.trackId,a=null==r||null===(t=r[i])||void 0===t?void 0:t.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=n.State.WAITING_INIT_PTS}break;case n.State.FRAG_LOADING_WAITING_RETRY:var o,l=performance.now(),u=this.retryDate;(!u||l>=u||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=n.State.IDLE);break;case n.State.WAITING_INIT_PTS:var c=this.waitingData;if(c){var d=c.frag,h=c.part,f=c.cache,v=c.complete;if(void 0!==this.initPTS[d.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=n.State.FRAG_LOADING;var g={frag:d,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&e.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)m.logger.log("Waiting fragment cc ("+d.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var y=this.getLoadPosition(),_=s.BufferHelper.bufferInfo(this.mediaBuffer,y,this.config.maxBufferHole);Object(p.fragmentWithinToleranceTest)(_.end,this.config.maxFragLookUpTolerance,d)<0&&(m.logger.log("Waiting fragment cc ("+d.cc+") @ "+d.start+" cancelled because another fragment at "+_.end+" is needed"),this.clearWaitingFragment())}}else this.state=n.State.IDLE}this.onTickEnd()},r.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=n.State.IDLE)},r.onTickEnd=function(){var e=this.media;if(e&&e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length&&(this.loadedmetadata=!0),this.lastCurrentTime=e.currentTime}},r.doTickIdle=function(){var e,t,r=this.hls,i=this.levels,s=this.media,o=this.trackId,l=r.config;if(i&&i[o]&&(s||!this.startFragRequested&&l.startFragPrefetch)){var d=i[o].details;if(!d||d.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(d))return void(this.state=n.State.WAITING_TRACK);this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,u.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u.PlaylistLevelType.AUDIO);if(null!==h){var f=h.len,p=this.getMaxBufferLength(),v=this.audioSwitch;if(!(f>=p)||v){if(!v&&this._streamEnded(h,d))return r.trigger(a.Events.BUFFER_EOS,{type:"audio"}),void(this.state=n.State.ENDED);var g=d.fragments[0].start,m=h.end;if(v){var y=this.getLoadPosition();m=y,d.PTSKnown&&y<g&&(h.end>g||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}var _=this.getNextFragment(m,d);if(!_)return void(this.bufferFlushed=!0);"identity"!==(null===(e=_.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=_.decryptdata)&&void 0!==t&&t.key?this.loadFragment(_,d,m):this.loadKey(_,d)}}}},r.getMaxBufferLength=function(){var t=e.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,u.PlaylistLevelType.MAIN);return null===r?t:Math.max(t,r.len)},r.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new l.Level(e)}))},r.onAudioTrackSwitching=function(e,t){var r=!!t.url;this.trackId=t.id;var i=this.fragCurrent;null!=i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(b):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=n.State.IDLE):this.state=n.State.STOPPED,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(e,t){this.mainDetails=t.details},r.onAudioTrackLoaded=function(e,t){var r,i=this.levels,a=t.details,s=t.id;if(i){this.log("Track "+s+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var o=i[s],l=0;if(a.live||null!==(r=o.details)&&void 0!==r&&r.live){var u=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!u)return;!o.details&&a.hasProgramDateTime&&u.hasProgramDateTime?(Object(v.alignMediaPlaylistByPDT)(a,u),l=a.fragments[0].start):l=this.alignPlaylists(a,o.details)}o.details=a,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(o.details,l),this.state===n.State.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=n.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)},r._handleFragmentLoadProgress=function(e){var t,r=e.frag,i=e.part,a=e.payload,s=this.config,o=this.trackId,l=this.levels;if(l){var c=l[o];console.assert(c,"Audio track is defined on fragment load progress");var p=c.details;console.assert(p,"Audio track details are defined on fragment load progress");var v=s.defaultAudioCodec||c.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new h.default(this.hls,u.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var y=this.initPTS[r.cc],_=null===(t=r.initSegment)||void 0===t?void 0:t.data;if(void 0!==y){var T=!1,b=i?i.index:-1,E=-1!==b,S=new f.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,a.byteLength,b,E);g.push(a,_,v,"",r,i,p.totalduration,T,S,y)}else m.logger.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+o),(this.waitingData=this.waitingData||{frag:r,part:i,cache:new d.default,complete:!1}).cache.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=n.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:e.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},r.onFragBuffered=function(e,t){var r=t.frag,i=t.part;if(r.type===u.PlaylistLevelType.AUDIO){if(this.fragContextChanged(r))return void this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);"initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,i)}},r.onError=function(t,r){switch(r.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.AUDIO,r);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==n.State.ERROR&&this.state!==n.State.STOPPED&&(this.state=r.fatal?n.State.ERROR:n.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===n.State.PARSING||this.state===n.State.PARSED)){var i=!0,a=this.getFwdBufferInfo(this.mediaBuffer,u.PlaylistLevelType.AUDIO);a&&a.len>.5&&(i=!this.reduceMaxBufferLength(a.len)),i&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},r.onBufferFlushed=function(e,t){t.type===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},r._handleTransmuxComplete=function(e){var t,r="audio",i=this.hls,s=e.remuxResult,o=e.chunkMeta,l=this.getCurrentContext(o);if(!l)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(o.level);var u=l.frag,d=l.part,h=s.audio,f=s.text,p=s.id3,v=s.initSegment;if(!this.fragContextChanged(u)){if(this.state=n.State.PARSING,this.audioSwitch&&h&&this.completeAudioSwitch(),null!=v&&v.tracks&&(this._bufferInitSegment(v.tracks,u,o),i.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:r,tracks:v.tracks})),h){var g=h.startPTS,m=h.endPTS,_=h.startDTS,T=h.endDTS;d&&(d.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:g,endPTS:m,startDTS:_,endDTS:T}),u.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,g,m,_,T),this.bufferFragmentData(h,u,d,o)}if(null!=p&&null!==(t=p.samples)&&void 0!==t&&t.length){var b=y({frag:u,id:r},p);i.trigger(a.Events.FRAG_PARSING_METADATA,b)}if(f){var E=y({frag:u,id:r},f);i.trigger(a.Events.FRAG_PARSING_USERDATA,E)}}},r._bufferInitSegment=function(e,t,r){if(this.state===n.State.PARSING){e.video&&delete e.video;var i=e.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,e);var s=i.initSegment;if(null!=s&&s.byteLength){var o={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:s};this.hls.trigger(a.Events.BUFFER_APPENDING,o)}this.tick()}}},r.loadFragment=function(t,r,a){var s=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||s===o.FragmentState.NOT_LOADED||s===o.FragmentState.PARTIAL)&&("initSegment"===t.sn?this._loadInitSegment(t):r.live&&!Object(i.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=n.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,a)))},r.completeAudioSwitch=function(){var t=this.hls,r=this.media,i=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:i})},t}(n.default);t.default=E},"./src/controller/audio-track-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts"),n=r("./src/errors.ts"),a=r("./src/controller/base-playlist-controller.ts"),s=r("./src/types/loader.ts");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(t){var r;return(r=e.call(this,t,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}u(t,e);var r=t.prototype;return r.registerListeners=function(){var e=this.hls;e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(i.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(i.Events.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,e.prototype.destroy.call(this)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},r.onManifestParsed=function(e,t){this.tracks=t.audioTracks||[]},r.onAudioTrackLoaded=function(e,t){var r=t.id,i=t.details,n=this.tracksInGroup[r];if(n){var a=n.details;n.details=t.details,this.log("audioTrack "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,a))}else this.warn("Invalid audio track id "+r)},r.onLevelLoading=function(e,t){this.switchLevel(t.level)},r.onLevelSwitching=function(e,t){this.switchLevel(t.level)},r.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r;var n=this.tracks.filter((function(e){return!r||e.groupId===r}));this.selectDefaultTrack&&!n.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=n;var a={audioTracks:n};this.log("Updating audio tracks, "+n.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},r.onError=function(t,r){e.prototype.onError.call(this,t,r),!r.fatal&&r.context&&r.context.type===s.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},r.setAudioTrack=function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=t[this.trackId];this.log("Now switching to audio-track index "+e);var n=t[e],a=n.id,s=n.groupId,o=void 0===s?"":s,l=n.name,u=n.type,c=n.url;if(this.trackId=e,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(i.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:o,name:l,type:u,url:c}),!n.details||n.details.live){var d=this.switchParams(n.url,null==r?void 0:r.details);this.loadPlaylist(d)}}},r.selectInitialTrack=function(){var e=this.tracksInGroup;console.assert(e.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,r=this.findTrackId(t)||this.findTrackId();-1!==r?this.setAudioTrack(r):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},r.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1},r.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,n=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(i.Events.AUDIO_TRACK_LOADING,{url:a,id:r,groupId:n,deliveryDirectives:e||null})}},l(t,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}]),t}(a.default);t.default=d},"./src/controller/base-playlist-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var i=r("./src/polyfills/number.ts"),n=r("./src/types/level.ts"),a=r("./src/controller/level-helper.ts"),s=r("./src/utils/logger.ts"),o=r("./src/errors.ts"),l=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=s.logger.log.bind(s.logger,t+":"),this.warn=s.logger.warn.bind(s.logger,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.onError=function(e,t){t.fatal&&t.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var r=null==t?void 0:t.renditionReports;if(r)for(var a=0;a<r.length;a++){var s=r[a],o=""+s.URI;if(o===e.substr(-o.length)){var l=parseInt(s["LAST-MSN"]),u=parseInt(s["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);void 0!==u&&c>t.partTarget&&(u+=1)}if(Object(i.isFiniteNumber)(l))return new n.HlsUrlParameters(l,Object(i.isFiniteNumber)(u)?u:void 0,n.HlsSkip.No)}}},t.loadPlaylist=function(e){},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,r){var i=this,n=t.details,s=t.stats,o=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(n.advancedDateTime=Date.now()-o,n.live||null!=r&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+e+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),r&&n.fragments.length>0&&Object(a.mergeDetails)(r,n),!this.canLoad||!n.live)return;var l,u=void 0,c=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,h=n.lastPartSn,f=n.endSN,p=n.lastPartIndex,v=h===f;-1!==p?(u=v?f+1:h,c=v?d?0:p:p+1):u=f+1;var g=n.age,m=g+n.ageHeader,y=Math.min(m-n.partTarget,1.5*n.targetduration);if(y>0){if(r&&y>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+y+" with playlist age: "+n.age),y=0;else{var _=Math.floor(y/n.targetduration);u+=_,void 0!==c&&(c+=Math.round(y%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+y+" skip sn "+_+" to part "+c)}n.tuneInGoal=y}if(l=this.getDeliveryDirectives(n,t.deliveryDirectives,u,c),d||!v)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(n,t.deliveryDirectives,u,c);var T=Object(a.computeReloadInterval)(n,s);void 0!==u&&n.canBlockReload&&(T-=n.partTarget||1),this.log("reload live playlist "+e+" in "+Math.round(T)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(l)}),T)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,r,i){var a=Object(n.getSkipValue)(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,a=n.HlsSkip.No),new n.HlsUrlParameters(r,i,a)},t.retryLoadingOrFail=function(e){var t,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;if(n)if(this.retryCount++,e.details.indexOf("LoadTimeOut")>-1&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+e.details+'"')}else this.warn('cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0;return n},e}()},"./src/controller/base-stream-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"State",(function(){return k})),r.d(t,"default",(function(){return C}));var i=r("./src/polyfills/number.ts"),n=r("./src/task-loop.ts"),a=r("./src/controller/fragment-tracker.ts"),s=r("./src/utils/buffer-helper.ts"),o=r("./src/utils/logger.ts"),l=r("./src/events.ts"),u=r("./src/errors.ts"),c=r("./src/types/transmuxer.ts"),d=r("./src/utils/mp4-tools.ts"),h=r("./src/utils/discontinuities.ts"),f=r("./src/controller/fragment-finders.ts"),p=r("./src/controller/level-helper.ts"),v=r("./src/loader/fragment-loader.ts"),g=r("./src/crypt/decrypter.ts"),m=r("./src/utils/time-ranges.ts"),y=r("./src/types/loader.ts");function _(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function T(e,t,r){return t&&_(e.prototype,t),r&&_(e,r),e}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,S(e,t)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var k={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},C=function(e){function t(t,r,i){var n;return(n=e.call(this)||this).hls=void 0,n.fragPrevious=null,n.fragCurrent=null,n.fragmentTracker=void 0,n.transmuxer=null,n._state=k.STOPPED,n.media=void 0,n.mediaBuffer=void 0,n.config=void 0,n.bitrateTest=!1,n.lastCurrentTime=0,n.nextLoadPosition=0,n.startPosition=0,n.loadedmetadata=!1,n.fragLoadError=0,n.retryDate=0,n.levels=null,n.fragmentLoader=void 0,n.levelLastLoaded=null,n.startFragRequested=!1,n.decrypter=void 0,n.initPTS=[],n.onvseeking=null,n.onvended=null,n.logPrefix="",n.log=void 0,n.warn=void 0,n.logPrefix=i,n.log=o.logger.log.bind(o.logger,i+":"),n.warn=o.logger.warn.bind(o.logger,i+":"),n.hls=t,n.fragmentLoader=new v.default(t.config),n.fragmentTracker=r,n.config=t.config,n.decrypter=new g.default(t,t.config),t.on(l.Events.KEY_LOADED,n.onKeyLoaded,b(n)),n}E(t,e);var r=t.prototype;return r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(e){},r.stopLoad=function(){this.fragmentLoader.abort();var e=this.fragCurrent;e&&this.fragmentTracker.removeFragment(e),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=k.STOPPED},r._streamEnded=function(e,t){var r=this.fragCurrent,i=this.fragmentTracker;if(!t.live&&r&&r.sn>=t.endSN&&!e.nextStart){var n=t.partList;if(null!=n&&n.length){var o=n[n.length-1];return s.BufferHelper.isBuffered(this.media,o.start+o.duration/2)}var l=i.getState(r);return l===a.FragmentState.PARTIAL||l===a.FragmentState.OK}return!1},r.onMediaAttached=function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===k.STOPPED&&this.startLoad(i.startPosition)},r.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,r=this.media,n=this.mediaBuffer,a=this.state,o=r?r.currentTime:0,l=s.BufferHelper.bufferInfo(n||r,o,e.maxBufferHole);if(this.log("media seeking to "+(Object(i.isFiniteNumber)(o)?o.toFixed(3):o)+", state: "+a),a===k.ENDED)this.resetLoadingState();else if(t&&!l.len){var u=e.maxFragLookUpTolerance,c=t.start-u,d=o>t.start+t.duration+u;(o<c||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.resetLoadingState())}r&&(this.lastCurrentTime=o),!this.loadedmetadata&&!l.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onKeyLoaded=function(e,t){if(this.state===k.KEY_LOADING&&t.frag===this.fragCurrent&&this.levels){this.state=k.IDLE;var r=this.levels[t.frag.level].details;r&&this.loadFragment(t.frag,r,t.frag.start)}},r.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=k.STOPPED,this.hls.off(l.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},r.loadKey=function(e,t){this.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=k.KEY_LOADING,this.fragCurrent=e,this.hls.trigger(l.Events.KEY_LOADING,{frag:e})},r.loadFragment=function(e,t,r){this._loadFragForPlayback(e,t,r)},r._loadFragForPlayback=function(e,t,r){var i=this,n=function(t){if(i.fragContextChanged(e))return i.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void i.fragmentTracker.removeFragment(e);e.stats.chunkCount++,i._handleFragmentLoadProgress(t)};this._doFragLoad(e,t,r,n).then((function(t){if(t){i.fragLoadError=0;var r=i.state;if(i.fragContextChanged(e))return void((r===k.FRAG_LOADING||r===k.BACKTRACKING||!i.fragCurrent&&r===k.PARSING)&&(i.fragmentTracker.removeFragment(e),i.state=k.IDLE));if("payload"in t&&(i.log("Loaded fragment "+e.sn+" of level "+e.level),i.hls.trigger(l.Events.FRAG_LOADED,t),i.state===k.BACKTRACKING))return i.fragmentTracker.backtrack(e,t),void i.resetFragmentLoading(e);i._handleFragmentLoadComplete(t)}})).catch((function(t){i.warn(t),i.resetFragmentLoading(e)}))},r.flushMainBuffer=function(e,t,r){if(void 0===r&&(r=null),e-t){var i={startOffset:e,endOffset:t,type:r};this.fragLoadError=0,this.hls.trigger(l.Events.BUFFER_FLUSHING,i)}},r._loadInitSegment=function(e){var t=this;this._doFragLoad(e).then((function(r){if(!r||t.fragContextChanged(e)||!t.levels)throw new Error("init load aborted");return r})).then((function(r){var i=t.hls,n=r.payload,a=e.decryptdata;if(n&&n.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return t.decrypter.webCryptoDecrypt(new Uint8Array(n),a.key.buffer,a.iv.buffer).then((function(t){var n=self.performance.now();return i.trigger(l.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:s,tdecrypt:n}}),r.payload=t,r}))}return r})).then((function(r){var i=t.fragCurrent,n=t.hls,a=t.levels;if(!a)throw new Error("init load aborted, missing levels");var s=a[e.level].details;console.assert(s,"Level details are defined when init segment is loaded");var o=e.stats;t.state=k.IDLE,t.fragLoadError=0,e.data=new Uint8Array(r.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),r.frag===i&&n.trigger(l.Events.FRAG_BUFFERED,{stats:o,frag:i,part:null,id:e.type}),t.tick()})).catch((function(r){t.warn(r),t.resetFragmentLoading(e)}))},r.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},r.fragBufferedComplete=function(e,t){var r=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level+" "+m.default.toString(s.BufferHelper.getBuffered(r))),this.state=k.IDLE,this.tick()},r._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var r=e.frag,i=e.part,n=e.partsLoaded,a=!n||0===n.length||n.some((function(e){return!e})),s=new c.ChunkMetadata(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(s)}},r._handleFragmentLoadProgress=function(e){},r._doFragLoad=function(e,t,r,n){var a=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(e.start,r||0),this.config.lowLatencyMode&&t){var s=t.partList;if(s&&n){r>e.end&&t.fragmentHint&&(e=t.fragmentHint);var o=this.getNextPart(s,e,r);if(o>-1){var u=s[o];return this.log("Loading part sn: "+e.sn+" p: "+u.index+" cc: "+e.cc+" of playlist ["+t.startSN+"-"+t.endSN+"] parts [0-"+o+"-"+(s.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=k.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:e,part:s[o],targetBufferTime:r}),this.doFragPartsLoad(e,s,o,n).catch((function(e){return a.handleFragLoadError(e)}))}if(!e.url||this.loadedEndOfParts(s,r))return Promise.resolve(null)}}return this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(t?"of ["+t.startSN+"-"+t.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(r.toFixed(3))),Object(i.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=k.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragmentLoader.load(e,n).catch((function(e){return a.handleFragLoadError(e)}))},r.doFragPartsLoad=function(e,t,r,i){var n=this;return new Promise((function(a,s){var o=[];!function r(u){var c=t[u];n.fragmentLoader.loadPart(e,c,i).then((function(i){o[c.index]=i;var s=i.part;n.hls.trigger(l.Events.FRAG_LOADED,i);var d=t[u+1];if(!d||d.fragment!==e)return a({frag:e,part:s,partsLoaded:o});r(u+1)})).catch(s)}(r)}))},r.handleFragLoadError=function(e){var t=e.data;return t&&t.details===u.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(l.Events.ERROR,t),null},r._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===k.PARSING){var r=t.frag,i=t.part,n=t.level,a=self.performance.now();r.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(r,i,n,e.partial)}else this.fragCurrent||(this.state=k.IDLE)},r.getCurrentContext=function(e){var t=this.levels,r=e.level,i=e.sn,n=e.part;if(!t||!t[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;var a=t[r],s=n>-1?Object(p.getPartWith)(a,i,n):null,o=s?s.fragment:Object(p.getFragmentWithSN)(a,i,this.fragCurrent);return o?{frag:o,part:s,level:a}:null},r.bufferFragmentData=function(e,t,r,i){if(e&&this.state===k.PARSING){var n=e.data1,a=e.data2,s=n;if(n&&a&&(s=Object(d.appendUint8Array)(n,a)),s&&s.length){var o={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:s};this.hls.trigger(l.Events.BUFFER_APPENDING,o),e.dropped&&e.independent&&!r&&this.flushBufferGap(t)}}},r.flushBufferGap=function(e){var t=this.media;if(t){if(!s.BufferHelper.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);var r=t.currentTime,i=s.BufferHelper.bufferInfo(t,r,0),n=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(e.start-a,i.end-a),r+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}},r.getFwdBufferInfo=function(e,t){var r=this.config,n=this.getLoadPosition();if(!Object(i.isFiniteNumber)(n))return null;var a=s.BufferHelper.bufferInfo(e,n,r.maxBufferHole);if(0===a.len&&void 0!==a.nextStart){var o=this.fragmentTracker.getBufferedFrag(n,t);if(o&&a.nextStart<o.end)return s.BufferHelper.bufferInfo(e,n,Math.max(a.nextStart,r.maxBufferHole))}return a},r.getMaxBufferLength=function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)},r.reduceMaxBufferLength=function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},r.getNextFragment=function(e,t){var r,i,n=t.fragments,a=n.length;if(!a)return null;var s,o=this.config,l=n[0].start;if(t.live){var u=o.initialLiveManifestSize;if(a<u)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+u+")"),null;!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(s=this.getInitialLiveFragment(t,n),this.startPosition=s?this.hls.liveSyncPosition||s.start:e)}else e<=l&&(s=n[0]);if(!s){var c=o.lowLatencyMode?t.partEnd:t.fragmentEnd;s=this.getFragmentAtPosition(e,c,t)}return null!==(r=s)&&void 0!==r&&r.initSegment&&!(null!==(i=s)&&void 0!==i&&i.initSegment.data)&&!this.bitrateTest&&(s=s.initSegment),s},r.getNextPart=function(e,t,r){for(var i=-1,n=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,i>-1&&r<l.start)break;var u=l.loaded;!u&&(n||l.independent||a)&&l.fragment===t&&(i=s),n=u}return i},r.loadedEndOfParts=function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded},r.getInitialLiveFragment=function(e,t){var r=this.fragPrevious,i=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),i=Object(f.findFragmentByPDT)(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){var a=t[n-e.startSN];r.cc===a.cc&&(i=a,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=Object(f.findFragWithCC)(t,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn)}}else{var s=this.hls.liveSyncPosition;null!==s&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i},r.getFragmentAtPosition=function(e,t,r){var i,n=this.config,s=this.fragPrevious,o=r.fragments,l=r.endSN,u=r.fragmentHint,c=n.maxFragLookUpTolerance,d=!!(n.lowLatencyMode&&r.partList&&u);if(d&&u&&!this.bitrateTest&&(o=o.concat(u),l=u.sn),e<t){var h=e>t-c?0:c;i=Object(f.findFragmentByPTS)(s,o,e,h)}else i=o[o.length-1];if(i){var p=i.sn-r.startSN,v=s&&i.level===s.level,g=o[p+1];if(this.fragmentTracker.getState(i)===a.FragmentState.BACKTRACKED){i=null;for(var m=p;o[m]&&this.fragmentTracker.getState(o[m])===a.FragmentState.BACKTRACKED;)i=s?o[m--]:o[--m];i||(i=g)}else s&&i.sn===s.sn&&!d&&v&&(i.sn<l&&this.fragmentTracker.getState(g)!==a.FragmentState.OK?(this.log("SN "+i.sn+" just loaded, load next one: "+g.sn),i=g):i=null)}return i},r.synchronizeToLiveEdge=function(e){var t=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,a=e.fragments[0].start,s=e.edge,o=n>=a-t.maxFragLookUpTolerance&&n<=s;if(null!==i&&r.duration>i&&(n<i||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||n<s-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+i.toFixed(3)),r.currentTime=i))}}},r.alignPlaylists=function(e,t){var r=this.levels,n=this.levelLastLoaded,a=this.fragPrevious,s=null!==n?r[n]:null,o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=e.fragments[0].start,u=!t,c=e.alignedSliding&&Object(i.isFiniteNumber)(l);if(u||!c&&!l){Object(h.alignStream)(a,s,e);var d=e.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(a?a.sn:"na")+" fragments: "+o),d}return l},r.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},r.setStartPosition=function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=e.startTimeOffset;Object(i.isFiniteNumber)(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset "+n+" found in playlist, adjust startPosition to "+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},r.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},r.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part"+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},r.resetFragmentLoading=function(e){(!this.fragCurrent||!this.fragContextChanged(e))&&(this.state=k.IDLE)},r.onFragmentOrKeyLoadError=function(e,t){if(!t.fatal){var r=t.frag;if(r&&r.type===e){var i=this.fragCurrent;console.assert(i&&r.sn===i.sn&&r.level===i.level&&r.urlId===i.urlId,"Frag load error must match current frag to retry");var n=this.config;if(this.fragLoadError+1<=n.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(r.level))return;var a=Math.min(Math.pow(2,this.fragLoadError)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);this.warn("Fragment "+r.sn+" of "+e+" "+r.level+" failed to load, retrying in "+a+"ms"),this.retryDate=self.performance.now()+a,this.fragLoadError++,this.state=k.FRAG_LOADING_WAITING_RETRY}else t.levelRetry?(e===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=k.IDLE):(o.logger.error(t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.hls.stopLoad(),this.state=k.ERROR)}}},r.afterBufferFlushed=function(e,t,r){if(e){var i=s.BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===k.ENDED&&this.resetLoadingState()}},r.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE},r.resetLiveStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;if(null!=t&&t.live)return this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},r.updateLevelTiming=function(e,t,r,i){var n=this,a=r.details;console.assert(!!a,"level.details must be defined"),Object.keys(e.elementaryStreams).reduce((function(t,s){var o=e.elementaryStreams[s];if(o){var u=o.endPTS-o.startPTS;if(u<=0)return n.warn("Could not parse fragment "+e.sn+" "+s+" duration reliably ("+u+") resetting transmuxer to fallback to playlist timing"),n.resetTransmuxer(),t||!1;var c=i?0:Object(p.updateFragPTSDTS)(a,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return n.hls.trigger(l.Events.LEVEL_PTS_UPDATED,{details:a,level:r,drift:c,type:s,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1)?(this.state=k.PARSED,this.hls.trigger(l.Events.FRAG_PARSED,{frag:e,part:t})):this.resetLoadingState()},r.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},T(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}]),t}(n.default)},"./src/controller/buffer-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return f}));var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),a=r("./src/utils/logger.ts"),s=r("./src/errors.ts"),o=r("./src/utils/buffer-helper.ts"),l=r("./src/utils/mediasource-helper.ts"),u=r("./src/loader/fragment.ts"),c=r("./src/controller/buffer-operation-queue.ts"),d=Object(l.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.hls,r=t.media,i=t.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),r&&(t.updateMediaElementDuration(),e.trigger(n.Events.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null},t.registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.BUFFER_RESET,this.onBufferReset,this),e.on(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(n.Events.BUFFER_EOS,this.onBufferEos,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(n.Events.FRAG_PARSED,this.onFragParsed,this),e.on(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.BUFFER_RESET,this.onBufferReset,this),e.off(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(n.Events.BUFFER_EOS,this.onBufferEos,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(n.Events.FRAG_PARSED,this.onFragParsed,this),e.off(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},t.onManifestParsed=function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&d){var i=this.mediaSource=new d;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(a.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(i){a.logger.warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(n.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(i){a.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",i)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(i){var n=r.tracks[e];if(n&&"function"==typeof n.buffer.changeType){var a=t[e],s=a.codec,o=a.levelCodec,l=a.container;if((n.levelCodec||n.codec).replace(h,"$1")!==(o||s).replace(h,"$1")){var u=l+";codecs="+(o||s);r.appendChangeType(e,u)}}}else r.pendingTracks[e]=t[e]})),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[e];n&&(a.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),n.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){a.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};i.append(n,e)},t.onBufferAppending=function(e,t){var r=this,i=this.hls,l=this.operationQueue,u=this.tracks,c=t.data,d=t.type,h=t.frag,f=t.part,p=t.chunkMeta,v=p.buffering[d],g=self.performance.now();v.start=g;var m=h.stats.buffering,y=f?f.stats.buffering:null;0===m.start&&(m.start=g),y&&0===y.start&&(y.start=g);var _=u.audio,T="audio"===d&&1===p.id&&"audio/mpeg"===(null==_?void 0:_.container),b={execute:function(){if(v.executeStart=self.performance.now(),T){var e=r.sourceBuffer[d];if(e){var t=h.start-e.timestampOffset;Math.abs(t)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+t+") sn: "+h.sn+")"),e.timestampOffset=h.start)}}r.appendExecutor(c,d)},onStart:function(){},onComplete:function(){var e=self.performance.now();v.executeEnd=v.end=e,0===m.first&&(m.first=e),y&&0===y.first&&(y.first=e);var t=r.sourceBuffer,i={};for(var a in t)i[a]=o.BufferHelper.getBuffered(t[a]);r.appendError=0,r.hls.trigger(n.Events.BUFFER_APPENDED,{type:d,frag:h,part:f,chunkMeta:p,parent:h.type,timeRanges:i})},onError:function(e){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+d+" SourceBuffer",e);var t={type:s.ErrorTypes.MEDIA_ERROR,parent:h.type,details:s.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=s.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,t.details=s.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),i.trigger(n.Events.ERROR,t)}};l.append(b,d)},t.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,s=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(n.Events.BUFFER_FLUSHED,{type:e})},onError:function(t){a.logger.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?i.append(s(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){i.append(s(e),e)}))},t.onFragParsed=function(e,t){var r=this,i=t.frag,s=t.part,o=[],l=s?s.elementaryStreams:i.elementaryStreams;l[u.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(l[u.ElementaryStreamTypes.AUDIO]&&o.push("audio"),l[u.ElementaryStreamTypes.VIDEO]&&o.push("video"));var c=function(){var e=self.performance.now();i.stats.buffering.end=e,s&&(s.stats.buffering.end=e);var t=s?s.stats:i.stats;r.hls.trigger(n.Events.FRAG_BUFFERED,{frag:i,part:s,stats:t,id:i.type})};0===o.length&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(c,o)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,i){var n=r.sourceBuffer[i];return(!t.type||t.type===i)&&n&&!n.ended&&(n.ended=!0,a.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS")),e&&!(n&&!n.ended)}),!0)&&this.blockBuffers((function(){var e=r.mediaSource;!e||"open"!==e.readyState||e.endOfStream()}))},t.onLevelUpdated=function(e,t){var r=t.details;!r.fragments.length||(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,a=this.sourceBuffer;if(r&&null!==t){var s=this.getSourceBufferTypes();if(s.length){var l=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(i.isFiniteNumber)(l)&&!(l<0)){var u=r.currentTime,c=t.levelTargetDuration,d=Math.max(l,c),h=Math.floor(u/c)*c-d;s.forEach((function(r){var i=a[r];if(i){var s=o.BufferHelper.getBuffered(i);s.length>0&&h>s.start(0)&&(e.trigger(n.Events.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live&&e.trigger(n.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),e.trigger(n.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:r}))}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,n=this.mediaSource,s=e.fragments[0].start+e.totalduration,o=r.duration,l=Object(i.isFiniteNumber)(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(s>l&&s>o||!Object(i.isFiniteNumber)(o))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),n.duration=s)}},t.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!==t&&void 0!==t&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),n=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,n)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||2===i){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(0===a.length)return void this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach((function(e){t.executeNext(e)}))}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i=0;for(var o in e)if(!t[o]){var l=e[o];if(!l)throw Error("source buffer exists for track "+o+", however track does not");var u=l.levelCodec||l.codec,c=l.container+";codecs="+u;a.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var d=t[o]=r.addSourceBuffer(c),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:d,codec:u,container:l.container,levelCodec:l.levelCodec,id:l.id},i++}catch(f){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+f.message),this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,mimeType:c})}}i&&this.hls.trigger(n.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){a.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(t)},t.removeExecutor=function(e,t,r){var n=this.media,s=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[e];if(!n||!s||!l)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var u=Object(i.isFiniteNumber)(n.duration)?n.duration:1/0,c=Object(i.isFiniteNumber)(s.duration)?s.duration:1/0,d=Math.max(0,t),h=Math.min(r,u,c);h>d?(a.logger.log("[buffer-controller]: Removing ["+d+","+h+"] from the "+e+" SourceBuffer"),console.assert(!l.updating,e+" sourceBuffer must not be updating"),l.remove(d,h)):o.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return a.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,console.assert(!i.updating,t+" sourceBuffer must not be updating"),i.appendBuffer(e)},t.blockBuffers=function(e,t){var r=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var i=this.operationQueue,n=t.map((function(e){return i.appendBlocker(e)}));Promise.all(n).then((function(){e(),t.forEach((function(e){var t=r.sourceBuffer[e];(!t||!t.updating)&&i.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];!t||this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}()},"./src/controller/buffer-operation-queue.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return n}));var i=r("./src/utils/logger.ts"),n=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,r=new Promise((function(e){t=e})),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},t.executeNext=function(e){var t=this.buffers,r=this.queues,n=t[e],a=r[e];if(a.length){var s=a[0];try{s.execute()}catch(o){i.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(o),(!n||!n.updating)&&(a.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var s=function(){function e(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var e=this.hls;e.on(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var e=this.hls;e.off(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(t,r){e.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},t.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null},t.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.getMaxLevel=function(t){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(i,n){return e.isLevelAllowed(n,r.restrictedLevels)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},e.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},e.getMaxLevelByMediaSize=function(e,t,r){if(!e||!e.length)return-1;for(var i=function(e,t){return!t||e.width!==t.width||e.height!==t.height},n=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=r)&&i(s,e[a+1])){n=a;break}}return n},a(e,[{key:"mediaWidth",get:function(){return this.getDimensions().width*e.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*e.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=self.devicePixelRatio}catch(t){}return e}}]),e}();t.default=s},"./src/controller/cmcd-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return f}));var i=r("./src/events.ts"),n=r("./src/types/cmcd.ts"),a=r("./src/utils/buffer-helper.ts"),s=r("./src/utils/logger.ts");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function h(){return h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},h.apply(this,arguments)}var f=function(){function e(t){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:n.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(t){s.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(e){try{var t=e.frag,i=r.hls.levels[t.level],a=r.getObjectType(t),o={d:1e3*t.duration,ot:a};(a===n.CMCDObjectType.VIDEO||a===n.CMCDObjectType.AUDIO||a==n.CMCDObjectType.MUXED)&&(o.br=i.bitrate/1e3,o.tb=r.getTopBandwidth(a)/1e3,o.bl=r.getBufferLength(a)),r.apply(e,o)}catch(l){s.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=t;var i=this.config=t.config,a=i.cmcd;null!=a&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||e.uuid(),this.cid=a.contentId,this.useHeaders=!0===a.useHeaders,this.registerListeners())}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(i.Events.BUFFER_CREATED,this.onBufferCreated,this)},t.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(i.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},t.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},t.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},t.onBufferCreated=function(e,t){var r,i;this.audioBuffer=null===(r=t.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(i=t.tracks.video)||void 0===i?void 0:i.buffer},t.createData=function(){var e;return{v:n.CMCDVersion,sf:n.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(e=this.media)||void 0===e?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},t.apply=function(t,r){void 0===r&&(r={}),h(r,this.createData());var i=r.ot===n.CMCDObjectType.INIT||r.ot===n.CMCDObjectType.VIDEO||r.ot===n.CMCDObjectType.MUXED;if(this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var a=e.toHeaders(r);if(!Object.keys(a).length)return;t.headers||(t.headers={}),h(t.headers,a)}else{var s=e.toQuery(r);if(!s)return;t.url=e.appendQueryToUri(t.url,s)}},t.getObjectType=function(e){var t=e.type;return"subtitle"===t?n.CMCDObjectType.TIMED_TEXT:"initSegment"===e.sn?n.CMCDObjectType.INIT:"audio"===t?n.CMCDObjectType.AUDIO:"main"===t?this.hls.audioTracks.length?n.CMCDObjectType.VIDEO:n.CMCDObjectType.MUXED:void 0},t.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===n.CMCDObjectType.AUDIO)t=i.audioTracks;else{var a=i.maxAutoLevel,s=a>-1?a+1:i.levels.length;t=i.levels.slice(0,s)}for(var o,l=u(t);!(o=l()).done;){var c=o.value;c.bitrate>r&&(r=c.bitrate)}return r>0?r:NaN},t.getBufferLength=function(e){var t=this.hls.media,r=e===n.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*a.BufferHelper.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},t.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var i=e.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(e,r,i){t(e),this.loader.load(e,r,i)},l(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},t.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function e(e){this.loader=void 0,this.loader=new r(e)}var i=e.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(e,r,i){t(e),this.loader.load(e,r,i)},l(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),e}()},e.uuid=function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.substr(t.lastIndexOf("/")+1)},e.serialize=function(e){for(var t,r=[],i=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},n=function(e){return Math.round(e)},a=function(e){return 100*n(e/100)},s={br:n,d:n,bl:a,dl:a,mtp:a,nor:function(e){return encodeURIComponent(e)},rtp:a,tb:n},o=u(Object.keys(e||{}).sort());!(t=o()).done;){var l=t.value,c=e[l];if(i(c)&&("v"!==l||1!==c)&&("pr"!=l||1!==c)){var d=s[l];d&&(c=d(c));var h=typeof c,f=void 0;f="ot"===l||"sf"===l||"st"===l?l+"="+c:"boolean"===h?l:"number"===h?l+"="+c:l+"="+JSON.stringify(c),r.push(f)}}return r.join(",")},e.toHeaders=function(t){for(var r={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,o=Object.keys(t);s<o.length;s++){var l=o[s];n[null!=a[l]?a[l]:1][l]=t[l]}for(var u=0;u<n.length;u++){var c=e.serialize(n[u]);c&&(r["CMCD-"+i[u]]=c)}return r},e.toQuery=function(t){return"CMCD="+encodeURIComponent(e.serialize(t))},e.appendQueryToUri=function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return""+e+r+t},e}()},"./src/controller/eme-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts"),n=r("./src/errors.ts"),a=r("./src/utils/logger.ts"),s=r("./src/utils/mediakeys-helper.ts");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var u=3,c=function(e,t,r){var i={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:r.audioRobustness||""})})),t.forEach((function(e){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:r.videoRobustness||""})})),[i]},d=function(e,t,r,i){if(e===s.KeySystems.WIDEVINE)return c(t,r,i);throw new Error("Unknown key-system: "+e)},h=function(){function e(e){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=e,this._config=e.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},t._registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t._unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this)},t.getLicenseServerUrl=function(e){switch(e){case s.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},t._attemptKeySystemAccess=function(e,t,r){var i=this,n=d(e,t,r,this._drmSystemOptions);a.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(e,n);this.mediaKeysPromise=s.then((function(t){return i._onMediaKeySystemAccessObtained(e,t)})),s.catch((function(t){a.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},t._onMediaKeySystemAccessObtained=function(e,t){var r=this;a.logger.log('Access for key-system "'+e+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(i);var n=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return i.mediaKeys=t,a.logger.log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated(),t}));return n.catch((function(e){a.logger.error("Failed to create media-keys:",e)})),n},t._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},t._onNewMediaKeySession=function(e){var t=this;a.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(r){t._onKeySessionMessage(e,r.message)}),!1)},t._onKeySessionMessage=function(e,t){a.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){a.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),e.update(t)}))},t.onMediaEncrypted=function(e){var t=this;if(a.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!this.mediaKeysPromise)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var r=function(r){!t._media||(t._attemptSetMediaKeys(r),t._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};this.mediaKeysPromise.then(r).catch(r)},t._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});a.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},t._generateRequestWithPreferredKeySession=function(e,t){var r=this,s=this._mediaKeysList[0];if(!s)return a.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(!s.mediaKeysSessionInitialized){var o=s.mediaKeysSession;return o?t?(a.logger.log('Generating key-session request for "'+e+'" init data type'),s.mediaKeysSessionInitialized=!0,void o.generateRequest(e,t).then((function(){a.logger.debug("Key-session generation succeeded")})).catch((function(e){a.logger.error("Error generating key-session request:",e),r.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))):(a.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(a.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}a.logger.warn("Key-Session already initialized but requested again")},t._createLicenseXhr=function(e,t,r){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,e,t,r);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,i,e),n=void 0}catch(s){a.logger.error(s)}try{i.readyState||i.open("POST",e,!0),n&&n.call(this.hls,i,e)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return i},t._onLicenseRequestReadyStageChange=function(e,t,r,s){if(4===e.readyState)if(200===e.status){this._requestLicenseFailureCount=0,a.logger.log("License request succeeded");var o=e.response,l=this._licenseResponseCallback;if(l)try{o=l.call(this.hls,e,t)}catch(d){a.logger.error(d)}s(o)}else{if(a.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u)return void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var c=u-this._requestLicenseFailureCount+1;a.logger.warn("Retrying license request, "+c+" attempts left"),this._requestLicense(r,s)}},t._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===s.KeySystems.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},t._requestLicense=function(e,t){a.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return a.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var s=this.getLicenseServerUrl(r.mediaKeySystemDomain),o=this._createLicenseXhr(s,e,t);a.logger.log("Sending license request to URL: "+s);var l=this._generateLicenseRequestChallenge(r,e);o.send(l)}catch(u){a.logger.error("Failure requesting DRM license: "+u),this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},t.onMediaAttached=function(e,t){if(this._emeEnabled){var r=t.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},t.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;!e||(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},t.onManifestParsed=function(e,t){if(this._emeEnabled){var r=t.levels.map((function(e){return e.audioCodec})).filter((function(e){return!!e})),i=t.levels.map((function(e){return e.videoCodec})).filter((function(e){return!!e}));this._attemptKeySystemAccess(s.KeySystems.WIDEVINE,r,i)}},l(e,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),e}();t.default=h},"./src/controller/fps-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts"),n=r("./src/utils/logger.ts"),a=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,r){var a=performance.now();if(t){if(this.lastTime){var s=a-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/s,c=this.hls;if(c.trigger(i.Events.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>c.config.fpsDroppedMonitoringThreshold*l){var d=c.currentLevel;n.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=d)&&(d-=1,c.trigger(i.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}();t.default=a},"./src/controller/fragment-finders.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"findFragmentByPDT",(function(){return a})),r.d(t,"findFragmentByPTS",(function(){return s})),r.d(t,"fragmentWithinToleranceTest",(function(){return o})),r.d(t,"pdtWithinToleranceTest",(function(){return l})),r.d(t,"findFragWithCC",(function(){return u}));var i=r("./src/polyfills/number.ts"),n=r("./src/utils/binary-search.ts");function a(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(i.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var n=0;n<e.length;++n){var a=e[n];if(l(t,r,a))return a}return null}function s(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var a=null;return e?a=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(a=t[0]),a&&0===o(r,i,a)?a:n.default.search(t,o.bind(null,r,i))||a}function o(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);var i=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=e?1:r.start-i>e&&r.start?-1:0}function l(e,t,r){var i=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>e}function u(e,t){return n.default.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}},"./src/controller/fragment-tracker.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"FragmentState",(function(){return i})),r.d(t,"FragmentTracker",(function(){return o}));var i,n,a=r("./src/events.ts"),s=r("./src/types/loader.ts");(n=i||(i={})).NOT_LOADED="NOT_LOADED",n.BACKTRACKED="BACKTRACKED",n.APPENDING="APPENDING",n.PARTIAL="PARTIAL",n.OK="OK";var o=function(){function e(e){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){if(t===s.PlaylistLevelType.MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var a=i[n],o=a?a.end:r.appendedPTS;if(a.start<=e&&void 0!==o&&e<=o)return n>9&&(this.activeParts=i.slice(n-9)),a}else if(r.start<=e&&void 0!==r.appendedPTS&&e<=r.appendedPTS)return r}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var a=r[i[n]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,r){var i=this;Object.keys(this.fragments).forEach((function(n){var a=i.fragments[n];if(a){if(!a.buffered)return void(a.body.type===r&&i.removeFragment(a.body));var s=a.range[e];!s||s.time.some((function(e){var r=!i.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&i.removeFragment(a.body),r}))}}))},t.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,n=e.part;if(r&&"initSegment"!==i.sn){var a=u(i),s=this.fragments[a];!s||(Object.keys(r).forEach((function(e){var a=i.elementaryStreams[e];if(a){var o=r[e],l=null!==n||!0===a.partial;s.range[e]=t.getBufferedTimes(i,n,l,o)}})),s.backtrack=s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},t.fragBuffered=function(e){var t=u(e),r=this.fragments[t];r&&(r.backtrack=r.loaded=null,r.buffered=!0)},t.getBufferedTimes=function(e,t,r,i){for(var n={time:[],partial:r},a=t?t.start:e.start,s=t?t.end:e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=0;u<i.length;u++){var c=i.start(u)-this.bufferPadding,d=i.end(u)+this.bufferPadding;if(l>=c&&o<=d){n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});break}if(a<d&&s>c)n.partial=!0,n.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(s,i.end(u))});else if(s<=c)break}return n},t.getPartialFragment=function(e){var t,r,i,n=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(u){var c=o[u];!c||l(c)&&(r=c.body.start-s,i=c.body.end+s,e>=r&&e<=i&&(t=Math.min(e-r,i-e),a<=t&&(n=c.body,a=t)))})),n},t.getState=function(e){var t=u(e),r=this.fragments[t];return r?r.buffered?l(r)?i.PARTIAL:i.OK:r.backtrack?i.BACKTRACKED:i.APPENDING:i.NOT_LOADED},t.backtrack=function(e,t){var r=u(e),i=this.fragments[r];if(!i||i.backtrack)return null;var n=i.backtrack=t||i.loaded;return i.loaded=null,n},t.getBacktrackData=function(e){var t=u(e),r=this.fragments[t];if(r){var i,n=r.backtrack;if(null!=n&&null!==(i=n.payload)&&void 0!==i&&i.byteLength)return n;this.removeFragment(e)}return null},t.isTimeBuffered=function(e,t,r){for(var i,n,a=0;a<r.length;a++){if(i=r.start(a)-this.bufferPadding,n=r.end(a)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1},t.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if("initSegment"!==r.sn&&!r.bitrateTest&&!i){var n=u(r);this.fragments[n]={body:r,loaded:t,backtrack:null,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var r=this,i=t.frag,n=t.part,a=t.timeRanges;if(i.type===s.PlaylistLevelType.MAIN)if(this.activeFragment=i,n){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(n)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];if(r.detectEvictedFragments(e,t),!n)for(var s=0;s<t.length;s++)i.appendedPTS=Math.max(t.end(s),i.appendedPTS||0)}))},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=u(e);return!!this.fragments[t]},t.removeFragmentsInRange=function(e,t,r){var i=this;Object.keys(this.fragments).forEach((function(n){var a=i.fragments[n];if(a&&a.buffered){var s=a.body;s.type===r&&s.start<t&&s.end>e&&i.removeFragment(s)}}))},t.removeFragment=function(e){var t=u(e);e.stats.loaded=0,e.clearElementaryStreamInfo(),delete this.fragments[t]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},e}();function l(e){var t,r;return e.buffered&&((null===(t=e.range.video)||void 0===t?void 0:t.partial)||(null===(r=e.range.audio)||void 0===r?void 0:r.partial))}function u(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"STALL_MINIMUM_DURATION_MS",(function(){return o})),r.d(t,"MAX_START_GAP_JUMP",(function(){return l})),r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return u})),r.d(t,"SKIP_BUFFER_RANGE_START",(function(){return c})),r.d(t,"default",(function(){return d}));var i=r("./src/utils/buffer-helper.ts"),n=r("./src/errors.ts"),a=r("./src/events.ts"),s=r("./src/utils/logger.ts"),o=250,l=2,u=.1,c=.05,d=function(){function e(e,t,r,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var t=e.prototype;return t.destroy=function(){this.hls=this.fragmentTracker=this.media=null},t.poll=function(e){var t=this.config,r=this.media,n=this.stalled,a=r.currentTime,u=r.seeking,c=this.seeking&&!u,d=!this.seeking&&u;if(this.seeking=u,a===e){if((d||c)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&i.BufferHelper.getBuffered(r).length){var h=i.BufferHelper.bufferInfo(r,a,0),f=h.len>0,p=h.nextStart||0;if(f||p){if(u){var v=h.len>l,g=!p||p-a>l&&!this.fragmentTracker.getPartialFragment(a);if(v||g)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var m,y=Math.max(p,h.start||0)-a,_=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=(null==_||null===(m=_.details)||void 0===m?void 0:m.live)?2*_.details.targetduration:l;if(y>0&&y<=T)return void this._trySkipBufferHole(null)}var b=self.performance.now();if(null===n)return void(this.stalled=b);var E=b-n;!u&&E>=o&&this._reportStall(h.len);var S=i.BufferHelper.bufferInfo(r,a,t.maxBufferHole);this._tryFixBufferStall(S,E)}}}else if(this.moved=!0,null!==n){if(this.stallReported){var k=self.performance.now()-n;s.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(k)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media.currentTime,a=i.getPartialFragment(n);a&&this._trySkipBufferHole(a)||e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(s.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,s.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,o=this.media,l=o.currentTime,d=0,h=i.BufferHelper.getBuffered(o),f=0;f<h.length;f++){var p=h.start(f);if(l+t.maxBufferHole>=d&&l<p){var v=Math.max(p+c,o.currentTime+u);return s.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+v),this.moved=!0,this.stalled=null,o.currentTime=v,e&&r.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+v,frag:e}),v}d=h.end(f)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=r.currentTime,o=(this.nudgeRetry||0)+1;if(this.nudgeRetry=o,o<e.nudgeMaxRetry){var l=i+o*e.nudgeOffset;s.logger.warn("Nudging 'currentTime' from "+i+" to "+l),r.currentTime=l,t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else s.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}()},"./src/controller/id3-track-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts"),n=r("./src/utils/texttrack-utils.ts"),a=r("./src/demux/id3.ts"),s=.25,o=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners()},t._registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){!this.id3Track||(Object(n.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Object(n.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var r=t.frag,i=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,o=0;o<i.length;o++){var l=a.getID3Frames(i[o].data);if(l){var u=i[o].pts,c=o<i.length-1?i[o+1].pts:r.end;c-u<=0&&(c=u+s);for(var d=0;d<l.length;d++){var h=l[d];if(!a.isTimeStampFrame(h)){var f=new n(u,c,"");f.value=h,this.id3Track.addCue(f)}}}}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,a=t.type;if(!a||"audio"===a){var s=this.id3Track;s&&Object(n.removeCuesInRange)(s,r,i)}},e}();t.default=o},"./src/controller/latency-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return l}));var i=r("./src/errors.ts"),n=r("./src/events.ts"),a=r("./src/utils/logger.ts");function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),e}var l=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(n.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(n.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(n.Events.ERROR,this.onError)},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(e,t){t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,a=i.maxLiveSyncPlaybackRate;if(n&&1!==a){var s=this.targetLatency;if(null!==s){var o=r-s,l=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&l&&o>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,a)),c=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,c))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},t.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},o(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,a=n.liveSyncDuration,s=n.liveSyncDurationCount,o=n.lowLatencyMode,l=this.hls.userConfig,u=o&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:s*i);var c=i,d=1;return u+Math.min(this.stallCount*d,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var i=r.edge,n=e-t-this.edgeStalled,a=i-r.totalduration,s=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,n),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return r?e.buffered.end(r-1):t.edge-this.currentTime}}]),e}()},"./src/controller/level-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return g}));var i=r("./src/types/level.ts"),n=r("./src/events.ts"),a=r("./src/errors.ts"),s=r("./src/utils/codecs.ts"),o=r("./src/controller/level-helper.ts"),l=r("./src/controller/base-playlist-controller.ts"),u=r("./src/types/loader.ts");function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},c.apply(this,arguments)}function d(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}function f(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),g=function(e){function t(t){var r;return(r=e.call(this,t,"[level-controller]")||this)._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}f(t,e);var r=t.prototype;return r._registerListeners=function(){var e=this.hls;e.on(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(n.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var e=this.hls;e.off(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(n.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},r.startLoad=function(){this._levels.forEach((function(e){e.loadError=0})),e.prototype.startLoad.call(this)},r.onManifestLoaded=function(e,t){var r,l,u=[],c=[],d=[],h={},f=!1,p=!1,g=!1;if(t.levels.forEach((function(e){var t=e.attrs;f=f||!(!e.width||!e.height),p=p||!!e.videoCodec,g=g||!!e.audioCodec,v&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0);var r=e.bitrate+"-"+e.attrs.RESOLUTION+"-"+e.attrs.CODECS;(l=h[r])?l.url.push(e.url):(l=new i.Level(e),h[r]=l,u.push(l)),t&&(t.AUDIO&&Object(o.addGroupId)(l,"audio",t.AUDIO),t.SUBTITLES&&Object(o.addGroupId)(l,"text",t.SUBTITLES))})),(f||p)&&g&&(u=u.filter((function(e){var t=e.videoCodec,r=e.width,i=e.height;return!!t||!(!r||!i)}))),u=u.filter((function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||Object(s.isCodecSupportedInMp4)(t,"audio"))&&(!r||Object(s.isCodecSupportedInMp4)(r,"video"))})),t.audioTracks&&(c=t.audioTracks.filter((function(e){return!e.audioCodec||Object(s.isCodecSupportedInMp4)(e.audioCodec,"audio")})),Object(o.assignTrackIdsByGroup)(c)),t.subtitles&&(d=t.subtitles,Object(o.assignTrackIdsByGroup)(d)),u.length>0){r=u[0].bitrate,u.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=u;for(var m=0;m<u.length;m++)if(u[m].bitrate===r){this._firstLevel=m,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+r);break}var y=g&&!p,_={levels:u,audioTracks:c,subtitleTracks:d,firstLevel:this._firstLevel,stats:t.stats,audio:g,video:p,altAudio:!y&&c.some((function(e){return!!e.url}))};this.hls.trigger(n.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(t,r){if(e.prototype.onError.call(this,t,r),!r.fatal){var i=r.context,n=this._levels[this.currentLevelIndex];if(i&&(i.type===u.PlaylistContextType.AUDIO_TRACK&&n.audioGroupIds&&i.groupId===n.audioGroupIds[n.urlId]||i.type===u.PlaylistContextType.SUBTITLE_TRACK&&n.textGroupIds&&i.groupId===n.textGroupIds[n.urlId]))return void this.redundantFailover(this.currentLevelIndex);var s,o=!1,l=!0;switch(r.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var c=this._levels[r.frag.level];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(s=r.frag.level)):s=r.frag.level}break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:i&&(i.deliveryDirectives&&(l=!1),s=i.level),o=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:s=r.level,o=!0}void 0!==s&&this.recoverLevel(r,s,o,l)}},r.recoverLevel=function(e,t,r,i){var n=e.details,a=this._levels[t];if(a.loadError++,r){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}if(i){var s=a.url.length;if(s>1&&a.loadError<s)e.levelRetry=!0,this.redundantFailover(t);else if(-1===this.manualLevelIndex){var o=0===t?this._levels.length-1:t-1;this.currentLevelIndex!==o&&0===this._levels[o].loadError&&(this.warn(n+": switch to "+o),e.levelRetry=!0,this.hls.nextAutoLevel=o)}}},r.redundantFailover=function(e){var t=this._levels[e],r=t.url.length;if(r>1){var i=(t.urlId+1)%r;this.warn("Switching to redundant URL-id "+i),this._levels.forEach((function(e){e.urlId=i})),this.level=e}},r.onFragLoaded=function(e,t){var r=t.frag;if(void 0!==r&&r.type===u.PlaylistLevelType.MAIN){var i=this._levels[r.level];void 0!==i&&(i.fragmentError=0,i.loadError=0)}},r.onLevelLoaded=function(e,t){var r,i,n=t.level,a=t.details,s=this._levels[n];if(!s)return this.warn("Invalid level index "+n),void(null!==(i=t.deliveryDirectives)&&void 0!==i&&i.skip&&(a.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(n,t,s.details)):null!==(r=t.deliveryDirectives)&&void 0!==r&&r.skip&&(a.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(e,t){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[t.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===n){i=a;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},r.loadPlaylist=function(e){var t=this.currentLevelIndex,r=this._levels[t];if(this.canLoad&&r&&r.url.length>0){var i=r.urlId,a=r.url[i];if(e)try{a=e.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+i+" "+a),this.clearTimer(),this.hls.trigger(n.Events.LEVEL_LOADING,{url:a,level:t,id:i,deliveryDirectives:e||null})}},r.removeLevel=function(e,t){var r=function(e,r){return r!==t},i=this._levels.filter((function(i,n){return n!==e||i.url.length>1&&void 0!==t&&(i.url=i.url.filter(r),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(r)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(r)),i.urlId=0,!0)})).map((function(e,t){var r=e.details;return null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t})),e}));this._levels=i,this.hls.trigger(n.Events.LEVELS_UPDATED,{levels:i})},h(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==e||null===(t=r[e])||void 0===t||!t.details)){if(e<0||e>=r.length){var i=e<0;if(this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:i,reason:"invalid level idx"}),i)return;e=Math.min(e,r.length-1)}this.clearTimer();var s=this.currentLevelIndex,o=r[s],l=r[e];this.log("switching to level "+e+" from "+s),this.currentLevelIndex=e;var u=c({},l,{level:e,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete u._urlId,this.hls.trigger(n.Events.LEVEL_SWITCHING,u);var d=l.details;if(!d||d.live){var h=this.switchParams(l.uri,null==o?void 0:o.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(l.default)},"./src/controller/level-helper.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"addGroupId",(function(){return a})),r.d(t,"assignTrackIdsByGroup",(function(){return s})),r.d(t,"updatePTS",(function(){return o})),r.d(t,"updateFragPTSDTS",(function(){return u})),r.d(t,"mergeDetails",(function(){return c})),r.d(t,"mapPartIntersection",(function(){return d})),r.d(t,"mapFragmentIntersection",(function(){return h})),r.d(t,"adjustSliding",(function(){return f})),r.d(t,"addSliding",(function(){return p})),r.d(t,"computeReloadInterval",(function(){return v})),r.d(t,"getFragmentWithSN",(function(){return g})),r.d(t,"getPartWith",(function(){return m}));var i=r("./src/polyfills/number.ts"),n=r("./src/utils/logger.ts");function a(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function s(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}function o(e,t,r){l(e[t],e[r])}function l(e,t){var r=t.startPTS;if(Object(i.isFiniteNumber)(r)){var n,a=0;t.sn>e.sn?(a=r-e.start,n=e):(a=e.start-r,n=t),n.duration!==a&&(n.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function u(e,t,r,a,s,o){a-r<=0&&(n.logger.warn("Fragment should have a positive duration",t),a=r+t.duration,o=s+t.duration);var u=r,c=a,d=t.startPTS,h=t.endPTS;if(Object(i.isFiniteNumber)(d)){var f=Math.abs(d-r);Object(i.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(f,t.deltaPTS):t.deltaPTS=f,u=Math.max(r,d),r=Math.min(r,d),s=Math.min(s,t.startDTS),c=Math.min(a,h),a=Math.max(a,h),o=Math.max(o,t.endDTS)}t.duration=a-r;var p=r-t.start;t.appendedPTS=a,t.start=t.startPTS=r,t.maxStartPTS=u,t.startDTS=s,t.endPTS=a,t.minEndPTS=c,t.endDTS=o;var v=t.sn;if(!e||v<e.startSN||v>e.endSN)return 0;var g,m=v-e.startSN,y=e.fragments;for(y[m]=t,g=m;g>0;g--)l(y[g],y[g-1]);for(g=m;g<y.length-1;g++)l(y[g],y[g+1]);return e.fragmentHint&&l(y[y.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,p}function c(e,t){for(var r=null,a=e.fragments,s=a.length-1;s>=0;s--){var o=a[s].initSegment;if(o){r=o;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var l,c=0;if(h(e,t,(function(e,n){e.relurl&&(c=e.cc-n.cc),Object(i.isFiniteNumber)(e.startPTS)&&Object(i.isFiniteNumber)(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.appendedPTS=e.appendedPTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(l=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,n.urlId=e.urlId,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;(!e.initSegment||e.initSegment.relurl===(null===(t=r)||void 0===t?void 0:t.relurl))&&(e.initSegment=r)})),t.skippedSegments&&(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed)){n.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=t.skippedSegments;p--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}var v=t.fragments;if(c){n.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<v.length;g++)v[g].cc+=c}t.skippedSegments&&(t.startCC=t.fragments[0].cc),d(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),l?u(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):f(e,t),v.length&&(t.totalduration=t.edge-v[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var m=t.advancedDateTime;if(t.advanced&&m){var y=t.edge;t.driftStart||(t.driftStartTime=m,t.driftStart=y),t.driftEndTime=m,t.driftEnd=y}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function d(e,t,r){if(e&&t)for(var i=0,n=0,a=e.length;n<=a;n++){var s=e[n],o=t[n+i];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?r(s,o):i--}}function h(e,t,r){for(var i=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=n;u<=a;u++){var c=l[s+u],d=o[u];i&&!d&&u<i&&(d=t.fragments[u]=c),c&&d&&r(c,d)}}function f(e,t){var r=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;r<0||r>=i.length||p(t,i[r].start)}function p(e,t){if(t){for(var r=e.fragments,i=e.skippedSegments;i<r.length;i++)r[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function v(e,t){var r,i=1e3*e.levelTargetDuration,n=i/2,a=e.age,s=a>0&&a<3*i,o=t.loading.end-t.loading.start,l=e.availabilityDelay;if(!1===e.updated)if(s){var u=333*e.misses;r=Math.max(Math.min(n,2*o),u),e.availabilityDelay=(e.availabilityDelay||0)+r}else r=n;else s?(l=Math.min(l||i/2,a),e.availabilityDelay=l,r=l+i-a):r=i-o;return Math.round(r)}function g(e,t,r){if(!e||!e.details)return null;var i=e.details,n=i.fragments[t-i.startSN];return n||(n=i.fragmentHint)&&n.sn===t?n:t<i.startSN&&r&&r.sn===t?r:null}function m(e,t,r){if(!e||!e.details)return null;var i=e.details.partList;if(i)for(var n=i.length;n--;){var a=i[n];if(a.index===r&&a.fragment.sn===t)return a}return null}},"./src/controller/stream-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));var i=r("./src/polyfills/number.ts"),n=r("./src/controller/base-stream-controller.ts"),a=r("./src/is-supported.ts"),s=r("./src/events.ts"),o=r("./src/utils/buffer-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),u=r("./src/types/loader.ts"),c=r("./src/loader/fragment.ts"),d=r("./src/demux/transmuxer-interface.ts"),h=r("./src/types/transmuxer.ts"),f=r("./src/controller/gap-controller.ts"),p=r("./src/errors.ts"),v=r("./src/utils/logger.ts");function g(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),e}function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=100,b=function(e){function t(t,r){var i;return(i=e.call(this,t,r,"[stream-controller]")||this).audioCodecSwap=!1,i.gapController=null,i.level=-1,i._forceStartLoad=!1,i.altAudio=!1,i.audioOnly=!1,i.fragPlaying=null,i.onvplaying=null,i.onvseeked=null,i.fragLastKbps=0,i.stalled=!1,i.couldBacktrack=!1,i.audioCodecSwitch=!1,i.videoBuffer=null,i._registerListeners(),i}y(t,e);var r=t.prototype;return r._registerListeners=function(){var e=this.hls;e.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(s.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(s.Events.ERROR,this.onError,this),e.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var e=this.hls;e.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(s.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(s.Events.ERROR,this.onError,this),e.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(s.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(s.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(T),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=n.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=n.State.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case n.State.IDLE:this.doTickIdle();break;case n.State.WAITING_LEVEL:var e,t=this.levels,r=this.level,i=null==t||null===(e=t[r])||void 0===e?void 0:e.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=n.State.IDLE;break}break;case n.State.FRAG_LOADING_WAITING_RETRY:var a,s=self.performance.now(),o=this.retryDate;(!o||s>=o||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=n.State.IDLE)}this.onTickEnd()},r.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var e,t,r=this.hls,i=this.levelLastLoaded,a=this.levels,o=this.media,d=r.config,h=r.nextLoadLevel;if(null!==i&&(o||!this.startFragRequested&&d.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&a&&a[h]){var f=a[h];this.level=r.nextLoadLevel=h;var p=f.details;if(!p||this.state===n.State.WAITING_LEVEL||p.live&&this.levelLastLoaded!==h)return void(this.state=n.State.WAITING_LEVEL);var v=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:o,u.PlaylistLevelType.MAIN);if(null!==v&&!(v.len>=this.getMaxBufferLength(f.maxBitrate))){if(this._streamEnded(v,p)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(s.Events.BUFFER_EOS,g),void(this.state=n.State.ENDED)}var m=v.end,y=this.getNextFragment(m,p);if(this.couldBacktrack&&!this.fragPrevious&&y&&"initSegment"!==y.sn){var _=y.sn-p.startSN;_>1&&(y=p.fragments[_-1],this.fragmentTracker.removeFragment(y))}if(y&&this.fragmentTracker.getState(y)===l.FragmentState.OK&&this.nextLoadPosition>m){var T=this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(o,T,u.PlaylistLevelType.MAIN),y=this.getNextFragment(this.nextLoadPosition,p)}!y||(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),"identity"!==(null===(e=y.decryptdata)||void 0===e?void 0:e.keyFormat)||null!==(t=y.decryptdata)&&void 0!==t&&t.key?this.loadFragment(y,p,m):this.loadKey(y,p))}}},r.loadFragment=function(t,r,i){var n,a=this.fragmentTracker.getState(t);if(this.fragCurrent=t,a===l.FragmentState.BACKTRACKED){var s=this.fragmentTracker.getBacktrackData(t);if(s)return this._handleFragmentLoadProgress(s),void this._handleFragmentLoadComplete(s);a=l.FragmentState.NOT_LOADED}a===l.FragmentState.NOT_LOADED||a===l.FragmentState.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t):this.bitrateTest?(t.bitrateTest=!0,this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,r,i)):a===l.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(e){var t=this.fragmentTracker.getAppendedFrag(e,u.PlaylistLevelType.MAIN);return t&&"fragment"in t?t.fragment:t},r.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,u.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,i=this.getAppendedFrag(t.currentTime);if(i&&i.start>1&&this.flushMainBuffer(0,i.start-1),!t.paused&&e){var n=e[this.hls.nextLoadLevel],a=this.fragLastKbps;r=a&&this.fragCurrent?this.fragCurrent.duration*n.maxBitrate/(1e3*a)+1:0}else r=0;var s=this.getBufferedFrag(t.currentTime+r);if(s){var o=this.followingBufferedFrag(s);if(o){this.abortCurrentFrag();var l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(s.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,.5*u),.75*u));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var e=this.fragCurrent;this.fragCurrent=null,null!=e&&e.loader&&e.loader.abort(),this.state===n.State.KEY_LOADING&&(this.state=n.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(t,r){e.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},r.onMediaAttached=function(t,r){e.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new f.default(this.config,i,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var t=this.media;t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;Object(i.isFiniteNumber)(t)&&this.log("Media seeked to "+t.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(s.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},r.onManifestParsed=function(e,t){var r,i=!1,n=!1;t.levels.forEach((function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},r.onLevelLoading=function(e,t){var r=this.levels;if(r&&this.state===n.State.IDLE){var i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(i.details))&&(this.state=n.State.WAITING_LEVEL)}},r.onLevelLoaded=function(e,t){var r,i=this.levels,a=t.level,o=t.details,l=o.totalduration;if(i){this.log("Level "+a+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+l);var u=this.fragCurrent;u&&(this.state===n.State.FRAG_LOADING||this.state===n.State.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&(this.state=n.State.IDLE,u.loader.abort());var c=i[a],d=0;if(o.live||null!==(r=c.details)&&void 0!==r&&r.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,c.details)}if(c.details=o,this.levelLastLoaded=a,this.hls.trigger(s.Events.LEVEL_UPDATED,{details:o,level:a}),this.state===n.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=n.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,d),this.tick()}else this.warn("Levels were reset while loading level "+a)},r._handleFragmentLoadProgress=function(e){var t,r=e.frag,i=e.part,n=e.payload,a=this.levels;if(a){var s=a[r.level],o=s.details;if(o){var l=s.videoCodec,c=o.PTSKnown||!o.live,f=null===(t=r.initSegment)||void 0===t?void 0:t.data,p=this._getAudioCodec(s),v=this.transmuxer=this.transmuxer||new d.default(this.hls,u.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=i?i.index:-1,m=-1!==g,y=new h.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,n.byteLength,g,m),_=this.initPTS[r.cc];v.push(n,f,p,l,r,i,o.totalduration,c,y,_)}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},r.onAudioTrackSwitching=function(e,t){var r=this.altAudio,i=!!t.url,n=t.id;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;null!=a&&a.loader&&(this.log("Switching to main audio track, cancel main fragment load"),a.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&o.trigger(s.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:n})}},r.onAudioTrackSwitched=function(e,t){var r=t.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},r.onBufferCreated=function(e,t){var r,i,n=t.tracks,a=!1;for(var s in n){var o=n[s];if("main"===o.id){if(i=s,r=o,"video"===s){var l=n[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(e,t){var r=t.frag,i=t.part;if(!r||r.type===u.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===n.State.PARSED&&(this.state=n.State.IDLE));var a=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},r.onError=function(e,t){switch(t.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.MAIN,t);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==n.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=n.State.ERROR):!t.levelRetry&&this.state===n.State.WAITING_LEVEL&&(this.state=n.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===t.parent&&(this.state===n.State.PARSING||this.state===n.State.PARSED)){var r=!0,i=this.getFwdBufferInfo(this.media,u.PlaylistLevelType.MAIN);i&&i.len>.5&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},r.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){var r=o.BufferHelper.getBuffered(e);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):t.poll(this.lastCurrentTime),this.lastCurrentTime=e.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=n.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(e,t){var r=t.type;if(r!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var i=(r===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,u.PlaylistLevelType.MAIN)}},r.onLevelsUpdated=function(e,t){this.levels=t.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var e=this.media,t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void v.logger.log("could not seek to "+r+", already seeking at "+t);var i=o.BufferHelper.getBuffered(e),n=(i.length?i.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(v.logger.log("adjusting start position by "+n+" to match buffer start"),r+=n,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+t),e.currentTime=r}},r._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},r._loadBitrateTestFrag=function(e){var t=this;this._doFragLoad(e).then((function(r){var i=t.hls;if(r&&!i.nextLoadLevel&&!t.fragContextChanged(e)){t.fragLoadError=0,t.state=n.State.IDLE,t.startFragRequested=!1,t.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(s.Events.FRAG_LOADED,r)}}))},r._handleTransmuxComplete=function(e){var t,r="main",a=this.hls,o=e.remuxResult,l=e.chunkMeta,u=this.getCurrentContext(l);if(!u)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(l.level);var d=u.frag,h=u.part,f=u.level,p=o.video,v=o.text,g=o.id3,m=o.initSegment,y=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(d)){if(this.state=n.State.PARSING,m){m.tracks&&(this._bufferInitSegment(f,m.tracks,d,l),a.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:d,id:r,tracks:m.tracks}));var _=m.initPTS,T=m.timescale;Object(i.isFiniteNumber)(_)&&(this.initPTS[d.cc]=_,a.trigger(s.Events.INIT_PTS_FOUND,{frag:d,id:r,initPTS:_,timescale:T}))}if(p&&!1!==o.independent){if(f.details){var b=p.startPTS,E=p.endPTS,S=p.startDTS,k=p.endDTS;if(h)h.elementaryStreams[p.type]={startPTS:b,endPTS:E,startDTS:S,endDTS:k};else if(p.firstKeyFrame&&p.independent&&(this.couldBacktrack=!0),p.dropped&&p.independent){if(this.getLoadPosition()+this.config.maxBufferHole<b)return void this.backtrack(d);d.setElementaryStreamInfo(p.type,d.start,E,d.start,k,!0)}d.setElementaryStreamInfo(p.type,b,E,S,k),this.bufferFragmentData(p,d,h,l)}}else if(!1===o.independent)return void this.backtrack(d);if(y){var C=y.startPTS,w=y.endPTS,A=y.startDTS,L=y.endDTS;h&&(h.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:C,endPTS:w,startDTS:A,endDTS:L}),d.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,C,w,A,L),this.bufferFragmentData(y,d,h,l)}if(null!=g&&null!==(t=g.samples)&&void 0!==t&&t.length){var x={frag:d,id:r,samples:g.samples};a.trigger(s.Events.FRAG_PARSING_METADATA,x)}if(v){var D={frag:d,id:r,samples:v.samples};a.trigger(s.Events.FRAG_PARSING_USERDATA,D)}}},r._bufferInitSegment=function(e,t,r,i){var a=this;if(this.state===n.State.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var o=t.audio,l=t.video,u=t.audiovideo;if(o){var c=e.audioCodec,d=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===d.indexOf("firefox")&&(c="mp4a.40.5")),-1!==d.indexOf("android")&&"audio/mpeg"!==o.container&&(c="mp4a.40.2",this.log("Android: force audio codec to "+c)),e.audioCodec&&e.audioCodec!==c&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+c+'"'),o.levelCodec=c,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(e.audioCodec||"")+"/"+o.codec+"]")}l&&(l.levelCodec=e.videoCodec,l.id="main",this.log("Init video buffer, container:"+l.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+l.codec+"]")),u&&this.log("Init audiovideo buffer, container:"+u.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+u.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var n=t[e].initSegment;null!=n&&n.byteLength&&a.hls.trigger(s.Events.BUFFER_APPENDING,{type:e,data:n,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}},r.backtrack=function(e){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(e);var t=this.fragmentTracker.backtrack(e);this.fragPrevious=null,this.nextLoadPosition=e.start,t?this.resetFragmentLoading(e):this.state=n.State.BACKTRACKING},r.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(o.BufferHelper.isBuffered(e,r)?t=this.getAppendedFrag(r):o.BufferHelper.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){var i=this.fragPlaying,n=t.level;(!i||t.sn!==i.sn||i.level!==n||t.urlId!==i.urlId)&&(this.hls.trigger(s.Events.FRAG_CHANGED,{frag:t}),(!i||i.level!==n)&&this.hls.trigger(s.Events.LEVEL_SWITCHED,{level:n}),this.fragPlaying=t)}}},m(t,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;if(e){var t=this.getAppendedFrag(e.currentTime);return this.followingBufferedFrag(t)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(n.default)},"./src/controller/subtitle-stream-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"SubtitleStreamController",(function(){return m}));var i=r("./src/events.ts"),n=r("./src/utils/buffer-helper.ts"),a=r("./src/controller/fragment-finders.ts"),s=r("./src/utils/discontinuities.ts"),o=r("./src/controller/level-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),u=r("./src/controller/base-stream-controller.ts"),c=r("./src/types/loader.ts"),d=r("./src/types/level.ts");function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=500,m=function(e){function t(t,r){var i;return(i=e.call(this,t,r,"[subtitle-stream-controller]")||this).levels=[],i.currentTrackId=-1,i.tracksBuffered=[],i.mainDetails=null,i._registerListeners(),i}p(t,e);var r=t.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(i.Events.ERROR,this.onError,this),e.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(i.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(i.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},r._unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(i.Events.ERROR,this.onError,this),e.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(i.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(i.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},r.startLoad=function(){this.stopLoad(),this.state=u.State.IDLE,this.setInterval(g),this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},r.onLevelLoaded=function(e,t){this.mainDetails=t.details},r.onSubtitleFragProcessed=function(e,t){var r=t.frag,i=t.success;if(this.fragPrevious=r,this.state=u.State.IDLE,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var a,s=r.start,o=0;o<n.length;o++)if(s>=n[o].start&&s<=n[o].end){a=n[o];break}var l=r.start+r.duration;a?a.end=l:(a={start:s,end:l},n.push(a)),this.fragmentTracker.fragBuffered(r)}}},r.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset;if(0===r&&i!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,a=this.levels;if(!a.length||!a[n]||!a[n].details)return;var s=i-a[n].details.targetduration;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=s)e.shift();else{if(!(e[t].start<s))break;e[t].start=s,t++}})),this.fragmentTracker.removeFragmentsInRange(r,s,c.PlaylistLevelType.SUBTITLE)}},r.onError=function(e,t){var r,i=t.frag;!i||i.type!==c.PlaylistLevelType.SUBTITLE||(null!==(r=this.fragCurrent)&&void 0!==r&&r.loader&&this.fragCurrent.loader.abort(),this.state=u.State.IDLE)},r.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks;this.tracksBuffered=[],this.levels=i.map((function(e){return new d.Level(e)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(e){r.tracksBuffered[e.id]=[]})),this.mediaBuffer=null},r.onSubtitleTrackSwitch=function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(g)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(e,t){var r,i=t.details,n=t.id,l=this.currentTrackId,c=this.levels;if(c.length){var d=c[l];if(!(n>=c.length||n!==l)&&d){if(this.mediaBuffer=this.mediaBufferTimeRanges,i.live||null!==(r=d.details)&&void 0!==r&&r.live){var h=this.mainDetails;if(i.deltaUpdateFailed||!h)return;var f=h.fragments[0];d.details?0===this.alignPlaylists(i,d.details)&&f&&Object(o.addSliding)(i,f.start):i.hasProgramDateTime&&h.hasProgramDateTime?Object(s.alignMediaPlaylistByPDT)(i,h):f&&Object(o.addSliding)(i,f.start)}d.details=i,this.levelLastLoaded=n,this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===u.State.IDLE&&(Object(a.findFragmentByPTS)(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}}},r._handleFragmentLoadComplete=function(e){var t=e.frag,r=e.payload,n=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&n&&n.key&&n.iv&&"AES-128"===n.method){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer).then((function(e){var r=performance.now();a.trigger(i.Events.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:s,tdecrypt:r}})}))}},r.doTick=function(){if(this.media){if(this.state===u.State.IDLE){var e,t=this.currentTrackId,r=this.levels;if(!r.length||!r[t]||!r[t].details)return;var i=r[t].details,s=i.targetduration,o=this.config,c=this.media,d=n.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,c.currentTime-s,o.maxBufferHole),h=d.end;if(d.len>this.getMaxBufferLength()+s)return;console.assert(i,"Subtitle track details are defined on idle subtitle stream controller tick");var f,p=i.fragments,v=p.length,g=i.edge,m=this.fragPrevious;if(h<g){var y=o.maxFragLookUpTolerance;!(f=Object(a.findFragmentByPTS)(m,p,h,y))&&m&&m.start<p[0].start&&(f=p[0])}else f=p[v-1];null!==(e=f)&&void 0!==e&&e.encrypted?this.loadKey(f,i):f&&this.fragmentTracker.getState(f)===l.FragmentState.NOT_LOADED&&this.loadFragment(f,i,h)}}else this.state=u.State.IDLE},r.loadFragment=function(t,r,i){this.fragCurrent=t,e.prototype.loadFragment.call(this,t,r,i)},f(t,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),t}(u.default)},"./src/controller/subtitle-track-controller.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/events.ts"),n=r("./src/utils/texttrack-utils.ts"),a=r("./src/controller/base-playlist-controller.ts"),s=r("./src/types/loader.ts");function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(t){var r;return(r=e.call(this,t,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r.subtitleDisplay=!0,r.registerListeners(),r}u(t,e);var r=t.prototype;return r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,e.prototype.destroy.call(this)},r.registerListeners=function(){var e=this.hls;e.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(i.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){var e=this.hls;e.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(i.Events.ERROR,this.onError,this)},r.onMediaAttached=function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},r.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},r.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),h(this.media.textTracks).forEach((function(e){Object(n.clearCurrentCues)(e)})),this.subtitleTrack=-1,this.media=null)},r.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},r.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},r.onSubtitleTrackLoaded=function(e,t){var r=t.id,i=t.details,n=this.trackId,a=this.tracksInGroup[n];if(a){var s=a.details;a.details=t.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,t,s))}else this.warn("Invalid subtitle track id "+r)},r.onLevelLoading=function(e,t){this.switchLevel(t.level)},r.onLevelSwitching=function(e,t){this.switchLevel(t.level)},r.switchLevel=function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var r=t.textGroupIds[t.urlId];if(this.groupId!==r){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter((function(e){return!r||e.groupId===r}));this.tracksInGroup=a;var s=this.findTrackId(null==n?void 0:n.name)||this.findTrackId();this.groupId=r;var o={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i.Events.SUBTITLE_TRACKS_UPDATED,o),-1!==s&&this.setSubtitleTrack(s,n)}}},r.findTrackId=function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var i=t[r];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1},r.onError=function(t,r){e.prototype.onError.call(this,t,r),!r.fatal&&r.context&&r.context.type===s.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},r.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var r=t.id,n=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADING,{url:a,id:r,groupId:n,deliveryDirectives:e||null})}},r.toggleTrackModes=function(e){var t=this,r=this.media,i=this.subtitleDisplay,n=this.trackId;if(r){var a=h(r.textTracks),s=a.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(a).forEach((function(e){e.mode="disabled"}));else{var o=s[n];o&&(o.mode="disabled")}var l=s[e];l&&(l.mode=i?"showing":"hidden")}},r.setSubtitleTrack=function(e,t){var r,n=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!==(r=n[e])&&void 0!==r&&r.details)||e<-1||e>=n.length)){this.clearTimer();var a=n[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,a){var s=a.id,o=a.groupId,l=void 0===o?"":o,u=a.name,c=a.type,d=a.url;this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:s,groupId:l,name:u,type:c,url:d});var h=this.switchParams(a.url,null==t?void 0:t.details);this.loadPlaylist(h)}else this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},r.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=h(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},l(t,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),t}(a.default);function h(e){for(var t=[],r=0;r<e.length;r++){var i=e[r];"subtitles"===i.kind&&i.label&&t.push(e[r])}return t}t.default=d},"./src/controller/timeline-controller.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"TimelineController",(function(){return h}));var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),a=r("./src/utils/cea-608-parser.ts"),s=r("./src/utils/output-filter.ts"),o=r("./src/utils/webvtt-parser.ts"),l=r("./src/utils/texttrack-utils.ts"),u=r("./src/utils/imsc1-ttml-parser.ts"),c=r("./src/types/loader.ts"),d=r("./src/utils/logger.ts"),h=function(){function e(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var t=new s.default(this,"textTrack1"),r=new s.default(this,"textTrack2"),i=new s.default(this,"textTrack3"),o=new s.default(this,"textTrack4");this.cea608Parser1=new a.default(1,t,r),this.cea608Parser2=new a.default(3,i,o)}e.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(n.Events.FRAG_LOADING,this.onFragLoading,this),e.on(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(n.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(n.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(n.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(n.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(n.Events.FRAG_LOADING,this.onFragLoading,this),e.off(n.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(n.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(n.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(n.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(n.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(e,t,r,i,a){for(var s=!1,o=a.length;o--;){var l=a[o],u=p(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),s=!0,u/(r-t)>.5))return}if(s||a.push([t,r]),this.config.renderTextTracksNatively){var c=this.captionsTracks[e];this.Cues.newCue(c,t,r,i)}else{var d=this.Cues.newCue(null,t,r,i);this.hls.trigger(n.Events.CUES_PARSED,{type:"captions",cues:d,track:e})}},t.onInitPtsFound=function(e,t){var r=this,i=t.frag,a=t.id,s=t.initPTS,o=t.timescale,l=this.unparsedVttFrags;"main"===a&&(this.initPTS[i.cc]=s,this.timescale[i.cc]=o),l.length&&(this.unparsedVttFrags=[],l.forEach((function(e){r.onFragLoaded(n.Events.FRAG_LOADED,e)})))},t.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r];if(i[e])return i}return null},t.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},t.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,n=t[e],a=n.label,s=n.languageCode,o=this.getExistingTrack(e);if(o)r[e]=o,Object(l.clearCurrentCues)(r[e]),Object(l.sendAddTrackEvent)(r[e],i);else{var u=this.createTextTrack("captions",a,s);u&&(u[e]=!0,r[e]=u)}}},t.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(n.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},t.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},t.onMediaAttaching=function(e,t){this.media=t.media,this._cleanTracks()},t.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Object(l.clearCurrentCues)(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=v(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Object(l.clearCurrentCues)(t[r])}},t.onSubtitleTracksUpdated=function(e,t){var r=this;this.textTracks=[];var i=t.subtitleTracks||[],a=i.some((function(e){return e.textCodec===u.IMSC1_CODEC}));if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var s=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,t){var i;if(t<o.length){for(var n=null,a=0;a<o.length;a++)if(f(o[a],e)){n=o[a];break}n&&(i=n)}i?Object(l.clearCurrentCues)(i):(i=r.createTextTrack("subtitles",e.name,e.lang))&&(i.mode="disabled"),i&&(i.groupId=e.groupId,r.textTracks.push(i))}))}else if(!s&&this.tracks&&this.tracks.length){var c=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(n.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},t.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var i="textTrack"+t[1],n=r.captionsProperties[i];!n||(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)}}))},t.onFragLoading=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn,a=this.lastPartIndex;if(this.enabled&&r&&i&&t.frag.type===c.PlaylistLevelType.MAIN){var s,o,l=t.frag.sn,u=null!=(s=null==t||null===(o=t.part)||void 0===o?void 0:o.index)?s:-1;l===n+1||l===n&&u===a+1||(r.reset(),i.reset()),this.lastSn=l,this.lastPartIndex=u}},t.onFragLoaded=function(e,t){var r=t.frag,a=t.payload,s=this.initPTS,o=this.unparsedVttFrags;if(r.type===c.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!Object(i.isFiniteNumber)(s[r.cc]))return o.push(t),void(s.length&&this.hls.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata,d="stats"in t;if(null==l||null==l.key||"AES-128"!==l.method||d){var h=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===u.IMSC1_CODEC?this._parseIMSC1(r,a):this._parseVTTs(r,a,f)}}else this.hls.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(e,t){var r=this,i=this.hls;Object(u.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(t){r._appendCues(t,e.level),i.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){d.logger.log("Failed to parse IMSC1: "+t),i.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))},t._parseVTTs=function(e,t,r){var i=this,a=this.hls;Object(o.parseWebVTT)(t,this.initPTS[e.cc],this.timescale[e.cc],r,e.cc,e.start,(function(t){i._appendCues(t,e.level),a.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(r){i._fallbackToIMSC1(e,t),d.logger.log("Failed to parse VTT cue: "+r),a.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})}))},t._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Object(u.parseIMSC1)(t,this.initPTS[e.cc],this.timescale[e.cc],(function(){i.textCodec=u.IMSC1_CODEC,r._parseIMSC1(e,t)}),(function(){i.textCodec="wvtt"}))},t._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if("disabled"===i.mode)return;e.forEach((function(e){return Object(l.addCueToTrack)(i,e)}))}else{var a=this.tracks[t].default?"default":"subtitles"+t;r.trigger(n.Events.CUES_PARSED,{type:"subtitles",cues:e,track:a})}},t.onFragDecrypted=function(e,t){var r=t.frag;if(r.type===c.PlaylistLevelType.SUBTITLE){if(!Object(i.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(t);this.onFragLoaded(n.Events.FRAG_LOADED,t)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(e,t){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i)for(var n=0;n<t.samples.length;n++){var a=t.samples[n].bytes;if(a){var s=this.extractCea608Data(a);r.addData(t.samples[n].pts,s[0]),i.addData(t.samples[n].pts,s[1])}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.endOffsetSubtitles,a=t.type,s=this.media;if(s&&!(s.currentTime<i)){if(!a||"video"===a){var o=this.captionsTracks;Object.keys(o).forEach((function(e){return Object(l.removeCuesInRange)(o[e],r,i)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){var u=this.textTracks;Object.keys(u).forEach((function(e){return Object(l.removeCuesInRange)(u[e],r,n)}))}}},t.extractCea608Data=function(e){for(var t=31&e[0],r=2,i=[[],[]],n=0;n<t;n++){var a=e[r++],s=127&e[r++],o=127&e[r++],l=3&a;0===s&&0===o||0!=(4&a)&&(0===l||1===l)&&(i[l].push(s),i[l].push(o))}return i},e}();function f(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function p(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}function v(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"removePadding",(function(){return n})),r.d(t,"default",(function(){return a}));var i=r("./src/utils/typed-array.ts");function n(e){var t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?Object(i.sliceUint8)(e,0,t-r):e}var a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},t.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],a=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256),f=0,p=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var m=h[f],y=h[m],_=h[y],T=257*h[g]^16843008*g;i[f]=T<<24|T>>>8,n[f]=T<<16|T>>>16,a[f]=T<<8|T>>>24,s[f]=T,T=16843009*_^65537*y^257*m^16843008*f,l[g]=T<<24|T>>>8,u[g]=T<<16|T>>>16,c[g]=T<<8|T>>>24,d[g]=T,f?(f=m^h[h[h[_^m]]],p^=h[h[p]]):f=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var a,s,o,l,u=this.ksRows=4*(n+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),h=this.sBox,f=this.rcon,p=this.invSubMix,v=p[0],g=p[1],m=p[2],y=p[3];for(a=0;a<u;a++)a<n?o=c[a]=t[a]:(l=o,a%n==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[a/n|0]<<24):n>6&&a%n==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),c[a]=o=(c[a-n]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?c[a]:c[a-4],d[s]=s<4||a<=4?l:v[h[l>>>24]]^g[h[l>>>16&255]]^m[h[l>>>8&255]]^y[h[255&l]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r){for(var i,n,a,s,o,l,u,c,d,h,f,p,v,g,m=this.keySize+6,y=this.invKeySchedule,_=this.invSBox,T=this.invSubMix,b=T[0],E=T[1],S=T[2],k=T[3],C=this.uint8ArrayToUint32Array_(r),w=C[0],A=C[1],L=C[2],x=C[3],D=new Int32Array(e),R=new Int32Array(D.length),I=this.networkToHostOrderSwap;t<D.length;){for(d=I(D[t]),h=I(D[t+1]),f=I(D[t+2]),p=I(D[t+3]),o=d^y[0],l=p^y[1],u=f^y[2],c=h^y[3],v=4,g=1;g<m;g++)i=b[o>>>24]^E[l>>16&255]^S[u>>8&255]^k[255&c]^y[v],n=b[l>>>24]^E[u>>16&255]^S[c>>8&255]^k[255&o]^y[v+1],a=b[u>>>24]^E[c>>16&255]^S[o>>8&255]^k[255&l]^y[v+2],s=b[c>>>24]^E[o>>16&255]^S[l>>8&255]^k[255&u]^y[v+3],o=i,l=n,u=a,c=s,v+=4;i=_[o>>>24]<<24^_[l>>16&255]<<16^_[u>>8&255]<<8^_[255&c]^y[v],n=_[l>>>24]<<24^_[u>>16&255]<<16^_[c>>8&255]<<8^_[255&o]^y[v+1],a=_[u>>>24]<<24^_[c>>16&255]<<16^_[o>>8&255]<<8^_[255&l]^y[v+2],s=_[c>>>24]<<24^_[o>>16&255]<<16^_[l>>8&255]<<8^_[255&u]^y[v+3],R[t]=I(i^w),R[t+1]=I(s^A),R[t+2]=I(a^L),R[t+3]=I(n^x),w=d,A=h,L=f,x=p,t+=4}return R.buffer},e}()},"./src/crypt/decrypter.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));var i=r("./src/crypt/aes-crypto.ts"),n=r("./src/crypt/fast-aes-key.ts"),a=r("./src/crypt/aes-decryptor.ts"),s=r("./src/utils/logger.ts"),o=r("./src/utils/mp4-tools.ts"),l=r("./src/utils/typed-array.ts"),u=16,c=function(){function e(e,t,r){var i=(void 0===r?{}:r).removePKCS7Padding,n=void 0===i||i;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=e,this.config=t,this.removePKCS7Padding=n,n)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(s){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var t=e.prototype;return t.destroy=function(){this.observer=null},t.isSync=function(){return this.config.enableSoftwareAES},t.flush=function(){var e=this.currentResult;if(e){var t=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Object(a.removePadding)(t):t}this.reset()},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,r,i){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,r);var n=this.flush();n&&i(n.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,r).then(i)},t.softwareDecrypt=function(e,t,r){var i=this.currentIV,n=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(e=Object(o.appendUint8Array)(s,e),this.remainderData=null);var u=this.getValidChunk(e);if(!u.length)return null;i&&(r=i);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new a.default),c.expandKey(t);var d=n;return this.currentResult=c.decrypt(u.buffer,0,r),this.currentIV=Object(l.sliceUint8)(u,-16).buffer,d||null},t.webCryptoDecrypt=function(e,t,r){var a=this,s=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new n.default(s,t)),this.fastAesKey.expandKey().then((function(t){return s?new i.default(s,r).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))})).catch((function(i){return a.onWebCryptoError(i,e,t,r)}))},t.onWebCryptoError=function(e,t,r,i){return s.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(t,r,i)},t.getValidChunk=function(e){var t=e,r=e.length-e.length%u;return r!==e.length&&(t=Object(l.sliceUint8)(e,0,r),this.remainderData=Object(l.sliceUint8)(e,r)),t},t.logOnce=function(e){!this.logEnabled||(s.logger.log("[decrypter.ts]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/adts.ts"),a=r("./src/utils/logger.ts"),s=r("./src/demux/id3.ts");function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(t,r){var i;return(i=e.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}o(t,e);var r=t.prototype;return r.resetInitSegment=function(t,r,i){e.prototype.resetInitSegment.call(this,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(n.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},r.canParse=function(e,t){return n.canParse(e,t)},r.appendFrame=function(e,t,r){n.initTrackConfig(e,this.observer,t,r,e.manifestCodec);var i=n.appendFrame(e,t,r,this.initPTS,this.frameIndex);if(i&&0===i.missing)return i},t}(i.default);u.minProbeByteLength=9,t.default=u},"./src/demux/adts.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"getAudioConfig",(function(){return s})),r.d(t,"isHeaderPattern",(function(){return o})),r.d(t,"getHeaderLength",(function(){return l})),r.d(t,"getFullFrameLength",(function(){return u})),r.d(t,"canGetFrameLength",(function(){return c})),r.d(t,"isHeader",(function(){return d})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f})),r.d(t,"initTrackConfig",(function(){return p})),r.d(t,"getFrameDuration",(function(){return v})),r.d(t,"parseFrameHeader",(function(){return g})),r.d(t,"appendFrame",(function(){return m}));var i=r("./src/utils/logger.ts"),n=r("./src/errors.ts"),a=r("./src/events.ts");function s(e,t,r,s){var o,l,u,c,d=navigator.userAgent.toLowerCase(),h=s,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&t[r+2])>>>6);var p=(60&t[r+2])>>>2;if(!(p>f.length-1))return u=(1&t[r+2])<<2,u|=(192&t[r+3])>>>6,i.logger.log("manifest codec:"+s+", ADTS type:"+o+", samplingIndex:"+p),/firefox/i.test(d)?p>=6?(o=5,c=new Array(4),l=p-3):(o=2,c=new Array(2),l=p):-1!==d.indexOf("android")?(o=2,c=new Array(2),l=p):(o=5,c=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&p>=6?l=p-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(p>=6&&1===u||/vivaldi/i.test(d))||!s&&1===u)&&(o=2,c=new Array(2)),l=p)),c[0]=o<<3,c[0]|=(14&p)>>1,c[1]|=(1&p)<<7,c[1]|=u<<3,5===o&&(c[1]|=(14&l)>>1,c[2]=(1&l)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:f[p],channelCount:u,codec:"mp4a.40."+o,manifestCodec:h};e.trigger(a.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function o(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function u(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function c(e,t){return t+5<e.length}function d(e,t){return t+1<e.length&&o(e,t)}function h(e,t){return c(e,t)&&o(e,t)&&u(e,t)<=e.length-t}function f(e,t){if(d(e,t)){var r=l(e,t);if(t+r>=e.length)return!1;var i=u(e,t);if(i<=r)return!1;var n=t+i;return n===e.length||d(e,n)}return!1}function p(e,t,r,n,a){if(!e.samplerate){var o=s(t,r,n,a);if(!o)return;e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,i.logger.log("parsed codec:"+e.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function v(e){return 9216e4/e}function g(e,t,r,i,n){var a=l(e,t),s=u(e,t);if((s-=a)>0)return{headerLength:a,frameLength:s,stamp:r+i*n}}function m(e,t,r,i,n){var a=g(t,r,i,n,v(e.samplerate));if(a){var s,o=a.frameLength,l=a.headerLength,u=a.stamp,c=l+o,d=Math.max(0,r+c-t.length);d?(s=new Uint8Array(c-l)).set(t.subarray(r+l,t.length),0):s=t.subarray(r+l,r+c);var h={unit:s,pts:u};return d||e.samples.push(h),{sample:h,length:c,missing:d}}}},"./src/demux/base-audio-demuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"initPTSFn",(function(){return u}));var i=r("./src/polyfills/number.ts"),n=r("./src/demux/id3.ts"),a=r("./src/demux/dummy-demuxed-track.ts"),s=r("./src/utils/mp4-tools.ts"),o=r("./src/utils/typed-array.ts"),l=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(){},t.resetContiguity=function(){},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,r){},t.demux=function(e,t){this.cachedData&&(e=Object(s.appendUint8Array)(this.cachedData,e),this.cachedData=null);var r,i,l=n.getID3Data(e,0),c=l?l.length:0,d=this._audioTrack,h=this._id3Track,f=l?n.getTimeStamp(l):void 0,p=e.length;for((0===this.frameIndex||null===this.initPTS)&&(this.initPTS=u(f,t)),l&&l.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:l}),i=this.initPTS;c<p;){if(this.canParse(e,c)){var v=this.appendFrame(d,e,c);v?(this.frameIndex++,i=v.sample.pts,r=c+=v.length):c=p}else n.canParse(e,c)?(l=n.getID3Data(e,c),h.samples.push({pts:i,dts:i,data:l}),r=c+=l.length):c++;if(c===p&&r!==p){var g=Object(o.sliceUint8)(e,r);this.cachedData?this.cachedData=Object(s.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:d,avcTrack:Object(a.dummyTrack)(),id3Track:h,textTrack:Object(a.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(a.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(a.dummyTrack)()}},t.destroy=function(){},e}(),u=function(e,t){return Object(i.isFiniteNumber)(e)?90*e:9e4*t};t.default=l},"./src/demux/chunk-cache.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:n(t,r),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}();function n(e,t){for(var r=new Uint8Array(t),i=0,n=0;n<e.length;n++){var a=e[n];r.set(a,i),i+=a.length}return r}},"./src/demux/dummy-demuxed-track.ts":function(e,t,r){"use strict";function i(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(t),r.d(t,"dummyTrack",(function(){return i}))},"./src/demux/exp-golomb.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/utils/logger.ts"),n=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},t.readSPS=function(){var e,t,r,i=0,n=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var v=o();if(l(5),d(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var g=u();if(3===g&&d(1),f(),f(),d(1),c())for(t=3!==g?8:12,r=0;r<t;r++)c()&&p(r<6?16:64)}f();var m=u();if(0===m)u();else if(1===m)for(d(1),h(),h(),e=u(),r=0;r<e;r++)h();f(),d(1);var y=u(),_=u(),T=l(1);0===T&&d(1),d(1),c()&&(i=u(),n=u(),a=u(),s=u());var b=[1,1];if(c()&&c())switch(o()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*i-2*n),height:(2-T)*(_+1)*16-(T?2:4)*(a+s),pixelRatio:b}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=n},"./src/demux/id3.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isHeader",(function(){return n})),r.d(t,"isFooter",(function(){return a})),r.d(t,"getID3Data",(function(){return s})),r.d(t,"canParse",(function(){return l})),r.d(t,"getTimeStamp",(function(){return u})),r.d(t,"isTimeStampFrame",(function(){return c})),r.d(t,"getID3Frames",(function(){return h})),r.d(t,"decodeFrame",(function(){return f})),r.d(t,"utf8ArrayToStr",(function(){return y})),r.d(t,"testables",(function(){return _}));var i,n=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},a=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},s=function(e,t){for(var r=t,i=0;n(e,t);)i+=10,i+=o(e,t+6),a(e,t+10)&&(i+=10),t+=i;if(i>0)return e.subarray(r,r+i)},o=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},l=function(e,t){return n(e,t)&&o(e,t+6)+10<=e.length-t},u=function(e){for(var t=h(e),r=0;r<t.length;r++){var i=t[r];if(c(i))return m(i)}},c=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},d=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=o(e,4),i=10;return{type:t,size:r,data:e.subarray(i,i+r)}},h=function(e){for(var t=0,r=[];n(e,t);){for(var i=o(e,t+6),s=(t+=10)+i;t+8<s;){var l=d(e.subarray(t)),u=f(l);u&&r.push(u),t+=l.size+10}a(e,t)&&(t+=10)}return r},f=function(e){return"PRIV"===e.type?p(e):"W"===e.type[0]?g(e):v(e)},p=function(e){if(!(e.size<2)){var t=y(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},v=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=y(e.data.subarray(t),!0);t+=r.length+1;var i=y(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=y(e.data.subarray(1));return{key:e.type,data:n}}},g=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=y(e.data.subarray(t),!0);t+=r.length+1;var i=y(e.data.subarray(t));return{key:e.type,info:r,data:i}}var n=y(e.data);return{key:e.type,data:n}},m=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},y=function(e,t){void 0===t&&(t=!1);var r=T();if(r){var i=r.decode(e);if(t){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}for(var a,s,o,l=e.length,u="",c=0;c<l;){if(0===(a=e[c++])&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:s=e[c++],u+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[c++],o=e[c++],u+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0)}}return u},_={decodeTextFrame:v};function T(){return!i&&"undefined"!=typeof self.TextDecoder&&(i=new self.TextDecoder("utf-8")),i}},"./src/demux/mp3demuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/id3.ts"),a=r("./src/utils/logger.ts"),s=r("./src/demux/mpegaudio.ts");function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.resetInitSegment=function(t,r,i){e.prototype.resetInitSegment.call(this,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(n.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(s.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(e,t){return s.canParse(e,t)},r.appendFrame=function(e,t,r){if(null!==this.initPTS)return s.appendFrame(e,t,r,this.initPTS,this.frameIndex)},t}(i.default);u.minProbeByteLength=4,t.default=u},"./src/demux/mp4demuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/utils/mp4-tools.ts"),n=r("./src/demux/dummy-demuxed-track.ts"),a=function(){function e(e,t){this.remainderData=null,this.config=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.resetContiguity=function(){},e.probe=function(e){return Object(i.findBox)({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.demux=function(e){var t=e,r=Object(n.dummyTrack)();if(this.config.progressive){this.remainderData&&(t=Object(i.appendUint8Array)(this.remainderData,e));var a=Object(i.segmentValidRange)(t);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=t;return{audioTrack:Object(n.dummyTrack)(),avcTrack:r,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},t.flush=function(){var e=Object(n.dummyTrack)();return e.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(n.dummyTrack)(),avcTrack:e,id3Track:Object(n.dummyTrack)(),textTrack:Object(n.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}();a.minProbeByteLength=1024,t.default=a},"./src/demux/mpegaudio.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"appendFrame",(function(){return l})),r.d(t,"parseHeader",(function(){return u})),r.d(t,"isHeaderPattern",(function(){return c})),r.d(t,"isHeader",(function(){return d})),r.d(t,"canParse",(function(){return h})),r.d(t,"probe",(function(){return f}));var i=null,n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],s=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function l(e,t,r,i,n){if(!(r+24>t.length)){var a=u(t,r);if(a&&r+a.frameLength<=t.length){var s=i+n*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function u(e,t){var r=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,c=e[t+2]>>2&3;if(1!==r&&0!==u&&15!==u&&3!==c){var d=e[t+2]>>1&1,h=e[t+3]>>6,f=1e3*n[14*(3===r?3-l:3===l?3:4)+u-1],p=a[3*(3===r?0:2===r?1:2)+c],v=3===h?1:2,g=s[r][l],m=o[l],y=8*g*m,_=Math.floor(g*f/p+d)*m;if(null===i){var T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);i=T?parseInt(T[1]):0}return!!i&&i<=87&&2===l&&f>=224e3&&0===h&&(e[t+3]=128|e[t+3]),{sampleRate:p,channelCount:v,frameLength:_,samplesPerFrame:y}}}function c(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function d(e,t){return t+1<e.length&&c(e,t)}function h(e,t){var r=4;return c(e,t)&&r<=e.length-t}function f(e,t){if(t+1<e.length&&c(e,t)){var r=4,i=u(e,t),n=r;null!=i&&i.frameLength&&(n=i.frameLength);var a=t+n;return a===e.length||d(e,a)}return!1}},"./src/demux/sample-aes.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/crypt/decrypter.ts"),n=r("./src/demux/tsdemuxer.ts"),a=function(){function e(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new i.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,t)},t.decryptAacSample=function(e,t,r,i){var n=e[t].unit,a=n.subarray(16,n.length-n.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,(function(a){var s=new Uint8Array(a);n.set(s,16),i||o.decryptAacSamples(e,t+1,r)}))},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,i),!i)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},t.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},t.decryptAvcSample=function(e,t,r,i,a,s){var o=Object(n.discardEPB)(a.data),l=this.getAvcEncryptedData(o),u=this;this.decryptBuffer(l.buffer,(function(n){a.data=u.getAvcDecryptedUnit(o,n),s||u.decryptAvcSamples(e,t,r+1,i)}))},t.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var a=n[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,i,a,s),!s)return}}}},e}();t.default=a},"./src/demux/transmuxer-interface.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return d}));var i=r("./node_modules/webworkify-webpack/index.js"),n=(r.n(i),r("./src/events.ts")),a=r("./src/demux/transmuxer.ts"),s=r("./src/utils/logger.ts"),o=r("./src/errors.ts"),l=r("./src/utils/mediasource-helper.ts"),u=r("./node_modules/eventemitter3/index.js"),c=(r.n(u),Object(l.getMediaSource)()||{isTypeSupported:function(){return!1}}),d=function(){function e(e,t,r,l){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=e,this.id=t,this.onTransmuxComplete=r,this.onFlush=l;var h=e.config,f=function(t,r){(r=r||{}).frag=d.frag,r.id=d.id,e.trigger(t,r)};this.observer=new u.EventEmitter,this.observer.on(n.Events.FRAG_DECRYPTED,f),this.observer.on(n.Events.ERROR,f);var p={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(h.enableWorker&&"undefined"!=typeof Worker){var g;s.logger.log("demuxing in webworker");try{g=this.worker=i("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(t){e.trigger(n.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:v,id:t,config:JSON.stringify(h)})}catch(m){s.logger.warn("Error in worker:",m),s.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new a.default(this.observer,p,h,v,t),this.worker=null}}else this.transmuxer=new a.default(this.observer,p,h,v,t)}var t=e.prototype;return t.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.observer=null},t.push=function(e,t,r,i,n,o,l,u,c,d){var h,f,p=this;c.transmuxing.start=self.performance.now();var v=this.transmuxer,g=this.worker,m=o?o.start:n.start,y=n.decryptdata,_=this.frag,T=!(_&&n.cc===_.cc),b=!(_&&c.level===_.level),E=_?c.sn-_.sn:-1,S=this.part?c.part-this.part.index:1,k=!b&&(1===E||0===E&&1===S),C=self.performance.now();(b||E||0===n.stats.parsing.start)&&(n.stats.parsing.start=C),o&&(S||!k)&&(o.stats.parsing.start=C);var w=!(_&&(null===(h=n.initSegment)||void 0===h?void 0:h.url)===(null===(f=_.initSegment)||void 0===f?void 0:f.url)),A=new a.TransmuxState(T,k,u,b,m,w);if(!k||T||w){s.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+"\n        discontinuity: "+T+"\n        trackSwitch: "+b+"\n        contiguous: "+k+"\n        accurateTimeOffset: "+u+"\n        timeOffset: "+m+"\n        initSegmentChange: "+w);var L=new a.TransmuxConfig(r,i,t,l,d);this.configureTransmuxer(L)}if(this.frag=n,this.part=o,g)g.postMessage({cmd:"demux",data:e,decryptdata:y,chunkMeta:c,state:A},e instanceof ArrayBuffer?[e]:[]);else if(v){var x=v.push(e,y,c,A);Object(a.isPromise)(x)?x.then((function(e){p.handleTransmuxComplete(e)})):this.handleTransmuxComplete(x)}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:e});else if(r){var n=r.flush(e);Object(a.isPromise)(n)?n.then((function(r){t.handleFlushResult(r,e)})):this.handleFlushResult(n,e)}},t.handleFlushResult=function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},t.configureTransmuxer=function(e){var t=this.worker,r=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):r&&r.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o}));var i=r("./src/demux/transmuxer.ts"),n=r("./src/events.ts"),a=r("./src/utils/logger.ts"),s=r("./node_modules/eventemitter3/index.js");function o(e){var t=new s.EventEmitter,r=function(t,r){e.postMessage({event:t,data:r})};t.on(n.Events.FRAG_DECRYPTED,r),t.on(n.Events.ERROR,r),e.addEventListener("message",(function(n){var s=n.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.transmuxer=new i.default(t,s.typeSupported,o,s.vendor,s.id),Object(a.enableLogs)(o.debug),r("init",null);break;case"configure":e.transmuxer.configure(s.config);break;case"demux":var u=e.transmuxer.push(s.data,s.decryptdata,s.chunkMeta,s.state);Object(i.isPromise)(u)?u.then((function(t){l(e,t)})):l(e,u);break;case"flush":var d=s.chunkMeta,h=e.transmuxer.flush(d);Object(i.isPromise)(h)?h.then((function(t){c(e,t,d)})):c(e,h,d)}}))}function l(e,t){if(!d(t.remuxResult)){var r=[],i=t.remuxResult,n=i.audio,a=i.video;n&&u(r,n),a&&u(r,a),e.postMessage({event:"transmuxComplete",data:t},r)}}function u(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function c(e,t,r){t.forEach((function(t){l(e,t)})),e.postMessage({event:"flush",data:r})}function d(e){return!e.audio&&!e.video&&!e.text&&!e.id3&&!e.initSegment}r.n(s)},"./src/demux/transmuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return y})),r.d(t,"isPromise",(function(){return b})),r.d(t,"TransmuxConfig",(function(){return E})),r.d(t,"TransmuxState",(function(){return S}));var i,n=r("./src/events.ts"),a=r("./src/errors.ts"),s=r("./src/crypt/decrypter.ts"),o=r("./src/demux/aacdemuxer.ts"),l=r("./src/demux/mp4demuxer.ts"),u=r("./src/demux/tsdemuxer.ts"),c=r("./src/demux/mp3demuxer.ts"),d=r("./src/remux/mp4-remuxer.ts"),h=r("./src/remux/passthrough-remuxer.ts"),f=r("./src/demux/chunk-cache.ts"),p=r("./src/utils/mp4-tools.ts"),v=r("./src/utils/logger.ts");try{i=self.performance.now.bind(self.performance)}catch(k){v.logger.debug("Unable to use Performance API on this environment"),i=self.Date.now}var g=[{demux:u.default,remux:d.default},{demux:l.default,remux:h.default},{demux:o.default,remux:d.default},{demux:c.default,remux:d.default}],m=1024;g.forEach((function(e){var t=e.demux;m=Math.max(m,t.minProbeByteLength)}));var y=function(){function e(e,t,r,i,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new f.default,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,r,n){var a=this,s=r.transmuxing;s.executeStart=i();var o=new Uint8Array(e),l=this.cache,u=this.config,c=this.currentTransmuxState,d=this.transmuxConfig;n&&(this.currentTransmuxState=n);var h=_(o,t);if(h&&"AES-128"===h.method){var f=this.getDecrypter();if(!u.enableSoftwareAES)return this.decryptionPromise=f.webCryptoDecrypt(o,h.key.buffer,h.iv.buffer).then((function(e){var t=a.push(e,null,r);return a.decryptionPromise=null,t})),this.decryptionPromise;var v=f.softwareDecrypt(o,h.key.buffer,h.iv.buffer);if(!v)return s.executeEnd=i(),T(r);o=new Uint8Array(v)}var g=n||c,m=g.contiguous,y=g.discontinuity,b=g.trackSwitch,E=g.accurateTimeOffset,S=g.timeOffset,k=g.initSegmentChange,C=d.audioCodec,w=d.videoCodec,A=d.defaultInitPts,L=d.duration,x=d.initSegmentData;if((y||b||k)&&this.resetInitSegment(x,C,w,L),(y||k)&&this.resetInitialTimestamp(A),m||this.resetContiguity(),this.needsProbing(o,y,b)){if(l.dataLength){var D=l.flush();o=Object(p.appendUint8Array)(D,o)}this.configureTransmuxer(o,d)}var R=this.transmux(o,h,S,E,r),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,s.executeEnd=i(),R},t.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=i();var s=this.decrypter,o=this.cache,l=this.currentTransmuxState,u=this.decryptionPromise;if(u)return u.then((function(){return t.flush(e)}));var c=[],d=l.timeOffset;if(s){var h=s.flush();h&&c.push(this.push(h,null,e))}var f=o.dataLength;o.reset();var p=this.demuxer,v=this.remuxer;if(!p||!v)return f>=m&&this.observer.emit(n.Events.ERROR,n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=i(),[T(e)];var g=p.flush(d);return b(g)?g.then((function(r){return t.flushRemux(c,r,e),c})):(this.flushRemux(c,g,e),c)},t.flushRemux=function(e,t,r){var n=t.audioTrack,a=t.avcTrack,s=t.id3Track,o=t.textTrack,l=this.currentTransmuxState,u=l.accurateTimeOffset,c=l.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var d=this.remuxer.remux(n,a,s,o,c,u,!0,this.id);e.push({remuxResult:d,chunkMeta:r}),r.transmuxing.executeEnd=i()},t.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,r,i){var n=this.demuxer,a=this.remuxer;!n||!a||(n.resetInitSegment(t,r,i),a.resetInitSegment(e,t,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,r,i,n){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)},t.transmuxUnencrypted=function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),a=n.audioTrack,s=n.avcTrack,o=n.id3Track,l=n.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,l,t,r,!1,this.id),chunkMeta:i}},t.transmuxSampleAes=function(e,t,r,i,n){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.avcTrack,e.id3Track,e.textTrack,r,i,!1,a.id),chunkMeta:n}}))},t.configureTransmuxer=function(e,t){for(var r,i=this.config,n=this.observer,a=this.typeSupported,s=this.vendor,o=t.audioCodec,u=t.defaultInitPts,c=t.duration,d=t.initSegmentData,f=t.videoCodec,p=0,m=g.length;p<m;p++)if(g[p].demux.probe(e)){r=g[p];break}r||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:l.default,remux:h.default});var y=this.demuxer,_=this.remuxer,T=r.remux,b=r.demux;(!_||!(_ instanceof T))&&(this.remuxer=new T(n,i,a,s)),(!y||!(y instanceof b))&&(this.demuxer=new b(n,i,a),this.probe=b.probe),this.resetInitSegment(d,o,f,c),this.resetInitialTimestamp(u)},t.needsProbing=function(e,t,r){return!this.demuxer||!this.remuxer||t||r},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new s.default(this.observer,this.config)),e},e}();function _(e,t){var r=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t),r}var T=function(e){return{remuxResult:{},chunkMeta:e}};function b(e){return"then"in e&&e.then instanceof Function}var E=function(e,t,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},S=function(e,t,r,i,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"discardEPB",(function(){return T}));var i=r("./src/demux/adts.ts"),n=r("./src/demux/mpegaudio.ts"),a=r("./src/demux/exp-golomb.ts"),s=r("./src/demux/id3.ts"),o=r("./src/demux/sample-aes.ts"),l=r("./src/events.ts"),u=r("./src/utils/mp4-tools.ts"),c=r("./src/utils/logger.ts"),d=r("./src/errors.ts"),h={video:1,audio:2,id3:3,text:4},f=function(){function e(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}e.probe=function(t){var r=e.syncOffset(t);return!(r<0)&&(r&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:h[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},t.demux=function(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),i||(this.sampleAes=null);var a,s=this._avcTrack,o=this._audioTrack,h=this._id3Track,f=s.pid,p=s.pesData,y=o.pid,_=h.pid,T=o.pesData,b=h.pesData,E=!1,S=this.pmtParsed,k=this._pmtId,C=t.length;if(this.remainderData&&(C=(t=Object(u.appendUint8Array)(this.remainderData,t)).length,this.remainderData=null),C<188&&!n)return this.remainderData=t,{audioTrack:o,avcTrack:s,id3Track:h,textTrack:this._txtTrack};var w=Math.max(0,e.syncOffset(t));(C-=(C+w)%188)<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,C,t.buffer.byteLength-C));for(var A=0,L=w;L<C;L+=188)if(71===t[L]){var x=!!(64&t[L+1]),D=((31&t[L+1])<<8)+t[L+2],R=void 0;if((48&t[L+3])>>4>1){if((R=L+5+t[L+4])===L+188)continue}else R=L+4;switch(D){case f:x&&(p&&(a=m(p))&&this.parseAVCPES(a,!1),p={data:[],size:0}),p&&(p.data.push(t.subarray(R,L+188)),p.size+=L+188-R);break;case y:x&&(T&&(a=m(T))&&(o.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),T={data:[],size:0}),T&&(T.data.push(t.subarray(R,L+188)),T.size+=L+188-R);break;case _:x&&(b&&(a=m(b))&&this.parseID3PES(a),b={data:[],size:0}),b&&(b.data.push(t.subarray(R,L+188)),b.size+=L+188-R);break;case 0:x&&(R+=t[R]+1),k=this._pmtId=v(t,R);break;case k:x&&(R+=t[R]+1);var I=g(t,R,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,i);(f=I.avc)>0&&(s.pid=f),(y=I.audio)>0&&(o.pid=y,o.isAAC=I.isAAC),(_=I.id3)>0&&(h.pid=_),E&&!S&&(c.logger.log("reparse from beginning"),E=!1,L=w-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:E=!0}}else A++;A>0&&this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+A+" TS packet/s that do not start with 0x47"}),s.pesData=p,o.pesData=T,h.pesData=b;var O={audioTrack:o,avcTrack:s,id3Track:h,textTrack:this._txtTrack};return n&&this.extractRemainingSamples(O),O},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.avcTrack,n=e.id3Track,a=i.pesData,s=r.pesData,o=n.pesData;a&&(t=m(a))?(this.parseAVCPES(t,!0),i.pesData=null):i.pesData=a,s&&(t=m(s))?(r.isAAC?this.parseAACPES(t):this.parseMPEGPES(t),r.pesData=null):(null!=s&&s.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s),o&&(t=m(o))?(this.parseID3PES(t),n.pesData=null):n.pesData=o},t.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new o.default(this.observer,this.config,t);return this.decrypt(i,n)},t.decrypt=function(e,t){return new Promise((function(r){var i=e.audioTrack,n=e.avcTrack;i.samples&&i.isAAC?t.decryptAacSamples(i.samples,0,(function(){n.samples?t.decryptAvcSamples(n.samples,0,0,(function(){r(e)})):r(e)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(function(){r(e)}))}))},t.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},t.parseAVCPES=function(e,t){var r,i=this,n=this._avcTrack,o=this.parseAVCNALu(e.data),l=!1,u=this.avcSample,c=!1;e.data=null,u&&o.length&&!n.audFound&&(y(u,n),u=this.avcSample=p(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:r=!0,u||(u=i.avcSample=p(!0,e.pts,e.dts,"")),l&&(u.debug+="NDR "),u.frame=!0;var o=t.data;if(c&&o.length>4){var d=new a.default(o).readSliceType();(2===d||4===d||7===d||9===d)&&(u.key=!0)}break;case 5:r=!0,u||(u=i.avcSample=p(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:r=!0,l&&u&&(u.debug+="SEI ");var h=new a.default(T(t.data));h.readUByte();for(var f=0,v=0,g=!1,m=0;!g&&h.bytesAvailable>1;){f=0;do{f+=m=h.readUByte()}while(255===m);v=0;do{v+=m=h.readUByte()}while(255===m);if(4===f&&0!==h.bytesAvailable){if(g=!0,181===h.readUByte()&&49===h.readUShort()&&1195456820===h.readUInt()&&3===h.readUByte()){for(var b=h.readUByte(),E=31&b,S=[b,h.readUByte()],k=0;k<E;k++)S.push(h.readUByte()),S.push(h.readUByte()),S.push(h.readUByte());_(i._txtTrack.samples,{type:3,pts:e.pts,bytes:S})}}else if(5===f&&0!==h.bytesAvailable){if(g=!0,v>16){for(var C=[],w=0;w<16;w++)C.push(h.readUByte().toString(16)),(3===w||5===w||7===w||9===w)&&C.push("-");for(var A=v-16,L=new Uint8Array(A),x=0;x<A;x++)L[x]=h.readUByte();_(i._txtTrack.samples,{pts:e.pts,payloadType:f,uuid:C.join(""),userData:Object(s.utf8ArrayToStr)(L),userDataBytes:L})}}else if(v<h.bytesAvailable)for(var D=0;D<v;D++)h.readUByte()}break;case 7:if(r=!0,c=!0,l&&u&&(u.debug+="SPS "),!n.sps){var R=new a.default(t.data).readSPS();n.width=R.width,n.height=R.height,n.pixelRatio=R.pixelRatio,n.sps=[t.data],n.duration=i._duration;for(var I=t.data.subarray(1,4),O="avc1.",P=0;P<3;P++){var M=I[P].toString(16);M.length<2&&(M="0"+M),O+=M}n.codec=O}break;case 8:r=!0,l&&u&&(u.debug+="PPS "),n.pps||(n.pps=[t.data]);break;case 9:r=!1,n.audFound=!0,u&&y(u,n),u=i.avcSample=p(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&r&&u.units.push(t)})),t&&u&&(y(u,n),this.avcSample=null)},t.getLastNalUnit=function(){var e,t,r=this.avcSample;if(!r||0===r.units.length){var i=this._avcTrack.samples;r=i[i.length-1]}if(null!==(e=r)&&void 0!==e&&e.units){var n=r.units;t=n[n.length-1]}return t},t.parseAVCNALu=function(e){var t,r,i=e.byteLength,n=this._avcTrack,a=n.naluState||0,s=a,o=[],l=0,u=-1,c=0;for(-1===a&&(u=0,c=31&e[0],a=0,l=1);l<i;)if(t=e[l++],a)if(1!==a)if(t)if(1===t){if(u>=0){var d={data:e.subarray(u,l-a-1),type:c};o.push(d)}else{var h=this.getLastNalUnit();if(h&&(s&&l<=4-s&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-s)),(r=l-a-1)>0)){var f=new Uint8Array(h.data.byteLength+r);f.set(h.data,0),f.set(e.subarray(0,r),h.data.byteLength),h.data=f,h.state=0}}l<i?(u=l,c=31&e[l],a=0):a=-1}else a=0;else a=3;else a=t?0:2;else a=t?0:1;if(u>=0&&a>=0){var p={data:e.subarray(u,i),type:c,state:a};o.push(p)}if(0===o.length){var v=this.getLastNalUnit();if(v){var g=new Uint8Array(v.data.byteLength+e.byteLength);g.set(v.data,0),g.set(e,v.data.byteLength),v.data=g}}return n.naluState=a,o},t.parseAACPES=function(e){var t,r,n,a,s,o=0,u=this._audioTrack,h=this.aacOverFlow,f=e.data;if(h){this.aacOverFlow=null;var p=h.sample.unit.byteLength,v=Math.min(h.missing,p),g=p-v;h.sample.unit.set(f.subarray(0,v),g),u.samples.push(h.sample),o=h.missing}for(t=o,r=f.length;t<r-1&&!i.isHeader(f,t);t++);if(t===o||(t<r-1?(n="AAC PES did not start with ADTS header,offset:"+t,a=!1):(n="no ADTS header found in AAC PES",a=!0),c.logger.warn("parsing error:"+n),this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:n}),!a)){if(i.initTrackConfig(u,this.observer,f,t,this.audioCodec),void 0!==e.pts)s=e.pts;else{if(!h)return void c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var m=i.getFrameDuration(u.samplerate);s=h.sample.pts+m}for(var y=0;t<r;){if(i.isHeader(f,t)){if(t+5<r){var _=i.appendFrame(u,f,t,s,y);if(_){if(!_.missing){t+=_.length,y++;continue}this.aacOverFlow=_}}break}t++}}},t.parseMPEGPES=function(e){var t=e.data,r=t.length,i=0,a=0,s=e.pts;if(void 0!==s)for(;a<r;)if(n.isHeader(t,a)){var o=n.appendFrame(this._audioTrack,t,a,s,i);if(!o)break;a+=o.length,i++}else a++;else c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e){void 0!==e.pts?this._id3Track.samples.push(e):c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function p(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}function v(e,t){return(31&e[t+10])<<8|e[t+11]}function g(e,t,r,i){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){var s=(31&e[t+1])<<8|e[t+2];switch(e[t]){case 207:if(!i){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!i){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:r?-1===n.audio&&(n.audio=s,n.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return n}function m(e){var t,r,i,n,a,s=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var u=t[7];192&u&&(n=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&u?n-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(c.logger.warn(Math.round((n-a)/9e4)+"s delta between PTS and DTS, align them"),n=a):a=n);var d=(i=t[8])+9;if(e.size<=d)return null;e.size-=d;for(var h=new Uint8Array(e.size),f=0,p=o.length;f<p;f++){var v=(t=o[f]).byteLength;if(d){if(d>v){d-=v;continue}t=t.subarray(d),v-=d,d=0}h.set(t,s),s+=v}return r&&(r-=i+3),{data:h,pts:n,dts:a,len:r}}return null}function y(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,i=r.length;if(!i)return void t.dropped++;var n=r[i-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}e.debug.length&&c.logger.log(e.pts+"/"+e.dts+":"+e.debug)}function _(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)}function T(e){for(var t=e.byteLength,r=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return e;var n=t-r.length,a=new Uint8Array(n),s=0;for(i=0;i<n;s++,i++)s===r[0]&&(s++,r.shift()),a[i]=e[s];return a}f.minProbeByteLength=188,t.default=f},"./src/errors.ts":function(e,t,r){"use strict";var i,n,a;r.r(t),r.d(t,"ErrorTypes",(function(){return i})),r.d(t,"ErrorDetails",(function(){return a})),(n=i||(i={})).NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown"}(a||(a={}))},"./src/events.ts":function(e,t,r){"use strict";var i,n;r.r(t),r.d(t,"Events",(function(){return i})),(n=i||(i={})).MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return _}));var i=r("./node_modules/url-toolkit/src/url-toolkit.js"),n=(r.n(i),r("./src/loader/playlist-loader.ts")),a=r("./src/loader/key-loader.ts"),s=r("./src/controller/id3-track-controller.ts"),o=r("./src/controller/latency-controller.ts"),l=r("./src/controller/level-controller.ts"),u=r("./src/controller/fragment-tracker.ts"),c=r("./src/controller/stream-controller.ts"),d=r("./src/is-supported.ts"),h=r("./src/utils/logger.ts"),f=r("./src/config.ts"),p=r("./node_modules/eventemitter3/index.js"),v=(r.n(p),r("./src/events.ts")),g=r("./src/errors.ts");function m(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function y(e,t,r){return t&&m(e.prototype,t),r&&m(e,r),e}var _=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(f.mergeConfig)(e.DefaultConfig,t);this.userConfig=t,Object(h.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(f.enableStreamingMode)(r);var i=r.abrController,d=r.bufferController,v=r.capLevelController,g=r.fpsController,m=this.abrController=new i(this),y=this.bufferController=new d(this),_=this.capLevelController=new v(this),T=new g(this),b=new n.default(this),E=new a.default(this),S=new s.default(this),k=this.levelController=new l.default(this),C=new u.FragmentTracker(this),w=this.streamController=new c.default(this,C);_.setStreamController(w),T.setStreamController(w);var A=[k,w];this.networkControllers=A;var L=[b,E,m,y,_,T,S,C];this.audioTrackController=this.createController(r.audioTrackController,null,A),this.createController(r.audioStreamController,C,A),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,A),this.createController(r.subtitleStreamController,C,A),this.createController(r.timelineController,null,L),this.emeController=this.createController(r.emeController,null,L),this.cmcdController=this.createController(r.cmcdController,null,L),this.latencyController=this.createController(o.default,null,L),this.coreComponents=L}e.isSupported=function(){return Object(d.isSupported)()};var t=e.prototype;return t.createController=function(e,t,r){if(e){var i=t?new e(this,t):new e(this);return r&&r.push(i),i}return null},t.on=function(e,t,r){void 0===r&&(r=this),this._emitter.on(e,t,r)},t.once=function(e,t,r){void 0===r&&(r=this),this._emitter.once(e,t,r)},t.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},t.off=function(e,t,r,i){void 0===r&&(r=this),this._emitter.off(e,t,r,i)},t.listeners=function(e){return this._emitter.listeners(e)},t.emit=function(e,t,r){return this._emitter.emit(e,t,r)},t.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){h.logger.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(v.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},t.listenerCount=function(e){return this._emitter.listenerCount(e)},t.destroy=function(){h.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0},t.attachMedia=function(e){h.logger.log("attachMedia"),this._media=e,this.trigger(v.Events.MEDIA_ATTACHING,{media:e})},t.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,n=this.url=i.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});h.logger.log("loadSource:"+n),t&&r&&r!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.Events.MANIFEST_LOADING,{url:e})},t.startLoad=function(e){void 0===e&&(e=-1),h.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},t.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},t.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){h.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},t.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},y(e,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){h.logger.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){h.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){h.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){h.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){h.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(h.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:f.hlsDefaultConfig},set:function(t){e.defaultConfig=t}}]),e}();_.defaultConfig=void 0},"./src/is-supported.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isSupported",(function(){return a})),r.d(t,"changeTypeSupported",(function(){return s}));var i=r("./src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var e=Object(i.getMediaSource)();if(!e)return!1;var t=n(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),a=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!a}function s(){var e,t=n();return"function"==typeof(null==t||null===(e=t.prototype)||void 0===e?void 0:e.changeType)}},"./src/loader/fragment-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return f})),r.d(t,"LoadError",(function(){return v}));var i=r("./src/polyfills/number.ts"),n=r("./src/errors.ts");function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||!u(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return o(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),c(r,e)},s(e)}function o(e,t,r){return(o=l()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&c(n,r.prototype),n}).apply(null,arguments)}function l(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=Math.pow(2,17),f=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(i,l){r.loader&&r.loader.destroy();var u=r.loader=e.loader=s?new s(a):new o(a),c=p(e),d={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:h};e.stats=u.stats,u.load(c,d,{onSuccess:function(t,n,a,s){r.resetLoader(e,u),i({frag:e,part:null,payload:t.data,networkDetails:s})},onError:function(t,i,a){r.resetLoader(e,u),l(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:t,networkDetails:a}))},onAbort:function(t,i,a){r.resetLoader(e,u),l(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:a}))},onTimeout:function(t,i,a){r.resetLoader(e,u),l(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:a}))},onProgress:function(r,i,n,a){t&&t({frag:e,part:null,payload:n,networkDetails:a})}})}))},t.loadPart=function(e,t,r){var i=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){i.loader&&i.loader.destroy();var c=i.loader=e.loader=s?new s(a):new o(a),d=p(e,t),f={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:h};t.stats=c.stats,c.load(d,f,{onSuccess:function(n,a,s,o){i.resetLoader(e,c),i.updateStatsFromPart(e,t);var u={frag:e,part:t,payload:n.data,networkDetails:o};r(u),l(u)},onError:function(r,a,s){i.resetLoader(e,c),u(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:r,networkDetails:s}))},onAbort:function(r,a,s){e.stats.aborted=t.stats.aborted,i.resetLoader(e,c),u(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,networkDetails:s}))},onTimeout:function(r,a,s){i.resetLoader(e,c),u(new v({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,networkDetails:s}))}})}))},t.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/n),a),o=(a-s)*Math.round(r.loaded/s);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var l=r.loading,u=i.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function p(e,t){void 0===t&&(t=null);var r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},a=r.byteRangeStartOffset,s=r.byteRangeEndOffset;return Object(i.isFiniteNumber)(a)&&Object(i.isFiniteNumber)(s)&&(n.rangeStart=a,n.rangeEnd=s),n}var v=function(e){function t(t){for(var r,i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];return(r=e.call.apply(e,[this].concat(n))||this).data=void 0,r.data=t,r}return a(t,e),t}(s(Error))},"./src/loader/fragment.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"ElementaryStreamTypes",(function(){return i})),r.d(t,"BaseSegment",(function(){return p})),r.d(t,"Fragment",(function(){return v})),r.d(t,"Part",(function(){return g}));var i,n,a=r("./src/polyfills/number.ts"),s=r("./node_modules/url-toolkit/src/url-toolkit.js"),o=(r.n(s),r("./src/utils/logger.ts")),l=r("./src/loader/level-key.ts"),u=r("./src/loader/load-stats.ts");function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}(n=i||(i={})).AUDIO="audio",n.VIDEO="video",n.AUDIOVIDEO="audiovideo";var p=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null,t),this.baseurl=e}return e.prototype.setByteRange=function(e,t){var r=e.split("@",2),i=[];1===r.length?i[0]=t?t.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},f(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),v=function(e){function t(t,r){var i;return(i=e.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkey=void 0,i.type=void 0,i.loader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new u.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.type=t,i}c(t,e);var r=t.prototype;return r.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},r.setDecryptDataFromLevelKey=function(e,t){var r=e;return"AES-128"===(null==e?void 0:e.method)&&e.uri&&!e.iv&&((r=l.LevelKey.fromURI(e.uri)).method=e.method,r.iv=this.createInitializationVector(t),r.keyFormat="identity"),r},r.setElementaryStreamInfo=function(e,t,r,i,n,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):s[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:n,partial:a}},r.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[i.AUDIO]=null,e[i.VIDEO]=null,e[i.AUDIOVIDEO]=null},f(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&o.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(a.isFiniteNumber)(this.programDateTime))return null;var e=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;return!(null===(e=this.decryptdata)||void 0===e||!e.keyFormat||!this.decryptdata.uri)}}]),t}(p),g=function(e){function t(t,r,i,n,a){var s;(s=e.call(this,i)||this).fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new u.LoadStats,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=r,s.index=n;var o=t.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return c(t,e),f(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(p)},"./src/loader/key-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));var i=r("./src/events.ts"),n=r("./src/errors.ts"),a=r("./src/utils/logger.ts"),s=function(){function e(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){this.hls.on(i.Events.KEY_LOADING,this.onKeyLoading,this)},t._unregisterListeners=function(){this.hls.off(i.Events.KEY_LOADING,this.onKeyLoading)},t.destroy=function(){for(var e in this._unregisterListeners(),this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},t.onKeyLoading=function(e,t){var r=t.frag,n=r.type,s=this.loaders[n];if(r.decryptdata){var o=r.decryptdata.uri;if(o!==this.decrypturl||null===this.decryptkey){var l=this.hls.config;if(s&&(a.logger.warn("abort previous key loader for type:"+n),s.abort()),!o)return void a.logger.warn("key uri is falsy");var u=l.loader,c=r.loader=this.loaders[n]=new u(l);this.decrypturl=o,this.decryptkey=null;var d={url:o,frag:r,responseType:"arraybuffer"},h={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(d,h,f)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(i.Events.KEY_LOADED,{frag:r}))}else a.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(e,t,r){var n=r.frag;n.decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=null,delete this.loaders[n.type],this.hls.trigger(i.Events.KEY_LOADED,{frag:n})):a.logger.error("after key load, decryptdata unset")},t.loaderror=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},t.loadtimeout=function(e,t){var r=t.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}()},"./src/loader/level-details.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LevelDetails",(function(){return o}));var i=r("./src/polyfills/number.ts");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var s=10,o=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=e}return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},a(e,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(i.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||s}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}()},"./src/loader/level-key.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LevelKey",(function(){return s}));var i=r("./node_modules/url-toolkit/src/url-toolkit.js");function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.n(i);var s=function(){function e(e,t){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=t?Object(i.buildAbsoluteURL)(e,t,{alwaysNormalize:!0}):e}return e.fromURL=function(t,r){return new e(t,r)},e.fromURI=function(t){return new e(t)},a(e,[{key:"uri",get:function(){return this._uri}}]),e}()},"./src/loader/load-stats.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"LoadStats",(function(){return i}));var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return m}));var i=r("./src/polyfills/number.ts"),n=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=(r.n(n),r("./src/loader/fragment.ts")),s=r("./src/loader/level-details.ts"),o=r("./src/loader/level-key.ts"),l=r("./src/utils/attr-list.ts"),u=r("./src/utils/logger.ts"),c=r("./src/utils/codecs.ts"),d=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,h=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;function g(e){var t,r;return v.test(null!=(t=null===(r=n.parseURL(e))||void 0===r?void 0:r.path)?t:"")}var m=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];if(i.id===t)return i}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).substr(-4)}return e},e.resolve=function(e,t){return n.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var i,n=[],a={},s=!1;for(d.lastIndex=0;null!=(i=d.exec(t));)if(i[1]){var o=new l.AttrList(i[1]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:e.resolve(i[2],r)},c=o.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),y((o.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),u),u.videoCodec&&-1!==u.videoCodec.indexOf("avc1")&&(u.videoCodec=e.convertAVC1ToAVCOTI(u.videoCodec)),n.push(u)}else if(i[3]){var h=new l.AttrList(i[3]);h["DATA-ID"]&&(s=!0,a[h["DATA-ID"]]=h)}return{levels:n,sessionData:s?a:null}},e.parseMasterPlaylistMedia=function(t,r,i,n){void 0===n&&(n=[]);var a,s=[],o=0;for(h.lastIndex=0;null!==(a=h.exec(t));){var u=new l.AttrList(a[1]);if(u.TYPE===i){var c={attrs:u,bitrate:0,id:o++,groupId:u["GROUP-ID"],instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:i,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,r):""};if(n.length){var d=e.findGroup(n,c.groupId)||n[0];_(c,d,"audioCodec"),_(c,d,"textCodec")}s.push(c)}}return s},e.parseLevelPlaylist=function(e,t,r,n,c){var d,h,v,m=new s.LevelDetails(t),y=m.fragments,_=null,E=0,S=0,k=0,C=0,w=null,A=new a.Fragment(n,t),L=-1,x=!1;for(f.lastIndex=0,m.m3u8=e;null!==(d=f.exec(e));){x&&(x=!1,(A=new a.Fragment(n,t)).start=k,A.sn=E,A.cc=C,A.level=r,_&&(A.initSegment=_,A.rawProgramDateTime=_.rawProgramDateTime));var D=d[1];if(D){A.duration=parseFloat(D);var R=(" "+d[2]).slice(1);A.title=R||null,A.tagList.push(R?["INF",D,R]:["INF",D])}else if(d[3])Object(i.isFiniteNumber)(A.duration)&&(A.start=k,v&&(A.levelkey=v),A.sn=E,A.level=r,A.cc=C,A.urlId=c,y.push(A),A.relurl=(" "+d[3]).slice(1),b(A,w),w=A,k+=A.duration,E++,S=0,x=!0);else if(d[4]){var I=(" "+d[4]).slice(1);w?A.setByteRange(I,w):A.setByteRange(I)}else if(d[5])A.rawProgramDateTime=(" "+d[5]).slice(1),A.tagList.push(["PROGRAM-DATE-TIME",A.rawProgramDateTime]),-1===L&&(L=y.length);else{if(!(d=d[0].match(p))){u.logger.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&"undefined"==typeof d[h];h++);var O=(" "+d[h]).slice(1),P=(" "+d[h+1]).slice(1),M=d[h+2]?(" "+d[h+2]).slice(1):"";switch(O){case"PLAYLIST-TYPE":m.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":E=m.startSN=parseInt(P);break;case"SKIP":var F=new l.AttrList(P),N=F.decimalInteger("SKIPPED-SEGMENTS");if(Object(i.isFiniteNumber)(N)){m.skippedSegments=N;for(var B=N;B--;)y.unshift(null);E+=N}var j=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(m.recentlyRemovedDateranges=j.split("\t"));break;case"TARGETDURATION":m.targetduration=parseFloat(P);break;case"VERSION":m.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(P||M)&&A.tagList.push(M?[P,M]:[P]);break;case"DIS":C++;case"GAP":A.tagList.push([O]);break;case"BITRATE":A.tagList.push([O,P]);break;case"DISCONTINUITY-SEQ":C=parseInt(P);break;case"KEY":var U,H=new l.AttrList(P),G=H.enumeratedString("METHOD"),K=H.URI,V=H.hexadecimalInteger("IV"),q=H.enumeratedString("KEYFORMATVERSIONS"),W=H.enumeratedString("KEYID"),z=null!=(U=H.enumeratedString("KEYFORMAT"))?U:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(z)>-1){u.logger.warn("Keyformat "+z+" is not supported from the manifest");continue}if("identity"!==z)continue;G&&(v=o.LevelKey.fromURL(t,K),K&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(G)>=0&&(v.method=G,v.keyFormat=z,W&&(v.keyID=W),q&&(v.keyFormatVersions=q),v.iv=V));break;case"START":var Y=new l.AttrList(P).decimalFloatingPoint("TIME-OFFSET");Object(i.isFiniteNumber)(Y)&&(m.startTimeOffset=Y);break;case"MAP":var X=new l.AttrList(P);A.relurl=X.URI,X.BYTERANGE&&A.setByteRange(X.BYTERANGE),A.level=r,A.sn="initSegment",v&&(A.levelkey=v),A.initSegment=null,_=A,x=!0;break;case"SERVER-CONTROL":var Q=new l.AttrList(P);m.canBlockReload=Q.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=Q.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&Q.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=Q.optionalFloat("PART-HOLD-BACK",0),m.holdBack=Q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var J=new l.AttrList(P);m.partTarget=J.decimalFloatingPoint("PART-TARGET");break;case"PART":var $=m.partList;$||($=m.partList=[]);var Z=S>0?$[$.length-1]:void 0,ee=S++,te=new a.Part(new l.AttrList(P),A,t,ee,Z);$.push(te),A.duration+=te.duration;break;case"PRELOAD-HINT":var re=new l.AttrList(P);m.preloadHint=re;break;case"RENDITION-REPORT":var ie=new l.AttrList(P);m.renditionReports=m.renditionReports||[],m.renditionReports.push(ie);break;default:u.logger.warn("line parsed but not handled: "+d)}}}w&&!w.relurl?(y.pop(),k-=w.duration,m.partList&&(m.fragmentHint=w)):m.partList&&(b(A,w),A.cc=C,m.fragmentHint=A);var ne=y.length,ae=y[0],se=y[ne-1];if((k+=m.skippedSegments*m.targetduration)>0&&ne&&se){m.averagetargetduration=k/ne;var oe=se.sn;m.endSN="initSegment"!==oe?oe:0,ae&&(m.startCC=ae.cc,ae.initSegment||m.fragments.every((function(e){return e.relurl&&g(e.relurl)}))&&(u.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(A=new a.Fragment(n,t)).relurl=se.relurl,A.level=r,A.sn="initSegment",ae.initSegment=A,m.needSidxRanges=!0))}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(k+=m.fragmentHint.duration),m.totalduration=k,m.endCC=C,L>0&&T(y,L),m},e}();function y(e,t){["video","audio","text"].forEach((function(r){var i=e.filter((function(e){return Object(c.isCodecType)(e,r)}));if(i.length){var n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[r+"Codec"]=n.length>0?n[0]:i[0],e=e.filter((function(e){return-1===i.indexOf(e)}))}})),t.unknownCodecs=e}function _(e,t,r){var i=t[r];i&&(e[r]=i)}function T(e,t){for(var r=e[t],i=t;i--;){var n=e[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}function b(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(i.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),a=r("./src/errors.ts"),s=r("./src/utils/logger.ts"),o=r("./src/utils/mp4-tools.ts"),l=r("./src/loader/m3u8-parser.ts"),u=r("./src/types/loader.ts"),c=r("./src/utils/attr-list.ts");function d(e){switch(e.type){case u.PlaylistContextType.AUDIO_TRACK:return u.PlaylistLevelType.AUDIO;case u.PlaylistContextType.SUBTITLE_TRACK:return u.PlaylistLevelType.SUBTITLE;default:return u.PlaylistLevelType.MAIN}}function h(e,t){var r=e.url;return(void 0===r||0===r.indexOf("data:"))&&(r=t.url),r}var f=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return e.loader=n,this.loaders[e.type]=n,n},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var r=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:u.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var r=t.id,i=t.level,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:u.PlaylistContextType.LEVEL,url:n,deliveryDirectives:a})},t.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:u.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:u.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:a})},t.load=function(e){var t,r,i,n,a,o,l=this.hls.config,c=this.getInternalLoader(e);if(c){var d=c.context;if(d&&d.url===e.url)return void s.logger.trace("[playlist-loader]: playlist request ongoing");s.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),c.abort()}switch(e.type){case u.PlaylistContextType.MANIFEST:r=l.manifestLoadingMaxRetry,i=l.manifestLoadingTimeOut,n=l.manifestLoadingRetryDelay,a=l.manifestLoadingMaxRetryTimeout;break;case u.PlaylistContextType.LEVEL:case u.PlaylistContextType.AUDIO_TRACK:case u.PlaylistContextType.SUBTITLE_TRACK:r=0,i=l.levelLoadingTimeOut;break;default:r=l.levelLoadingMaxRetry,i=l.levelLoadingTimeOut,n=l.levelLoadingRetryDelay,a=l.levelLoadingMaxRetryTimeout}if(c=this.createInternalLoader(e),null!==(t=e.deliveryDirectives)&&void 0!==t&&t.part&&(e.type===u.PlaylistContextType.LEVEL&&null!==e.level?o=this.hls.levels[e.level].details:e.type===u.PlaylistContextType.AUDIO_TRACK&&null!==e.id?o=this.hls.audioTracks[e.id].details:e.type===u.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(o=this.hls.subtitleTracks[e.id].details),o)){var h=o.partTarget,f=o.targetduration;h&&f&&(i=Math.min(1e3*Math.max(3*h,.8*f),i))}var p={timeout:i,maxRetry:r,retryDelay:n,maxRetryDelay:a,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(e,p,v)},t.loadsuccess=function(e,t,r,i){if(void 0===i&&(i=null),r.isSidxRequest)return this.handleSidxRequest(e,r),void this.handlePlaylistLoaded(e,t,r,i);this.resetInternalLoader(r.type);var n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,r,i):this.handleMasterPlaylist(e,t,r,i)):this.handleManifestParsingError(e,r,"no EXTM3U delimiter",i)},t.loaderror=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!1,e)},t.loadtimeout=function(e,t,r){void 0===r&&(r=null),this.handleNetworkError(t,r,!0)},t.handleMasterPlaylist=function(e,t,r,i){var a=this.hls,o=e.data,u=h(e,r),d=l.default.parseMasterPlaylist(o,u),f=d.levels,p=d.sessionData;if(f.length){var v=f.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),g=f.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),m=l.default.parseMasterPlaylistMedia(o,u,"AUDIO",v),y=l.default.parseMasterPlaylistMedia(o,u,"SUBTITLES",g),_=l.default.parseMasterPlaylistMedia(o,u,"CLOSED-CAPTIONS");m.length&&!m.some((function(e){return!e.url}))&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(s.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""})),a.trigger(n.Events.MANIFEST_LOADED,{levels:f,audioTracks:m,subtitles:y,captions:_,url:u,stats:t,networkDetails:i,sessionData:p})}else this.handleManifestParsingError(e,r,"no level found in manifest",i)},t.handleTrackOrLevelPlaylist=function(e,t,r,s){var o=this.hls,f=r.id,p=r.level,v=r.type,g=h(e,r),m=Object(i.isFiniteNumber)(f)?f:0,y=Object(i.isFiniteNumber)(p)?p:m,_=d(r),T=l.default.parseLevelPlaylist(e.data,g,y,_,m);if(T.fragments.length){if(v===u.PlaylistContextType.MANIFEST){var b={attrs:new c.AttrList({}),bitrate:0,details:T,name:"",url:g};o.trigger(n.Events.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:g,stats:t,networkDetails:s,sessionData:null})}if(t.parsing.end=performance.now(),T.needSidxRanges){var E,S=null===(E=T.fragments[0].initSegment)||void 0===E?void 0:E.url;this.load({url:S,isSidxRequest:!0,type:v,level:p,levelDetails:T,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else r.levelDetails=T,this.handlePlaylistLoaded(e,t,r,s)}else o.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:g,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},t.handleSidxRequest=function(e,t){var r=Object(o.parseSegmentIndex)(new Uint8Array(e.data));if(r){var i=r.references,n=t.levelDetails;i.forEach((function(e,t){var i=e.info,a=n.fragments[t];0===a.byteRange.length&&a.setByteRange(String(1+i.end-i.start)+"@"+String(i.start)),a.initSegment&&a.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}))}},t.handleManifestParsingError=function(e,t,r,i){this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===u.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:t,networkDetails:i})},t.handleNetworkError=function(e,t,r,i){void 0===r&&(r=!1),s.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var o=a.ErrorDetails.UNKNOWN,l=!1,c=this.getInternalLoader(e);switch(e.type){case u.PlaylistContextType.MANIFEST:o=r?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case u.PlaylistContextType.LEVEL:o=r?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case u.PlaylistContextType.AUDIO_TRACK:o=r?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case u.PlaylistContextType.SUBTITLE_TRACK:o=r?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}c&&this.resetInternalLoader(e.type);var d={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:c,context:e,networkDetails:t};i&&(d.response=i),this.hls.trigger(n.Events.ERROR,d)},t.handlePlaylistLoaded=function(e,t,r,i){var a=r.type,s=r.level,o=r.id,l=r.groupId,c=r.loader,d=r.levelDetails,h=r.deliveryDirectives;if(null!=d&&d.targetduration){if(c)switch(d.live&&(c.getCacheAge&&(d.ageHeader=c.getCacheAge()||0),(!c.getCacheAge||isNaN(d.ageHeader))&&(d.ageHeader=0)),a){case u.PlaylistContextType.MANIFEST:case u.PlaylistContextType.LEVEL:this.hls.trigger(n.Events.LEVEL_LOADED,{details:d,level:s||0,id:o||0,stats:t,networkDetails:i,deliveryDirectives:h});break;case u.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(n.Events.AUDIO_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:t,networkDetails:i,deliveryDirectives:h});break;case u.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADED,{details:d,id:o||0,groupId:l||"",stats:t,networkDetails:i,deliveryDirectives:h})}}else this.handleManifestParsingError(e,r,"invalid target duration",i)},e}();t.default=f},"./src/polyfills/number.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",(function(){return i})),r.d(t,"MAX_SAFE_INTEGER",(function(){return n}));var i=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();t.default=i},"./src/remux/mp4-generator.ts":function(e,t,r){"use strict";r.r(t);var i=Math.pow(2,32)-1,n=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var a=i.length,s=a;a--;)t+=i[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(i[a],t),t+=i[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),a=Math.floor(r%(i+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))},e.moov=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))},e.mvhd=function(t,r){r*=t;var n=Math.floor(r/(i+1)),a=Math.floor(r%(i+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var r,i,n=t.samples||[],a=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,a[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var r,i,n,a=[],s=[];for(r=0;r<t.sps.length;r++)n=(i=t.sps[r]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)n=(i=t.pps[r]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,n=t.duration*t.timescale,a=t.width,s=t.height,o=Math.floor(n/(i+1)),l=Math.floor(n%(i+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,r){var n=e.sdtp(t),a=t.id,s=Math.floor(r/(i+1)),o=Math.floor(r%(i+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var i,n,a,s,o,l,u=t.samples||[],c=u.length,d=12+16*c,h=new Uint8Array(d);for(r+=8+d,h.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<c;i++)a=(n=u[i]).duration,s=n.size,o=n.flags,l=n.cts,h.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t),i=new Uint8Array(e.FTYP.byteLength+r.byteLength);return i.set(e.FTYP),i.set(r,e.FTYP.byteLength),i},e}();n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0,t.default=n},"./src/remux/mp4-remuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return y})),r.d(t,"normalizePts",(function(){return _}));var i=r("./src/polyfills/number.ts"),n=r("./src/remux/aac-helper.ts"),a=r("./src/remux/mp4-generator.ts"),s=r("./src/events.ts"),o=r("./src/errors.ts"),l=r("./src/utils/logger.ts"),u=r("./src/types/loader.ts"),c=r("./src/utils/timescale-conversion.ts");function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},d.apply(this,arguments)}var h=1e4,f=1024,p=1152,v=null,g=null,m=!1,y=function(){function e(e,t,r,i){if(void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===v){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);v=n?parseInt(n[1]):0}if(null===g){var a=navigator.userAgent.match(/Safari\/(\d+)/i);g=a?parseInt(a[1]):0}m=!!v&&v<75||!!g&&g<600}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){l.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){l.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){l.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,r=e.reduce((function(e,r){var i=r.pts-e;return i<-4294967296?(t=!0,_(e,r.pts)):i>0?e:r.pts}),e[0].pts);return t&&l.logger.debug("PTS rollover detected"),r},t.remux=function(e,t,r,i,n,a,s,o){var c,d,h,f,p,v,g=n,m=n,y=e.pid>-1,b=t.pid>-1,E=t.samples.length,S=e.samples.length>0,k=E>1;if((!y||S)&&(!b||k)||this.ISGenerated||s){this.ISGenerated||(h=this.generateIS(e,t,n));var C=this.isVideoContiguous,w=-1;if(k&&(w=T(t.samples),!C&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,w>0){l.logger.warn("[mp4-remuxer]: Dropped "+w+" out of "+E+" video samples due to a missing keyframe");var A=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(w),t.dropped+=w,m+=(t.samples[0].pts-A)/(t.timescale||9e4)}else-1===w&&(l.logger.warn("[mp4-remuxer]: No keyframe found out of "+E+" video samples"),v=!1);if(this.ISGenerated){if(S&&k){var L=this.getVideoStartPts(t.samples),x=(_(e.samples[0].pts,L)-L)/t.inputTimeScale;g+=Math.max(0,x),m+=Math.max(0,-x)}if(S){if(e.samplerate||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,n)),d=this.remuxAudio(e,g,this.isAudioContiguous,a,b||k||o===u.PlaylistLevelType.AUDIO?m:void 0),k){var D=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,n)),c=this.remuxVideo(t,m,C,D)}}else k&&(c=this.remuxVideo(t,m,C,0));c&&(c.firstKeyFrame=w,c.independent=-1!==w)}}return this.ISGenerated&&(r.samples.length&&(p=this.remuxID3(r,n)),i.samples.length&&(f=this.remuxText(i,n))),{audio:d,video:c,initSegment:h,independent:v,text:f,id3:p}},t.generateIS=function(e,t,r){var n,s,o,l=e.samples,u=t.samples,c=this.typeSupported,d={},h=!Object(i.isFiniteNumber)(this._initPTS),f="audio/mp4";if(h&&(n=s=1/0),e.config&&l.length&&(e.timescale=e.samplerate,e.isAAC||(c.mpeg?(f="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3")),d.audio={id:"audio",container:f,codec:e.codec,initSegment:!e.isAAC&&c.mpeg?new Uint8Array(0):a.default.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(o=e.inputTimeScale,n=s=l[0].pts-Math.round(o*r))),t.sps&&t.pps&&u.length&&(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:a.default.initSegment([t]),metadata:{width:t.width,height:t.height}},h)){o=t.inputTimeScale;var p=this.getVideoStartPts(u),v=Math.round(o*r);s=Math.min(s,_(u[0].dts,p)-v),n=Math.min(n,p-v)}if(Object.keys(d).length)return this.ISGenerated=!0,h&&(this._initPTS=n,this._initDTS=s),{tracks:d,initPTS:n,timescale:o}},t.remuxVideo=function(e,t,r,i){var n,u,h,f=e.inputTimeScale,p=e.samples,g=[],y=p.length,T=this._initPTS,E=this.nextAvcDts,S=8,k=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,w=0,A=!1;r&&null!==E||(E=t*f-(p[0].pts-_(p[0].dts,p[0].pts)));for(var L=0;L<y;L++){var x=p[L];if(x.pts=_(x.pts-T,E),x.dts=_(x.dts-T,E),x.dts>x.pts){var D=18e3;w=Math.max(Math.min(w,x.pts-x.dts),-1*D)}x.dts<p[L>0?L-1:L].dts&&(A=!0)}A&&p.sort((function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||i})),u=p[0].dts,h=p[p.length-1].dts;var R=Math.round((h-u)/(y-1));if(w<0){if(w<-2*R){l.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-R,!0)+" ms");for(var I=w,O=0;O<y;O++)p[O].dts=I=Math.max(I,p[O].pts-R),p[O].pts=Math.max(I,p[O].pts)}else{l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(w,!0)+" ms to overcome this issue");for(var P=0;P<y;P++)p[P].dts=p[P].dts+w}u=p[0].dts}if(r){var M=u-E,F=M>R;if(F||M<-1){F?l.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(M,!0)+" ms ("+M+"dts) hole between fragments detected, filling it"):l.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(-M,!0)+" ms ("+M+"dts) overlapping between fragments detected"),u=E;var N=p[0].pts-M;p[0].dts=u,p[0].pts=N,l.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(N,!0)+"/"+Object(c.toMsFromMpegTsClock)(u,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(M,!0)+" ms")}}m&&(u=Math.max(0,u));for(var B=0,j=0,U=0;U<y;U++){for(var H=p[U],G=H.units,K=G.length,V=0,q=0;q<K;q++)V+=G[q].data.length;j+=V,B+=K,H.length=V,H.dts=Math.max(H.dts,u),H.pts=Math.max(H.pts,H.dts,0),k=Math.min(H.pts,k),C=Math.max(H.pts,C)}h=p[y-1].dts;var W,z=j+4*B+8;try{W=new Uint8Array(z)}catch(de){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:z,reason:"fail allocating video mdat "+z})}var Y=new DataView(W.buffer);Y.setUint32(0,z),W.set(a.default.types.mdat,4);for(var X=0;X<y;X++){for(var Q=p[X],J=Q.units,$=0,Z=0,ee=J.length;Z<ee;Z++){var te=J[Z],re=te.data,ie=te.data.byteLength;Y.setUint32(S,ie),S+=4,W.set(re,S),S+=ie,$+=4+ie}if(X<y-1)n=p[X+1].dts-Q.dts;else{var ne=this.config,ae=Q.dts-p[X>0?X-1:X].dts;if(ne.stretchShortVideoTrack&&null!==this.nextAudioPts){var se=Math.floor(ne.maxBufferHole*f),oe=(i?k+i*f:this.nextAudioPts)-Q.pts;oe>se?((n=oe-ae)<0&&(n=ae),l.logger.log("[mp4-remuxer]: It is approximately "+oe/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=ae}else n=ae}var le=Math.round(Q.pts-Q.dts);g.push(new b(Q.key,n,$,le))}if(g.length&&v&&v<70){var ue=g[0].flags;ue.dependsOn=2,ue.isNonSync=0}console.assert(void 0!==n,"mp4SampleDuration must be computed"),this.nextAvcDts=E=h+n,this.isVideoContiguous=!0;var ce={data1:a.default.moof(e.sequenceNumber++,u,d({},e,{samples:g})),data2:W,startPTS:k/f,endPTS:(C+n)/f,startDTS:u/f,endDTS:E/f,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(W.length,"MDAT length must not be zero"),ce},t.remuxAudio=function(e,t,r,i,u){var c=e.inputTimeScale,v=c/(e.samplerate?e.samplerate:c),g=e.isAAC?f:p,m=g*v,y=this._initPTS,T=!e.isAAC&&this.typeSupported.mpeg,E=[],S=e.samples,k=T?0:8,C=this.nextAudioPts||-1,w=t*c;if(this.isAudioContiguous=r=r||S.length&&C>0&&(i&&Math.abs(w-C)<9e3||Math.abs(_(S[0].pts-y,w)-C)<20*m),S.forEach((function(e){e.pts=_(e.pts-y,w)})),!r||C<0){if(!(S=S.filter((function(e){return e.pts>=0}))).length)return;C=0===u?0:i?Math.max(0,w):S[0].pts}if(e.isAAC)for(var A=void 0!==u,L=this.config.maxAudioFramesDrift,x=0,D=C;x<S.length;x++){var R=S[x],I=R.pts,O=I-D,P=Math.abs(1e3*O/c);if(O<=-L*m&&A)0===x&&(l.logger.warn("Audio frame @ "+(I/c).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*O/c)+" ms."),this.nextAudioPts=C=D=I);else if(O>=L*m&&P<h&&A){var M=Math.round(O/m);(D=I-M*m)<0&&(M--,D+=m),0===x&&(this.nextAudioPts=C=D),l.logger.warn("[mp4-remuxer]: Injecting "+M+" audio frame @ "+(D/c).toFixed(3)+"s due to "+Math.round(1e3*O/c)+" ms gap.");for(var F=0;F<M;F++){var N=Math.max(D,0),B=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);B||(l.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),B=R.unit.subarray()),S.splice(x,0,{unit:B,pts:N}),D+=m,x++}}R.pts=D,D+=m}for(var j,U=null,H=null,G=0,K=S.length;K--;)G+=S[K].unit.byteLength;for(var V=0,q=S.length;V<q;V++){var W=S[V],z=W.unit,Y=W.pts;if(null!==H)E[V-1].duration=Math.round((Y-H)/v);else{if(r&&e.isAAC&&(Y=C),U=Y,!(G>0))return;G+=k;try{j=new Uint8Array(G)}catch(re){return void this.observer.emit(s.Events.ERROR,s.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating audio mdat "+G})}T||(new DataView(j.buffer).setUint32(0,G),j.set(a.default.types.mdat,4))}j.set(z,k);var X=z.byteLength;k+=X,E.push(new b(!0,g,X,0)),H=Y}var Q=E.length;if(Q){var J=E[E.length-1];this.nextAudioPts=C=H+v*J.duration;var $=T?new Uint8Array(0):a.default.moof(e.sequenceNumber++,U/v,d({},e,{samples:E}));e.samples=[];var Z=U/c,ee=C/c,te={data1:$,data2:j,startPTS:Z,endPTS:ee,startDTS:Z,endDTS:ee,type:"audio",hasAudio:!0,hasVideo:!1,nb:Q};return this.isAudioContiguous=!0,console.assert(j.length,"MDAT length must not be zero"),te}},t.remuxEmptyAudio=function(e,t,r,i){var a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o=this.nextAudioPts,u=(null!==o?o:i.startDTS*a)+this._initDTS,c=i.endDTS*a+this._initDTS,d=s*f,h=Math.ceil((c-u)/d),p=n.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(l.logger.warn("[mp4-remuxer]: remux empty Audio"),p){for(var v=[],g=0;g<h;g++){var m=u+g*d;v.push({unit:p,pts:m,dts:m})}return e.samples=v,this.remuxAudio(e,t,r,!1)}l.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t.remuxID3=function(e,t){var r=e.samples.length;if(r){for(var i=e.inputTimeScale,n=this._initPTS,a=this._initDTS,s=0;s<r;s++){var o=e.samples[s];o.pts=_(o.pts-n,t*i)/i,o.dts=_(o.dts-a,t*i)/i}var l=e.samples;return e.samples=[],{samples:l}}},t.remuxText=function(e,t){var r=e.samples.length;if(r){for(var i=e.inputTimeScale,n=this._initPTS,a=0;a<r;a++){var s=e.samples[a];s.pts=_(s.pts-n,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}},e}();function _(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function T(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}var b=function(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags=new E(e)},E=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/polyfills/number.ts"),n=r("./src/utils/mp4-tools.ts"),a=r("./src/loader/fragment.ts"),s=r("./src/utils/logger.ts"),o=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndDTS=null},t.resetNextTimestamp=function(){this.lastEndDTS=null},t.resetInitSegment=function(e,t,r){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Object(n.parseInitSegment)(e);t||(t=u(i.audio,a.ElementaryStreamTypes.AUDIO)),r||(r=u(i.video,a.ElementaryStreamTypes.VIDEO));var o={};i.audio&&i.video?o.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?o.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?o.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:s.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},t.remux=function(e,t,r,a,o){var u=this.initPTS,c=this.lastEndDTS,d={audio:void 0,video:void 0,text:a,id3:r,initSegment:void 0};Object(i.isFiniteNumber)(c)||(c=this.lastEndDTS=o||0);var h=t.samples;if(!h||!h.length)return d;var f={initPTS:void 0,timescale:1},p=this.initData;if((!p||!p.length)&&(this.generateInitSegment(h),p=this.initData),!p||!p.length)return s.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(i.isFiniteNumber)(u)||(this.initPTS=f.initPTS=u=l(p,h,c));var v=Object(n.getDuration)(h,p),g=c,m=v+g;Object(n.offsetStartDTS)(p,h,u),v>0?this.lastEndDTS=m:(s.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!p.audio,_=!!p.video,T="";y&&(T+="audio"),_&&(T+="video");var b={data1:h,startPTS:g,startDTS:g,endPTS:m,endDTS:m,type:T,hasAudio:y,hasVideo:_,nb:1,dropped:0};return d.audio="audio"===b.type?b:void 0,d.video="audio"!==b.type?b:void 0,d.text=a,d.id3=r,d.initSegment=f,d},e}(),l=function(e,t,r){return Object(n.getStartDTS)(e,t)-r};function u(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===a.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=o},"./src/task-loop.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}()},"./src/types/cmcd.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"CMCDVersion",(function(){return o})),r.d(t,"CMCDObjectType",(function(){return i})),r.d(t,"CMCDStreamingFormat",(function(){return a})),r.d(t,"CMCDStreamType",(function(){return s}));var i,n,a,s,o=1;(n=i||(i={})).MANIFEST="m",n.AUDIO="a",n.VIDEO="v",n.MUXED="av",n.INIT="i",n.CAPTION="c",n.TIMED_TEXT="tt",n.KEY="k",n.OTHER="o",function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(a||(a={})),function(e){e.VOD="v",e.LIVE="l"}(s||(s={}))},"./src/types/level.ts":function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}var a,s;function o(e,t){var r=e.canSkipUntil,i=e.canSkipDateRanges,n=e.endSN;return r&&(void 0!==t?t-n:0)<r?i?a.v2:a.Yes:a.No}r.r(t),r.d(t,"HlsSkip",(function(){return a})),r.d(t,"getSkipValue",(function(){return o})),r.d(t,"HlsUrlParameters",(function(){return l})),r.d(t,"Level",(function(){return u})),(s=a||(a={})).No="",s.Yes="YES",s.v2="v2";var l=function(){function e(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}return e.prototype.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.toString()},e}(),u=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}return n(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.details=void 0,this._urlId=t)}}]),e}()},"./src/types/loader.ts":function(e,t,r){"use strict";var i,n,a;r.r(t),r.d(t,"PlaylistContextType",(function(){return i})),r.d(t,"PlaylistLevelType",(function(){return a})),(n=i||(i={})).MANIFEST="manifest",n.LEVEL="level",n.AUDIO_TRACK="audioTrack",n.SUBTITLE_TRACK="subtitleTrack",function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(a||(a={}))},"./src/types/transmuxer.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"ChunkMetadata",(function(){return i}));var i=function(e,t,r,i,a,s){void 0===i&&(i=0),void 0===a&&(a=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=n(),this.buffering={audio:n(),video:n(),audiovideo:n()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=a,this.partial=s};function n(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"AttrList",(function(){return a}));var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function e(t){for(var r in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=i.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,r={},i='"';for(n.lastIndex=0;null!==(t=n.exec(e));){var a=t[2];0===a.indexOf(i)&&a.lastIndexOf(i)===a.length-1&&(a=a.slice(1,-1)),r[t[1]]=a}return r},e}()},"./src/utils/binary-search.ts":function(e,t,r){"use strict";r.r(t);var i={search:function(e,t){for(var r=0,i=e.length-1,n=null,a=null;r<=i;){var s=t(a=e[n=(r+i)/2|0]);if(s>0)r=n+1;else{if(!(s<0))return a;i=n-1}}return null}};t.default=i},"./src/utils/buffer-helper.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"BufferHelper",(function(){return a}));var i=r("./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function e(){}return e.isBuffered=function(t,r){try{if(t)for(var i=e.getBuffered(t),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(a){}return!1},e.bufferInfo=function(t,r,i){try{if(t){var n,a=e.getBuffered(t),s=[];for(n=0;n<a.length;n++)s.push({start:a.start(n),end:a.end(n)});return this.bufferedInfo(s,r,i)}}catch(o){}return{len:0,start:r,end:r,nextStart:void 0}},e.bufferedInfo=function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var i=[];if(r)for(var n=0;n<e.length;n++){var a=i.length;if(a){var s=i[a-1].end;e[n].start-s<r?e[n].end>s&&(i[a-1].end=e[n].end):i.push(e[n])}else i.push(e[n])}else i=e;for(var o,l=0,u=t,c=t,d=0;d<i.length;d++){var h=i[d].start,f=i[d].end;if(t+r>=h&&t<f)u=h,l=(c=f)-t;else if(t+r<h){o=h;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(t){return i.logger.log("failed to get media.buffered",t),n}},e}()},"./src/utils/cea-608-parser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"Row",(function(){return _})),r.d(t,"CaptionScreen",(function(){return T}));var i,n,a=r("./src/utils/logger.ts"),s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return s.hasOwnProperty(e)&&(t=s[e]),String.fromCharCode(t)},l=15,u=100,c={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(n=i||(i={}))[n.ERROR=0]="ERROR",n[n.TEXT=1]="TEXT",n[n.WARNING=2]="WARNING",n[n.INFO=2]="INFO",n[n.DEBUG=3]="DEBUG",n[n.DATA=3]="DATA";var v=function(){function e(){this.time=null,this.verboseLevel=i.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&a.logger.log(this.time+" ["+e+"] "+t)},e}(),g=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},m=function(){function e(e,t,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),y=function(){function e(e,t,r,i,n,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new m(t,r,i,n,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),_=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<u;t++)this.chars.push(new y);this.logger=e,this.pos=0,this.currPenState=new m}var t=e.prototype;return t.equals=function(e){for(var t=!0,r=0;r<u;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(i.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(this.logger.log(i.DEBUG,"Too large cursor position "+this.pos),this.pos=u)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=o(e);this.pos>=u?this.logger.log(i.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<u;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,r=0;r<u;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),T=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<l;t++)this.rows.push(new _(e));this.logger=e,this.currRow=l-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<l;e++)this.rows[e].clear();this.currRow=l-1},t.equals=function(e){for(var t=!0,r=0;r<l;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<l;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<l;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(i.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(i.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<l;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var s=a.rows[n].cueStartTime,o=this.logger.time;if(s&&null!==o&&s<o)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[n+u])}}this.currRow=t;var c=this.rows[this.currRow];if(null!==e.indent){var d=e.indent,h=Math.max(d-1,0);c.setCursor(e.indent),e.color=c.chars[h].penState.foreground}var f={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(f)},t.setBkgData=function(e){this.logger.log(i.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(i.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(i.INFO,"Rolling up")}else this.logger.log(i.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,n=0;n<l;n++){var a=this.rows[n].getTextString();a&&(i=n+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},t.getTextAndFormat=function(){return this.rows},e}(),b=function(){function e(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new T(r),this.nonDisplayedMemory=new T(r),this.lastOutputScreen=new T(r),this.currRollUpRow=this.displayedMemory.rows[l-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[l-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(i.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(i.INFO,r+": "+this.writeScreen.getDisplayText(!0)),("MODE_PAINT-ON"===this.mode||"MODE_ROLL-UP"===this.mode)&&(this.logger.log(i.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(i.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(i.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(i.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(i.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(i.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(i.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(i.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(i.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(i.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(i.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(i.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(i.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(i.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(i.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(i.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),E=function(){function e(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new v;this.channels=[null,new b(e,t,i),new b(e+1,r,i)],this.cmdHistory=C(),this.logger=i}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var r,n,a,s=!1;this.logger.time=e;for(var o=0;o<t.length;o+=2)if(n=127&t[o],a=127&t[o+1],0!==n||0!==a){if(this.logger.log(i.DATA,"["+g([t[o],t[o+1]])+"] -> ("+g([n,a])+")"),(r=this.parseCmd(n,a))||(r=this.parseMidrow(n,a)),r||(r=this.parsePAC(n,a)),r||(r=this.parseBackgroundAttributes(n,a)),!r&&(s=this.parseChars(n,a))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(s):this.logger.log(i.WARNING,"No channel found yet. TEXT-MODE?")}!r&&!s&&this.logger.log(i.WARNING,"Couldn't parse cleaned data "+g([n,a])+" orig: "+g([t[o],t[o+1]]))}},t.parseCmd=function(e,t){var r=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(k(e,t,r))return S(null,null,r),this.logger.log(i.DEBUG,"Repeated command ("+g([e,t])+") is dropped"),!0;var n=20===e||21===e||23===e?1:2,a=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),S(e,t,r),this.currentChannel=n,!0},t.parseMidrow=function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(i.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(i.DEBUG,"MIDROW ("+g([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var r,i=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(k(e,t,i))return S(null,null,i),!0;var n=e<=23?1:2;r=t>=64&&t<=95?1===n?c[e]:h[e]:1===n?d[e]:f[e];var a=this.channels[n];return!!a&&(a.setPAC(this.interpretPAC(r,t)),S(e,t,i),this.currentChannel=n,!0)},t.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},t.parseChars=function(e,t){var r,n,a=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19?(n=17===s?t+80:18===s?t+112:t+144,this.logger.log(i.INFO,"Special char '"+o(n)+"' in channel "+r),a=[n]):e>=32&&e<=127&&(a=0===t?[e]:[e,t]),a){var l=g(a);this.logger.log(i.DEBUG,"Char codes =  "+l.join(",")),S(e,t,this.cmdHistory)}return a},t.parseBackgroundAttributes=function(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;var r,i={};16===e||24===e?(r=Math.floor((t-32)/2),i.background=p[r],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));var n=e<=23?1:2;return this.channels[n].setBkgData(i),S(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory=C()},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},e}();function S(e,t,r){r.a=e,r.b=t}function k(e,t,r){return r.a===e&&r.b===t}function C(){return{a:null,b:null}}t.default=E},"./src/utils/codecs.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"isCodecType",(function(){return n})),r.d(t,"isCodecSupportedInMp4",(function(){return a}));var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function n(e,t){var r=i[t];return!!r&&!0===r[e.slice(0,4)]}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/cues.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/utils/vttparser.ts"),n=r("./src/utils/webvtt-parser.ts"),a=r("./src/utils/texttrack-utils.ts"),s=/\s/,o={newCue:function(e,t,r,o){for(var l,u,c,d,h,f=[],p=self.VTTCue||self.TextTrackCue,v=0;v<o.rows.length;v++)if(c=!0,d=0,h="",!(l=o.rows[v]).isEmpty()){for(var g=0;g<l.chars.length;g++)s.test(l.chars[g].uchar)&&c?d++:(h+=l.chars[g].uchar,c=!1);l.cueStartTime=t,t===r&&(r+=1e-4),d>=16?d--:d++;var m=Object(i.fixLineBreaks)(h.trim()),y=Object(n.generateCueId)(t,r,m);(!e||!e.cues||!e.cues.getCueById(y))&&((u=new p(t,r,m)).id=y,u.line=v+1,u.align="left",u.position=10+Math.min(80,10*Math.floor(8*d/32)),f.push(u))}return e&&f.length&&(f.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),f.forEach((function(t){return Object(a.addCueToTrack)(e,t)}))),f}};t.default=o},"./src/utils/discontinuities.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"findFirstFragWithCC",(function(){return s})),r.d(t,"shouldAlignOnDiscontinuities",(function(){return o})),r.d(t,"findDiscontinuousReferenceFrag",(function(){return l})),r.d(t,"adjustSlidingStart",(function(){return c})),r.d(t,"alignStream",(function(){return d})),r.d(t,"alignPDT",(function(){return f})),r.d(t,"alignFragmentByPDTDelta",(function(){return p})),r.d(t,"alignMediaPlaylistByPDT",(function(){return v}));var i=r("./src/polyfills/number.ts"),n=r("./src/utils/logger.ts"),a=r("./src/controller/level-helper.ts");function s(e,t){for(var r=null,i=0,n=e.length;i<n;i++){var a=e[i];if(a&&a.cc===t){r=a;break}}return r}function o(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}function l(e,t){var r=e.fragments,i=t.fragments;if(i.length&&r.length){var a=s(r,i[0].cc);if(a&&(!a||a.startPTS))return a;n.logger.log("No frag in previous level to align on")}else n.logger.log("No fragments to align")}function u(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function c(e,t){for(var r=t.fragments,i=0,n=r.length;i<n;i++)u(r[i],e);t.fragmentHint&&u(t.fragmentHint,e),t.alignedSliding=!0}function d(e,t,r){!t||(h(e,r,t),!r.alignedSliding&&t.details&&f(r,t.details),!r.alignedSliding&&t.details&&!r.skippedSegments&&Object(a.adjustSliding)(t.details,r))}function h(e,t,r){if(o(e,r,t)){var a=l(r.details,t);a&&Object(i.isFiniteNumber)(a.start)&&(n.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),c(a.start,t))}}function f(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime,a=e.fragments[0].programDateTime,s=(a-r)/1e3+t.fragments[0].start;s&&Object(i.isFiniteNumber)(s)&&(n.logger.log("Adjusting PTS using programDateTime delta "+(a-r)+"ms, sliding:"+s.toFixed(3)+" "+e.url+" "),c(s,e))}}function p(e,t){var r=e.programDateTime;if(r){var i=(r-t)/1e3;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function v(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime-1e3*t.fragments[0].start;e.fragments.forEach((function(e){p(e,r)})),e.fragmentHint&&p(e.fragmentHint,r),e.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/utils/ewma.ts"),n=function(){function e(e,t,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i.default(e),this.fast_=new i.default(t)}var t=e.prototype;return t.update=function(e,t){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new i.default(e,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new i.default(t,n.getEstimate(),n.getTotalWeight()))},t.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();t.default=n},"./src/utils/ewma.ts":function(e,t,r){"use strict";r.r(t);var i=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}();t.default=i},"./src/utils/fetch-loader.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"fetchSupported",(function(){return p}));var i=r("./src/polyfills/number.ts"),n=r("./src/loader/load-stats.ts"),a=r("./src/demux/chunk-cache.ts");function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){if(null===e||!c(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return l(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),d(r,e)},o(e)}function l(e,t,r){return(l=u()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&d(n,r.prototype),n}).apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(){return f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},f.apply(this,arguments)}function p(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var v=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||m,this.controller=new self.AbortController,this.stats=new n.LoadStats}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;(!e||!e.ok)&&(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,r){var n=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var s=g(e,this.controller.signal),o=r.onProgress,l="arraybuffer"===e.responseType,u=l?"byteLength":"length";this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(a,e,n.response)}),t.timeout),self.fetch(this.request).then((function(r){if(n.response=n.loader=r,!r.ok){var s=r.status,u=r.statusText;throw new y(u||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),o&&Object(i.isFiniteNumber)(t.highWaterMark)?n.loadProgressively(r,a,e,t.highWaterMark,o):l?r.arrayBuffer():r.text()})).then((function(s){var l=n.response;self.clearTimeout(n.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=s[u];var c={url:l.url,data:s};o&&!Object(i.isFiniteNumber)(t.highWaterMark)&&o(a,e,s,l),r.onSuccess(c,a,e,l)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!a.aborted){var i=t.code||0;r.onError({code:i,text:t.message},e,t.details)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.loadProgressively=function(e,t,r,i,n){void 0===i&&(i=0);var s=new a.default,o=e.body.getReader();return function a(){return o.read().then((function(o){if(o.done)return s.dataLength&&n(t,r,s.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=o.value,u=l.length;return t.loaded+=u,u<i||s.dataLength?(s.push(l),s.dataLength>=i&&n(t,r,s.flush(),e)):n(t,r,l,e),a()})).catch((function(){return Promise.reject()}))}()},e}();function g(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(f({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}function m(e,t){return new self.Request(e.url,t)}var y=function(e){function t(t,r,i){var n;return(n=e.call(this,t)||this).code=void 0,n.details=void 0,n.code=r,n.details=i,n}return s(t,e),t}(o(Error));t.default=v},"./src/utils/imsc1-ttml-parser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"IMSC1_CODEC",(function(){return c})),r.d(t,"parseIMSC1",(function(){return p}));var i=r("./src/utils/mp4-tools.ts"),n=r("./src/utils/vttparser.ts"),a=r("./src/utils/vttcue.ts"),s=r("./src/demux/id3.ts"),o=r("./src/utils/timescale-conversion.ts"),l=r("./src/utils/webvtt-parser.ts");function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},u.apply(this,arguments)}var c="stpp.ttml.im1t",d=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(e,t,r,n,a){var l=Object(i.findBox)(new Uint8Array(e),["mdat"]);if(0!==l.length){var u=l[0],c=Object(s.utf8ArrayToStr)(new Uint8Array(e,u.start,u.end-u.start)),d=Object(o.toTimescaleFromScale)(t,1,r);try{n(v(c,d))}catch(h){a(h)}}else a(new Error("Could not parse IMSC1 mdat"))}function v(e,t){var r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(i).reduce((function(e,t){return e[t]=r.getAttribute("ttp:"+t)||i[t],e}),{}),s="preserve"!==r.getAttribute("xml:space"),o=m(g(r,"styling","style")),c=m(g(r,"layout","region")),d=g(r,"body","[begin]");return[].map.call(d,(function(e){var r=y(e,s);if(!r||!e.hasAttribute("begin"))return null;var i=E(e.getAttribute("begin"),n),d=E(e.getAttribute("dur"),n),h=E(e.getAttribute("end"),n);if(null===i)throw b(e);if(null===h){if(null===d)throw b(e);h=i+d}var p=new a.default(i-t,h-t,r);p.id=Object(l.generateCueId)(p.startTime,p.endTime,p.text);var v=c[e.getAttribute("region")],g=o[e.getAttribute("style")];p.position=10,p.size=80;var m=_(v,g),T=m.textAlign;if(T){var S=f[T];S&&(p.lineAlign=S),p.align=T}return u(p,m),p})).filter((function(e){return null!==e}))}function g(e,t,r){var i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function m(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function y(e,t){return[].slice.call(e.childNodes).reduce((function(e,r,i){var n;return"br"===r.nodeName&&i?e+"\n":null!==(n=r.childNodes)&&void 0!==n&&n.length?y(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function _(e,t){var r="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(i,n){var a=T(t,r,n)||T(e,r,n);return a&&(i[n]=a),i}),{})}function T(e,t,r){return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function b(e){return new Error("Could not parse ttml timestamp "+e)}function E(e,t){if(!e)return null;var r=Object(n.parseTimeStamp)(e);return null===r&&(d.test(e)?r=S(e,t):h.test(e)&&(r=k(e,t))),r}function S(e,t){var r=d.exec(e),i=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/t.frameRate}function k(e,t){var r=h.exec(e),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}},"./src/utils/logger.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"enableLogs",(function(){return l})),r.d(t,"logger",(function(){return u}));var i=function(){},n={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=n;function s(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):i}function o(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach((function(t){a[t]=e[t]?e[t].bind(e):s(t)}))}function l(e){if(self.console&&!0===e||"object"==typeof e){o(e,"debug","log","info","warn","error");try{a.log()}catch(t){a=n}}else a=n}var u=n},"./src/utils/mediakeys-helper.ts":function(e,t,r){"use strict";var i,n;r.r(t),r.d(t,"KeySystems",(function(){return i})),r.d(t,"requestMediaKeySystemAccess",(function(){return a})),(n=i||(i={})).WIDEVINE="com.widevine.alpha",n.PLAYREADY="com.microsoft.playready";var a="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(e,t,r){"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(t),r.d(t,"getMediaSource",(function(){return i}))},"./src/utils/mp4-tools.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"bin2str",(function(){return o})),r.d(t,"readUint16",(function(){return l})),r.d(t,"readUint32",(function(){return u})),r.d(t,"writeUint32",(function(){return c})),r.d(t,"findBox",(function(){return d})),r.d(t,"parseSegmentIndex",(function(){return h})),r.d(t,"parseInitSegment",(function(){return f})),r.d(t,"getStartDTS",(function(){return p})),r.d(t,"getDuration",(function(){return v})),r.d(t,"computeRawDurationFromSamples",(function(){return g})),r.d(t,"offsetStartDTS",(function(){return m})),r.d(t,"segmentValidRange",(function(){return y})),r.d(t,"appendUint8Array",(function(){return _}));var i=r("./src/utils/typed-array.ts"),n=r("./src/loader/fragment.ts"),a=Math.pow(2,32)-1,s=[].push;function o(e){return String.fromCharCode.apply(null,e)}function l(e,t){"data"in e&&(t+=e.start,e=e.data);var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function u(e,t){"data"in e&&(t+=e.start,e=e.data);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r}function c(e,t,r){"data"in e&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function d(e,t){var r,i,n,a=[];if(!t.length)return a;"data"in e?(r=e.data,i=e.start,n=e.end):(i=0,n=(r=e).byteLength);for(var l=i;l<n;){var c=u(r,l),h=c>1?l+c:n;if(o(r.subarray(l+4,l+8))===t[0])if(1===t.length)a.push({data:r,start:l+8,end:h});else{var f=d({data:r,start:l+8,end:h},t.slice(1));f.length&&s.apply(a,f)}l=h}return a}function h(e){var t=d(e,["moov"])[0],r=t?t.end:null,i=d(e,["sidx"]);if(!i||!i[0])return null;var n=[],a=i[0],s=a.data[0],o=0===s?8:16,c=u(a,o);o+=4;var h=0,f=0;o+=0===s?8:16,o+=2;var p=a.end+f,v=l(a,o);o+=2;for(var g=0;g<v;g++){var m=o,y=u(a,m);m+=4;var _=2147483647&y;if(1===(2147483648&y)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var T=u(a,m);m+=4,n.push({referenceSize:_,subsegmentDuration:T,info:{duration:T/c,start:p,end:p+_-1}}),p+=_,o=m+=4}return{earliestPresentationTime:h,timescale:c,version:s,referencesCount:v,references:n,moovEndOffset:r}}function f(e){for(var t=[],r=d(e,["moov","trak"]),i=0;i<r.length;i++){var a=r[i],s=d(a,["tkhd"])[0];if(s){var l=s.data[s.start],c=0===l?12:20,h=u(s,c),f=d(a,["mdia","mdhd"])[0];if(f){var p=u(f,c=0===(l=f.data[f.start])?12:20),v=d(a,["mdia","hdlr"])[0];if(v){var g=o(v.data.subarray(v.start+8,v.start+12)),m={soun:n.ElementaryStreamTypes.AUDIO,vide:n.ElementaryStreamTypes.VIDEO}[g];if(m){var y=d(a,["mdia","minf","stbl","stsd"])[0],_=void 0;y&&(_=o(y.data.subarray(y.start+12,y.start+16))),t[h]={timescale:p,type:m},t[m]={timescale:p,id:h,codec:_}}}}}}return d(e,["moov","mvex","trex"]).forEach((function(e){var r=u(e,4),i=t[r];i&&(i.default={duration:u(e,12),flags:u(e,20)})})),t}function p(e,t){return d(t,["moof","traf"]).reduce((function(t,r){var i=d(r,["tfdt"])[0],n=i.data[i.start],a=d(r,["tfhd"]).reduce((function(t,r){var a=u(r,4),s=e[a];if(s){var o=u(i,4);1===n&&(o*=Math.pow(2,32),o+=u(i,8));var l=o/(s.timescale||9e4);if(isFinite(l)&&(null===t||l<t))return l}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)||0}function v(e,t){for(var r=0,i=0,a=0,s=d(e,["moof","traf"]),o=0;o<s.length;o++){var l=s[o],c=d(l,["tfhd"])[0],f=t[u(c,4)];if(f){var p=f.default,v=u(c,0)|(null==p?void 0:p.flags),m=null==p?void 0:p.duration;8&v&&(m=u(c,2&v?12:8));for(var y=f.timescale||9e4,_=d(l,["trun"]),T=0;T<_.length;T++)!(r=g(_[T]))&&m&&(r=m*u(_[T],4)),f.type===n.ElementaryStreamTypes.VIDEO?i+=r/y:f.type===n.ElementaryStreamTypes.AUDIO&&(a+=r/y)}}if(0===i&&0===a){var b=h(e);if(null!=b&&b.references)return b.references.reduce((function(e,t){return e+t.info.duration||0}),0)}return i||a}function g(e){var t=u(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var i=0,n=u(e,4),a=0;a<n;a++)256&t&&(i+=u(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return i}function m(e,t,r){d(t,["moof","traf"]).forEach((function(t){d(t,["tfhd"]).forEach((function(i){var n=u(i,4),s=e[n];if(s){var o=s.timescale||9e4;d(t,["tfdt"]).forEach((function(e){var t=e.data[e.start],i=u(e,4);if(0===t)c(e,4,i-r*o);else{i*=Math.pow(2,32),i+=u(e,8),i-=r*o,i=Math.max(i,0);var n=Math.floor(i/(a+1)),s=Math.floor(i%(a+1));c(e,4,n),c(e,8,s)}}))}}))}))}function y(e){var t={valid:null,remainder:null},r=d(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var n=r[r.length-1];return t.valid=Object(i.sliceUint8)(e,0,n.start-8),t.remainder=Object(i.sliceUint8)(e,n.start-8),t}function _(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}},"./src/utils/output-filter.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var i=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"sendAddTrackEvent",(function(){return n})),r.d(t,"addCueToTrack",(function(){return a})),r.d(t,"clearCurrentCues",(function(){return s})),r.d(t,"removeCuesInRange",(function(){return o})),r.d(t,"getCuesInRange",(function(){return u}));var i=r("./src/utils/logger.ts");function n(e,t){var r;try{r=new Event("addtrack")}catch(i){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function a(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(a){i.logger.debug("[texttrack-utils]: "+a);var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}"disabled"===r&&(e.mode=r)}function s(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function o(e,t,r){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var n=u(e.cues,t,r),a=0;a<n.length;a++)e.removeCue(n[a]);"disabled"===i&&(e.mode=i)}function l(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var i=0,n=r;i<=n;){var a=Math.floor((n+i)/2);if(t<e[a].startTime)n=a-1;else{if(!(t>e[a].startTime&&i<r))return a;i=a+1}}return e[i].startTime-t<t-e[n].startTime?i:n}function u(e,t,r){var i=[],n=l(e,t);if(n>-1)for(var a=n,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}},"./src/utils/time-ranges.ts":function(e,t,r){"use strict";r.r(t);var i={toString:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}};t.default=i},"./src/utils/timescale-conversion.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"toTimescaleFromBase",(function(){return n})),r.d(t,"toTimescaleFromScale",(function(){return a})),r.d(t,"toMsFromMpegTsClock",(function(){return s})),r.d(t,"toMpegTsClockFromTimescale",(function(){return o}));var i=9e4;function n(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=e*t*r;return i?Math.round(n):n}function a(e,t,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),n(e,t,1/r,i)}function s(e,t){return void 0===t&&(t=!1),n(e,1e3,1/i,t)}function o(e,t){return void 0===t&&(t=1),n(e,i,1/t)}},"./src/utils/typed-array.ts":function(e,t,r){"use strict";function i(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}r.r(t),r.d(t,"sliceUint8",(function(){return i}))},"./src/utils/vttcue.ts":function(e,t,r){"use strict";r.r(t),t.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t||!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function i(t){return r(e,t)}function n(e){return r(t,e)}function a(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var s in a)e[s]=a[s]}return e}function s(e,t,r){var s=this,o={enumerable:!0};s.hasBeenReset=!1;var l="",u=!1,c=e,d=t,h=r,f=null,p="",v=!0,g="auto",m="start",y=50,_="middle",T=50,b="middle";Object.defineProperty(s,"id",a({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",a({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",a({},o,{get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",a({},o,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",a({},o,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",a({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",a({},o,{get:function(){return p},set:function(e){var t=i(e);if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",a({},o,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",a({},o,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",a({},o,{get:function(){return m},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",a({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",a({},o,{get:function(){return _},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",a({},o,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",a({},o,{get:function(){return b},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),s.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"parseTimeStamp",(function(){return a})),r.d(t,"fixLineBreaks",(function(){return d})),r.d(t,"VTTParser",(function(){return h}));var i=r("./src/utils/vttcue.ts"),n=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}();function a(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(i||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var s=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)},t.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},e}();function o(e,t,r,i){var n=i?e.split(i):[e];for(var a in n)if("string"==typeof n[a]){var s=n[a].split(r);2===s.length&&t(s[0],s[1])}}var l=new i.default(0,0,""),u="middle"===l.align?"middle":"center";function c(e,t,r){var i=e;function n(){var t=a(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(e,t){var i=new s;o(e,(function(e,t){var n;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){i.set(e,r[a].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),i.integer(e,n[0]),i.percent(e,n[0])&&i.set("snapToLines",!1),i.alt(e,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",u,"end"]);break;case"position":n=t.split(","),i.percent(e,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",u,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",u,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===l.line&&(n=-1),t.line=n,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",u);var a=i.get("position","auto");"auto"===a&&50===l.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}function d(){e=e.replace(/^\s+/,"")}if(d(),t.startTime=n(),d(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),d(),t.endTime=n(),d(),c(e,t)}function d(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var h=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=d(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var i=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),i}function n(e){o(e,(function(e,t){}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var a="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var s=(a=r()).match(/^(\xef\xbb\xbf)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var l=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:a=r(),t.state){case"HEADER":/:/.test(a)?n(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new i.default(0,0,""),t.state="CUE",-1===a.indexOf("--\x3e")){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{c(a,t.cue,t.regionList)}catch(h){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var u=-1!==a.indexOf("--\x3e");if(!a||u&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=a;continue;case"BADCUE":a||(t.state="ID")}}}catch(h){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},e}()},"./src/utils/webvtt-parser.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"generateCueId",(function(){return h})),r.d(t,"parseWebVTT",(function(){return p}));var i=r("./src/polyfills/number.ts"),n=r("./src/utils/vttparser.ts"),a=r("./src/demux/id3.ts"),s=r("./src/utils/timescale-conversion.ts"),o=r("./src/remux/mp4-remuxer.ts"),l=/\r\n|\n\r|\n|\r/g,u=function(e,t,r){return void 0===r&&(r=0),e.substr(r,t.length)===t},c=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!Object(i.isFiniteNumber)(t)||!Object(i.isFiniteNumber)(r)||!Object(i.isFiniteNumber)(n)||!Object(i.isFiniteNumber)(a))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,t+=6e4*n,t+=36e5*a},d=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function h(e,t,r){return d(e.toString())+d(t.toString())+d(r)}var f=function(e,t,r){var i=e[t],n=e[i.prevCC];if(!n||!n.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!==(a=n)&&void 0!==a&&a.new;){var a;e.ccOffset+=i.start-n.start,i.new=!1,n=e[(i=n).prevCC]}e.presentationOffset=r};function p(e,t,r,i,d,p,v,g){var m,y=new n.VTTParser,_=Object(a.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(l,"\n").split("\n"),T=[],b=Object(s.toMpegTsClockFromTimescale)(t,r),E="00:00.000",S=0,k=0,C=!0,w=!1;y.oncue=function(e){var t=i[d],r=i.ccOffset,n=(S-b)/9e4;if(null!=t&&t.new&&(void 0!==k?r=i.ccOffset=t.start:f(i,d,n)),n&&(r=n-i.presentationOffset),w){var a=e.endTime-e.startTime,s=Object(o.normalizePts)(9e4*(e.startTime+r-k),9e4*p)/9e4;e.startTime=s,e.endTime=s+a}var l=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(l)),e.id||(e.id=h(e.startTime,e.endTime,l)),e.endTime>0&&T.push(e)},y.onparsingerror=function(e){m=e},y.onflush=function(){m?g(m):v(T)},_.forEach((function(e){if(C){if(u(e,"X-TIMESTAMP-MAP=")){C=!1,w=!0,e.substr(16).split(",").forEach((function(e){u(e,"LOCAL:")?E=e.substr(6):u(e,"MPEGTS:")&&(S=parseInt(e.substr(7)))}));try{k=c(E)/1e3}catch(t){w=!1,m=t}return}""===e&&(C=!1)}y.parse(e+"\n")})),y.flush()}},"./src/utils/xhr-loader.ts":function(e,t,r){"use strict";r.r(t);var i=r("./src/utils/logger.ts"),n=r("./src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,s=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new n.LoadStats,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.config,t=this.context;if(e){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,t.url)}catch(o){r.open("GET",t.url,!0),n(r,t.url)}r.readyState||r.open("GET",t.url,!0);var a=this.context.headers;if(a)for(var s in a)r.setRequestHeader(s,a[s])}catch(o){return void this.callbacks.onError({code:r.status,text:o.message},t,r)}t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),r.send()}},t.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var n=t.readyState,a=this.config;if(!r.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===n){t.onreadystatechange=null,t.onprogress=null;var s=t.status;if(s>=200&&s<300){var o,l;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),l="arraybuffer"===e.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=l,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o};this.callbacks.onSuccess(c,r,e,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(i.logger.error(s+" while loading "+e.url),this.callbacks.onError({code:s,text:t.statusText},e,t)):(i.logger.warn(s+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},t.loadtimeout=function(){i.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},e}();t.default=s}}).default},e.exports=t())},988:e=>{e.exports=r;var t=Object.prototype.toString;function r(e){if(!e)return!1;var r=t.call(e);return"[object Function]"===r||"function"==typeof e&&"[object RegExp]"!==r||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}},642:(e,t)=>{function r(e){if(e&&"object"==typeof e){var t=e.which||e.keyCode||e.charCode;t&&(e=t)}if("number"==typeof e)return s[e];var r,a=String(e);return(r=i[a.toLowerCase()])?r:(r=n[a.toLowerCase()])||(1===a.length?a.charCodeAt(0):void 0)}r.isEventKey=function(e,t){if(e&&"object"==typeof e){var r=e.which||e.keyCode||e.charCode;if(null==r)return!1;if("string"==typeof t){var a;if(a=i[t.toLowerCase()])return a===r;if(a=n[t.toLowerCase()])return a===r}else if("number"==typeof t)return t===r;return!1}};var i=(t=e.exports=r).code=t.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n=t.aliases={windows:91,"\u21e7":16,"\u2325":18,"\u2303":17,"\u2318":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(a=97;a<123;a++)i[String.fromCharCode(a)]=a-32;for(var a=48;a<58;a++)i[a-48]=a;for(a=1;a<13;a++)i["f"+a]=a+111;for(a=0;a<10;a++)i["numpad "+a]=a+96;var s=t.names=t.title={};for(a in i)s[i[a]]=a;for(var o in n)i[o]=n[o]},54:e=>{function t(e,t){var r,i=null;try{r=JSON.parse(e,t)}catch(n){i=n}return[i,r]}e.exports=t},207:(e,t,r)=>{"use strict";var i=r(697),n=r(675),a=r(723),s=r(642),o=r(477),l=r(743),u=r(54),c=r(424),d=r(497),h=r(811),f=r(324);function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}for(var v,g=p(i),m=p(n),y=p(a),_=p(s),T=p(o),b=p(l),E=p(u),S=p(c),k=p(d),C=p(h),w=p(f),A="7.18.1",L={},x=function(e,t){return L[e]=L[e]||[],t&&(L[e]=L[e].concat(t)),L[e]},D=function(e,t){x(e,t)},R=function(e,t){var r=x(e).indexOf(t);return!(r<=-1)&&(L[e]=L[e].slice(),L[e].splice(r,1),!0)},I=function(e,t){x(e,[].concat(t).map((function(t){var r=function r(){return R(e,r),t.apply(void 0,arguments)};return r})))},O={prefixed:!0},P=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],M=P[0],F=0;F<P.length;F++)if(P[F][1]in m.default){v=P[F];break}if(v){for(var N=0;N<v.length;N++)O[M[N]]=v[N];O.prefixed=v[0]!==M[0]}var B=[],j=function(e,t){return function(r,i,n){var a=t.levels[i],s=new RegExp("^("+a+")$");if("log"!==r&&n.unshift(r.toUpperCase()+":"),n.unshift(e+":"),B){B.push([].concat(n));var o=B.length-1e3;B.splice(0,o>0?o:0)}if(g.default.console){var l=g.default.console[r];!l&&"debug"===r&&(l=g.default.console.info||g.default.console.log),l&&a&&s.test(r)&&l[Array.isArray(n)?"apply":"call"](g.default.console,n)}}};function U(e){var t,r="info",i=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];t("log",r,i)};return t=j(e,i),i.createLogger=function(t){return U(e+": "+t)},i.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:r},i.level=function(e){if("string"==typeof e){if(!i.levels.hasOwnProperty(e))throw new Error('"'+e+'" in not a valid log level');r=e}return r},i.history=function(){return B?[].concat(B):[]},i.history.filter=function(e){return(B||[]).filter((function(t){return new RegExp(".*"+e+".*").test(t[0])}))},i.history.clear=function(){B&&(B.length=0)},i.history.disable=function(){null!==B&&(B.length=0,B=null)},i.history.enable=function(){null===B&&(B=[])},i.error=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t("error",r,i)},i.warn=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t("warn",r,i)},i.debug=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return t("debug",r,i)},i}var H=U("VIDEOJS"),G=H.createLogger,K=Object.prototype.toString,V=function(e){return Y(e)?Object.keys(e):[]};function q(e,t){V(e).forEach((function(r){return t(e[r],r)}))}function W(e,t,r){return void 0===r&&(r=0),V(e).reduce((function(r,i){return t(r,e[i],i)}),r)}function z(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return Object.assign?y.default.apply(void 0,[e].concat(r)):(r.forEach((function(t){!t||q(t,(function(t,r){e[r]=t}))})),e)}function Y(e){return!!e&&"object"==typeof e}function X(e){return Y(e)&&"[object Object]"===K.call(e)&&e.constructor===Object}function Q(e,t){if(!e||!t)return"";if("function"==typeof g.default.getComputedStyle){var r;try{r=g.default.getComputedStyle(e)}catch(i){return""}return r?r.getPropertyValue(t)||r[t]:""}return""}var J=g.default.navigator&&g.default.navigator.userAgent||"",$=/AppleWebKit\/([\d.]+)/i.exec(J),Z=$?parseFloat($.pop()):null,ee=/iPod/i.test(J),te=function(){var e=J.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),re=/Android/i.test(J),ie=function(){var e=J.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),r=e[2]&&parseFloat(e[2]);return t&&r?parseFloat(e[1]+"."+e[2]):t||null}(),ne=re&&ie<5&&Z<537,ae=/Firefox/i.test(J),se=/Edg/i.test(J),oe=!se&&(/Chrome/i.test(J)||/CriOS/i.test(J)),le=function(){var e=J.match(/(Chrome|CriOS)\/(\d+)/);return e&&e[2]?parseFloat(e[2]):null}(),ue=function(){var e=/MSIE\s(\d+)\.\d/.exec(J),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(J)&&/rv:11.0/.test(J)&&(t=11),t}(),ce=/Safari/i.test(J)&&!oe&&!re&&!se,de=/Windows/i.test(J),he=Boolean(be()&&("ontouchstart"in g.default||g.default.navigator.maxTouchPoints||g.default.DocumentTouch&&g.default.document instanceof g.default.DocumentTouch)),fe=/iPad/i.test(J)||ce&&he&&!/iPhone/i.test(J),pe=/iPhone/i.test(J)&&!fe,ve=pe||fe||ee,ge=(ce||ve)&&!oe,me=Object.freeze({__proto__:null,IS_IPOD:ee,IOS_VERSION:te,IS_ANDROID:re,ANDROID_VERSION:ie,IS_NATIVE_ANDROID:ne,IS_FIREFOX:ae,IS_EDGE:se,IS_CHROME:oe,CHROME_VERSION:le,IE_VERSION:ue,IS_SAFARI:ce,IS_WINDOWS:de,TOUCH_ENABLED:he,IS_IPAD:fe,IS_IPHONE:pe,IS_IOS:ve,IS_ANY_SAFARI:ge});function ye(e){return"string"==typeof e&&Boolean(e.trim())}function _e(e){if(e.indexOf(" ")>=0)throw new Error("class has illegal whitespace characters")}function Te(e){return new RegExp("(^|\\s)"+e+"($|\\s)")}function be(){return m.default===g.default.document}function Ee(e){return Y(e)&&1===e.nodeType}function Se(){try{return g.default.parent!==g.default.self}catch(e){return!0}}function ke(e){return function(t,r){if(!ye(t))return m.default[e](null);ye(r)&&(r=m.default.querySelector(r));var i=Ee(r)?r:m.default;return i[e]&&i[e](t)}}function Ce(e,t,r,i){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===r&&(r={});var n=m.default.createElement(e);return Object.getOwnPropertyNames(t).forEach((function(e){var r=t[e];-1!==e.indexOf("aria-")||"role"===e||"type"===e?(H.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+e+" to "+r+"."),n.setAttribute(e,r)):"textContent"===e?we(n,r):(n[e]!==r||"tabIndex"===e)&&(n[e]=r)})),Object.getOwnPropertyNames(r).forEach((function(e){n.setAttribute(e,r[e])})),i&&qe(n,i),n}function we(e,t){return"undefined"==typeof e.textContent?e.innerText=t:e.textContent=t,e}function Ae(e,t){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)}function Le(e,t){return _e(t),e.classList?e.classList.contains(t):Te(t).test(e.className)}function xe(e,t){return e.classList?e.classList.add(t):Le(e,t)||(e.className=(e.className+" "+t).trim()),e}function De(e,t){return e?(e.classList?e.classList.remove(t):(_e(t),e.className=e.className.split(/\s+/).filter((function(e){return e!==t})).join(" ")),e):(H.warn("removeClass was called with an element that doesn't exist"),null)}function Re(e,t,r){var i=Le(e,t);if("function"==typeof r&&(r=r(e,t)),"boolean"!=typeof r&&(r=!i),r!==i)return r?xe(e,t):De(e,t),e}function Ie(e,t){Object.getOwnPropertyNames(t).forEach((function(r){var i=t[r];null===i||"undefined"==typeof i||!1===i?e.removeAttribute(r):e.setAttribute(r,!0===i?"":i)}))}function Oe(e){var t={},r=",autoplay,controls,playsinline,loop,muted,default,defaultMuted,";if(e&&e.attributes&&e.attributes.length>0)for(var i=e.attributes,n=i.length-1;n>=0;n--){var a=i[n].name,s=i[n].value;("boolean"==typeof e[a]||-1!==r.indexOf(","+a+","))&&(s=null!==s),t[a]=s}return t}function Pe(e,t){return e.getAttribute(t)}function Me(e,t,r){e.setAttribute(t,r)}function Fe(e,t){e.removeAttribute(t)}function Ne(){m.default.body.focus(),m.default.onselectstart=function(){return!1}}function Be(){m.default.onselectstart=function(){return!0}}function je(e){if(e&&e.getBoundingClientRect&&e.parentNode){var t=e.getBoundingClientRect(),r={};return["bottom","height","left","right","top","width"].forEach((function(e){void 0!==t[e]&&(r[e]=t[e])})),r.height||(r.height=parseFloat(Q(e,"height"))),r.width||(r.width=parseFloat(Q(e,"width"))),r}}function Ue(e){if(!e||e&&!e.offsetParent)return{left:0,top:0,width:0,height:0};for(var t=e.offsetWidth,r=e.offsetHeight,i=0,n=0;e.offsetParent&&e!==m.default[O.fullscreenElement];)i+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:i,top:n,width:t,height:r}}function He(e,t){var r={x:0,y:0};if(ve)for(var i=e;i&&"html"!==i.nodeName.toLowerCase();){var n=Q(i,"transform");if(/^matrix/.test(n)){var a=n.slice(7,-1).split(/,\s/).map(Number);r.x+=a[4],r.y+=a[5]}else if(/^matrix3d/.test(n)){var s=n.slice(9,-1).split(/,\s/).map(Number);r.x+=s[12],r.y+=s[13]}i=i.parentNode}var o={},l=Ue(t.target),u=Ue(e),c=u.width,d=u.height,h=t.offsetY-(u.top-l.top),f=t.offsetX-(u.left-l.left);return t.changedTouches&&(f=t.changedTouches[0].pageX-u.left,h=t.changedTouches[0].pageY+u.top,ve&&(f-=r.x,h-=r.y)),o.y=1-Math.max(0,Math.min(1,h/d)),o.x=Math.max(0,Math.min(1,f/c)),o}function Ge(e){return Y(e)&&3===e.nodeType}function Ke(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}function Ve(e){return"function"==typeof e&&(e=e()),(Array.isArray(e)?e:[e]).map((function(e){return"function"==typeof e&&(e=e()),Ee(e)||Ge(e)?e:"string"==typeof e&&/\S/.test(e)?m.default.createTextNode(e):void 0})).filter((function(e){return e}))}function qe(e,t){return Ve(t).forEach((function(t){return e.appendChild(t)})),e}function We(e,t){return qe(Ke(e),t)}function ze(e){return void 0===e.button&&void 0===e.buttons||0===e.button&&void 0===e.buttons||"mouseup"===e.type&&0===e.button&&0===e.buttons||!(0!==e.button||1!==e.buttons)}var Ye,Xe=ke("querySelector"),Qe=ke("querySelectorAll"),Je=Object.freeze({__proto__:null,isReal:be,isEl:Ee,isInFrame:Se,createEl:Ce,textContent:we,prependTo:Ae,hasClass:Le,addClass:xe,removeClass:De,toggleClass:Re,setAttributes:Ie,getAttributes:Oe,getAttribute:Pe,setAttribute:Me,removeAttribute:Fe,blockTextSelection:Ne,unblockTextSelection:Be,getBoundingClientRect:je,findPosition:Ue,getPointerPosition:He,isTextNode:Ge,emptyEl:Ke,normalizeContent:Ve,appendContent:qe,insertContent:We,isSingleLeftClick:ze,$:Xe,$$:Qe}),$e=!1,Ze=function(){if(!1!==Ye.options.autoSetup){var e=Array.prototype.slice.call(m.default.getElementsByTagName("video")),t=Array.prototype.slice.call(m.default.getElementsByTagName("audio")),r=Array.prototype.slice.call(m.default.getElementsByTagName("video-js")),i=e.concat(t,r);if(i&&i.length>0)for(var n=0,a=i.length;n<a;n++){var s=i[n];if(!s||!s.getAttribute){et(1);break}void 0===s.player&&null!==s.getAttribute("data-setup")&&Ye(s)}else $e||et(1)}};function et(e,t){!be()||(t&&(Ye=t),g.default.setTimeout(Ze,e))}function tt(){$e=!0,g.default.removeEventListener("load",tt)}be()&&("complete"===m.default.readyState?tt():g.default.addEventListener("load",tt));var rt,it=function(e){var t=m.default.createElement("style");return t.className=e,t},nt=function(e,t){e.styleSheet?e.styleSheet.cssText=t:e.textContent=t},at=3;function st(){return at++}g.default.WeakMap||(rt=function(){function e(){this.vdata="vdata"+Math.floor(g.default.performance&&g.default.performance.now()||Date.now()),this.data={}}var t=e.prototype;return t.set=function(e,t){var r=e[this.vdata]||st();return e[this.vdata]||(e[this.vdata]=r),this.data[r]=t,this},t.get=function(e){var t=e[this.vdata];if(t)return this.data[t];H("We have no data for this element",e)},t.has=function(e){return e[this.vdata]in this.data},t.delete=function(e){var t=e[this.vdata];t&&(delete this.data[t],delete e[this.vdata])},e}());var ot=g.default.WeakMap?new WeakMap:new rt;function lt(e,t){if(ot.has(e)){var r=ot.get(e);0===r.handlers[t].length&&(delete r.handlers[t],e.removeEventListener?e.removeEventListener(t,r.dispatcher,!1):e.detachEvent&&e.detachEvent("on"+t,r.dispatcher)),Object.getOwnPropertyNames(r.handlers).length<=0&&(delete r.handlers,delete r.dispatcher,delete r.disabled),0===Object.getOwnPropertyNames(r).length&&ot.delete(e)}}function ut(e,t,r,i){r.forEach((function(r){e(t,r,i)}))}function ct(e){if(e.fixed_)return e;function t(){return!0}function r(){return!1}if(!e||!e.isPropagationStopped||!e.isImmediatePropagationStopped){var i=e||g.default.event;for(var n in e={},i)"layerX"!==n&&"layerY"!==n&&"keyLocation"!==n&&"webkitMovementX"!==n&&"webkitMovementY"!==n&&("returnValue"===n&&i.preventDefault||(e[n]=i[n]));if(e.target||(e.target=e.srcElement||m.default),e.relatedTarget||(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement),e.preventDefault=function(){i.preventDefault&&i.preventDefault(),e.returnValue=!1,i.returnValue=!1,e.defaultPrevented=!0},e.defaultPrevented=!1,e.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),e.cancelBubble=!0,i.cancelBubble=!0,e.isPropagationStopped=t},e.isPropagationStopped=r,e.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),e.isImmediatePropagationStopped=t,e.stopPropagation()},e.isImmediatePropagationStopped=r,null!==e.clientX&&void 0!==e.clientX){var a=m.default.documentElement,s=m.default.body;e.pageX=e.clientX+(a&&a.scrollLeft||s&&s.scrollLeft||0)-(a&&a.clientLeft||s&&s.clientLeft||0),e.pageY=e.clientY+(a&&a.scrollTop||s&&s.scrollTop||0)-(a&&a.clientTop||s&&s.clientTop||0)}e.which=e.charCode||e.keyCode,null!==e.button&&void 0!==e.button&&(e.button=1&e.button?0:4&e.button?1:2&e.button?2:0)}return e.fixed_=!0,e}var dt,ht=function(){if("boolean"!=typeof dt){dt=!1;try{var e=Object.defineProperty({},"passive",{get:function(){dt=!0}});g.default.addEventListener("test",null,e),g.default.removeEventListener("test",null,e)}catch(t){}}return dt},ft=["touchstart","touchmove"];function pt(e,t,r){if(Array.isArray(t))return ut(pt,e,t,r);ot.has(e)||ot.set(e,{});var i=ot.get(e);if(i.handlers||(i.handlers={}),i.handlers[t]||(i.handlers[t]=[]),r.guid||(r.guid=st()),i.handlers[t].push(r),i.dispatcher||(i.disabled=!1,i.dispatcher=function(t,r){if(!i.disabled){t=ct(t);var n=i.handlers[t.type];if(n)for(var a=n.slice(0),s=0,o=a.length;s<o&&!t.isImmediatePropagationStopped();s++)try{a[s].call(e,t,r)}catch(l){H.error(l)}}}),1===i.handlers[t].length)if(e.addEventListener){var n=!1;ht()&&ft.indexOf(t)>-1&&(n={passive:!0}),e.addEventListener(t,i.dispatcher,n)}else e.attachEvent&&e.attachEvent("on"+t,i.dispatcher)}function vt(e,t,r){if(ot.has(e)){var i=ot.get(e);if(i.handlers){if(Array.isArray(t))return ut(vt,e,t,r);var n=function(e,t){i.handlers[t]=[],lt(e,t)};if(void 0===t){for(var a in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},a)&&n(e,a);return}var s=i.handlers[t];if(s){if(!r)return void n(e,t);if(r.guid)for(var o=0;o<s.length;o++)s[o].guid===r.guid&&s.splice(o--,1);lt(e,t)}}}}function gt(e,t,r){var i=ot.has(e)?ot.get(e):{},n=e.parentNode||e.ownerDocument;if("string"==typeof t?t={type:t,target:e}:t.target||(t.target=e),t=ct(t),i.dispatcher&&i.dispatcher.call(e,t,r),n&&!t.isPropagationStopped()&&!0===t.bubbles)gt.call(null,n,t,r);else if(!n&&!t.defaultPrevented&&t.target&&t.target[t.type]){ot.has(t.target)||ot.set(t.target,{});var a=ot.get(t.target);t.target[t.type]&&(a.disabled=!0,"function"==typeof t.target[t.type]&&t.target[t.type](),a.disabled=!1)}return!t.defaultPrevented}function mt(e,t,r){if(Array.isArray(t))return ut(mt,e,t,r);var i=function i(){vt(e,t,i),r.apply(this,arguments)};i.guid=r.guid=r.guid||st(),pt(e,t,i)}function yt(e,t,r){var i=function i(){vt(e,t,i),r.apply(this,arguments)};i.guid=r.guid=r.guid||st(),pt(e,t,i)}var _t,Tt=Object.freeze({__proto__:null,fixEvent:ct,on:pt,off:vt,trigger:gt,one:mt,any:yt}),bt=30,Et=function(e,t,r){t.guid||(t.guid=st());var i=t.bind(e);return i.guid=r?r+"_"+t.guid:t.guid,i},St=function(e,t){var r=g.default.performance.now(),i=function(){var i=g.default.performance.now();i-r>=t&&(e.apply(void 0,arguments),r=i)};return i},kt=function(e,t,r,i){void 0===i&&(i=g.default);var n,a=function(){i.clearTimeout(n),n=null},s=function(){var a=this,s=arguments,o=function(){n=null,o=null,r||e.apply(a,s)};!n&&r&&e.apply(a,s),i.clearTimeout(n),n=i.setTimeout(o,t)};return s.cancel=a,s},Ct=function(){};Ct.prototype.allowedEvents_={},Ct.prototype.on=function(e,t){var r=this.addEventListener;this.addEventListener=function(){},pt(this,e,t),this.addEventListener=r},Ct.prototype.addEventListener=Ct.prototype.on,Ct.prototype.off=function(e,t){vt(this,e,t)},Ct.prototype.removeEventListener=Ct.prototype.off,Ct.prototype.one=function(e,t){var r=this.addEventListener;this.addEventListener=function(){},mt(this,e,t),this.addEventListener=r},Ct.prototype.any=function(e,t){var r=this.addEventListener;this.addEventListener=function(){},yt(this,e,t),this.addEventListener=r},Ct.prototype.trigger=function(e){var t=e.type||e;"string"==typeof e&&(e={type:t}),e=ct(e),this.allowedEvents_[t]&&this["on"+t]&&this["on"+t](e),gt(this,e)},Ct.prototype.dispatchEvent=Ct.prototype.trigger,Ct.prototype.queueTrigger=function(e){var t=this;_t||(_t=new Map);var r=e.type||e,i=_t.get(this);i||(i=new Map,_t.set(this,i));var n=i.get(r);i.delete(r),g.default.clearTimeout(n);var a=g.default.setTimeout((function(){0===i.size&&(i=null,_t.delete(t)),t.trigger(e)}),0);i.set(r,a)};var wt=function(e){return"function"==typeof e.name?e.name():"string"==typeof e.name?e.name:e.name_?e.name_:e.constructor&&e.constructor.name?e.constructor.name:typeof e},At=function(e){return e instanceof Ct||!!e.eventBusEl_&&["on","one","off","trigger"].every((function(t){return"function"==typeof e[t]}))},Lt=function(e,t){At(e)?t():(e.eventedCallbacks||(e.eventedCallbacks=[]),e.eventedCallbacks.push(t))},xt=function(e){return"string"==typeof e&&/\S/.test(e)||Array.isArray(e)&&!!e.length},Dt=function(e,t,r){if(!e||!e.nodeName&&!At(e))throw new Error("Invalid target for "+wt(t)+"#"+r+"; must be a DOM node or evented object.")},Rt=function(e,t,r){if(!xt(e))throw new Error("Invalid event type for "+wt(t)+"#"+r+"; must be a non-empty string or array.")},It=function(e,t,r){if("function"!=typeof e)throw new Error("Invalid listener for "+wt(t)+"#"+r+"; must be a function.")},Ot=function(e,t,r){var i,n,a,s=t.length<3||t[0]===e||t[0]===e.eventBusEl_;return s?(i=e.eventBusEl_,t.length>=3&&t.shift(),n=t[0],a=t[1]):(i=t[0],n=t[1],a=t[2]),Dt(i,e,r),Rt(n,e,r),It(a,e,r),{isTargetingSelf:s,target:i,type:n,listener:a=Et(e,a)}},Pt=function(e,t,r,i){Dt(e,e,t),e.nodeName?Tt[t](e,r,i):e[t](r,i)},Mt={on:function(){for(var e=this,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=Ot(this,r,"on"),a=n.isTargetingSelf,s=n.target,o=n.type,l=n.listener;if(Pt(s,"on",o,l),!a){var u=function(){return e.off(s,o,l)};u.guid=l.guid;var c=function(){return e.off("dispose",u)};c.guid=l.guid,Pt(this,"on","dispose",u),Pt(s,"on","dispose",c)}},one:function(){for(var e=this,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=Ot(this,r,"one"),a=n.isTargetingSelf,s=n.target,o=n.type,l=n.listener;if(a)Pt(s,"one",o,l);else{var u=function t(){e.off(s,o,t);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];l.apply(null,i)};u.guid=l.guid,Pt(s,"one",o,u)}},any:function(){for(var e=this,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=Ot(this,r,"any"),a=n.isTargetingSelf,s=n.target,o=n.type,l=n.listener;if(a)Pt(s,"any",o,l);else{var u=function t(){e.off(s,o,t);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];l.apply(null,i)};u.guid=l.guid,Pt(s,"any",o,u)}},off:function(e,t,r){if(!e||xt(e))vt(this.eventBusEl_,e,t);else{var i=e,n=t;Dt(i,this,"off"),Rt(n,this,"off"),It(r,this,"off"),r=Et(this,r),this.off("dispose",r),i.nodeName?(vt(i,n,r),vt(i,"dispose",r)):At(i)&&(i.off(n,r),i.off("dispose",r))}},trigger:function(e,t){Dt(this.eventBusEl_,this,"trigger");var r=e&&"string"!=typeof e?e.type:e;if(!xt(r)){var i="Invalid event type for "+wt(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!e)throw new Error(i);(this.log||H).error(i)}return gt(this.eventBusEl_,e,t)}};function Ft(e,t){void 0===t&&(t={});var r=t.eventBusKey;if(r){if(!e[r].nodeName)throw new Error('The eventBusKey "'+r+'" does not refer to an element.');e.eventBusEl_=e[r]}else e.eventBusEl_=Ce("span",{className:"vjs-event-bus"});return z(e,Mt),e.eventedCallbacks&&e.eventedCallbacks.forEach((function(e){e()})),e.on("dispose",(function(){e.off(),[e,e.el_,e.eventBusEl_].forEach((function(e){e&&ot.has(e)&&ot.delete(e)})),g.default.setTimeout((function(){e.eventBusEl_=null}),0)})),e}var Nt={state:{},setState:function(e){var t,r=this;return"function"==typeof e&&(e=e()),q(e,(function(e,i){r.state[i]!==e&&((t=t||{})[i]={from:r.state[i],to:e}),r.state[i]=e})),t&&At(this)&&this.trigger({changes:t,type:"statechanged"}),t}};function Bt(e,t){return z(e,Nt),e.state=z({},e.state,t),"function"==typeof e.handleStateChanged&&At(e)&&e.on("statechanged",e.handleStateChanged),e}var jt=function(e){return"string"!=typeof e?e:e.replace(/./,(function(e){return e.toLowerCase()}))},Ut=function(e){return"string"!=typeof e?e:e.replace(/./,(function(e){return e.toUpperCase()}))},Ht=function(e,t){return Ut(e)===Ut(t)};function Gt(){for(var e={},t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return r.forEach((function(t){!t||q(t,(function(t,r){X(t)?(X(e[r])||(e[r]={}),e[r]=Gt(e[r],t)):e[r]=t}))})),e}var Kt=function(){function e(){this.map_={}}var t=e.prototype;return t.has=function(e){return e in this.map_},t.delete=function(e){var t=this.has(e);return delete this.map_[e],t},t.set=function(e,t){return this.map_[e]=t,this},t.forEach=function(e,t){for(var r in this.map_)e.call(t,this.map_[r],r,this)},e}(),Vt=g.default.Map?g.default.Map:Kt,qt=function(){function e(){this.set_={}}var t=e.prototype;return t.has=function(e){return e in this.set_},t.delete=function(e){var t=this.has(e);return delete this.set_[e],t},t.add=function(e){return this.set_[e]=1,this},t.forEach=function(e,t){for(var r in this.set_)e.call(t,r,r,this)},e}(),Wt=g.default.Set?g.default.Set:qt,zt=function(){function e(e,t,r){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=Gt({},this.options_),t=this.options_=Gt(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){var i=e&&e.id&&e.id()||"no_player";this.id_=i+"_component_"+st()}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),!1!==t.evented&&(Ft(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),Bt(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new Wt,this.setIntervalIds_=new Wt,this.rafIds_=new Wt,this.namedRafs_=new Vt,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(r),!1!==t.reportTouchActivity&&this.enableTouchActivity()}var t=e.prototype;return t.dispose=function(){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),this.el_=null),this.player_=null}},t.isDisposed=function(){return Boolean(this.isDisposed_)},t.player=function(){return this.player_},t.options=function(e){return e?(this.options_=Gt(this.options_,e),this.options_):this.options_},t.el=function(){return this.el_},t.createEl=function(e,t,r){return Ce(e,t,r)},t.localize=function(e,t,r){void 0===r&&(r=e);var i=this.player_.language&&this.player_.language(),n=this.player_.languages&&this.player_.languages(),a=n&&n[i],s=i&&i.split("-")[0],o=n&&n[s],l=r;return a&&a[e]?l=a[e]:o&&o[e]&&(l=o[e]),t&&(l=l.replace(/\{(\d+)\}/g,(function(e,r){var i=t[r-1],n=i;return"undefined"==typeof i&&(n=e),n}))),l},t.handleLanguagechange=function(){},t.contentEl=function(){return this.contentEl_||this.el_},t.id=function(){return this.id_},t.name=function(){return this.name_},t.children=function(){return this.children_},t.getChildById=function(e){return this.childIndex_[e]},t.getChild=function(e){if(e)return this.childNameIndex_[e]},t.getDescendant=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.reduce((function(e,t){return e.concat(t)}),[]);for(var i=this,n=0;n<t.length;n++)if(!(i=i.getChild(t[n]))||!i.getChild)return;return i},t.addChild=function(t,r,i){var n,a;if(void 0===r&&(r={}),void 0===i&&(i=this.children_.length),"string"==typeof t){a=Ut(t);var s=r.componentClass||a;r.name=a;var o=e.getComponent(s);if(!o)throw new Error("Component "+s+" does not exist");if("function"!=typeof o)return null;n=new o(this.player_||this,r)}else n=t;if(n.parentComponent_&&n.parentComponent_.removeChild(n),this.children_.splice(i,0,n),n.parentComponent_=this,"function"==typeof n.id&&(this.childIndex_[n.id()]=n),(a=a||n.name&&Ut(n.name()))&&(this.childNameIndex_[a]=n,this.childNameIndex_[jt(a)]=n),"function"==typeof n.el&&n.el()){var l=null;this.children_[i+1]&&(this.children_[i+1].el_?l=this.children_[i+1].el_:Ee(this.children_[i+1])&&(l=this.children_[i+1])),this.contentEl().insertBefore(n.el(),l)}return n},t.removeChild=function(e){if("string"==typeof e&&(e=this.getChild(e)),e&&this.children_){for(var t=!1,r=this.children_.length-1;r>=0;r--)if(this.children_[r]===e){t=!0,this.children_.splice(r,1);break}if(t){e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[Ut(e.name())]=null,this.childNameIndex_[jt(e.name())]=null;var i=e.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}}},t.initChildren=function(){var t=this,r=this.options_.children;if(r){var i,n=this.options_,a=function(e){var r=e.name,i=e.opts;if(void 0!==n[r]&&(i=n[r]),!1!==i){!0===i&&(i={}),i.playerOptions=t.options_.playerOptions;var a=t.addChild(r,i);a&&(t[r]=a)}},s=e.getComponent("Tech");(i=Array.isArray(r)?r:Object.keys(r)).concat(Object.keys(this.options_).filter((function(e){return!i.some((function(t){return"string"==typeof t?e===t:e===t.name}))}))).map((function(e){var i,n;return"string"==typeof e?n=r[i=e]||t.options_[i]||{}:(i=e.name,n=e),{name:i,opts:n}})).filter((function(t){var r=e.getComponent(t.opts.componentClass||Ut(t.name));return r&&!s.isTech(r)})).forEach(a)}},t.buildCSSClass=function(){return""},t.ready=function(e,t){if(void 0===t&&(t=!1),e){if(!this.isReady_)return this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e);t?e.call(this):this.setTimeout(e,1)}},t.triggerReady=function(){this.isReady_=!0,this.setTimeout((function(){var e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach((function(e){e.call(this)}),this),this.trigger("ready")}),1)},t.$=function(e,t){return Xe(e,t||this.contentEl())},t.$$=function(e,t){return Qe(e,t||this.contentEl())},t.hasClass=function(e){return Le(this.el_,e)},t.addClass=function(e){xe(this.el_,e)},t.removeClass=function(e){De(this.el_,e)},t.toggleClass=function(e,t){Re(this.el_,e,t)},t.show=function(){this.removeClass("vjs-hidden")},t.hide=function(){this.addClass("vjs-hidden")},t.lockShowing=function(){this.addClass("vjs-lock-showing")},t.unlockShowing=function(){this.removeClass("vjs-lock-showing")},t.getAttribute=function(e){return Pe(this.el_,e)},t.setAttribute=function(e,t){Me(this.el_,e,t)},t.removeAttribute=function(e){Fe(this.el_,e)},t.width=function(e,t){return this.dimension("width",e,t)},t.height=function(e,t){return this.dimension("height",e,t)},t.dimensions=function(e,t){this.width(e,!0),this.height(t)},t.dimension=function(e,t,r){if(void 0!==t)return(null===t||t!==t)&&(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(r||this.trigger("componentresize"));if(!this.el_)return 0;var i=this.el_.style[e],n=i.indexOf("px");return parseInt(-1!==n?i.slice(0,n):this.el_["offset"+Ut(e)],10)},t.currentDimension=function(e){var t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=Q(this.el_,e),0===(t=parseFloat(t))||isNaN(t)){var r="offset"+Ut(e);t=this.el_[r]}return t},t.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},t.currentWidth=function(){return this.currentDimension("width")},t.currentHeight=function(){return this.currentDimension("height")},t.focus=function(){this.el_.focus()},t.blur=function(){this.el_.blur()},t.handleKeyDown=function(e){this.player_&&(_.default.isEventKey(e,"Tab")||e.stopPropagation(),this.player_.handleKeyDown(e))},t.handleKeyPress=function(e){this.handleKeyDown(e)},t.emitTapEvents=function(){var e,t=0,r=null,i=10,n=200;this.on("touchstart",(function(i){1===i.touches.length&&(r={pageX:i.touches[0].pageX,pageY:i.touches[0].pageY},t=g.default.performance.now(),e=!0)})),this.on("touchmove",(function(t){if(t.touches.length>1)e=!1;else if(r){var n=t.touches[0].pageX-r.pageX,a=t.touches[0].pageY-r.pageY;Math.sqrt(n*n+a*a)>i&&(e=!1)}}));var a=function(){e=!1};this.on("touchleave",a),this.on("touchcancel",a),this.on("touchend",(function(i){r=null,!0===e&&g.default.performance.now()-t<n&&(i.preventDefault(),this.trigger("tap"))}))},t.enableTouchActivity=function(){if(this.player()&&this.player().reportUserActivity){var e,t=Et(this.player(),this.player().reportUserActivity);this.on("touchstart",(function(){t(),this.clearInterval(e),e=this.setInterval(t,250)}));var r=function(r){t(),this.clearInterval(e)};this.on("touchmove",t),this.on("touchend",r),this.on("touchcancel",r)}},t.setTimeout=function(e,t){var r,i=this;return e=Et(this,e),this.clearTimersOnDispose_(),r=g.default.setTimeout((function(){i.setTimeoutIds_.has(r)&&i.setTimeoutIds_.delete(r),e()}),t),this.setTimeoutIds_.add(r),r},t.clearTimeout=function(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),g.default.clearTimeout(e)),e},t.setInterval=function(e,t){e=Et(this,e),this.clearTimersOnDispose_();var r=g.default.setInterval(e,t);return this.setIntervalIds_.add(r),r},t.clearInterval=function(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),g.default.clearInterval(e)),e},t.requestAnimationFrame=function(e){var t,r=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),e=Et(this,e),t=g.default.requestAnimationFrame((function(){r.rafIds_.has(t)&&r.rafIds_.delete(t),e()})),this.rafIds_.add(t),t):this.setTimeout(e,1e3/60)},t.requestNamedAnimationFrame=function(e,t){var r=this;if(!this.namedRafs_.has(e)){this.clearTimersOnDispose_(),t=Et(this,t);var i=this.requestAnimationFrame((function(){t(),r.namedRafs_.has(e)&&r.namedRafs_.delete(e)}));return this.namedRafs_.set(e,i),e}},t.cancelNamedAnimationFrame=function(e){!this.namedRafs_.has(e)||(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))},t.cancelAnimationFrame=function(e){return this.supportsRaf_?(this.rafIds_.has(e)&&(this.rafIds_.delete(e),g.default.cancelAnimationFrame(e)),e):this.clearTimeout(e)},t.clearTimersOnDispose_=function(){var e=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",(function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach((function(t){var r=t[0],i=t[1];e[r].forEach((function(t,r){return e[i](r)}))})),e.clearingTimersOnDispose_=!1})))},e.registerComponent=function(t,r){if("string"!=typeof t||!t)throw new Error('Illegal component name, "'+t+'"; must be a non-empty string.');var i,n=e.getComponent("Tech"),a=n&&n.isTech(r),s=e===r||e.prototype.isPrototypeOf(r.prototype);if(a||!s)throw i=a?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error('Illegal component, "'+t+'"; '+i+".");t=Ut(t),e.components_||(e.components_={});var o=e.getComponent("Player");if("Player"===t&&o&&o.players){var l=o.players,u=Object.keys(l);if(l&&u.length>0&&u.map((function(e){return l[e]})).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return e.components_[t]=r,e.components_[jt(t)]=r,r},e.getComponent=function(t){if(t&&e.components_)return e.components_[t]},e}();function Yt(e,t,r){if("number"!=typeof t||t<0||t>r)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is non-numeric or out of bounds (0-"+r+").")}function Xt(e,t,r,i){return Yt(e,i,r.length-1),r[i][t]}function Qt(e){var t;return t=void 0===e||0===e.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:e.length,start:Xt.bind(null,"start",0,e),end:Xt.bind(null,"end",1,e)},g.default.Symbol&&g.default.Symbol.iterator&&(t[g.default.Symbol.iterator]=function(){return(e||[]).values()}),t}function Jt(e,t){return Array.isArray(e)?Qt(e):void 0===e||void 0===t?Qt():Qt([[e,t]])}function $t(e,t){var r,i,n=0;if(!t)return 0;(!e||!e.length)&&(e=Jt(0,0));for(var a=0;a<e.length;a++)r=e.start(a),(i=e.end(a))>t&&(i=t),n+=i-r;return n/t}function Zt(e){if(e instanceof Zt)return e;"number"==typeof e?this.code=e:"string"==typeof e?this.message=e:Y(e)&&("number"==typeof e.code&&(this.code=e.code),z(this,e)),this.message||(this.message=Zt.defaultMessages[this.code]||"")}zt.prototype.supportsRaf_="function"==typeof g.default.requestAnimationFrame&&"function"==typeof g.default.cancelAnimationFrame,zt.registerComponent("Component",zt),Zt.prototype.code=0,Zt.prototype.message="",Zt.prototype.status=null,Zt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Zt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var er=0;er<Zt.errorTypes.length;er++)Zt[Zt.errorTypes[er]]=er,Zt.prototype[Zt.errorTypes[er]]=er;function tr(e){return null!=e&&"function"==typeof e.then}function rr(e){tr(e)&&e.then(null,(function(e){}))}var ir=function(e){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce((function(t,r,i){return e[r]&&(t[r]=e[r]),t}),{cues:e.cues&&Array.prototype.map.call(e.cues,(function(e){return{startTime:e.startTime,endTime:e.endTime,text:e.text,id:e.id}}))})},nr={textTracksToJson:function(e){var t=e.$$("track"),r=Array.prototype.map.call(t,(function(e){return e.track}));return Array.prototype.map.call(t,(function(e){var t=ir(e.track);return e.src&&(t.src=e.src),t})).concat(Array.prototype.filter.call(e.textTracks(),(function(e){return-1===r.indexOf(e)})).map(ir))},jsonToTextTracks:function(e,t){return e.forEach((function(e){var r=t.addRemoteTextTrack(e).track;!e.src&&e.cues&&e.cues.forEach((function(e){return r.addCue(e)}))})),t.textTracks()},trackToJson_:ir},ar="vjs-modal-dialog",sr=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).handleKeyDown_=function(e){return i.handleKeyDown(e)},i.close_=function(e){return i.close(e)},i.opened_=i.hasBeenOpened_=i.hasBeenFilled_=!1,i.closeable(!i.options_.uncloseable),i.content(i.options_.content),i.contentEl_=Ce("div",{className:ar+"-content"},{role:"document"}),i.descEl_=Ce("p",{className:ar+"-description vjs-control-text",id:i.el().getAttribute("aria-describedby")}),we(i.descEl_,i.description()),i.el_.appendChild(i.descEl_),i.el_.appendChild(i.contentEl_),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},r.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,e.prototype.dispose.call(this)},r.buildCSSClass=function(){return ar+" vjs-hidden "+e.prototype.buildCSSClass.call(this)},r.label=function(){return this.localize(this.options_.label||"Modal Window")},r.description=function(){var e=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(e+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),e},r.open=function(){if(!this.opened_){var e=this.player();this.trigger("beforemodalopen"),this.opened_=!0,(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_)&&this.fill(),this.wasPlaying_=!e.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&e.pause(),this.on("keydown",this.handleKeyDown_),this.hadControls_=e.controls(),e.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0}},r.opened=function(e){return"boolean"==typeof e&&this[e?"open":"close"](),this.opened_},r.close=function(){if(this.opened_){var e=this.player();this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&e.play(),this.off("keydown",this.handleKeyDown_),this.hadControls_&&e.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose()}},r.closeable=function(e){if("boolean"==typeof e){var t=this.closeable_=!!e,r=this.getChild("closeButton");if(t&&!r){var i=this.contentEl_;this.contentEl_=this.el_,r=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=i,this.on(r,"close",this.close_)}!t&&r&&(this.off(r,"close",this.close_),this.removeChild(r),r.dispose())}return this.closeable_},r.fill=function(){this.fillWith(this.content())},r.fillWith=function(e){var t=this.contentEl(),r=t.parentNode,i=t.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,r.removeChild(t),this.empty(),We(t,e),this.trigger("modalfill"),i?r.insertBefore(t,i):r.appendChild(t);var n=this.getChild("closeButton");n&&r.appendChild(n.el_)},r.empty=function(){this.trigger("beforemodalempty"),Ke(this.contentEl()),this.trigger("modalempty")},r.content=function(e){return"undefined"!=typeof e&&(this.content_=e),this.content_},r.conditionalFocus_=function(){var e=m.default.activeElement,t=this.player_.el_;this.previouslyActiveEl_=null,(t.contains(e)||t===e)&&(this.previouslyActiveEl_=e,this.focus())},r.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},r.handleKeyDown=function(e){if(e.stopPropagation(),_.default.isEventKey(e,"Escape")&&this.closeable())return e.preventDefault(),void this.close();if(_.default.isEventKey(e,"Tab")){for(var t,r=this.focusableEls_(),i=this.el_.querySelector(":focus"),n=0;n<r.length;n++)if(i===r[n]){t=n;break}m.default.activeElement===this.el_&&(t=0),e.shiftKey&&0===t?(r[r.length-1].focus(),e.preventDefault()):!e.shiftKey&&t===r.length-1&&(r[0].focus(),e.preventDefault())}},r.focusableEls_=function(){var e=this.el_.querySelectorAll("*");return Array.prototype.filter.call(e,(function(e){return(e instanceof g.default.HTMLAnchorElement||e instanceof g.default.HTMLAreaElement)&&e.hasAttribute("href")||(e instanceof g.default.HTMLInputElement||e instanceof g.default.HTMLSelectElement||e instanceof g.default.HTMLTextAreaElement||e instanceof g.default.HTMLButtonElement)&&!e.hasAttribute("disabled")||e instanceof g.default.HTMLIFrameElement||e instanceof g.default.HTMLObjectElement||e instanceof g.default.HTMLEmbedElement||e.hasAttribute("tabindex")&&-1!==e.getAttribute("tabindex")||e.hasAttribute("contenteditable")}))},t}(zt);sr.prototype.options_={pauseOnOpen:!0,temporary:!0},zt.registerComponent("ModalDialog",sr);var or=function(e){function t(t){var r;void 0===t&&(t=[]),(r=e.call(this)||this).tracks_=[],Object.defineProperty(T.default(r),"length",{get:function(){return this.tracks_.length}});for(var i=0;i<t.length;i++)r.addTrack(t[i]);return r}b.default(t,e);var r=t.prototype;return r.addTrack=function(e){var t=this,r=this.tracks_.length;""+r in this||Object.defineProperty(this,r,{get:function(){return this.tracks_[r]}}),-1===this.tracks_.indexOf(e)&&(this.tracks_.push(e),this.trigger({track:e,type:"addtrack",target:this})),e.labelchange_=function(){t.trigger({track:e,type:"labelchange",target:t})},At(e)&&e.addEventListener("labelchange",e.labelchange_)},r.removeTrack=function(e){for(var t,r=0,i=this.length;r<i;r++)if(this[r]===e){(t=this[r]).off&&t.off(),this.tracks_.splice(r,1);break}!t||this.trigger({track:t,type:"removetrack",target:this})},r.getTrackById=function(e){for(var t=null,r=0,i=this.length;r<i;r++){var n=this[r];if(n.id===e){t=n;break}}return t},t}(Ct);for(var lr in or.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},or.prototype.allowedEvents_)or.prototype["on"+lr]=null;var ur=function(e,t){for(var r=0;r<e.length;r++)!Object.keys(e[r]).length||t.id===e[r].id||(e[r].enabled=!1)},cr=function(e){function t(t){var r;void 0===t&&(t=[]);for(var i=t.length-1;i>=0;i--)if(t[i].enabled){ur(t,t[i]);break}return(r=e.call(this,t)||this).changing_=!1,r}b.default(t,e);var r=t.prototype;return r.addTrack=function(t){var r=this;t.enabled&&ur(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.enabledChange_=function(){r.changing_||(r.changing_=!0,ur(r,t),r.changing_=!1,r.trigger("change"))},t.addEventListener("enabledchange",t.enabledChange_))},r.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.enabledChange_&&(t.removeEventListener("enabledchange",t.enabledChange_),t.enabledChange_=null)},t}(or),dr=function(e,t){for(var r=0;r<e.length;r++)!Object.keys(e[r]).length||t.id===e[r].id||(e[r].selected=!1)},hr=function(e){function t(t){var r;void 0===t&&(t=[]);for(var i=t.length-1;i>=0;i--)if(t[i].selected){dr(t,t[i]);break}return(r=e.call(this,t)||this).changing_=!1,Object.defineProperty(T.default(r),"selectedIndex",{get:function(){for(var e=0;e<this.length;e++)if(this[e].selected)return e;return-1},set:function(){}}),r}b.default(t,e);var r=t.prototype;return r.addTrack=function(t){var r=this;t.selected&&dr(this,t),e.prototype.addTrack.call(this,t),t.addEventListener&&(t.selectedChange_=function(){r.changing_||(r.changing_=!0,dr(r,t),r.changing_=!1,r.trigger("change"))},t.addEventListener("selectedchange",t.selectedChange_))},r.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&t.selectedChange_&&(t.removeEventListener("selectedchange",t.selectedChange_),t.selectedChange_=null)},t}(or),fr=function(e){function t(){return e.apply(this,arguments)||this}b.default(t,e);var r=t.prototype;return r.addTrack=function(t){var r=this;e.prototype.addTrack.call(this,t),this.queueChange_||(this.queueChange_=function(){return r.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return r.trigger("selectedlanguagechange")}),t.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",this.triggerSelectedlanguagechange_)},r.removeTrack=function(t){e.prototype.removeTrack.call(this,t),t.removeEventListener&&(this.queueChange_&&t.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&t.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},t}(or),pr=function(){function e(e){void 0===e&&(e=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var t=0,r=e.length;t<r;t++)this.addTrackElement_(e[t])}var t=e.prototype;return t.addTrackElement_=function(e){var t=this.trackElements_.length;""+t in this||Object.defineProperty(this,t,{get:function(){return this.trackElements_[t]}}),-1===this.trackElements_.indexOf(e)&&this.trackElements_.push(e)},t.getTrackElementByTrack_=function(e){for(var t,r=0,i=this.trackElements_.length;r<i;r++)if(e===this.trackElements_[r].track){t=this.trackElements_[r];break}return t},t.removeTrackElement_=function(e){for(var t=0,r=this.trackElements_.length;t<r;t++)if(e===this.trackElements_[t]){this.trackElements_[t].track&&"function"==typeof this.trackElements_[t].track.off&&this.trackElements_[t].track.off(),"function"==typeof this.trackElements_[t].off&&this.trackElements_[t].off(),this.trackElements_.splice(t,1);break}},e}(),vr=function(){function e(t){e.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}var t=e.prototype;return t.setCues_=function(e){var t=this.length||0,r=0,i=e.length;this.cues_=e,this.length_=e.length;var n=function(e){""+e in this||Object.defineProperty(this,""+e,{get:function(){return this.cues_[e]}})};if(t<i)for(r=t;r<i;r++)n.call(this,r)},t.getCueById=function(e){for(var t=null,r=0,i=this.length;r<i;r++){var n=this[r];if(n.id===e){t=n;break}}return t},e}(),gr={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},mr={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},yr={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},_r={disabled:"disabled",hidden:"hidden",showing:"showing"},Tr=function(e){function t(t){var r;void 0===t&&(t={}),r=e.call(this)||this;var i={id:t.id||"vjs_track_"+st(),kind:t.kind||"",language:t.language||""},n=t.label||"",a=function(e){Object.defineProperty(T.default(r),e,{get:function(){return i[e]},set:function(){}})};for(var s in i)a(s);return Object.defineProperty(T.default(r),"label",{get:function(){return n},set:function(e){e!==n&&(n=e,this.trigger("labelchange"))}}),r}return b.default(t,e),t}(Ct),br=function(e){var t=["protocol","hostname","port","pathname","search","hash","host"],r=m.default.createElement("a");r.href=e;for(var i={},n=0;n<t.length;n++)i[t[n]]=r[t[n]];return"http:"===i.protocol&&(i.host=i.host.replace(/:80$/,"")),"https:"===i.protocol&&(i.host=i.host.replace(/:443$/,"")),i.protocol||(i.protocol=g.default.location.protocol),i.host||(i.host=g.default.location.host),i},Er=function(e){if(!e.match(/^https?:\/\//)){var t=m.default.createElement("a");t.href=e,e=t.href}return e},Sr=function(e){if("string"==typeof e){var t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(e);if(t)return t.pop().toLowerCase()}return""},kr=function(e,t){void 0===t&&(t=g.default.location);var r=br(e);return(":"===r.protocol?t.protocol:r.protocol)+r.host!==t.protocol+t.host},Cr=Object.freeze({__proto__:null,parseUrl:br,getAbsoluteURL:Er,getFileExtension:Sr,isCrossOrigin:kr}),wr=function(e,t){var r=new g.default.WebVTT.Parser(g.default,g.default.vttjs,g.default.WebVTT.StringDecoder()),i=[];r.oncue=function(e){t.addCue(e)},r.onparsingerror=function(e){i.push(e)},r.onflush=function(){t.trigger({type:"loadeddata",target:t})},r.parse(e),i.length>0&&(g.default.console&&g.default.console.groupCollapsed&&g.default.console.groupCollapsed("Text Track parsing errors for "+t.src),i.forEach((function(e){return H.error(e)})),g.default.console&&g.default.console.groupEnd&&g.default.console.groupEnd()),r.flush()},Ar=function(e,t){var r={uri:e},i=kr(e);i&&(r.cors=i);var n="use-credentials"===t.tech_.crossOrigin();n&&(r.withCredentials=n),S.default(r,Et(this,(function(e,r,i){if(e)return H.error(e,r);t.loaded_=!0,"function"!=typeof g.default.WebVTT?t.tech_&&t.tech_.any(["vttjsloaded","vttjserror"],(function(e){if("vttjserror"!==e.type)return wr(i,t);H.error("vttjs failed to load, stopping trying to process "+t.src)})):wr(i,t)})))},Lr=function(e){function t(t){var r;if(void 0===t&&(t={}),!t.tech)throw new Error("A tech was not provided.");var i=Gt(t,{kind:yr[t.kind]||"subtitles",language:t.language||t.srclang||""}),n=_r[i.mode]||"disabled",a=i.default;("metadata"===i.kind||"chapters"===i.kind)&&(n="hidden"),(r=e.call(this,i)||this).tech_=i.tech,r.cues_=[],r.activeCues_=[],r.preload_=!1!==r.tech_.preloadTextTracks;var s=new vr(r.cues_),o=new vr(r.activeCues_),l=!1,u=Et(T.default(r),(function(){!this.tech_.isReady_||this.tech_.isDisposed()||(this.activeCues=this.activeCues,l&&(this.trigger("cuechange"),l=!1))})),c=function(){r.tech_.off("timeupdate",u)};return r.tech_.one("dispose",c),"disabled"!==n&&r.tech_.on("timeupdate",u),Object.defineProperties(T.default(r),{default:{get:function(){return a},set:function(){}},mode:{get:function(){return n},set:function(e){!_r[e]||n!==e&&(n=e,!this.preload_&&"disabled"!==n&&0===this.cues.length&&Ar(this.src,this),this.tech_.off("timeupdate",u),"disabled"!==n&&this.tech_.on("timeupdate",u),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?s:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return o;for(var e=this.tech_.currentTime(),t=[],r=0,i=this.cues.length;r<i;r++){var n=this.cues[r];(n.startTime<=e&&n.endTime>=e||n.startTime===n.endTime&&n.startTime<=e&&n.startTime+.5>=e)&&t.push(n)}if(l=!1,t.length!==this.activeCues_.length)l=!0;else for(var a=0;a<t.length;a++)-1===this.activeCues_.indexOf(t[a])&&(l=!0);return this.activeCues_=t,o.setCues_(this.activeCues_),o},set:function(){}}}),i.src?(r.src=i.src,r.preload_||(r.loaded_=!0),(r.preload_||"subtitles"!==i.kind&&"captions"!==i.kind)&&Ar(r.src,T.default(r))):r.loaded_=!0,r}b.default(t,e);var r=t.prototype;return r.addCue=function(e){var t=e;if(g.default.vttjs&&!(e instanceof g.default.vttjs.VTTCue)){for(var r in t=new g.default.vttjs.VTTCue(e.startTime,e.endTime,e.text),e)r in t||(t[r]=e[r]);t.id=e.id,t.originalCue_=e}for(var i=this.tech_.textTracks(),n=0;n<i.length;n++)i[n]!==this&&i[n].removeCue(t);this.cues_.push(t),this.cues.setCues_(this.cues_)},r.removeCue=function(e){for(var t=this.cues_.length;t--;){var r=this.cues_[t];if(r===e||r.originalCue_&&r.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}},t}(Tr);Lr.prototype.allowedEvents_={cuechange:"cuechange"};var xr=function(e){function t(t){var r;void 0===t&&(t={});var i=Gt(t,{kind:mr[t.kind]||""});r=e.call(this,i)||this;var n=!1;return Object.defineProperty(T.default(r),"enabled",{get:function(){return n},set:function(e){"boolean"!=typeof e||e===n||(n=e,this.trigger("enabledchange"))}}),i.enabled&&(r.enabled=i.enabled),r.loaded_=!0,r}return b.default(t,e),t}(Tr),Dr=function(e){function t(t){var r;void 0===t&&(t={});var i=Gt(t,{kind:gr[t.kind]||""});r=e.call(this,i)||this;var n=!1;return Object.defineProperty(T.default(r),"selected",{get:function(){return n},set:function(e){"boolean"!=typeof e||e===n||(n=e,this.trigger("selectedchange"))}}),i.selected&&(r.selected=i.selected),r}return b.default(t,e),t}(Tr),Rr=0,Ir=1,Or=2,Pr=3,Mr=function(e){function t(t){var r;void 0===t&&(t={}),r=e.call(this)||this;var i,n=new Lr(t);return r.kind=n.kind,r.src=n.src,r.srclang=n.language,r.label=n.label,r.default=n.default,Object.defineProperties(T.default(r),{readyState:{get:function(){return i}},track:{get:function(){return n}}}),i=Rr,n.addEventListener("loadeddata",(function(){i=Or,r.trigger({type:"load",target:T.default(r)})})),r}return b.default(t,e),t}(Ct);Mr.prototype.allowedEvents_={load:"load"},Mr.NONE=Rr,Mr.LOADING=Ir,Mr.LOADED=Or,Mr.ERROR=Pr;var Fr={audio:{ListClass:cr,TrackClass:xr,capitalName:"Audio"},video:{ListClass:hr,TrackClass:Dr,capitalName:"Video"},text:{ListClass:fr,TrackClass:Lr,capitalName:"Text"}};Object.keys(Fr).forEach((function(e){Fr[e].getterName=e+"Tracks",Fr[e].privateName=e+"Tracks_"}));var Nr={remoteText:{ListClass:fr,TrackClass:Lr,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:pr,TrackClass:Mr,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},Br=y.default({},Fr,Nr);function jr(e,t,r,i,n){void 0===n&&(n={});var a=e.textTracks();n.kind=t,r&&(n.label=r),i&&(n.language=i),n.tech=e;var s=new Br.text.TrackClass(n);return a.addTrack(s),s}Nr.names=Object.keys(Nr),Fr.names=Object.keys(Fr),Br.names=[].concat(Nr.names).concat(Fr.names);var Ur=function(e){function t(t,r){var i;return void 0===t&&(t={}),void 0===r&&(r=function(){}),t.reportTouchActivity=!1,(i=e.call(this,null,t,r)||this).onDurationChange_=function(e){return i.onDurationChange(e)},i.trackProgress_=function(e){return i.trackProgress(e)},i.trackCurrentTime_=function(e){return i.trackCurrentTime(e)},i.stopTrackingCurrentTime_=function(e){return i.stopTrackingCurrentTime(e)},i.disposeSourceHandler_=function(e){return i.disposeSourceHandler(e)},i.hasStarted_=!1,i.on("playing",(function(){this.hasStarted_=!0})),i.on("loadstart",(function(){this.hasStarted_=!1})),Br.names.forEach((function(e){var r=Br[e];t&&t[r.getterName]&&(i[r.privateName]=t[r.getterName])})),i.featuresProgressEvents||i.manualProgressOn(),i.featuresTimeupdateEvents||i.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach((function(e){!1===t["native"+e+"Tracks"]&&(i["featuresNative"+e+"Tracks"]=!1)})),!1===t.nativeCaptions||!1===t.nativeTextTracks?i.featuresNativeTextTracks=!1:(!0===t.nativeCaptions||!0===t.nativeTextTracks)&&(i.featuresNativeTextTracks=!0),i.featuresNativeTextTracks||i.emulateTextTracks(),i.preloadTextTracks=!1!==t.preloadTextTracks,i.autoRemoteTextTracks_=new Br.text.ListClass,i.initTrackListeners(),t.nativeControlsForTouch||i.emitTapEvents(),i.constructor&&(i.name_=i.constructor.name||"Unknown Tech"),i}b.default(t,e);var r=t.prototype;return r.triggerSourceset=function(e){var t=this;this.isReady_||this.one("ready",(function(){return t.setTimeout((function(){return t.triggerSourceset(e)}),1)})),this.trigger({src:e,type:"sourceset"})},r.manualProgressOn=function(){this.on("durationchange",this.onDurationChange_),this.manualProgress=!0,this.one("ready",this.trackProgress_)},r.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange_)},r.trackProgress=function(e){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Et(this,(function(){var e=this.bufferedPercent();this.bufferedPercent_!==e&&this.trigger("progress"),this.bufferedPercent_=e,1===e&&this.stopTrackingProgress()})),500)},r.onDurationChange=function(e){this.duration_=this.duration()},r.buffered=function(){return Jt(0,0)},r.bufferedPercent=function(){return $t(this.buffered(),this.duration_)},r.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},r.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime_),this.on("pause",this.stopTrackingCurrentTime_)},r.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime_),this.off("pause",this.stopTrackingCurrentTime_)},r.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval((function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})}),250)},r.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},r.dispose=function(){this.clearTracks(Fr.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),e.prototype.dispose.call(this)},r.clearTracks=function(e){var t=this;(e=[].concat(e)).forEach((function(e){for(var r=t[e+"Tracks"]()||[],i=r.length;i--;){var n=r[i];"text"===e&&t.removeRemoteTextTrack(n),r.removeTrack(n)}}))},r.cleanupAutoTextTracks=function(){for(var e=this.autoRemoteTextTracks_||[],t=e.length;t--;){var r=e[t];this.removeRemoteTextTrack(r)}},r.reset=function(){},r.crossOrigin=function(){},r.setCrossOrigin=function(){},r.error=function(e){return void 0!==e&&(this.error_=new Zt(e),this.trigger("error")),this.error_},r.played=function(){return this.hasStarted_?Jt(0,0):Jt()},r.play=function(){},r.setScrubbing=function(){},r.scrubbing=function(){},r.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},r.initTrackListeners=function(){var e=this;Fr.names.forEach((function(t){var r=Fr[t],i=function(){e.trigger(t+"trackchange")},n=e[r.getterName]();n.addEventListener("removetrack",i),n.addEventListener("addtrack",i),e.on("dispose",(function(){n.removeEventListener("removetrack",i),n.removeEventListener("addtrack",i)}))}))},r.addWebVttScript_=function(){var e=this;if(!g.default.WebVTT)if(m.default.body.contains(this.el())){if(!this.options_["vtt.js"]&&X(k.default)&&Object.keys(k.default).length>0)return void this.trigger("vttjsloaded");var t=m.default.createElement("script");t.src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",(function(){t.onload=null,t.onerror=null})),g.default.WebVTT=!0,this.el().parentNode.appendChild(t)}else this.ready(this.addWebVttScript_)},r.emulateTextTracks=function(){var e=this,t=this.textTracks(),r=this.remoteTextTracks(),i=function(e){return t.addTrack(e.track)},n=function(e){return t.removeTrack(e.track)};r.on("addtrack",i),r.on("removetrack",n),this.addWebVttScript_();var a=function(){return e.trigger("texttrackchange")},s=function(){a();for(var e=0;e<t.length;e++){var r=t[e];r.removeEventListener("cuechange",a),"showing"===r.mode&&r.addEventListener("cuechange",a)}};s(),t.addEventListener("change",s),t.addEventListener("addtrack",s),t.addEventListener("removetrack",s),this.on("dispose",(function(){r.off("addtrack",i),r.off("removetrack",n),t.removeEventListener("change",s),t.removeEventListener("addtrack",s),t.removeEventListener("removetrack",s);for(var e=0;e<t.length;e++)t[e].removeEventListener("cuechange",a)}))},r.addTextTrack=function(e,t,r){if(!e)throw new Error("TextTrack kind is required but was not provided");return jr(this,e,t,r)},r.createRemoteTextTrack=function(e){var t=Gt(e,{tech:this});return new Nr.remoteTextEl.TrackClass(t)},r.addRemoteTextTrack=function(e,t){var r=this;void 0===e&&(e={});var i=this.createRemoteTextTrack(e);return!0!==t&&!1!==t&&(H.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),t=!0),this.remoteTextTrackEls().addTrackElement_(i),this.remoteTextTracks().addTrack(i.track),!0!==t&&this.ready((function(){return r.autoRemoteTextTracks_.addTrack(i.track)})),i},r.removeRemoteTextTrack=function(e){var t=this.remoteTextTrackEls().getTrackElementByTrack_(e);this.remoteTextTrackEls().removeTrackElement_(t),this.remoteTextTracks().removeTrack(e),this.autoRemoteTextTracks_.removeTrack(e)},r.getVideoPlaybackQuality=function(){return{}},r.requestPictureInPicture=function(){var e=this.options_.Promise||g.default.Promise;if(e)return e.reject()},r.disablePictureInPicture=function(){return!0},r.setDisablePictureInPicture=function(){},r.setPoster=function(){},r.playsinline=function(){},r.setPlaysinline=function(){},r.overrideNativeAudioTracks=function(){},r.overrideNativeVideoTracks=function(){},r.canPlayType=function(){return""},t.canPlayType=function(){return""},t.canPlaySource=function(e,r){return t.canPlayType(e.type)},t.isTech=function(e){return e.prototype instanceof t||e instanceof t||e===t},t.registerTech=function(e,r){if(t.techs_||(t.techs_={}),!t.isTech(r))throw new Error("Tech "+e+" must be a Tech");if(!t.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!t.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return e=Ut(e),t.techs_[e]=r,t.techs_[jt(e)]=r,"Tech"!==e&&t.defaultTechOrder_.push(e),r},t.getTech=function(e){if(e){if(t.techs_&&t.techs_[e])return t.techs_[e];if(e=Ut(e),g.default&&g.default.videojs&&g.default.videojs[e])return H.warn("The "+e+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),g.default.videojs[e]}},t}(zt);Br.names.forEach((function(e){var t=Br[e];Ur.prototype[t.getterName]=function(){return this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName]}})),Ur.prototype.featuresVolumeControl=!0,Ur.prototype.featuresMuteControl=!0,Ur.prototype.featuresFullscreenResize=!1,Ur.prototype.featuresPlaybackRate=!1,Ur.prototype.featuresProgressEvents=!1,Ur.prototype.featuresSourceset=!1,Ur.prototype.featuresTimeupdateEvents=!1,Ur.prototype.featuresNativeTextTracks=!1,Ur.withSourceHandlers=function(e){e.registerSourceHandler=function(t,r){var i=e.sourceHandlers;i||(i=e.sourceHandlers=[]),void 0===r&&(r=i.length),i.splice(r,0,t)},e.canPlayType=function(t){for(var r,i=e.sourceHandlers||[],n=0;n<i.length;n++)if(r=i[n].canPlayType(t))return r;return""},e.selectSourceHandler=function(t,r){for(var i=e.sourceHandlers||[],n=0;n<i.length;n++)if(i[n].canHandleSource(t,r))return i[n];return null},e.canPlaySource=function(t,r){var i=e.selectSourceHandler(t,r);return i?i.canHandleSource(t,r):""},["seekable","seeking","duration"].forEach((function(e){var t=this[e];"function"==typeof t&&(this[e]=function(){return this.sourceHandler_&&this.sourceHandler_[e]?this.sourceHandler_[e].apply(this.sourceHandler_,arguments):t.apply(this,arguments)})}),e.prototype),e.prototype.setSource=function(t){var r=e.selectSourceHandler(t,this.options_);r||(e.nativeSourceHandler?r=e.nativeSourceHandler:H.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler_),r!==e.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=r.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler_)},e.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},zt.registerComponent("Tech",Ur),Ur.registerTech("Tech",Ur),Ur.defaultTechOrder_=[];var Hr={},Gr={},Kr={};function Vr(e,t){Hr[e]=Hr[e]||[],Hr[e].push(t)}function qr(e,t,r){e.setTimeout((function(){return ii(t,Hr[t.type],r,e)}),1)}function Wr(e,t){e.forEach((function(e){return e.setTech&&e.setTech(t)}))}function zr(e,t,r){return e.reduceRight(Zr(r),t[r]())}function Yr(e,t,r,i){return t[r](e.reduce(Zr(r),i))}function Xr(e,t,r,i){void 0===i&&(i=null);var n="call"+Ut(r),a=e.reduce(Zr(n),i),s=a===Kr,o=s?null:t[r](a);return ei(e,r,o,s),o}var Qr={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1,ended:1},Jr={setCurrentTime:1,setMuted:1,setVolume:1},$r={play:1,pause:1};function Zr(e){return function(t,r){return t===Kr?Kr:r[e]?r[e](t):t}}function ei(e,t,r,i){for(var n=e.length-1;n>=0;n--){var a=e[n];a[t]&&a[t](i,r)}}function ti(e){Gr[e.id()]=null}function ri(e,t){var r=Gr[e.id()],i=null;if(null==r)return i=t(e),Gr[e.id()]=[[t,i]],i;for(var n=0;n<r.length;n++){var a=r[n],s=a[0],o=a[1];s===t&&(i=o)}return null===i&&(i=t(e),r.push([t,i])),i}function ii(e,t,r,i,n,a){void 0===e&&(e={}),void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===a&&(a=!1);var s=t,o=s[0],l=s.slice(1);if("string"==typeof o)ii(e,Hr[o],r,i,n,a);else if(o){var u=ri(i,o);if(!u.setSource)return n.push(u),ii(e,l,r,i,n,a);u.setSource(z({},e),(function(t,s){if(t)return ii(e,l,r,i,n,a);n.push(u),ii(s,e.type===s.type?l:Hr[s.type],r,i,n,a)}))}else l.length?ii(e,l,r,i,n,a):a?r(e,n):ii(e,Hr["*"],r,i,n,!0)}var ni={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},ai=function(e){void 0===e&&(e="");var t=Sr(e);return ni[t.toLowerCase()]||""},si=function(e,t){if(!t)return"";if(e.cache_.source.src===t&&e.cache_.source.type)return e.cache_.source.type;var r=e.cache_.sources.filter((function(e){return e.src===t}));if(r.length)return r[0].type;for(var i=e.$$("source"),n=0;n<i.length;n++){var a=i[n];if(a.type&&a.src&&a.src===t)return a.type}return ai(t)},oi=function e(t){if(Array.isArray(t)){var r=[];t.forEach((function(t){t=e(t),Array.isArray(t)?r=r.concat(t):Y(t)&&r.push(t)})),t=r}else t="string"==typeof t&&t.trim()?[li({src:t})]:Y(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[li(t)]:[];return t};function li(e){if(!e.type){var t=ai(e.src);t&&(e.type=t)}return e}var ui=function(e){function t(t,r,i){var n,a=Gt({createEl:!1},r);if(n=e.call(this,t,a,i)||this,r.playerOptions.sources&&0!==r.playerOptions.sources.length)t.src(r.playerOptions.sources);else for(var s=0,o=r.playerOptions.techOrder;s<o.length;s++){var l=Ut(o[s]),u=Ur.getTech(l);if(l||(u=zt.getComponent(l)),u&&u.isSupported()){t.loadTech_(l);break}}return n}return b.default(t,e),t}(zt);zt.registerComponent("MediaLoader",ui);var ci=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).handleMouseOver_=function(e){return i.handleMouseOver(e)},i.handleMouseOut_=function(e){return i.handleMouseOut(e)},i.handleClick_=function(e){return i.handleClick(e)},i.handleKeyDown_=function(e){return i.handleKeyDown(e)},i.emitTapEvents(),i.enable(),i}b.default(t,e);var r=t.prototype;return r.createEl=function(e,t,r){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===r&&(r={}),t=z({className:this.buildCSSClass(),tabIndex:0},t),"button"===e&&H.error("Creating a ClickableComponent with an HTML element of "+e+" is not supported; use a Button instead."),r=z({role:"button"},r),this.tabIndex_=t.tabIndex;var i=Ce(e,t,r);return i.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i},r.dispose=function(){this.controlTextEl_=null,e.prototype.dispose.call(this)},r.createControlTextEl=function(e){return this.controlTextEl_=Ce("span",{className:"vjs-control-text"},{"aria-live":"polite"}),e&&e.appendChild(this.controlTextEl_),this.controlText(this.controlText_,e),this.controlTextEl_},r.controlText=function(e,t){if(void 0===t&&(t=this.el()),void 0===e)return this.controlText_||"Need Text";var r=this.localize(e);this.controlText_=e,we(this.controlTextEl_,r),!this.nonIconControl&&!this.player_.options_.noUITitleAttributes&&t.setAttribute("title",r)},r.buildCSSClass=function(){return"vjs-control vjs-button "+e.prototype.buildCSSClass.call(this)},r.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),"undefined"!=typeof this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick_),this.on("keydown",this.handleKeyDown_))},r.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),"undefined"!=typeof this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver_),this.off("mouseout",this.handleMouseOut_),this.off(["tap","click"],this.handleClick_),this.off("keydown",this.handleKeyDown_)},r.handleLanguagechange=function(){this.controlText(this.controlText_)},r.handleClick=function(e){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},r.handleKeyDown=function(t){_.default.isEventKey(t,"Space")||_.default.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(zt);zt.registerComponent("ClickableComponent",ci);var di=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update(),i.update_=function(e){return i.update(e)},t.on("posterchange",i.update_),i}b.default(t,e);var r=t.prototype;return r.dispose=function(){this.player().off("posterchange",this.update_),e.prototype.dispose.call(this)},r.createEl=function(){return Ce("div",{className:"vjs-poster",tabIndex:-1})},r.update=function(e){var t=this.player().poster();this.setSrc(t),t?this.show():this.hide()},r.setSrc=function(e){var t="";e&&(t='url("'+e+'")'),this.el_.style.backgroundImage=t},r.handleClick=function(e){if(this.player_.controls()){var t=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;this.player_.tech(!0)&&!((ue||se)&&t)&&this.player_.tech(!0).focus(),this.player_.paused()?rr(this.player_.play()):this.player_.pause()}},t}(ci);zt.registerComponent("PosterImage",di);var hi="#222",fi="#ccc",pi={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function vi(e,t){var r;if(4===e.length)r=e[1]+e[1]+e[2]+e[2]+e[3]+e[3];else{if(7!==e.length)throw new Error("Invalid color code provided, "+e+"; must be formatted as e.g. #f0e or #f604e2.");r=e.slice(1)}return"rgba("+parseInt(r.slice(0,2),16)+","+parseInt(r.slice(2,4),16)+","+parseInt(r.slice(4,6),16)+","+t+")"}function gi(e,t,r){try{e.style[t]=r}catch(i){return}}var mi=function(e){function t(t,r,i){var n;n=e.call(this,t,r,i)||this;var a=function(e){return n.updateDisplay(e)};return t.on("loadstart",(function(e){return n.toggleDisplay(e)})),t.on("texttrackchange",a),t.on("loadedmetadata",(function(e){return n.preselectTrack(e)})),t.ready(Et(T.default(n),(function(){if(t.tech_&&t.tech_.featuresNativeTextTracks)this.hide();else{t.on("fullscreenchange",a),t.on("playerresize",a),g.default.addEventListener("orientationchange",a),t.on("dispose",(function(){return g.default.removeEventListener("orientationchange",a)}));for(var e=this.options_.playerOptions.tracks||[],r=0;r<e.length;r++)this.player_.addRemoteTextTrack(e[r],!0);this.preselectTrack()}}))),n}b.default(t,e);var r=t.prototype;return r.preselectTrack=function(){for(var e,t,r,i={captions:1,subtitles:1},n=this.player_.textTracks(),a=this.player_.cache_.selectedLanguage,s=0;s<n.length;s++){var o=n[s];a&&a.enabled&&a.language&&a.language===o.language&&o.kind in i?o.kind===a.kind?r=o:r||(r=o):a&&!a.enabled?(r=null,e=null,t=null):o.default&&("descriptions"!==o.kind||e?o.kind in i&&!t&&(t=o):e=o)}r?r.mode="showing":t?t.mode="showing":e&&(e.mode="showing")},r.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{translate:"yes","aria-live":"off","aria-atomic":"true"})},r.clearDisplay=function(){"function"==typeof g.default.WebVTT&&g.default.WebVTT.processCues(g.default,[],this.el_)},r.updateDisplay=function(){var e=this.player_.textTracks(),t=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),t){for(var r=[],i=0;i<e.length;++i){var n=e[i];"showing"===n.mode&&r.push(n)}this.updateForTrack(r)}else{for(var a=null,s=null,o=e.length;o--;){var l=e[o];"showing"===l.mode&&("descriptions"===l.kind?a=l:s=l)}s?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):a&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(a))}},r.updateDisplayState=function(e){for(var t=this.player_.textTrackSettings.getValues(),r=e.activeCues,i=r.length;i--;){var n=r[i];if(n){var a=n.displayState;if(t.color&&(a.firstChild.style.color=t.color),t.textOpacity&&gi(a.firstChild,"color",vi(t.color||"#fff",t.textOpacity)),t.backgroundColor&&(a.firstChild.style.backgroundColor=t.backgroundColor),t.backgroundOpacity&&gi(a.firstChild,"backgroundColor",vi(t.backgroundColor||"#000",t.backgroundOpacity)),t.windowColor&&(t.windowOpacity?gi(a,"backgroundColor",vi(t.windowColor,t.windowOpacity)):a.style.backgroundColor=t.windowColor),t.edgeStyle&&("dropshadow"===t.edgeStyle?a.firstChild.style.textShadow="2px 2px 3px "+hi+", 2px 2px 4px "+hi+", 2px 2px 5px "+hi:"raised"===t.edgeStyle?a.firstChild.style.textShadow="1px 1px "+hi+", 2px 2px "+hi+", 3px 3px "+hi:"depressed"===t.edgeStyle?a.firstChild.style.textShadow="1px 1px "+fi+", 0 1px "+fi+", -1px -1px "+hi+", 0 -1px "+hi:"uniform"===t.edgeStyle&&(a.firstChild.style.textShadow="0 0 4px "+hi+", 0 0 4px "+hi+", 0 0 4px "+hi+", 0 0 4px "+hi)),t.fontPercent&&1!==t.fontPercent){var s=g.default.parseFloat(a.style.fontSize);a.style.fontSize=s*t.fontPercent+"px",a.style.height="auto",a.style.top="auto"}t.fontFamily&&"default"!==t.fontFamily&&("small-caps"===t.fontFamily?a.firstChild.style.fontVariant="small-caps":a.firstChild.style.fontFamily=pi[t.fontFamily])}}},r.updateForTrack=function(e){if(Array.isArray(e)||(e=[e]),"function"==typeof g.default.WebVTT&&!e.every((function(e){return!e.activeCues}))){for(var t=[],r=0;r<e.length;++r)for(var i=e[r],n=0;n<i.activeCues.length;++n)t.push(i.activeCues[n]);g.default.WebVTT.processCues(g.default,t,this.el_);for(var a=0;a<e.length;++a){for(var s=e[a],o=0;o<s.activeCues.length;++o){var l=s.activeCues[o].displayState;xe(l,"vjs-text-track-cue"),xe(l,"vjs-text-track-cue-"+(s.language?s.language:a)),s.language&&Me(l,"lang",s.language)}this.player_.textTrackSettings&&this.updateDisplayState(s)}}},t}(zt);zt.registerComponent("TextTrackDisplay",mi);var yi=function(e){function t(){return e.apply(this,arguments)||this}return b.default(t,e),t.prototype.createEl=function(){var t=this.player_.isAudio(),r=this.localize(t?"Audio Player":"Video Player"),i=Ce("span",{className:"vjs-control-text",textContent:this.localize("{1} is loading.",[r])}),n=e.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return n.appendChild(i),n},t}(zt);zt.registerComponent("LoadingSpinner",yi);var _i=function(e){function t(){return e.apply(this,arguments)||this}b.default(t,e);var r=t.prototype;return r.createEl=function(e,t,r){void 0===t&&(t={}),void 0===r&&(r={});var i=Ce("button",t=z({className:this.buildCSSClass()},t),r=z({type:"button"},r));return i.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),this.createControlTextEl(i),i},r.addChild=function(e,t){void 0===t&&(t={});var r=this.constructor.name;return H.warn("Adding an actionable (user controllable) child to a Button ("+r+") is not supported; use a ClickableComponent instead."),zt.prototype.addChild.call(this,e,t)},r.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},r.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},r.handleKeyDown=function(t){_.default.isEventKey(t,"Space")||_.default.isEventKey(t,"Enter")?t.stopPropagation():e.prototype.handleKeyDown.call(this,t)},t}(ci);zt.registerComponent("Button",_i);var Ti=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).mouseused_=!1,i.on("mousedown",(function(e){return i.handleMouseDown(e)})),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-big-play-button"},r.handleClick=function(e){var t=this.player_.play();if(this.mouseused_&&e.clientX&&e.clientY){var r=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&this.player_.eme.sessions.length>0;return rr(t),void(this.player_.tech(!0)&&(!ue&&!se||!r)&&this.player_.tech(!0).focus())}var i=this.player_.getChild("controlBar"),n=i&&i.getChild("playToggle");if(n){var a=function(){return n.focus()};tr(t)?t.then(a,(function(){})):this.setTimeout(a,1)}else this.player_.tech(!0).focus()},r.handleKeyDown=function(t){this.mouseused_=!1,e.prototype.handleKeyDown.call(this,t)},r.handleMouseDown=function(e){this.mouseused_=!0},t}(_i);Ti.prototype.controlText_="Play Video",zt.registerComponent("BigPlayButton",Ti);var bi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).controlText(r&&r.controlText||i.localize("Close")),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-close-button "+e.prototype.buildCSSClass.call(this)},r.handleClick=function(e){this.trigger({type:"close",bubbles:!1})},r.handleKeyDown=function(t){_.default.isEventKey(t,"Esc")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):e.prototype.handleKeyDown.call(this,t)},t}(_i);zt.registerComponent("CloseButton",bi);var Ei=function(e){function t(t,r){var i;return void 0===r&&(r={}),i=e.call(this,t,r)||this,r.replay=void 0===r.replay||r.replay,i.on(t,"play",(function(e){return i.handlePlay(e)})),i.on(t,"pause",(function(e){return i.handlePause(e)})),r.replay&&i.on(t,"ended",(function(e){return i.handleEnded(e)})),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-play-control "+e.prototype.buildCSSClass.call(this)},r.handleClick=function(e){this.player_.paused()?rr(this.player_.play()):this.player_.pause()},r.handleSeeked=function(e){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(e):this.handlePlay(e)},r.handlePlay=function(e){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},r.handlePause=function(e){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},r.handleEnded=function(e){var t=this;this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",(function(e){return t.handleSeeked(e)}))},t}(_i);Ei.prototype.controlText_="Play",zt.registerComponent("PlayToggle",Ei);var Si=function(e,t){e=e<0?0:e;var r=Math.floor(e%60),i=Math.floor(e/60%60),n=Math.floor(e/3600),a=Math.floor(t/60%60),s=Math.floor(t/3600);return(isNaN(e)||e===1/0)&&(n=i=r="-"),(n=n>0||s>0?n+":":"")+(i=((n||a>=10)&&i<10?"0"+i:i)+":")+(r=r<10?"0"+r:r)},ki=Si;function Ci(e){ki=e}function wi(){ki=Si}function Ai(e,t){return void 0===t&&(t=e),ki(e,t)}var Li=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on(t,["timeupdate","ended"],(function(e){return i.updateContent(e)})),i.updateTextNode_(),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t=this.buildCSSClass(),r=e.prototype.createEl.call(this,"div",{className:t+" vjs-time-control vjs-control"}),i=Ce("span",{className:"vjs-control-text",textContent:this.localize(this.labelText_)+"\xa0"},{role:"presentation"});return r.appendChild(i),this.contentEl_=Ce("span",{className:t+"-display"},{"aria-live":"off",role:"presentation"}),r.appendChild(this.contentEl_),r},r.dispose=function(){this.contentEl_=null,this.textNode_=null,e.prototype.dispose.call(this)},r.updateTextNode_=function(e){var t=this;void 0===e&&(e=0),e=Ai(e),this.formattedTime_!==e&&(this.formattedTime_=e,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",(function(){if(t.contentEl_){var e=t.textNode_;e&&t.contentEl_.firstChild!==e&&(e=null,H.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),t.textNode_=m.default.createTextNode(t.formattedTime_),t.textNode_&&(e?t.contentEl_.replaceChild(t.textNode_,e):t.contentEl_.appendChild(t.textNode_))}})))},r.updateContent=function(e){},t}(zt);Li.prototype.labelText_="Time",Li.prototype.controlText_="Time",zt.registerComponent("TimeDisplay",Li);var xi=function(e){function t(){return e.apply(this,arguments)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-current-time"},r.updateContent=function(e){var t;t=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),this.updateTextNode_(t)},t}(Li);xi.prototype.labelText_="Current Time",xi.prototype.controlText_="Current Time",zt.registerComponent("CurrentTimeDisplay",xi);var Di=function(e){function t(t,r){var i,n=function(e){return i.updateContent(e)};return(i=e.call(this,t,r)||this).on(t,"durationchange",n),i.on(t,"loadstart",n),i.on(t,"loadedmetadata",n),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-duration"},r.updateContent=function(e){var t=this.player_.duration();this.updateTextNode_(t)},t}(Li);Di.prototype.labelText_="Duration",Di.prototype.controlText_="Duration",zt.registerComponent("DurationDisplay",Di);var Ri=function(e){function t(){return e.apply(this,arguments)||this}return b.default(t,e),t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider"},{"aria-hidden":!0}),r=e.prototype.createEl.call(this,"div"),i=e.prototype.createEl.call(this,"span",{textContent:"/"});return r.appendChild(i),t.appendChild(r),t},t}(zt);zt.registerComponent("TimeDivider",Ri);var Ii=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on(t,"durationchange",(function(e){return i.updateContent(e)})),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-remaining-time"},r.createEl=function(){var t=e.prototype.createEl.call(this);return!1!==this.options_.displayNegative&&t.insertBefore(Ce("span",{},{"aria-hidden":!0},"-"),this.contentEl_),t},r.updateContent=function(e){var t;"number"==typeof this.player_.duration()&&(t=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(t))},t}(Li);Ii.prototype.labelText_="Remaining Time",Ii.prototype.controlText_="Remaining Time",zt.registerComponent("RemainingTimeDisplay",Ii);var Oi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).updateShowing(),i.on(i.player(),"durationchange",(function(e){return i.updateShowing(e)})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Ce("div",{className:"vjs-live-display"},{"aria-live":"off"}),this.contentEl_.appendChild(Ce("span",{className:"vjs-control-text",textContent:this.localize("Stream Type")+"\xa0"})),this.contentEl_.appendChild(m.default.createTextNode(this.localize("LIVE"))),t.appendChild(this.contentEl_),t},r.dispose=function(){this.contentEl_=null,e.prototype.dispose.call(this)},r.updateShowing=function(e){this.player().duration()===1/0?this.show():this.hide()},t}(zt);zt.registerComponent("LiveDisplay",Oi);var Pi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).updateLiveEdgeStatus(),i.player_.liveTracker&&(i.updateLiveEdgeStatusHandler_=function(e){return i.updateLiveEdgeStatus(e)},i.on(i.player_.liveTracker,"liveedgechange",i.updateLiveEdgeStatusHandler_)),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t=e.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Ce("span",{className:"vjs-seek-to-live-text",textContent:this.localize("LIVE")},{"aria-hidden":"true"}),t.appendChild(this.textEl_),t},r.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},r.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},r.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatusHandler_),this.textEl_=null,e.prototype.dispose.call(this)},t}(_i);Pi.prototype.controlText_="Seek to live, currently playing live",zt.registerComponent("SeekToLive",Pi);var Mi=function(e,t,r){return e=Number(e),Math.min(r,Math.max(t,isNaN(e)?t:e))},Fi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).handleMouseDown_=function(e){return i.handleMouseDown(e)},i.handleMouseUp_=function(e){return i.handleMouseUp(e)},i.handleKeyDown_=function(e){return i.handleKeyDown(e)},i.handleClick_=function(e){return i.handleClick(e)},i.handleMouseMove_=function(e){return i.handleMouseMove(e)},i.update_=function(e){return i.update(e)},i.bar=i.getChild(i.options_.barName),i.vertical(!!i.options_.vertical),i.enable(),i}b.default(t,e);var r=t.prototype;return r.enabled=function(){return this.enabled_},r.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown_),this.on("touchstart",this.handleMouseDown_),this.on("keydown",this.handleKeyDown_),this.on("click",this.handleClick_),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},r.disable=function(){if(this.enabled()){var e=this.bar.el_.ownerDocument;this.off("mousedown",this.handleMouseDown_),this.off("touchstart",this.handleMouseDown_),this.off("keydown",this.handleKeyDown_),this.off("click",this.handleClick_),this.off(this.player_,"controlsvisible",this.update_),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1}},r.createEl=function(t,r,i){return void 0===r&&(r={}),void 0===i&&(i={}),r.className=r.className+" vjs-slider",r=z({tabIndex:0},r),i=z({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},i),e.prototype.createEl.call(this,t,r,i)},r.handleMouseDown=function(e){var t=this.bar.el_.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"===e.type&&!oe&&e.preventDefault(),Ne(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(t,"mousemove",this.handleMouseMove_),this.on(t,"mouseup",this.handleMouseUp_),this.on(t,"touchmove",this.handleMouseMove_),this.on(t,"touchend",this.handleMouseUp_),this.handleMouseMove(e,!0)},r.handleMouseMove=function(e){},r.handleMouseUp=function(){var e=this.bar.el_.ownerDocument;Be(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(e,"mousemove",this.handleMouseMove_),this.off(e,"mouseup",this.handleMouseUp_),this.off(e,"touchmove",this.handleMouseMove_),this.off(e,"touchend",this.handleMouseUp_),this.update()},r.update=function(){var e=this;if(this.el_&&this.bar){var t=this.getProgress();return t===this.progress_||(this.progress_=t,this.requestNamedAnimationFrame("Slider#update",(function(){var r=e.vertical()?"height":"width";e.bar.el().style[r]=(100*t).toFixed(2)+"%"}))),t}},r.getProgress=function(){return Number(Mi(this.getPercent(),0,1).toFixed(4))},r.calculateDistance=function(e){var t=He(this.el_,e);return this.vertical()?t.y:t.x},r.handleKeyDown=function(t){_.default.isEventKey(t,"Left")||_.default.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepBack()):_.default.isEventKey(t,"Right")||_.default.isEventKey(t,"Up")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):e.prototype.handleKeyDown.call(this,t)},r.handleClick=function(e){e.stopPropagation(),e.preventDefault()},r.vertical=function(e){if(void 0===e)return this.vertical_||!1;this.vertical_=!!e,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},t}(zt);zt.registerComponent("Slider",Fi);var Ni=function(e,t){return Mi(e/t*100,0,100).toFixed(2)+"%"},Bi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).partEls_=[],i.on(t,"progress",(function(e){return i.update(e)})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),r=Ce("span",{className:"vjs-control-text"}),i=Ce("span",{textContent:this.localize("Loaded")}),n=m.default.createTextNode(": ");return this.percentageEl_=Ce("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),t.appendChild(r),r.appendChild(i),r.appendChild(n),r.appendChild(this.percentageEl_),t},r.dispose=function(){this.partEls_=null,this.percentageEl_=null,e.prototype.dispose.call(this)},r.update=function(e){var t=this;this.requestNamedAnimationFrame("LoadProgressBar#update",(function(){var e=t.player_.liveTracker,r=t.player_.buffered(),i=e&&e.isLive()?e.seekableEnd():t.player_.duration(),n=t.player_.bufferedEnd(),a=t.partEls_,s=Ni(n,i);t.percent_!==s&&(t.el_.style.width=s,we(t.percentageEl_,s),t.percent_=s);for(var o=0;o<r.length;o++){var l=r.start(o),u=r.end(o),c=a[o];c||(c=t.el_.appendChild(Ce()),a[o]=c),(c.dataset.start!==l||c.dataset.end!==u)&&(c.dataset.start=l,c.dataset.end=u,c.style.left=Ni(l,n),c.style.width=Ni(u-l,n))}for(var d=a.length;d>r.length;d--)t.el_.removeChild(a[d-1]);a.length=r.length}))},t}(zt);zt.registerComponent("LoadProgressBar",Bi);var ji=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update=St(Et(T.default(i),i.update),bt),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},r.update=function(e,t,r){var i=Ue(this.el_),n=je(this.player_.el()),a=e.width*t;if(n&&i){var s=e.left-n.left+a,o=e.width-a+(n.right-e.right),l=i.width/2;s<l?l+=l-s:o<l&&(l=o),l<0?l=0:l>i.width&&(l=i.width),l=Math.round(l),this.el_.style.right="-"+l+"px",this.write(r)}},r.write=function(e){we(this.el_,e)},r.updateTime=function(e,t,r,i){var n=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",(function(){var a,s=n.player_.duration();if(n.player_.liveTracker&&n.player_.liveTracker.isLive()){var o=n.player_.liveTracker.liveWindow(),l=o-t*o;a=(l<1?"":"-")+Ai(l,o)}else a=Ai(r,s);n.update(e,t,a),i&&i()}))},t}(zt);zt.registerComponent("TimeTooltip",ji);var Ui=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update=St(Et(T.default(i),i.update),bt),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},r.update=function(e,t){var r=this.getChild("timeTooltip");if(r){var i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();r.updateTime(e,t,i)}},t}(zt);Ui.prototype.options_={children:[]},!ve&&!re&&Ui.prototype.options_.children.push("timeTooltip"),zt.registerComponent("PlayProgressBar",Ui);var Hi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update=St(Et(T.default(i),i.update),bt),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},r.update=function(e,t){var r=this,i=t*this.player_.duration();this.getChild("timeTooltip").updateTime(e,t,i,(function(){r.el_.style.left=e.width*t+"px"}))},t}(zt);Hi.prototype.options_={children:["timeTooltip"]},zt.registerComponent("MouseTimeDisplay",Hi);var Gi=5,Ki=12,Vi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).setEventHandlers_(),i}b.default(t,e);var r=t.prototype;return r.setEventHandlers_=function(){var e=this;this.update_=Et(this,this.update),this.update=St(this.update_,bt),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=function(t){return e.enableInterval_(t)},this.disableIntervalHandler_=function(t){return e.disableInterval_(t)},this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in m.default&&"visibilityState"in m.default&&this.on(m.default,"visibilitychange",this.toggleVisibility_)},r.toggleVisibility_=function(e){"hidden"===m.default.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(e)):(!this.player_.ended()&&!this.player_.paused()&&this.enableInterval_(),this.update())},r.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,bt))},r.disableInterval_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&e&&"ended"!==e.type||!this.updateInterval||(this.clearInterval(this.updateInterval),this.updateInterval=null)},r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},r.update=function(t){var r=this;if("hidden"!==m.default.visibilityState){var i=e.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",(function(){var e=r.player_.ended()?r.player_.duration():r.getCurrentTime_(),t=r.player_.liveTracker,n=r.player_.duration();t&&t.isLive()&&(n=r.player_.liveTracker.liveCurrentTime()),r.percent_!==i&&(r.el_.setAttribute("aria-valuenow",(100*i).toFixed(2)),r.percent_=i),(r.currentTime_!==e||r.duration_!==n)&&(r.el_.setAttribute("aria-valuetext",r.localize("progress bar timing: currentTime={1} duration={2}",[Ai(e,n),Ai(n,n)],"{1} of {2}")),r.currentTime_=e,r.duration_=n),r.bar&&r.bar.update(je(r.el()),r.getProgress())})),i}},r.userSeek_=function(e){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&this.player_.liveTracker.nextSeekedFromUser(),this.player_.currentTime(e)},r.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},r.getPercent=function(){var e,t=this.getCurrentTime_(),r=this.player_.liveTracker;return r&&r.isLive()?(e=(t-r.seekableStart())/r.liveWindow(),r.atLiveEdge()&&(e=1)):e=t/this.player_.duration(),e},r.handleMouseDown=function(t){!ze(t)||(t.stopPropagation(),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),e.prototype.handleMouseDown.call(this,t))},r.handleMouseMove=function(e,t){if(void 0===t&&(t=!1),ze(e)){!t&&!this.player_.scrubbing()&&this.player_.scrubbing(!0);var r,i=this.calculateDistance(e),n=this.player_.liveTracker;if(n&&n.isLive()){if(i>=.99)return void n.seekToLiveEdge();var a=n.seekableStart(),s=n.liveCurrentTime();if((r=a+i*n.liveWindow())>=s&&(r=s),r<=a&&(r=a+.1),r===1/0)return}else(r=i*this.player_.duration())===this.player_.duration()&&(r-=.1);this.userSeek_(r)}},r.enable=function(){e.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");!t||t.show()},r.disable=function(){e.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");!t||t.hide()},r.handleMouseUp=function(t){e.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?rr(this.player_.play()):this.update_()},r.stepForward=function(){this.userSeek_(this.player_.currentTime()+Gi)},r.stepBack=function(){this.userSeek_(this.player_.currentTime()-Gi)},r.handleAction=function(e){this.player_.paused()?this.player_.play():this.player_.pause()},r.handleKeyDown=function(t){var r=this.player_.liveTracker;if(_.default.isEventKey(t,"Space")||_.default.isEventKey(t,"Enter"))t.preventDefault(),t.stopPropagation(),this.handleAction(t);else if(_.default.isEventKey(t,"Home"))t.preventDefault(),t.stopPropagation(),this.userSeek_(0);else if(_.default.isEventKey(t,"End"))t.preventDefault(),t.stopPropagation(),r&&r.isLive()?this.userSeek_(r.liveCurrentTime()):this.userSeek_(this.player_.duration());else if(/^[0-9]$/.test(_.default(t))){t.preventDefault(),t.stopPropagation();var i=10*(_.default.codes[_.default(t)]-_.default.codes[0])/100;r&&r.isLive()?this.userSeek_(r.seekableStart()+r.liveWindow()*i):this.userSeek_(this.player_.duration()*i)}else _.default.isEventKey(t,"PgDn")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()-Gi*Ki)):_.default.isEventKey(t,"PgUp")?(t.preventDefault(),t.stopPropagation(),this.userSeek_(this.player_.currentTime()+Gi*Ki)):e.prototype.handleKeyDown.call(this,t)},r.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableIntervalHandler_),this.off(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in m.default&&"visibilityState"in m.default&&this.off(m.default,"visibilitychange",this.toggleVisibility_),e.prototype.dispose.call(this)},t}(Fi);Vi.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},!ve&&!re&&Vi.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),zt.registerComponent("SeekBar",Vi);var qi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).handleMouseMove=St(Et(T.default(i),i.handleMouseMove),bt),i.throttledHandleMouseSeek=St(Et(T.default(i),i.handleMouseSeek),bt),i.handleMouseUpHandler_=function(e){return i.handleMouseUp(e)},i.handleMouseDownHandler_=function(e){return i.handleMouseDown(e)},i.enable(),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},r.handleMouseMove=function(e){var t=this.getChild("seekBar");if(t){var r=t.getChild("playProgressBar"),i=t.getChild("mouseTimeDisplay");if(r||i){var n=t.el(),a=Ue(n),s=He(n,e).x;s=Mi(s,0,1),i&&i.update(a,s),r&&r.update(a,t.getProgress())}}},r.handleMouseSeek=function(e){var t=this.getChild("seekBar");t&&t.handleMouseMove(e)},r.enabled=function(){return this.enabled_},r.disable=function(){if(this.children().forEach((function(e){return e.disable&&e.disable()})),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDownHandler_),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())){var e=this.getChild("seekBar");this.player_.scrubbing(!1),e.videoWasPlaying&&rr(this.player_.play())}},r.enable=function(){this.children().forEach((function(e){return e.enable&&e.enable()})),!this.enabled()&&(this.on(["mousedown","touchstart"],this.handleMouseDownHandler_),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},r.removeListenersAddedOnMousedownAndTouchstart=function(){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseSeek),this.off(e,"touchmove",this.throttledHandleMouseSeek),this.off(e,"mouseup",this.handleMouseUpHandler_),this.off(e,"touchend",this.handleMouseUpHandler_)},r.handleMouseDown=function(e){var t=this.el_.ownerDocument,r=this.getChild("seekBar");r&&r.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},r.handleMouseUp=function(e){var t=this.getChild("seekBar");t&&t.handleMouseUp(e),this.removeListenersAddedOnMousedownAndTouchstart()},t}(zt);qi.prototype.options_={children:["seekBar"]},zt.registerComponent("ProgressControl",qi);var Wi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on(t,["enterpictureinpicture","leavepictureinpicture"],(function(e){return i.handlePictureInPictureChange(e)})),i.on(t,["disablepictureinpicturechanged","loadedmetadata"],(function(e){return i.handlePictureInPictureEnabledChange(e)})),i.disable(),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-picture-in-picture-control "+e.prototype.buildCSSClass.call(this)},r.handlePictureInPictureEnabledChange=function(){m.default.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},r.handlePictureInPictureChange=function(e){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},r.handleClick=function(e){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},t}(_i);Wi.prototype.controlText_="Picture-in-Picture",zt.registerComponent("PictureInPictureToggle",Wi);var zi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on(t,"fullscreenchange",(function(e){return i.handleFullscreenChange(e)})),!1===m.default[t.fsApi_.fullscreenEnabled]&&i.disable(),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-fullscreen-control "+e.prototype.buildCSSClass.call(this)},r.handleFullscreenChange=function(e){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},r.handleClick=function(e){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},t}(_i);zi.prototype.controlText_="Fullscreen",zt.registerComponent("FullscreenToggle",zi);var Yi=function(e,t){t.tech_&&!t.tech_.featuresVolumeControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresVolumeControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))},Xi=function(e){function t(){return e.apply(this,arguments)||this}return b.default(t,e),t.prototype.createEl=function(){var t=e.prototype.createEl.call(this,"div",{className:"vjs-volume-level"});return t.appendChild(e.prototype.createEl.call(this,"span",{className:"vjs-control-text"})),t},t}(zt);zt.registerComponent("VolumeLevel",Xi);var Qi=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update=St(Et(T.default(i),i.update),bt),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-tooltip"},{"aria-hidden":"true"})},r.update=function(e,t,r,i){if(!r){var n=je(this.el_),a=je(this.player_.el()),s=e.width*t;if(!a||!n)return;var o=e.left-a.left+s,l=e.width-s+(a.right-e.right),u=n.width/2;o<u?u+=u-o:l<u&&(u=l),u<0?u=0:u>n.width&&(u=n.width),this.el_.style.right="-"+u+"px"}this.write(i+"%")},r.write=function(e){we(this.el_,e)},r.updateVolume=function(e,t,r,i,n){var a=this;this.requestNamedAnimationFrame("VolumeLevelTooltip#updateVolume",(function(){a.update(e,t,r,i.toFixed(0)),n&&n()}))},t}(zt);zt.registerComponent("VolumeLevelTooltip",Qi);var Ji=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).update=St(Et(T.default(i),i.update),bt),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},r.update=function(e,t,r){var i=this,n=100*t;this.getChild("volumeLevelTooltip").updateVolume(e,t,r,n,(function(){r?i.el_.style.bottom=e.height*t+"px":i.el_.style.left=e.width*t+"px"}))},t}(zt);Ji.prototype.options_={children:["volumeLevelTooltip"]},zt.registerComponent("MouseVolumeLevelDisplay",Ji);var $i=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on("slideractive",(function(e){return i.updateLastVolume_(e)})),i.on(t,"volumechange",(function(e){return i.updateARIAAttributes(e)})),t.ready((function(){return i.updateARIAAttributes()})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},r.handleMouseDown=function(t){!ze(t)||e.prototype.handleMouseDown.call(this,t)},r.handleMouseMove=function(e){var t=this.getChild("mouseVolumeLevelDisplay");if(t){var r=this.el(),i=je(r),n=this.vertical(),a=He(r,e);a=n?a.y:a.x,a=Mi(a,0,1),t.update(i,a,n)}!ze(e)||(this.checkMuted(),this.player_.volume(this.calculateDistance(e)))},r.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},r.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},r.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},r.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},r.updateARIAAttributes=function(e){var t=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",t),this.el_.setAttribute("aria-valuetext",t+"%")},r.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},r.updateLastVolume_=function(){var e=this,t=this.player_.volume();this.one("sliderinactive",(function(){0===e.player_.volume()&&e.player_.lastVolume_(t)}))},t}(Fi);$i.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},!ve&&!re&&$i.prototype.options_.children.splice(0,0,"mouseVolumeLevelDisplay"),$i.prototype.playerEvent="volumechange",zt.registerComponent("VolumeBar",$i);var Zi=function(e){function t(t,r){var i;return void 0===r&&(r={}),r.vertical=r.vertical||!1,("undefined"==typeof r.volumeBar||X(r.volumeBar))&&(r.volumeBar=r.volumeBar||{},r.volumeBar.vertical=r.vertical),i=e.call(this,t,r)||this,Yi(T.default(i),t),i.throttledHandleMouseMove=St(Et(T.default(i),i.handleMouseMove),bt),i.handleMouseUpHandler_=function(e){return i.handleMouseUp(e)},i.on("mousedown",(function(e){return i.handleMouseDown(e)})),i.on("touchstart",(function(e){return i.handleMouseDown(e)})),i.on("mousemove",(function(e){return i.handleMouseMove(e)})),i.on(i.volumeBar,["focus","slideractive"],(function(){i.volumeBar.addClass("vjs-slider-active"),i.addClass("vjs-slider-active"),i.trigger("slideractive")})),i.on(i.volumeBar,["blur","sliderinactive"],(function(){i.volumeBar.removeClass("vjs-slider-active"),i.removeClass("vjs-slider-active"),i.trigger("sliderinactive")})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},r.handleMouseDown=function(e){var t=this.el_.ownerDocument;this.on(t,"mousemove",this.throttledHandleMouseMove),this.on(t,"touchmove",this.throttledHandleMouseMove),this.on(t,"mouseup",this.handleMouseUpHandler_),this.on(t,"touchend",this.handleMouseUpHandler_)},r.handleMouseUp=function(e){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseMove),this.off(t,"touchmove",this.throttledHandleMouseMove),this.off(t,"mouseup",this.handleMouseUpHandler_),this.off(t,"touchend",this.handleMouseUpHandler_)},r.handleMouseMove=function(e){this.volumeBar.handleMouseMove(e)},t}(zt);Zi.prototype.options_={children:["volumeBar"]},zt.registerComponent("VolumeControl",Zi);var en=function(e,t){t.tech_&&!t.tech_.featuresMuteControl&&e.addClass("vjs-hidden"),e.on(t,"loadstart",(function(){t.tech_.featuresMuteControl?e.removeClass("vjs-hidden"):e.addClass("vjs-hidden")}))},tn=function(e){function t(t,r){var i;return i=e.call(this,t,r)||this,en(T.default(i),t),i.on(t,["loadstart","volumechange"],(function(e){return i.update(e)})),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-mute-control "+e.prototype.buildCSSClass.call(this)},r.handleClick=function(e){var t=this.player_.volume(),r=this.player_.lastVolume_();if(0===t){var i=r<.1?.1:r;this.player_.volume(i),this.player_.muted(!1)}else this.player_.muted(!this.player_.muted())},r.update=function(e){this.updateIcon_(),this.updateControlText_()},r.updateIcon_=function(){var e=this.player_.volume(),t=3;ve&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===e||this.player_.muted()?t=0:e<.33?t=1:e<.67&&(t=2);for(var r=0;r<4;r++)De(this.el_,"vjs-vol-"+r);xe(this.el_,"vjs-vol-"+t)},r.updateControlText_=function(){var e=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==e&&this.controlText(e)},t}(_i);tn.prototype.controlText_="Mute",zt.registerComponent("MuteToggle",tn);var rn=function(e){function t(t,r){var i;return void 0===r&&(r={}),"undefined"!=typeof r.inline?r.inline=r.inline:r.inline=!0,("undefined"==typeof r.volumeControl||X(r.volumeControl))&&(r.volumeControl=r.volumeControl||{},r.volumeControl.vertical=!r.inline),(i=e.call(this,t,r)||this).handleKeyPressHandler_=function(e){return i.handleKeyPress(e)},i.on(t,["loadstart"],(function(e){return i.volumePanelState_(e)})),i.on(i.muteToggle,"keyup",(function(e){return i.handleKeyPress(e)})),i.on(i.volumeControl,"keyup",(function(e){return i.handleVolumeControlKeyUp(e)})),i.on("keydown",(function(e){return i.handleKeyPress(e)})),i.on("mouseover",(function(e){return i.handleMouseOver(e)})),i.on("mouseout",(function(e){return i.handleMouseOut(e)})),i.on(i.volumeControl,["slideractive"],i.sliderActive_),i.on(i.volumeControl,["sliderinactive"],i.sliderInactive_),i}b.default(t,e);var r=t.prototype;return r.sliderActive_=function(){this.addClass("vjs-slider-active")},r.sliderInactive_=function(){this.removeClass("vjs-slider-active")},r.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},r.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),e.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},r.dispose=function(){this.handleMouseOut(),e.prototype.dispose.call(this)},r.handleVolumeControlKeyUp=function(e){_.default.isEventKey(e,"Esc")&&this.muteToggle.focus()},r.handleMouseOver=function(e){this.addClass("vjs-hover"),pt(m.default,"keyup",this.handleKeyPressHandler_)},r.handleMouseOut=function(e){this.removeClass("vjs-hover"),vt(m.default,"keyup",this.handleKeyPressHandler_)},r.handleKeyPress=function(e){_.default.isEventKey(e,"Esc")&&this.handleMouseOut()},t}(zt);rn.prototype.options_={children:["muteToggle","volumeControl"]},zt.registerComponent("VolumePanel",rn);var nn=function(e){function t(t,r){var i;return i=e.call(this,t,r)||this,r&&(i.menuButton_=r.menuButton),i.focusedChild_=-1,i.on("keydown",(function(e){return i.handleKeyDown(e)})),i.boundHandleBlur_=function(e){return i.handleBlur(e)},i.boundHandleTapClick_=function(e){return i.handleTapClick(e)},i}b.default(t,e);var r=t.prototype;return r.addEventListenerForItem=function(e){e instanceof zt&&(this.on(e,"blur",this.boundHandleBlur_),this.on(e,["tap","click"],this.boundHandleTapClick_))},r.removeEventListenerForItem=function(e){e instanceof zt&&(this.off(e,"blur",this.boundHandleBlur_),this.off(e,["tap","click"],this.boundHandleTapClick_))},r.removeChild=function(t){"string"==typeof t&&(t=this.getChild(t)),this.removeEventListenerForItem(t),e.prototype.removeChild.call(this,t)},r.addItem=function(e){var t=this.addChild(e);t&&this.addEventListenerForItem(t)},r.createEl=function(){var t=this.options_.contentElType||"ul";this.contentEl_=Ce(t,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");var r=e.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return r.appendChild(this.contentEl_),pt(r,"click",(function(e){e.preventDefault(),e.stopImmediatePropagation()})),r},r.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,e.prototype.dispose.call(this)},r.handleBlur=function(e){var t=e.relatedTarget||m.default.activeElement;if(!this.children().some((function(e){return e.el()===t}))){var r=this.menuButton_;r&&r.buttonPressed_&&t!==r.el().firstChild&&r.unpressButton()}},r.handleTapClick=function(e){if(this.menuButton_){this.menuButton_.unpressButton();var t=this.children();if(!Array.isArray(t))return;var r=t.filter((function(t){return t.el()===e.target}))[0];if(!r)return;"CaptionSettingsMenuItem"!==r.name()&&this.menuButton_.focus()}},r.handleKeyDown=function(e){_.default.isEventKey(e,"Left")||_.default.isEventKey(e,"Down")?(e.preventDefault(),e.stopPropagation(),this.stepForward()):(_.default.isEventKey(e,"Right")||_.default.isEventKey(e,"Up"))&&(e.preventDefault(),e.stopPropagation(),this.stepBack())},r.stepForward=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_+1),this.focus(e)},r.stepBack=function(){var e=0;void 0!==this.focusedChild_&&(e=this.focusedChild_-1),this.focus(e)},r.focus=function(e){void 0===e&&(e=0);var t=this.children().slice();t.length&&t[0].hasClass("vjs-menu-title")&&t.shift(),t.length>0&&(e<0?e=0:e>=t.length&&(e=t.length-1),this.focusedChild_=e,t[e].el_.focus())},t}(zt);zt.registerComponent("Menu",nn);var an=function(e){function t(t,r){var i;void 0===r&&(r={}),(i=e.call(this,t,r)||this).menuButton_=new _i(t,r),i.menuButton_.controlText(i.controlText_),i.menuButton_.el_.setAttribute("aria-haspopup","true");var n=_i.prototype.buildCSSClass();i.menuButton_.el_.className=i.buildCSSClass()+" "+n,i.menuButton_.removeClass("vjs-control"),i.addChild(i.menuButton_),i.update(),i.enabled_=!0;var a=function(e){return i.handleClick(e)};return i.handleMenuKeyUp_=function(e){return i.handleMenuKeyUp(e)},i.on(i.menuButton_,"tap",a),i.on(i.menuButton_,"click",a),i.on(i.menuButton_,"keydown",(function(e){return i.handleKeyDown(e)})),i.on(i.menuButton_,"mouseenter",(function(){i.addClass("vjs-hover"),i.menu.show(),pt(m.default,"keyup",i.handleMenuKeyUp_)})),i.on("mouseleave",(function(e){return i.handleMouseLeave(e)})),i.on("keydown",(function(e){return i.handleSubmenuKeyDown(e)})),i}b.default(t,e);var r=t.prototype;return r.update=function(){var e=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=e,this.addChild(e),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},r.createMenu=function(){var e=new nn(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var t=Ce("li",{className:"vjs-menu-title",textContent:Ut(this.options_.title),tabIndex:-1}),r=new zt(this.player_,{el:t});e.addItem(r)}if(this.items=this.createItems(),this.items)for(var i=0;i<this.items.length;i++)e.addItem(this.items[i]);return e},r.createItems=function(){},r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},r.buildWrapperCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+_i.prototype.buildCSSClass()+" "+e.prototype.buildCSSClass.call(this)},r.buildCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+e.prototype.buildCSSClass.call(this)},r.controlText=function(e,t){return void 0===t&&(t=this.menuButton_.el()),this.menuButton_.controlText(e,t)},r.dispose=function(){this.handleMouseLeave(),e.prototype.dispose.call(this)},r.handleClick=function(e){this.buttonPressed_?this.unpressButton():this.pressButton()},r.handleMouseLeave=function(e){this.removeClass("vjs-hover"),vt(m.default,"keyup",this.handleMenuKeyUp_)},r.focus=function(){this.menuButton_.focus()},r.blur=function(){this.menuButton_.blur()},r.handleKeyDown=function(e){_.default.isEventKey(e,"Esc")||_.default.isEventKey(e,"Tab")?(this.buttonPressed_&&this.unpressButton(),_.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus())):(_.default.isEventKey(e,"Up")||_.default.isEventKey(e,"Down"))&&(this.buttonPressed_||(e.preventDefault(),this.pressButton()))},r.handleMenuKeyUp=function(e){(_.default.isEventKey(e,"Esc")||_.default.isEventKey(e,"Tab"))&&this.removeClass("vjs-hover")},r.handleSubmenuKeyPress=function(e){this.handleSubmenuKeyDown(e)},r.handleSubmenuKeyDown=function(e){(_.default.isEventKey(e,"Esc")||_.default.isEventKey(e,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),_.default.isEventKey(e,"Tab")||(e.preventDefault(),this.menuButton_.focus()))},r.pressButton=function(){if(this.enabled_){if(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),ve&&Se())return;this.menu.focus()}},r.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},r.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},r.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},t}(zt);zt.registerComponent("MenuButton",an);var sn=function(e){function t(t,r){var i,n=r.tracks;if((i=e.call(this,t,r)||this).items.length<=1&&i.hide(),!n)return T.default(i);var a=Et(T.default(i),i.update);return n.addEventListener("removetrack",a),n.addEventListener("addtrack",a),n.addEventListener("labelchange",a),i.player_.on("ready",a),i.player_.on("dispose",(function(){n.removeEventListener("removetrack",a),n.removeEventListener("addtrack",a),n.removeEventListener("labelchange",a)})),i}return b.default(t,e),t}(an);zt.registerComponent("TrackButton",sn);var on=["Tab","Esc","Up","Down","Right","Left"],ln=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).selectable=r.selectable,i.isSelected_=r.selected||!1,i.multiSelectable=r.multiSelectable,i.selected(i.isSelected_),i.selectable?i.multiSelectable?i.el_.setAttribute("role","menuitemcheckbox"):i.el_.setAttribute("role","menuitemradio"):i.el_.setAttribute("role","menuitem"),i}b.default(t,e);var r=t.prototype;return r.createEl=function(t,r,i){this.nonIconControl=!0;var n=e.prototype.createEl.call(this,"li",z({className:"vjs-menu-item",tabIndex:-1},r),i);return n.replaceChild(Ce("span",{className:"vjs-menu-item-text",textContent:this.localize(this.options_.label)}),n.querySelector(".vjs-icon-placeholder")),n},r.handleKeyDown=function(t){on.some((function(e){return _.default.isEventKey(t,e)}))||e.prototype.handleKeyDown.call(this,t)},r.handleClick=function(e){this.selected(!0)},r.selected=function(e){this.selectable&&(e?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(ci);zt.registerComponent("MenuItem",ln);var un=function(e){function t(t,r){var i,n=r.track,a=t.textTracks();r.label=n.label||n.language||"Unknown",r.selected="showing"===n.mode,(i=e.call(this,t,r)||this).track=n,i.kinds=(r.kinds||[r.kind||i.track.kind]).filter(Boolean);var s,o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.handleTracksChange.apply(T.default(i),t)},l=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.handleSelectedLanguageChange.apply(T.default(i),t)};return t.on(["loadstart","texttrackchange"],o),a.addEventListener("change",o),a.addEventListener("selectedlanguagechange",l),i.on("dispose",(function(){t.off(["loadstart","texttrackchange"],o),a.removeEventListener("change",o),a.removeEventListener("selectedlanguagechange",l)})),void 0===a.onchange&&i.on(["tap","click"],(function(){if("object"!=typeof g.default.Event)try{s=new g.default.Event("change")}catch(e){}s||(s=m.default.createEvent("Event")).initEvent("change",!0,!0),a.dispatchEvent(s)})),i.handleTracksChange(),i}b.default(t,e);var r=t.prototype;return r.handleClick=function(t){var r=this.track,i=this.player_.textTracks();if(e.prototype.handleClick.call(this,t),i)for(var n=0;n<i.length;n++){var a=i[n];-1!==this.kinds.indexOf(a.kind)&&(a===r?"showing"!==a.mode&&(a.mode="showing"):"disabled"!==a.mode&&(a.mode="disabled"))}},r.handleTracksChange=function(e){var t="showing"===this.track.mode;t!==this.isSelected_&&this.selected(t)},r.handleSelectedLanguageChange=function(e){if("showing"===this.track.mode){var t=this.player_.cache_.selectedLanguage;if(t&&t.enabled&&t.language===this.track.language&&t.kind!==this.track.kind)return;this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}}},r.dispose=function(){this.track=null,e.prototype.dispose.call(this)},t}(ln);zt.registerComponent("TextTrackMenuItem",un);var cn=function(e){function t(t,r){return r.track={player:t,kind:r.kind,kinds:r.kinds,default:!1,mode:"disabled"},r.kinds||(r.kinds=[r.kind]),r.label?r.track.label=r.label:r.track.label=r.kinds.join(" and ")+" off",r.selectable=!0,r.multiSelectable=!1,e.call(this,t,r)||this}b.default(t,e);var r=t.prototype;return r.handleTracksChange=function(e){for(var t=this.player().textTracks(),r=!0,i=0,n=t.length;i<n;i++){var a=t[i];if(this.options_.kinds.indexOf(a.kind)>-1&&"showing"===a.mode){r=!1;break}}r!==this.isSelected_&&this.selected(r)},r.handleSelectedLanguageChange=function(e){for(var t=this.player().textTracks(),r=!0,i=0,n=t.length;i<n;i++){var a=t[i];if(["captions","descriptions","subtitles"].indexOf(a.kind)>-1&&"showing"===a.mode){r=!1;break}}r&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(un);zt.registerComponent("OffTextTrackMenuItem",cn);var dn=function(e){function t(t,r){return void 0===r&&(r={}),r.tracks=t.textTracks(),e.call(this,t,r)||this}return b.default(t,e),t.prototype.createItems=function(e,t){var r;void 0===e&&(e=[]),void 0===t&&(t=un),this.label_&&(r=this.label_+" off"),e.push(new cn(this.player_,{kinds:this.kinds_,kind:this.kind_,label:r})),this.hideThreshold_+=1;var i=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var n=0;n<i.length;n++){var a=i[n];if(this.kinds_.indexOf(a.kind)>-1){var s=new t(this.player_,{track:a,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1});s.addClass("vjs-"+a.kind+"-menu-item"),e.push(s)}}return e},t}(sn);zt.registerComponent("TextTrackButton",dn);var hn=function(e){function t(t,r){var i,n=r.track,a=r.cue,s=t.currentTime();return r.selectable=!0,r.multiSelectable=!1,r.label=a.text,r.selected=a.startTime<=s&&s<a.endTime,(i=e.call(this,t,r)||this).track=n,i.cue=a,n.addEventListener("cuechange",Et(T.default(i),i.update)),i}b.default(t,e);var r=t.prototype;return r.handleClick=function(t){e.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},r.update=function(e){var t=this.cue,r=this.player_.currentTime();this.selected(t.startTime<=r&&r<t.endTime)},t}(ln);zt.registerComponent("ChaptersTrackMenuItem",hn);var fn=function(e){function t(t,r,i){return e.call(this,t,r,i)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-chapters-button "+e.prototype.buildWrapperCSSClass.call(this)},r.update=function(t){(!this.track_||t&&("addtrack"===t.type||"removetrack"===t.type))&&this.setTrack(this.findChaptersTrack()),e.prototype.update.call(this)},r.setTrack=function(e){if(this.track_!==e){if(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_){var t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);t&&t.removeEventListener("load",this.updateHandler_),this.track_=null}if(this.track_=e,this.track_){this.track_.mode="hidden";var r=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_);r&&r.addEventListener("load",this.updateHandler_)}}},r.findChaptersTrack=function(){for(var e=this.player_.textTracks()||[],t=e.length-1;t>=0;t--){var r=e[t];if(r.kind===this.kind_)return r}},r.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(Ut(this.kind_))},r.createMenu=function(){return this.options_.title=this.getMenuCaption(),e.prototype.createMenu.call(this)},r.createItems=function(){var e=[];if(!this.track_)return e;var t=this.track_.cues;if(!t)return e;for(var r=0,i=t.length;r<i;r++){var n=t[r],a=new hn(this.player_,{track:this.track_,cue:n});e.push(a)}return e},t}(dn);fn.prototype.kind_="chapters",fn.prototype.controlText_="Chapters",zt.registerComponent("ChaptersButton",fn);var pn=function(e){function t(t,r,i){var n;n=e.call(this,t,r,i)||this;var a=t.textTracks(),s=Et(T.default(n),n.handleTracksChange);return a.addEventListener("change",s),n.on("dispose",(function(){a.removeEventListener("change",s)})),n}b.default(t,e);var r=t.prototype;return r.handleTracksChange=function(e){for(var t=this.player().textTracks(),r=!1,i=0,n=t.length;i<n;i++){var a=t[i];if(a.kind!==this.kind_&&"showing"===a.mode){r=!0;break}}r?this.disable():this.enable()},r.buildCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(dn);pn.prototype.kind_="descriptions",pn.prototype.controlText_="Descriptions",zt.registerComponent("DescriptionsButton",pn);var vn=function(e){function t(t,r,i){return e.call(this,t,r,i)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+e.prototype.buildWrapperCSSClass.call(this)},t}(dn);vn.prototype.kind_="subtitles",vn.prototype.controlText_="Subtitles",zt.registerComponent("SubtitlesButton",vn);var gn=function(e){function t(t,r){var i;return r.track={player:t,kind:r.kind,label:r.kind+" settings",selectable:!1,default:!1,mode:"disabled"},r.selectable=!1,r.name="CaptionSettingsMenuItem",(i=e.call(this,t,r)||this).addClass("vjs-texttrack-settings"),i.controlText(", opens "+r.kind+" settings dialog"),i}return b.default(t,e),t.prototype.handleClick=function(e){this.player().getChild("textTrackSettings").open()},t}(un);zt.registerComponent("CaptionSettingsMenuItem",gn);var mn=function(e){function t(t,r,i){return e.call(this,t,r,i)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-captions-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-captions-button "+e.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){var t=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(t.push(new gn(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),e.prototype.createItems.call(this,t)},t}(dn);mn.prototype.kind_="captions",mn.prototype.controlText_="Captions",zt.registerComponent("CaptionsButton",mn);var yn=function(e){function t(){return e.apply(this,arguments)||this}return b.default(t,e),t.prototype.createEl=function(t,r,i){var n=e.prototype.createEl.call(this,t,r,i),a=n.querySelector(".vjs-menu-item-text");return"captions"===this.options_.track.kind&&(a.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(Ce("span",{className:"vjs-control-text",textContent:" "+this.localize("Captions")}))),n},t}(un);zt.registerComponent("SubsCapsMenuItem",yn);var _n=function(e){function t(t,r){var i;return void 0===r&&(r={}),(i=e.call(this,t,r)||this).label_="subtitles",["en","en-us","en-ca","fr-ca"].indexOf(i.player_.language_)>-1&&(i.label_="captions"),i.menuButton_.controlText(Ut(i.label_)),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+e.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){var t=[];return!(this.player().tech_&&this.player().tech_.featuresNativeTextTracks)&&this.player().getChild("textTrackSettings")&&(t.push(new gn(this.player_,{kind:this.label_})),this.hideThreshold_+=1),t=e.prototype.createItems.call(this,t,yn)},t}(dn);_n.prototype.kinds_=["captions","subtitles"],_n.prototype.controlText_="Subtitles",zt.registerComponent("SubsCapsButton",_n);var Tn=function(e){function t(t,r){var i,n=r.track,a=t.audioTracks();r.label=n.label||n.language||"Unknown",r.selected=n.enabled,(i=e.call(this,t,r)||this).track=n,i.addClass("vjs-"+n.kind+"-menu-item");var s=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.handleTracksChange.apply(T.default(i),t)};return a.addEventListener("change",s),i.on("dispose",(function(){a.removeEventListener("change",s)})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(t,r,i){var n=e.prototype.createEl.call(this,t,r,i),a=n.querySelector(".vjs-menu-item-text");return"main-desc"===this.options_.track.kind&&(a.appendChild(Ce("span",{className:"vjs-icon-placeholder"},{"aria-hidden":!0})),a.appendChild(Ce("span",{className:"vjs-control-text",textContent:" "+this.localize("Descriptions")}))),n},r.handleClick=function(t){if(e.prototype.handleClick.call(this,t),this.track.enabled=!0,this.player_.tech_.featuresNativeAudioTracks)for(var r=this.player_.audioTracks(),i=0;i<r.length;i++){var n=r[i];n!==this.track&&(n.enabled=n===this.track)}},r.handleTracksChange=function(e){this.selected(this.track.enabled)},t}(ln);zt.registerComponent("AudioTrackMenuItem",Tn);var bn=function(e){function t(t,r){return void 0===r&&(r={}),r.tracks=t.audioTracks(),e.call(this,t,r)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-audio-button "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-audio-button "+e.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(e){void 0===e&&(e=[]),this.hideThreshold_=1;for(var t=this.player_.audioTracks(),r=0;r<t.length;r++){var i=t[r];e.push(new Tn(this.player_,{track:i,selectable:!0,multiSelectable:!1}))}return e},t}(sn);bn.prototype.controlText_="Audio Track",zt.registerComponent("AudioTrackButton",bn);var En=function(e){function t(t,r){var i,n=r.rate,a=parseFloat(n,10);return r.label=n,r.selected=a===t.playbackRate(),r.selectable=!0,r.multiSelectable=!1,(i=e.call(this,t,r)||this).label=n,i.rate=a,i.on(t,"ratechange",(function(e){return i.update(e)})),i}b.default(t,e);var r=t.prototype;return r.handleClick=function(t){e.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},r.update=function(e){this.selected(this.player().playbackRate()===this.rate)},t}(ln);En.prototype.contentElType="button",zt.registerComponent("PlaybackRateMenuItem",En);var Sn=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).menuButton_.el_.setAttribute("aria-describedby",i.labelElId_),i.updateVisibility(),i.updateLabel(),i.on(t,"loadstart",(function(e){return i.updateVisibility(e)})),i.on(t,"ratechange",(function(e){return i.updateLabel(e)})),i.on(t,"playbackrateschange",(function(e){return i.handlePlaybackRateschange(e)})),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){var t=e.prototype.createEl.call(this);return this.labelElId_="vjs-playback-rate-value-label-"+this.id_,this.labelEl_=Ce("div",{className:"vjs-playback-rate-value",id:this.labelElId_,textContent:"1x"}),t.appendChild(this.labelEl_),t},r.dispose=function(){this.labelEl_=null,e.prototype.dispose.call(this)},r.buildCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildCSSClass.call(this)},r.buildWrapperCSSClass=function(){return"vjs-playback-rate "+e.prototype.buildWrapperCSSClass.call(this)},r.createItems=function(){for(var e=this.playbackRates(),t=[],r=e.length-1;r>=0;r--)t.push(new En(this.player(),{rate:e[r]+"x"}));return t},r.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},r.handleClick=function(e){var t=this.player().playbackRate(),r=this.playbackRates(),i=(r.indexOf(t)+1)%r.length;this.player().playbackRate(r[i])},r.handlePlaybackRateschange=function(e){this.update()},r.playbackRates=function(){var e=this.player();return e.playbackRates&&e.playbackRates()||[]},r.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&this.playbackRates().length>0},r.updateVisibility=function(e){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},r.updateLabel=function(e){this.playbackRateSupported()&&(this.labelEl_.textContent=this.player().playbackRate()+"x")},t}(an);Sn.prototype.controlText_="Playback Rate",zt.registerComponent("PlaybackRateMenuButton",Sn);var kn=function(e){function t(){return e.apply(this,arguments)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-spacer "+e.prototype.buildCSSClass.call(this)},r.createEl=function(t,r,i){return void 0===t&&(t="div"),void 0===r&&(r={}),void 0===i&&(i={}),r.className||(r.className=this.buildCSSClass()),e.prototype.createEl.call(this,t,r,i)},t}(zt);zt.registerComponent("Spacer",kn);var Cn=function(e){function t(){return e.apply(this,arguments)||this}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},r.createEl=function(){return e.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),textContent:"\xa0"})},t}(kn);zt.registerComponent("CustomControlSpacer",Cn);var wn=function(e){function t(){return e.apply(this,arguments)||this}return b.default(t,e),t.prototype.createEl=function(){return e.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},t}(zt);wn.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in m.default&&wn.prototype.options_.children.splice(wn.prototype.options_.children.length-1,0,"pictureInPictureToggle"),zt.registerComponent("ControlBar",wn);var An=function(e){function t(t,r){var i;return(i=e.call(this,t,r)||this).on(t,"error",(function(e){return i.open(e)})),i}b.default(t,e);var r=t.prototype;return r.buildCSSClass=function(){return"vjs-error-display "+e.prototype.buildCSSClass.call(this)},r.content=function(){var e=this.player().error();return e?this.localize(e.message):""},t}(sr);An.prototype.options_=y.default({},sr.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),zt.registerComponent("ErrorDisplay",An);var Ln="vjs-text-track-settings",xn=["#000","Black"],Dn=["#00F","Blue"],Rn=["#0FF","Cyan"],In=["#0F0","Green"],On=["#F0F","Magenta"],Pn=["#F00","Red"],Mn=["#FFF","White"],Fn=["#FF0","Yellow"],Nn=["1","Opaque"],Bn=["0.5","Semi-Transparent"],jn=["0","Transparent"],Un={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[xn,Mn,Pn,In,Dn,Fn,On,Rn]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[Nn,Bn,jn]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[Mn,xn,Pn,In,Dn,Fn,On,Rn]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(e){return"1.00"===e?null:Number(e)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[Nn,Bn]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[jn,Bn,Nn]}};function Hn(e,t){if(t&&(e=t(e)),e&&"none"!==e)return e}function Gn(e,t){return Hn(e.options[e.options.selectedIndex].value,t)}function Kn(e,t,r){if(t)for(var i=0;i<e.options.length;i++)if(Hn(e.options[i].value,r)===t){e.selectedIndex=i;break}}Un.windowColor.options=Un.backgroundColor.options;var Vn=function(e){function t(t,r){var i;return r.temporary=!1,(i=e.call(this,t,r)||this).updateDisplay=i.updateDisplay.bind(T.default(i)),i.fill(),i.hasBeenOpened_=i.hasBeenFilled_=!0,i.endDialog=Ce("p",{className:"vjs-control-text",textContent:i.localize("End of dialog window.")}),i.el().appendChild(i.endDialog),i.setDefaults(),void 0===r.persistTextTrackSettings&&(i.options_.persistTextTrackSettings=i.options_.playerOptions.persistTextTrackSettings),i.on(i.$(".vjs-done-button"),"click",(function(){i.saveSettings(),i.close()})),i.on(i.$(".vjs-default-button"),"click",(function(){i.setDefaults(),i.updateDisplay()})),q(Un,(function(e){i.on(i.$(e.selector),"change",i.updateDisplay)})),i.options_.persistTextTrackSettings&&i.restoreSettings(),i}b.default(t,e);var r=t.prototype;return r.dispose=function(){this.endDialog=null,e.prototype.dispose.call(this)},r.createElSelect_=function(e,t,r){var i=this;void 0===t&&(t=""),void 0===r&&(r="label");var n=Un[e],a=n.id.replace("%s",this.id_),s=[t,a].join(" ").trim();return["<"+r+' id="'+a+'" class="'+("label"===r?"vjs-label":"")+'">',this.localize(n.label),"</"+r+">",'<select aria-labelledby="'+s+'">'].concat(n.options.map((function(e){var t=a+"-"+e[1].replace(/\W+/g,"");return['<option id="'+t+'" value="'+e[0]+'" ','aria-labelledby="'+s+" "+t+'">',i.localize(e[1]),"</option>"].join("")}))).concat("</select>").join("")},r.createElFgColor_=function(){var e="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",e),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",e),"</span>","</fieldset>"].join("")},r.createElBgColor_=function(){var e="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",e),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",e),"</span>","</fieldset>"].join("")},r.createElWinColor_=function(){var e="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+e+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",e),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",e),"</span>","</fieldset>"].join("")},r.createElColors_=function(){return Ce("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},r.createElFont_=function(){return Ce("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},r.createElControls_=function(){var e=this.localize("restore all settings to the default values");return Ce("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+e+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+e+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},r.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},r.label=function(){return this.localize("Caption Settings Dialog")},r.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},r.buildCSSClass=function(){return e.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},r.getValues=function(){var e=this;return W(Un,(function(t,r,i){var n=Gn(e.$(r.selector),r.parser);return void 0!==n&&(t[i]=n),t}),{})},r.setValues=function(e){var t=this;q(Un,(function(r,i){Kn(t.$(r.selector),e[i],r.parser)}))},r.setDefaults=function(){var e=this;q(Un,(function(t){var r=t.hasOwnProperty("default")?t.default:0;e.$(t.selector).selectedIndex=r}))},r.restoreSettings=function(){var e;try{e=JSON.parse(g.default.localStorage.getItem(Ln))}catch(t){H.warn(t)}e&&this.setValues(e)},r.saveSettings=function(){if(this.options_.persistTextTrackSettings){var e=this.getValues();try{Object.keys(e).length?g.default.localStorage.setItem(Ln,JSON.stringify(e)):g.default.localStorage.removeItem(Ln)}catch(t){H.warn(t)}}},r.updateDisplay=function(){var e=this.player_.getChild("textTrackDisplay");e&&e.updateDisplay()},r.conditionalBlur_=function(){this.previouslyActiveEl_=null;var e=this.player_.controlBar,t=e&&e.subsCapsButton,r=e&&e.captionsButton;t?t.focus():r&&r.focus()},t}(sr);zt.registerComponent("TextTrackSettings",Vn);var qn=function(e){function t(t,r){var i,n=r.ResizeObserver||g.default.ResizeObserver;null===r.ResizeObserver&&(n=!1);var a=Gt({createEl:!n,reportTouchActivity:!1},r);return(i=e.call(this,t,a)||this).ResizeObserver=r.ResizeObserver||g.default.ResizeObserver,i.loadListener_=null,i.resizeObserver_=null,i.debouncedHandler_=kt((function(){i.resizeHandler()}),100,!1,T.default(i)),n?(i.resizeObserver_=new i.ResizeObserver(i.debouncedHandler_),i.resizeObserver_.observe(t.el())):(i.loadListener_=function(){if(i.el_&&i.el_.contentWindow){var e=i.debouncedHandler_,t=i.unloadListener_=function(){vt(this,"resize",e),vt(this,"unload",t),t=null};pt(i.el_.contentWindow,"unload",t),pt(i.el_.contentWindow,"resize",e)}},i.one("load",i.loadListener_)),i}b.default(t,e);var r=t.prototype;return r.createEl=function(){return e.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})},r.resizeHandler=function(){!this.player_||!this.player_.trigger||this.player_.trigger("playerresize")},r.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,e.prototype.dispose.call(this)},t}(zt);zt.registerComponent("ResizeManager",qn);var Wn={trackingThreshold:20,liveTolerance:15},zn=function(e){function t(t,r){var i,n=Gt(Wn,r,{createEl:!1});return(i=e.call(this,t,n)||this).handleVisibilityChange_=function(e){return i.handleVisibilityChange(e)},i.trackLiveHandler_=function(){return i.trackLive_()},i.handlePlay_=function(e){return i.handlePlay(e)},i.handleFirstTimeupdate_=function(e){return i.handleFirstTimeupdate(e)},i.handleSeeked_=function(e){return i.handleSeeked(e)},i.seekToLiveEdge_=function(e){return i.seekToLiveEdge(e)},i.reset_(),i.on(i.player_,"durationchange",(function(e){return i.handleDurationchange(e)})),i.on(i.player_,"canplay",(function(){return i.toggleTracking()})),ue&&"hidden"in m.default&&"visibilityState"in m.default&&i.on(m.default,"visibilitychange",i.handleVisibilityChange_),i}b.default(t,e);var r=t.prototype;return r.handleVisibilityChange=function(){this.player_.duration()===1/0&&(m.default.hidden?this.stopTracking():this.startTracking())},r.trackLive_=function(){var e=this.player_.seekable();if(e&&e.length){var t=Number(g.default.performance.now().toFixed(4)),r=-1===this.lastTime_?0:(t-this.lastTime_)/1e3;this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+r;var i=this.liveCurrentTime(),n=this.player_.currentTime(),a=this.player_.paused()||this.seekedBehindLive_||Math.abs(i-n)>this.options_.liveTolerance;(!this.timeupdateSeen_||i===1/0)&&(a=!1),a!==this.behindLiveEdge_&&(this.behindLiveEdge_=a,this.trigger("liveedgechange"))}},r.handleDurationchange=function(){this.toggleTracking()},r.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},r.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLiveHandler_,bt),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLiveHandler_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked_):(this.one(this.player_,"play",this.handlePlay_),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate_)))},r.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked_)},r.handleSeeked=function(){var e=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=this.nextSeekedFromUser_&&e>2,this.nextSeekedFromUser_=!1,this.trackLive_()},r.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge_)},r.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.nextSeekedFromUser_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLiveHandler_),this.off(this.player_,"seeked",this.handleSeeked_),this.off(this.player_,"play",this.handlePlay_),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate_),this.off(this.player_,"timeupdate",this.seekToLiveEdge_)},r.nextSeekedFromUser=function(){this.nextSeekedFromUser_=!0},r.stopTracking=function(){!this.isTracking()||(this.reset_(),this.trigger("liveedgechange"))},r.seekableEnd=function(){for(var e=this.player_.seekable(),t=[],r=e?e.length:0;r--;)t.push(e.end(r));return t.length?t.sort()[t.length-1]:1/0},r.seekableStart=function(){for(var e=this.player_.seekable(),t=[],r=e?e.length:0;r--;)t.push(e.start(r));return t.length?t.sort()[0]:0},r.liveWindow=function(){var e=this.liveCurrentTime();return e===1/0?0:e-this.seekableStart()},r.isLive=function(){return this.isTracking()},r.atLiveEdge=function(){return!this.behindLiveEdge()},r.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},r.pastSeekEnd=function(){var e=this.seekableEnd();return-1!==this.lastSeekEnd_&&e!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=e,this.pastSeekEnd_},r.behindLiveEdge=function(){return this.behindLiveEdge_},r.isTracking=function(){return"number"==typeof this.trackingInterval_},r.seekToLiveEdge=function(){this.seekedBehindLive_=!1,!this.atLiveEdge()&&(this.nextSeekedFromUser_=!1,this.player_.currentTime(this.liveCurrentTime()))},r.dispose=function(){this.off(m.default,"visibilitychange",this.handleVisibilityChange_),this.stopTracking(),e.prototype.dispose.call(this)},t}(zt);zt.registerComponent("LiveTracker",zn);var Yn,Xn=function(e){var t=e.el();if(t.hasAttribute("src"))return e.triggerSourceset(t.src),!0;var r=e.$$("source"),i=[],n="";if(!r.length)return!1;for(var a=0;a<r.length;a++){var s=r[a].src;s&&-1===i.indexOf(s)&&i.push(s)}return!!i.length&&(1===i.length&&(n=i[0]),e.triggerSourceset(n),!0)},Qn=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(e){var t=m.default.createElement(this.nodeName.toLowerCase());t.innerHTML=e;for(var r=m.default.createDocumentFragment();t.childNodes.length;)r.appendChild(t.childNodes[0]);return this.innerText="",g.default.Element.prototype.appendChild.call(this,r),this.innerHTML}}),Jn=function(e,t){for(var r={},i=0;i<e.length&&!((r=Object.getOwnPropertyDescriptor(e[i],t))&&r.set&&r.get);i++);return r.enumerable=!0,r.configurable=!0,r},$n=function(e){return Jn([e.el(),g.default.HTMLMediaElement.prototype,g.default.Element.prototype,Qn],"innerHTML")},Zn=function(e){var t=e.el();if(!t.resetSourceWatch_){var r={},i=$n(e),n=function(r){return function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];var s=r.apply(t,n);return Xn(e),s}};["append","appendChild","insertAdjacentHTML"].forEach((function(e){!t[e]||(r[e]=t[e],t[e]=n(r[e]))})),Object.defineProperty(t,"innerHTML",Gt(i,{set:n(i.set)})),t.resetSourceWatch_=function(){t.resetSourceWatch_=null,Object.keys(r).forEach((function(e){t[e]=r[e]})),Object.defineProperty(t,"innerHTML",i)},e.one("sourceset",t.resetSourceWatch_)}},ea=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Er(g.default.Element.prototype.getAttribute.call(this,"src")):""},set:function(e){return g.default.Element.prototype.setAttribute.call(this,"src",e),e}}),ta=function(e){return Jn([e.el(),g.default.HTMLMediaElement.prototype,ea],"src")},ra=function(e){if(e.featuresSourceset){var t=e.el();if(!t.resetSourceset_){var r=ta(e),i=t.setAttribute,n=t.load;Object.defineProperty(t,"src",Gt(r,{set:function(i){var n=r.set.call(t,i);return e.triggerSourceset(t.src),n}})),t.setAttribute=function(r,n){var a=i.call(t,r,n);return/src/i.test(r)&&e.triggerSourceset(t.src),a},t.load=function(){var r=n.call(t);return Xn(e)||(e.triggerSourceset(""),Zn(e)),r},t.currentSrc?e.triggerSourceset(t.currentSrc):Xn(e)||Zn(e),t.resetSourceset_=function(){t.resetSourceset_=null,t.load=n,t.setAttribute=i,Object.defineProperty(t,"src",r),t.resetSourceWatch_&&t.resetSourceWatch_()}}}},ia=function(e,t,r,i){void 0===i&&(i=!0);var n=function(r){return Object.defineProperty(e,t,{value:r,enumerable:!0,writable:!0})},a={configurable:!0,enumerable:!0,get:function(){var e=r();return n(e),e}};return i&&(a.set=n),Object.defineProperty(e,t,a)},na=function(e){function t(t,r){var i;i=e.call(this,t,r)||this;var n=t.source,a=!1;if(n&&(i.el_.currentSrc!==n.src||t.tag&&3===t.tag.initNetworkState_)?i.setSource(n):i.handleLateInit_(i.el_),t.enableSourceset&&i.setupSourcesetHandling_(),i.isScrubbing_=!1,i.el_.hasChildNodes()){for(var s=i.el_.childNodes,o=s.length,l=[];o--;){var u=s[o];"track"===u.nodeName.toLowerCase()&&(i.featuresNativeTextTracks?(i.remoteTextTrackEls().addTrackElement_(u),i.remoteTextTracks().addTrack(u.track),i.textTracks().addTrack(u.track),!a&&!i.el_.hasAttribute("crossorigin")&&kr(u.src)&&(a=!0)):l.push(u))}for(var c=0;c<l.length;c++)i.el_.removeChild(l[c])}return i.proxyNativeTracks_(),i.featuresNativeTextTracks&&a&&H.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),i.restoreMetadataTracksInIOSNativePlayer_(),(he||pe||ne)&&!0===t.nativeControlsForTouch&&i.setControls(!0),i.proxyWebkitFullscreen_(),i.triggerReady(),i}b.default(t,e);var r=t.prototype;return r.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),t.disposeMediaElement(this.el_),this.options_=null,e.prototype.dispose.call(this)},r.setupSourcesetHandling_=function(){ra(this)},r.restoreMetadataTracksInIOSNativePlayer_=function(){var e,t=this.textTracks(),r=function(){e=[];for(var r=0;r<t.length;r++){var i=t[r];"metadata"===i.kind&&e.push({track:i,storedMode:i.mode})}};r(),t.addEventListener("change",r),this.on("dispose",(function(){return t.removeEventListener("change",r)}));var i=function r(){for(var i=0;i<e.length;i++){var n=e[i];"disabled"===n.track.mode&&n.track.mode!==n.storedMode&&(n.track.mode=n.storedMode)}t.removeEventListener("change",r)};this.on("webkitbeginfullscreen",(function(){t.removeEventListener("change",r),t.removeEventListener("change",i),t.addEventListener("change",i)})),this.on("webkitendfullscreen",(function(){t.removeEventListener("change",r),t.addEventListener("change",r),t.removeEventListener("change",i)}))},r.overrideNative_=function(e,t){var r=this;if(t===this["featuresNative"+e+"Tracks"]){var i=e.toLowerCase();this[i+"TracksListeners_"]&&Object.keys(this[i+"TracksListeners_"]).forEach((function(e){r.el()[i+"Tracks"].removeEventListener(e,r[i+"TracksListeners_"][e])})),this["featuresNative"+e+"Tracks"]=!t,this[i+"TracksListeners_"]=null,this.proxyNativeTracksForType_(i)}},r.overrideNativeAudioTracks=function(e){this.overrideNative_("Audio",e)},r.overrideNativeVideoTracks=function(e){this.overrideNative_("Video",e)},r.proxyNativeTracksForType_=function(e){var t=this,r=Fr[e],i=this.el()[r.getterName],n=this[r.getterName]();if(this["featuresNative"+r.capitalName+"Tracks"]&&i&&i.addEventListener){var a={change:function(r){var i={type:"change",target:n,currentTarget:n,srcElement:n};n.trigger(i),"text"===e&&t[Nr.remoteText.getterName]().trigger(i)},addtrack:function(e){n.addTrack(e.track)},removetrack:function(e){n.removeTrack(e.track)}},s=function(){for(var e=[],t=0;t<n.length;t++){for(var r=!1,a=0;a<i.length;a++)if(i[a]===n[t]){r=!0;break}r||e.push(n[t])}for(;e.length;)n.removeTrack(e.shift())};this[r.getterName+"Listeners_"]=a,Object.keys(a).forEach((function(e){var r=a[e];i.addEventListener(e,r),t.on("dispose",(function(t){return i.removeEventListener(e,r)}))})),this.on("loadstart",s),this.on("dispose",(function(e){return t.off("loadstart",s)}))}},r.proxyNativeTracks_=function(){var e=this;Fr.names.forEach((function(t){e.proxyNativeTracksForType_(t)}))},r.createEl=function(){var e=this.options_.tag;if(!e||!this.options_.playerElIngest&&!this.movingMediaElementInDOM){if(e){var r=e.cloneNode(!0);e.parentNode&&e.parentNode.insertBefore(r,e),t.disposeMediaElement(e),e=r}else{e=m.default.createElement("video");var i=Gt({},this.options_.tag&&Oe(this.options_.tag));(!he||!0!==this.options_.nativeControlsForTouch)&&delete i.controls,Ie(e,z(i,{id:this.options_.techId,class:"vjs-tech"}))}e.playerId=this.options_.playerId}"undefined"!=typeof this.options_.preload&&Me(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var n=["loop","muted","playsinline","autoplay"],a=0;a<n.length;a++){var s=n[a],o=this.options_[s];"undefined"!=typeof o&&(o?Me(e,s,s):Fe(e,s),e[s]=o)}return e},r.handleLateInit_=function(e){if(0!==e.networkState&&3!==e.networkState){if(0===e.readyState){var t=!1,r=function(){t=!0};this.on("loadstart",r);var i=function(){t||this.trigger("loadstart")};return this.on("loadedmetadata",i),void this.ready((function(){this.off("loadstart",r),this.off("loadedmetadata",i),t||this.trigger("loadstart")}))}var n=["loadstart"];n.push("loadedmetadata"),e.readyState>=2&&n.push("loadeddata"),e.readyState>=3&&n.push("canplay"),e.readyState>=4&&n.push("canplaythrough"),this.ready((function(){n.forEach((function(e){this.trigger(e)}),this)}))}},r.setScrubbing=function(e){this.isScrubbing_=e},r.scrubbing=function(){return this.isScrubbing_},r.setCurrentTime=function(e){try{this.isScrubbing_&&this.el_.fastSeek&&ge?this.el_.fastSeek(e):this.el_.currentTime=e}catch(t){H(t,"Video is not ready. (Video.js)")}},r.duration=function(){var e=this;if(this.el_.duration===1/0&&re&&oe&&0===this.el_.currentTime){var t=function t(){e.el_.currentTime>0&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))};return this.on("timeupdate",t),NaN}return this.el_.duration||NaN},r.width=function(){return this.el_.offsetWidth},r.height=function(){return this.el_.offsetHeight},r.proxyWebkitFullscreen_=function(){var e=this;if("webkitDisplayingFullscreen"in this.el_){var t=function(){this.trigger("fullscreenchange",{isFullscreen:!1}),this.el_.controls&&!this.options_.nativeControlsForTouch&&this.controls()&&(this.el_.controls=!1)},r=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))};this.on("webkitbeginfullscreen",r),this.on("dispose",(function(){e.off("webkitbeginfullscreen",r),e.off("webkitendfullscreen",t)}))}},r.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var e=g.default.navigator&&g.default.navigator.userAgent||"";if(/Android/.test(e)||!/Chrome|Mac OS X 10.5/.test(e))return!0}return!1},r.enterFullScreen=function(){var e=this.el_;if(e.paused&&e.networkState<=e.HAVE_METADATA)rr(this.el_.play()),this.setTimeout((function(){e.pause();try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}}),0);else try{e.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},r.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},r.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},r.src=function(e){if(void 0===e)return this.el_.src;this.setSrc(e)},r.reset=function(){t.resetMediaElement(this.el_)},r.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},r.setControls=function(e){this.el_.controls=!!e},r.addTextTrack=function(t,r,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(t,r,i):e.prototype.addTextTrack.call(this,t,r,i)},r.createRemoteTextTrack=function(t){if(!this.featuresNativeTextTracks)return e.prototype.createRemoteTextTrack.call(this,t);var r=m.default.createElement("track");return t.kind&&(r.kind=t.kind),t.label&&(r.label=t.label),(t.language||t.srclang)&&(r.srclang=t.language||t.srclang),t.default&&(r.default=t.default),t.id&&(r.id=t.id),t.src&&(r.src=t.src),r},r.addRemoteTextTrack=function(t,r){var i=e.prototype.addRemoteTextTrack.call(this,t,r);return this.featuresNativeTextTracks&&this.el().appendChild(i),i},r.removeRemoteTextTrack=function(t){if(e.prototype.removeRemoteTextTrack.call(this,t),this.featuresNativeTextTracks)for(var r=this.$$("track"),i=r.length;i--;)(t===r[i]||t===r[i].track)&&this.el().removeChild(r[i])},r.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var e={};return"undefined"!=typeof this.el().webkitDroppedFrameCount&&"undefined"!=typeof this.el().webkitDecodedFrameCount&&(e.droppedVideoFrames=this.el().webkitDroppedFrameCount,e.totalVideoFrames=this.el().webkitDecodedFrameCount),g.default.performance&&"function"==typeof g.default.performance.now?e.creationTime=g.default.performance.now():g.default.performance&&g.default.performance.timing&&"number"==typeof g.default.performance.timing.navigationStart&&(e.creationTime=g.default.Date.now()-g.default.performance.timing.navigationStart),e},t}(Ur);ia(na,"TEST_VID",(function(){if(be()){var e=m.default.createElement("video"),t=m.default.createElement("track");return t.kind="captions",t.srclang="en",t.label="English",e.appendChild(t),e}})),na.isSupported=function(){try{na.TEST_VID.volume=.5}catch(e){return!1}return!(!na.TEST_VID||!na.TEST_VID.canPlayType)},na.canPlayType=function(e){return na.TEST_VID.canPlayType(e)},na.canPlaySource=function(e,t){return na.canPlayType(e.type)},na.canControlVolume=function(){try{var e=na.TEST_VID.volume;na.TEST_VID.volume=e/2+.1;var t=e!==na.TEST_VID.volume;return t&&ve?(g.default.setTimeout((function(){na&&na.prototype&&(na.prototype.featuresVolumeControl=e!==na.TEST_VID.volume)})),!1):t}catch(r){return!1}},na.canMuteVolume=function(){try{var e=na.TEST_VID.muted;return na.TEST_VID.muted=!e,na.TEST_VID.muted?Me(na.TEST_VID,"muted","muted"):Fe(na.TEST_VID,"muted","muted"),e!==na.TEST_VID.muted}catch(t){return!1}},na.canControlPlaybackRate=function(){if(re&&oe&&le<58)return!1;try{var e=na.TEST_VID.playbackRate;return na.TEST_VID.playbackRate=e/2+.1,e!==na.TEST_VID.playbackRate}catch(t){return!1}},na.canOverrideAttributes=function(){try{var e=function(){};Object.defineProperty(m.default.createElement("video"),"src",{get:e,set:e}),Object.defineProperty(m.default.createElement("audio"),"src",{get:e,set:e}),Object.defineProperty(m.default.createElement("video"),"innerHTML",{get:e,set:e}),Object.defineProperty(m.default.createElement("audio"),"innerHTML",{get:e,set:e})}catch(t){return!1}return!0},na.supportsNativeTextTracks=function(){return ge||ve&&oe},na.supportsNativeVideoTracks=function(){return!(!na.TEST_VID||!na.TEST_VID.videoTracks)},na.supportsNativeAudioTracks=function(){return!(!na.TEST_VID||!na.TEST_VID.audioTracks)},na.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach((function(e){var t=e[0],r=e[1];ia(na.prototype,t,(function(){return na[r]()}),!0)})),na.prototype.featuresVolumeControl=na.canControlVolume(),na.prototype.movingMediaElementInDOM=!ve,na.prototype.featuresFullscreenResize=!0,na.prototype.featuresProgressEvents=!0,na.prototype.featuresTimeupdateEvents=!0,na.patchCanPlayType=function(){ie>=4&&!ae&&!oe&&(Yn=na.TEST_VID&&na.TEST_VID.constructor.prototype.canPlayType,na.TEST_VID.constructor.prototype.canPlayType=function(e){return e&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(e)?"maybe":Yn.call(this,e)})},na.unpatchCanPlayType=function(){var e=na.TEST_VID.constructor.prototype.canPlayType;return Yn&&(na.TEST_VID.constructor.prototype.canPlayType=Yn),e},na.patchCanPlayType(),na.disposeMediaElement=function(e){if(e){for(e.parentNode&&e.parentNode.removeChild(e);e.hasChildNodes();)e.removeChild(e.firstChild);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},na.resetMediaElement=function(e){if(e){for(var t=e.querySelectorAll("source"),r=t.length;r--;)e.removeChild(t[r]);e.removeAttribute("src"),"function"==typeof e.load&&function(){try{e.load()}catch(t){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach((function(e){na.prototype[e]=function(){return this.el_[e]||this.el_.hasAttribute(e)}})),["muted","defaultMuted","autoplay","loop","playsinline"].forEach((function(e){na.prototype["set"+Ut(e)]=function(t){this.el_[e]=t,t?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}})),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach((function(e){na.prototype[e]=function(){return this.el_[e]}})),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach((function(e){na.prototype["set"+Ut(e)]=function(t){this.el_[e]=t}})),["pause","load","play"].forEach((function(e){na.prototype[e]=function(){return this.el_[e]()}})),Ur.withSourceHandlers(na),na.nativeSourceHandler={},na.nativeSourceHandler.canPlayType=function(e){try{return na.TEST_VID.canPlayType(e)}catch(t){return""}},na.nativeSourceHandler.canHandleSource=function(e,t){if(e.type)return na.nativeSourceHandler.canPlayType(e.type);if(e.src){var r=Sr(e.src);return na.nativeSourceHandler.canPlayType("video/"+r)}return""},na.nativeSourceHandler.handleSource=function(e,t,r){t.setSrc(e.src)},na.nativeSourceHandler.dispose=function(){},na.registerSourceHandler(na.nativeSourceHandler),Ur.registerTech("Html5",na);var aa=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],sa={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},oa=["tiny","xsmall","small","medium","large","xlarge","huge"],la={};oa.forEach((function(e){var t="x"===e.charAt(0)?"x-"+e.substring(1):e;la[e]="vjs-layout-"+t}));var ua={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},ca=function(e){function t(r,i,n){var a;if(r.id=r.id||i.id||"vjs_video_"+st(),(i=z(t.getTagSettings(r),i)).initChildren=!1,i.createEl=!1,i.evented=!1,i.reportTouchActivity=!1,!i.language)if("function"==typeof r.closest){var s=r.closest("[lang]");s&&s.getAttribute&&(i.language=s.getAttribute("lang"))}else for(var o=r;o&&1===o.nodeType;){if(Oe(o).hasOwnProperty("lang")){i.language=o.getAttribute("lang");break}o=o.parentNode}if((a=e.call(this,null,i,n)||this).boundDocumentFullscreenChange_=function(e){return a.documentFullscreenChange_(e)},a.boundFullWindowOnEscKey_=function(e){return a.fullWindowOnEscKey(e)},a.boundUpdateStyleEl_=function(e){return a.updateStyleEl_(e)},a.boundApplyInitTime_=function(e){return a.applyInitTime_(e)},a.boundUpdateCurrentBreakpoint_=function(e){return a.updateCurrentBreakpoint_(e)},a.boundHandleTechClick_=function(e){return a.handleTechClick_(e)},a.boundHandleTechDoubleClick_=function(e){return a.handleTechDoubleClick_(e)},a.boundHandleTechTouchStart_=function(e){return a.handleTechTouchStart_(e)},a.boundHandleTechTouchMove_=function(e){return a.handleTechTouchMove_(e)},a.boundHandleTechTouchEnd_=function(e){return a.handleTechTouchEnd_(e)},a.boundHandleTechTap_=function(e){return a.handleTechTap_(e)},a.isFullscreen_=!1,a.log=G(a.id_),a.fsApi_=O,a.isPosterFromTech_=!1,a.queuedCallbacks_=[],a.isReady_=!1,a.hasStarted_=!1,a.userActive_=!1,a.debugEnabled_=!1,!a.options_||!a.options_.techOrder||!a.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(a.tag=r,a.tagAttributes=r&&Oe(r),a.language(a.options_.language),i.languages){var l={};Object.getOwnPropertyNames(i.languages).forEach((function(e){l[e.toLowerCase()]=i.languages[e]})),a.languages_=l}else a.languages_=t.prototype.options_.languages;a.resetCache_(),a.poster_=i.poster||"",a.controls_=!!i.controls,r.controls=!1,r.removeAttribute("controls"),a.changingSrc_=!1,a.playCallbacks_=[],a.playTerminatedQueue_=[],r.hasAttribute("autoplay")?a.autoplay(!0):a.autoplay(a.options_.autoplay),i.plugins&&Object.keys(i.plugins).forEach((function(e){if("function"!=typeof a[e])throw new Error('plugin "'+e+'" does not exist')})),a.scrubbing_=!1,a.el_=a.createEl(),Ft(T.default(a),{eventBusKey:"el_"}),a.fsApi_.requestFullscreen&&(pt(m.default,a.fsApi_.fullscreenchange,a.boundDocumentFullscreenChange_),a.on(a.fsApi_.fullscreenchange,a.boundDocumentFullscreenChange_)),a.fluid_&&a.on(["playerreset","resize"],a.boundUpdateStyleEl_);var u=Gt(a.options_);i.plugins&&Object.keys(i.plugins).forEach((function(e){a[e](i.plugins[e])})),i.debug&&a.debug(!0),a.options_.playerOptions=u,a.middleware_=[],a.playbackRates(i.playbackRates),a.initChildren(),a.isAudio("audio"===r.nodeName.toLowerCase()),a.controls()?a.addClass("vjs-controls-enabled"):a.addClass("vjs-controls-disabled"),a.el_.setAttribute("role","region"),a.isAudio()?a.el_.setAttribute("aria-label",a.localize("Audio Player")):a.el_.setAttribute("aria-label",a.localize("Video Player")),a.isAudio()&&a.addClass("vjs-audio"),a.flexNotSupported_()&&a.addClass("vjs-no-flex"),he&&a.addClass("vjs-touch-enabled"),ve||a.addClass("vjs-workinghover"),t.players[a.id_]=T.default(a);var c=A.split(".")[0];return a.addClass("vjs-v"+c),a.userActive(!0),a.reportUserActivity(),a.one("play",(function(e){return a.listenForUserActivity_(e)})),a.on("stageclick",(function(e){return a.handleStageClick_(e)})),a.on("keydown",(function(e){return a.handleKeyDown(e)})),a.on("languagechange",(function(e){return a.handleLanguagechange(e)})),a.breakpoints(a.options_.breakpoints),a.responsive(a.options_.responsive),a}b.default(t,e);var r=t.prototype;return r.dispose=function(){var r=this;this.trigger("dispose"),this.off("dispose"),vt(m.default,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),vt(m.default,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),t.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),ti(this),Br.names.forEach((function(e){var t=Br[e],i=r[t.getterName]();i&&i.off&&i.off()})),e.prototype.dispose.call(this)},r.createEl=function(){var t,r=this.tag,i=this.playerElIngest_=r.parentNode&&r.parentNode.hasAttribute&&r.parentNode.hasAttribute("data-vjs-player"),n="video-js"===this.tag.tagName.toLowerCase();i?t=this.el_=r.parentNode:n||(t=this.el_=e.prototype.createEl.call(this,"div"));var a=Oe(r);if(n){for(t=this.el_=r,r=this.tag=m.default.createElement("video");t.children.length;)r.appendChild(t.firstChild);Le(t,"video-js")||xe(t,"video-js"),t.appendChild(r),i=this.playerElIngest_=t,Object.keys(t).forEach((function(e){try{r[e]=t[e]}catch(i){}}))}if(r.setAttribute("tabindex","-1"),a.tabindex="-1",(ue||oe&&de)&&(r.setAttribute("role","application"),a.role="application"),r.removeAttribute("width"),r.removeAttribute("height"),"width"in a&&delete a.width,"height"in a&&delete a.height,Object.getOwnPropertyNames(a).forEach((function(e){n&&"class"===e||t.setAttribute(e,a[e]),n&&r.setAttribute(e,a[e])})),r.playerId=r.id,r.id+="_html5_api",r.className="vjs-tech",r.player=t.player=this,this.addClass("vjs-paused"),!0!==g.default.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=it("vjs-styles-dimensions");var s=Xe(".vjs-styles-defaults"),o=Xe("head");o.insertBefore(this.styleEl_,s?s.nextSibling:o.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var l=r.getElementsByTagName("a"),u=0;u<l.length;u++){var c=l.item(u);xe(c,"vjs-hidden"),c.setAttribute("hidden","hidden")}return r.initNetworkState_=r.networkState,r.parentNode&&!i&&r.parentNode.insertBefore(t,r),Ae(r,t),this.children_.unshift(r),this.el_.setAttribute("lang",this.language_),this.el_.setAttribute("translate","no"),this.el_=t,t},r.crossOrigin=function(e){if(!e)return this.techGet_("crossOrigin");"anonymous"===e||"use-credentials"===e?this.techCall_("setCrossOrigin",e):H.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+e+'"')},r.width=function(e){return this.dimension("width",e)},r.height=function(e){return this.dimension("height",e)},r.dimension=function(e,t){var r=e+"_";if(void 0===t)return this[r]||0;if(""===t||"auto"===t)return this[r]=void 0,void this.updateStyleEl_();var i=parseFloat(t);isNaN(i)?H.error('Improper value "'+t+'" supplied for for '+e):(this[r]=i,this.updateStyleEl_())},r.fluid=function(e){var t=this;if(void 0===e)return!!this.fluid_;this.fluid_=!!e,At(this)&&this.off(["playerreset","resize"],this.boundUpdateStyleEl_),e?(this.addClass("vjs-fluid"),this.fill(!1),Lt(this,(function(){t.on(["playerreset","resize"],t.boundUpdateStyleEl_)}))):this.removeClass("vjs-fluid"),this.updateStyleEl_()},r.fill=function(e){if(void 0===e)return!!this.fill_;this.fill_=!!e,e?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},r.aspectRatio=function(e){if(void 0===e)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(e))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=e,this.fluid(!0),this.updateStyleEl_()},r.updateStyleEl_=function(){if(!0!==g.default.VIDEOJS_NO_DYNAMIC_STYLE){var e,t,r,i=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),n=i[1]/i[0];e=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/n:this.videoWidth()||300,t=void 0!==this.height_?this.height_:e*n,r=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(r),nt(this.styleEl_,"\n      ."+r+" {\n        width: "+e+"px;\n        height: "+t+"px;\n      }\n\n      ."+r+".vjs-fluid {\n        padding-top: "+100*n+"%;\n      }\n    ")}else{var a="number"==typeof this.width_?this.width_:this.options_.width,s="number"==typeof this.height_?this.height_:this.options_.height,o=this.tech_&&this.tech_.el();o&&(a>=0&&(o.width=a),s>=0&&(o.height=s))}},r.loadTech_=function(e,t){var r=this;this.tech_&&this.unloadTech_();var i=Ut(e),n=e.charAt(0).toLowerCase()+e.slice(1);"Html5"!==i&&this.tag&&(Ur.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=i,this.isReady_=!1;var a=this.autoplay();("string"==typeof this.autoplay()||!0===this.autoplay()&&this.options_.normalizeAutoplay)&&(a=!1);var s={source:t,autoplay:a,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+n+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};Br.names.forEach((function(e){var t=Br[e];s[t.getterName]=r[t.privateName]})),z(s,this.options_[i]),z(s,this.options_[n]),z(s,this.options_[e.toLowerCase()]),this.tag&&(s.tag=this.tag),t&&t.src===this.cache_.src&&this.cache_.currentTime>0&&(s.startTime=this.cache_.currentTime);var o=Ur.getTech(e);if(!o)throw new Error("No Tech named '"+i+"' exists! '"+i+"' should be registered using videojs.registerTech()'");this.tech_=new o(s),this.tech_.ready(Et(this,this.handleTechReady_),!0),nr.jsonToTextTracks(this.textTracksJson_||[],this.tech_),aa.forEach((function(e){r.on(r.tech_,e,(function(t){return r["handleTech"+Ut(e)+"_"](t)}))})),Object.keys(sa).forEach((function(e){r.on(r.tech_,e,(function(t){0===r.tech_.playbackRate()&&r.tech_.seeking()?r.queuedCallbacks_.push({callback:r["handleTech"+sa[e]+"_"].bind(r),event:t}):r["handleTech"+sa[e]+"_"](t)}))})),this.on(this.tech_,"loadstart",(function(e){return r.handleTechLoadStart_(e)})),this.on(this.tech_,"sourceset",(function(e){return r.handleTechSourceset_(e)})),this.on(this.tech_,"waiting",(function(e){return r.handleTechWaiting_(e)})),this.on(this.tech_,"ended",(function(e){return r.handleTechEnded_(e)})),this.on(this.tech_,"seeking",(function(e){return r.handleTechSeeking_(e)})),this.on(this.tech_,"play",(function(e){return r.handleTechPlay_(e)})),this.on(this.tech_,"firstplay",(function(e){return r.handleTechFirstPlay_(e)})),this.on(this.tech_,"pause",(function(e){return r.handleTechPause_(e)})),this.on(this.tech_,"durationchange",(function(e){return r.handleTechDurationChange_(e)})),this.on(this.tech_,"fullscreenchange",(function(e,t){return r.handleTechFullscreenChange_(e,t)})),this.on(this.tech_,"fullscreenerror",(function(e,t){return r.handleTechFullscreenError_(e,t)})),this.on(this.tech_,"enterpictureinpicture",(function(e){return r.handleTechEnterPictureInPicture_(e)})),this.on(this.tech_,"leavepictureinpicture",(function(e){return r.handleTechLeavePictureInPicture_(e)})),this.on(this.tech_,"error",(function(e){return r.handleTechError_(e)})),this.on(this.tech_,"posterchange",(function(e){return r.handleTechPosterChange_(e)})),this.on(this.tech_,"textdata",(function(e){return r.handleTechTextData_(e)})),this.on(this.tech_,"ratechange",(function(e){return r.handleTechRateChange_(e)})),this.on(this.tech_,"loadedmetadata",this.boundUpdateStyleEl_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode!==this.el()&&("Html5"!==i||!this.tag)&&Ae(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},r.unloadTech_=function(){var e=this;Br.names.forEach((function(t){var r=Br[t];e[r.privateName]=e[r.getterName]()})),this.textTracksJson_=nr.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},r.tech=function(e){return void 0===e&&H.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},r.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"click",this.boundHandleTechClick_),this.on(this.tech_,"dblclick",this.boundHandleTechDoubleClick_),this.on(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.on(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.on(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.on(this.tech_,"tap",this.boundHandleTechTap_)},r.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.boundHandleTechTap_),this.off(this.tech_,"touchstart",this.boundHandleTechTouchStart_),this.off(this.tech_,"touchmove",this.boundHandleTechTouchMove_),this.off(this.tech_,"touchend",this.boundHandleTechTouchEnd_),this.off(this.tech_,"click",this.boundHandleTechClick_),this.off(this.tech_,"dblclick",this.boundHandleTechDoubleClick_)},r.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},r.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(!0===this.autoplay()&&this.options_.normalizeAutoplay?"play":this.autoplay())},r.manualAutoplay_=function(e){var t=this;if(this.tech_&&"string"==typeof e){var r,i=function(){var e=t.muted();t.muted(!0);var r=function(){t.muted(e)};t.playTerminatedQueue_.push(r);var i=t.play();if(tr(i))return i.catch((function(e){throw r(),new Error("Rejection at manualAutoplay. Restoring muted value. "+(e||""))}))};if("any"!==e||this.muted()?r="muted"!==e||this.muted()?this.play():i():tr(r=this.play())&&(r=r.catch(i)),tr(r))return r.then((function(){t.trigger({type:"autoplay-success",autoplay:e})})).catch((function(){t.trigger({type:"autoplay-failure",autoplay:e})}))}},r.updateSourceCaches_=function(e){void 0===e&&(e="");var t=e,r="";"string"!=typeof t&&(t=e.src,r=e.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],t&&!r&&(r=si(this,t)),this.cache_.source=Gt({},e,{src:t,type:r});for(var i=this.cache_.sources.filter((function(e){return e.src&&e.src===t})),n=[],a=this.$$("source"),s=[],o=0;o<a.length;o++){var l=Oe(a[o]);n.push(l),l.src&&l.src===t&&s.push(l.src)}s.length&&!i.length?this.cache_.sources=n:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=t},r.handleTechSourceset_=function(e){var t=this;if(!this.changingSrc_){var r=function(e){return t.updateSourceCaches_(e)},i=this.currentSource().src,n=e.src;i&&!/^blob:/.test(i)&&/^blob:/.test(n)&&(!this.lastSource_||this.lastSource_.tech!==n&&this.lastSource_.player!==i)&&(r=function(){}),r(n),e.src||this.tech_.any(["sourceset","loadstart"],(function(e){if("sourceset"!==e.type){var r=t.techGet("currentSrc");t.lastSource_.tech=r,t.updateSourceCaches_(r)}}))}this.lastSource_={player:this.currentSource().src,tech:e.src},this.trigger({src:e.src,type:"sourceset"})},r.hasStarted=function(e){if(void 0===e)return this.hasStarted_;e!==this.hasStarted_&&(this.hasStarted_=e,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},r.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},r.handleTechRateChange_=function(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach((function(e){return e.callback(e.event)})),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},r.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var t=this.currentTime(),r=function r(){t!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",r))};this.on("timeupdate",r)},r.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},r.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},r.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},r.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},r.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},r.handleTechFirstPlay_=function(){this.options_.starttime&&(H.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},r.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},r.handleTechEnded_=function(){this.addClass("vjs-ended"),this.removeClass("vjs-waiting"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},r.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},r.handleTechClick_=function(e){!this.controls_||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.click||!1!==this.options_.userActions.click)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.click?this.options_.userActions.click.call(this,e):this.paused()?rr(this.play()):this.pause())},r.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),(function(t){return t.contains(e.target)}))||(void 0===this.options_||void 0===this.options_.userActions||void 0===this.options_.userActions.doubleClick||!1!==this.options_.userActions.doubleClick)&&(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},r.handleTechTap_=function(){this.userActive(!this.userActive())},r.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},r.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},r.handleTechTouchEnd_=function(e){e.cancelable&&e.preventDefault()},r.handleStageClick_=function(){this.reportUserActivity()},r.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},r.documentFullscreenChange_=function(e){var t=e.target.player;if(!t||t===this){var r=this.el(),i=m.default[this.fsApi_.fullscreenElement]===r;!i&&r.matches?i=r.matches(":"+this.fsApi_.fullscreen):!i&&r.msMatchesSelector&&(i=r.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(i)}},r.handleTechFullscreenChange_=function(e,t){var r=this;t&&(t.nativeIOSFullscreen&&(this.addClass("vjs-ios-native-fs"),this.tech_.one("webkitendfullscreen",(function(){r.removeClass("vjs-ios-native-fs")}))),this.isFullscreen(t.isFullscreen))},r.handleTechFullscreenError_=function(e,t){this.trigger("fullscreenerror",t)},r.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},r.handleTechEnterPictureInPicture_=function(e){this.isInPictureInPicture(!0)},r.handleTechLeavePictureInPicture_=function(e){this.isInPictureInPicture(!1)},r.handleTechError_=function(){var e=this.tech_.error();this.error(e)},r.handleTechTextData_=function(){var e=null;arguments.length>1&&(e=arguments[1]),this.trigger("textdata",e)},r.getCache=function(){return this.cache_},r.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}},r.techCall_=function(e,t){this.ready((function(){if(e in Jr)return Yr(this.middleware_,this.tech_,e,t);if(e in $r)return Xr(this.middleware_,this.tech_,e,t);try{this.tech_&&this.tech_[e](t)}catch(r){throw H(r),r}}),!0)},r.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Qr)return zr(this.middleware_,this.tech_,e);if(e in $r)return Xr(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){throw void 0===this.tech_[e]?(H("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t):"TypeError"===t.name?(H("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t):(H(t),t)}}},r.play=function(){var e=this,t=this.options_.Promise||g.default.Promise;return t?new t((function(t){e.play_(t)})):this.play_()},r.play_=function(e){var t=this;void 0===e&&(e=rr),this.playCallbacks_.push(e);var r=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!r)return this.waitToPlay_=function(e){t.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(!r&&(ge||ve)&&this.load());var i=this.techGet_("play");null===i?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(i)},r.runPlayTerminatedQueue_=function(){var e=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],e.forEach((function(e){e()}))},r.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach((function(t){t(e)}))},r.pause=function(){this.techCall_("pause")},r.paused=function(){return!1!==this.techGet_("paused")},r.played=function(){return this.techGet_("played")||Jt(0,0)},r.scrubbing=function(e){if("undefined"==typeof e)return this.scrubbing_;this.scrubbing_=!!e,this.techCall_("setScrubbing",this.scrubbing_),e?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},r.currentTime=function(e){return"undefined"!=typeof e?(e<0&&(e=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",e),void(this.cache_.initTime=0)):(this.cache_.initTime=e,this.off("canplay",this.boundApplyInitTime_),void this.one("canplay",this.boundApplyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},r.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},r.duration=function(e){if(void 0===e)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(e=parseFloat(e))<0&&(e=1/0),e!==this.cache_.duration&&(this.cache_.duration=e,e===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(e)||this.trigger("durationchange"))},r.remainingTime=function(){return this.duration()-this.currentTime()},r.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},r.buffered=function(){var e=this.techGet_("buffered");return(!e||!e.length)&&(e=Jt(0,0)),e},r.bufferedPercent=function(){return $t(this.buffered(),this.duration())},r.bufferedEnd=function(){var e=this.buffered(),t=this.duration(),r=e.end(e.length-1);return r>t&&(r=t),r},r.volume=function(e){var t;return void 0!==e?(t=Math.max(0,Math.min(1,parseFloat(e))),this.cache_.volume=t,this.techCall_("setVolume",t),void(t>0&&this.lastVolume_(t))):(t=parseFloat(this.techGet_("volume")),isNaN(t)?1:t)},r.muted=function(e){if(void 0===e)return this.techGet_("muted")||!1;this.techCall_("setMuted",e)},r.defaultMuted=function(e){return void 0!==e?this.techCall_("setDefaultMuted",e):this.techGet_("defaultMuted")||!1},r.lastVolume_=function(e){if(void 0===e||0===e)return this.cache_.lastVolume;this.cache_.lastVolume=e},r.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},r.isFullscreen=function(e){if(void 0!==e){var t=this.isFullscreen_;return this.isFullscreen_=Boolean(e),this.isFullscreen_!==t&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_},r.requestFullscreen=function(e){var t=this.options_.Promise||g.default.Promise;if(t){var r=this;return new t((function(t,i){function n(){r.off("fullscreenerror",s),r.off("fullscreenchange",a)}function a(){n(),t()}function s(e,t){n(),i(t)}r.one("fullscreenchange",a),r.one("fullscreenerror",s);var o=r.requestFullscreenHelper_(e);o&&(o.then(n,n),o.then(t,i))}))}return this.requestFullscreenHelper_()},r.requestFullscreenHelper_=function(e){var t,r=this;if(this.fsApi_.prefixed||(t=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==e&&(t=e)),this.fsApi_.requestFullscreen){var i=this.el_[this.fsApi_.requestFullscreen](t);return i&&i.then((function(){return r.isFullscreen(!0)}),(function(){return r.isFullscreen(!1)})),i}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("enterFullScreen"):this.enterFullWindow()},r.exitFullscreen=function(){var e=this.options_.Promise||g.default.Promise;if(e){var t=this;return new e((function(e,r){function i(){t.off("fullscreenerror",a),t.off("fullscreenchange",n)}function n(){i(),e()}function a(e,t){i(),r(t)}t.one("fullscreenchange",n),t.one("fullscreenerror",a);var s=t.exitFullscreenHelper_();s&&(s.then(i,i),s.then(e,r))}))}return this.exitFullscreenHelper_()},r.exitFullscreenHelper_=function(){var e=this;if(this.fsApi_.requestFullscreen){var t=m.default[this.fsApi_.exitFullscreen]();return t&&rr(t.then((function(){return e.isFullscreen(!1)}))),t}this.tech_.supportsFullScreen()&&!this.options_.preferFullWindow?this.techCall_("exitFullScreen"):this.exitFullWindow()},r.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=m.default.documentElement.style.overflow,pt(m.default,"keydown",this.boundFullWindowOnEscKey_),m.default.documentElement.style.overflow="hidden",xe(m.default.body,"vjs-full-window"),this.trigger("enterFullWindow")},r.fullWindowOnEscKey=function(e){_.default.isEventKey(e,"Esc")&&!0===this.isFullscreen()&&(this.isFullWindow?this.exitFullWindow():this.exitFullscreen())},r.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,vt(m.default,"keydown",this.boundFullWindowOnEscKey_),m.default.documentElement.style.overflow=this.docOrigOverflow,De(m.default.body,"vjs-full-window"),this.trigger("exitFullWindow")},r.disablePictureInPicture=function(e){if(void 0===e)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",e),this.options_.disablePictureInPicture=e,this.trigger("disablepictureinpicturechanged")},r.isInPictureInPicture=function(e){return void 0!==e?(this.isInPictureInPicture_=!!e,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},r.requestPictureInPicture=function(){if("pictureInPictureEnabled"in m.default&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},r.exitPictureInPicture=function(){if("pictureInPictureEnabled"in m.default)return m.default.exitPictureInPicture()},r.handleKeyDown=function(e){var t=this.options_.userActions;t&&t.hotkeys&&(function(e){var t=e.tagName.toLowerCase();return!!e.isContentEditable||("input"===t?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type):-1!==["textarea"].indexOf(t))}(this.el_.ownerDocument.activeElement)||("function"==typeof t.hotkeys?t.hotkeys.call(this,e):this.handleHotkeys(e)))},r.handleHotkeys=function(e){var t=this.options_.userActions?this.options_.userActions.hotkeys:{},r=t.fullscreenKey,i=void 0===r?function(e){return _.default.isEventKey(e,"f")}:r,n=t.muteKey,a=void 0===n?function(e){return _.default.isEventKey(e,"m")}:n,s=t.playPauseKey,o=void 0===s?function(e){return _.default.isEventKey(e,"k")||_.default.isEventKey(e,"Space")}:s;if(i.call(this,e)){e.preventDefault(),e.stopPropagation();var l=zt.getComponent("FullscreenToggle");!1!==m.default[this.fsApi_.fullscreenEnabled]&&l.prototype.handleClick.call(this,e)}else a.call(this,e)?(e.preventDefault(),e.stopPropagation(),zt.getComponent("MuteToggle").prototype.handleClick.call(this,e)):o.call(this,e)&&(e.preventDefault(),e.stopPropagation(),zt.getComponent("PlayToggle").prototype.handleClick.call(this,e))},r.canPlayType=function(e){for(var t,r=0,i=this.options_.techOrder;r<i.length;r++){var n=i[r],a=Ur.getTech(n);if(a||(a=zt.getComponent(n)),a){if(a.isSupported()&&(t=a.canPlayType(e)))return t}else H.error('The "'+n+'" tech is undefined. Skipped browser support check for that tech.')}return""},r.selectSource=function(e){var t=this,r=this.options_.techOrder.map((function(e){return[e,Ur.getTech(e)]})).filter((function(e){var t=e[0],r=e[1];return r?r.isSupported():(H.error('The "'+t+'" tech is undefined. Skipped browser support check for that tech.'),!1)})),i=function(e,t,r){var i;return e.some((function(e){return t.some((function(t){if(i=r(e,t))return!0}))})),i},n=function(e){return function(t,r){return e(r,t)}},a=function(e,r){var i=e[0];if(e[1].canPlaySource(r,t.options_[i.toLowerCase()]))return{source:r,tech:i}};return(this.options_.sourceOrder?i(e,r,n(a)):i(r,e,a))||!1},r.handleSrc_=function(e,t){var r=this;if("undefined"==typeof e)return this.cache_.src||"";this.resetRetryOnError_&&this.resetRetryOnError_();var i=oi(e);if(i.length){if(this.changingSrc_=!0,t||(this.cache_.sources=i),this.updateSourceCaches_(i[0]),qr(this,i[0],(function(e,n){if(r.middleware_=n,t||(r.cache_.sources=i),r.updateSourceCaches_(e),r.src_(e))return i.length>1?r.handleSrc_(i.slice(1)):(r.changingSrc_=!1,r.setTimeout((function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})}),0),void r.triggerReady());Wr(n,r.tech_)})),this.options_.retryOnError&&i.length>1){var n=function(){r.error(null),r.handleSrc_(i.slice(1),!0)},a=function(){r.off("error",n)};this.one("error",n),this.one("playing",a),this.resetRetryOnError_=function(){r.off("error",n),r.off("playing",a)}}}else this.setTimeout((function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})}),0)},r.src=function(e){return this.handleSrc_(e,!1)},r.src_=function(e){var t=this,r=this.selectSource([e]);return!r||(Ht(r.tech,this.techName_)?(this.ready((function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",e):this.techCall_("src",e.src),this.changingSrc_=!1}),!0),!1):(this.changingSrc_=!0,this.loadTech_(r.tech,r.source),this.tech_.ready((function(){t.changingSrc_=!1})),!1))},r.load=function(){this.techCall_("load")},r.reset=function(){var e=this,t=this.options_.Promise||g.default.Promise;this.paused()||!t?this.doReset_():rr(this.play().then((function(){return e.doReset_()})))},r.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),At(this)&&this.trigger("playerreset")},r.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},r.resetProgressBar_=function(){this.currentTime(0);var e=this.controlBar,t=e.durationDisplay,r=e.remainingTimeDisplay;t&&t.updateContent(),r&&r.updateContent()},r.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},r.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},r.currentSources=function(){var e=this.currentSource(),t=[];return 0!==Object.keys(e).length&&t.push(e),this.cache_.sources||t},r.currentSource=function(){return this.cache_.source||{}},r.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},r.currentType=function(){return this.currentSource()&&this.currentSource().type||""},r.preload=function(e){return void 0!==e?(this.techCall_("setPreload",e),void(this.options_.preload=e)):this.techGet_("preload")},r.autoplay=function(e){if(void 0===e)return this.options_.autoplay||!1;var t;"string"==typeof e&&/(any|play|muted)/.test(e)||!0===e&&this.options_.normalizeAutoplay?(this.options_.autoplay=e,this.manualAutoplay_("string"==typeof e?e:"play"),t=!1):this.options_.autoplay=!!e,t="undefined"==typeof t?this.options_.autoplay:t,this.tech_&&this.techCall_("setAutoplay",t)},r.playsinline=function(e){return void 0!==e?(this.techCall_("setPlaysinline",e),this.options_.playsinline=e,this):this.techGet_("playsinline")},r.loop=function(e){return void 0!==e?(this.techCall_("setLoop",e),void(this.options_.loop=e)):this.techGet_("loop")},r.poster=function(e){if(void 0===e)return this.poster_;e||(e=""),e!==this.poster_&&(this.poster_=e,this.techCall_("setPoster",e),this.isPosterFromTech_=!1,this.trigger("posterchange"))},r.handleTechPosterChange_=function(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){var e=this.tech_.poster()||"";e!==this.poster_&&(this.poster_=e,this.isPosterFromTech_=!0,this.trigger("posterchange"))}},r.controls=function(e){if(void 0===e)return!!this.controls_;e=!!e,this.controls_!==e&&(this.controls_=e,this.usingNativeControls()&&this.techCall_("setControls",e),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},r.usingNativeControls=function(e){if(void 0===e)return!!this.usingNativeControls_;e=!!e,this.usingNativeControls_!==e&&(this.usingNativeControls_=e,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},r.error=function(e){var t=this;if(void 0===e)return this.error_||null;if(x("beforeerror").forEach((function(r){var i=r(t,e);Y(i)&&!Array.isArray(i)||"string"==typeof i||"number"==typeof i||null===i?e=i:t.log.error("please return a value that MediaError expects in beforeerror hooks")})),this.options_.suppressNotSupportedError&&e&&4===e.code){var r=function(){this.error(e)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],r),void this.one("loadstart",(function(){this.off(["click","touchstart"],r)}))}if(null===e)return this.error_=e,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Zt(e),this.addClass("vjs-error"),H.error("(CODE:"+this.error_.code+" "+Zt.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error"),x("error").forEach((function(e){return e(t,t.error_)}))},r.reportUserActivity=function(e){this.userActivity_=!0},r.userActive=function(e){if(void 0===e)return this.userActive_;if((e=!!e)!==this.userActive_){if(this.userActive_=e,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",(function(e){e.stopPropagation(),e.preventDefault()})),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},r.listenForUserActivity_=function(){var e,t,r,i=Et(this,this.reportUserActivity),n=function(e){(e.screenX!==t||e.screenY!==r)&&(t=e.screenX,r=e.screenY,i())},a=function(){i(),this.clearInterval(e),e=this.setInterval(i,250)},s=function(t){i(),this.clearInterval(e)};this.on("mousedown",a),this.on("mousemove",n),this.on("mouseup",s),this.on("mouseleave",s);var o,l=this.getChild("controlBar");l&&!ve&&!re&&(l.on("mouseenter",(function(e){0!==this.player().options_.inactivityTimeout&&(this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout),this.player().options_.inactivityTimeout=0})),l.on("mouseleave",(function(e){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout}))),this.on("keydown",i),this.on("keyup",i),this.setInterval((function(){if(this.userActivity_){this.userActivity_=!1,this.userActive(!0),this.clearTimeout(o);var e=this.options_.inactivityTimeout;e<=0||(o=this.setTimeout((function(){this.userActivity_||this.userActive(!1)}),e))}}),250)},r.playbackRate=function(e){if(void 0===e)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",e)},r.defaultPlaybackRate=function(e){return void 0!==e?this.techCall_("setDefaultPlaybackRate",e):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},r.isAudio=function(e){if(void 0===e)return!!this.isAudio_;this.isAudio_=!!e},r.addTextTrack=function(e,t,r){if(this.tech_)return this.tech_.addTextTrack(e,t,r)},r.addRemoteTextTrack=function(e,t){if(this.tech_)return this.tech_.addRemoteTextTrack(e,t)},r.removeRemoteTextTrack=function(e){void 0===e&&(e={});var t=e.track;if(t||(t=e),this.tech_)return this.tech_.removeRemoteTextTrack(t)},r.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},r.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},r.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},r.language=function(e){if(void 0===e)return this.language_;this.language_!==String(e).toLowerCase()&&(this.language_=String(e).toLowerCase(),At(this)&&this.trigger("languagechange"))},r.languages=function(){return Gt(t.prototype.options_.languages,this.languages_)},r.toJSON=function(){var e=Gt(this.options_),t=e.tracks;e.tracks=[];for(var r=0;r<t.length;r++){var i=t[r];(i=Gt(i)).player=void 0,e.tracks[r]=i}return e},r.createModal=function(e,t){var r=this;(t=t||{}).content=e||"";var i=new sr(this,t);return this.addChild(i),i.on("dispose",(function(){r.removeChild(i)})),i.open(),i},r.updateCurrentBreakpoint_=function(){if(this.responsive())for(var e=this.currentBreakpoint(),t=this.currentWidth(),r=0;r<oa.length;r++){var i=oa[r];if(t<=this.breakpoints_[i]){if(e===i)return;e&&this.removeClass(la[e]),this.addClass(la[i]),this.breakpoint_=i;break}}},r.removeCurrentBreakpoint_=function(){var e=this.currentBreakpointClass();this.breakpoint_="",e&&this.removeClass(e)},r.breakpoints=function(e){return void 0===e||(this.breakpoint_="",this.breakpoints_=z({},ua,e),this.updateCurrentBreakpoint_()),z(this.breakpoints_)},r.responsive=function(e){return void 0===e?this.responsive_:(e=Boolean(e))!==this.responsive_?(this.responsive_=e,e?(this.on("playerresize",this.boundUpdateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.boundUpdateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),e):void 0},r.currentBreakpoint=function(){return this.breakpoint_},r.currentBreakpointClass=function(){return la[this.breakpoint_]||""},r.loadMedia=function(e,t){var r=this;if(e&&"object"==typeof e){this.reset(),this.cache_.media=Gt(e);var i=this.cache_.media,n=i.artwork,a=i.poster,s=i.src,o=i.textTracks;!n&&a&&(this.cache_.media.artwork=[{src:a,type:ai(a)}]),s&&this.src(s),a&&this.poster(a),Array.isArray(o)&&o.forEach((function(e){return r.addRemoteTextTrack(e,!1)})),this.ready(t)}},r.getMedia=function(){if(!this.cache_.media){var e=this.poster(),t={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),(function(e){return{kind:e.kind,label:e.label,language:e.language,src:e.src}}))};return e&&(t.poster=e,t.artwork=[{src:t.poster,type:ai(t.poster)}]),t}return Gt(this.cache_.media)},t.getTagSettings=function(e){var t={sources:[],tracks:[]},r=Oe(e),i=r["data-setup"];if(Le(e,"vjs-fill")&&(r.fill=!0),Le(e,"vjs-fluid")&&(r.fluid=!0),null!==i){var n=E.default(i||"{}"),a=n[0],s=n[1];a&&H.error(a),z(r,s)}if(z(t,r),e.hasChildNodes())for(var o=e.childNodes,l=0,u=o.length;l<u;l++){var c=o[l],d=c.nodeName.toLowerCase();"source"===d?t.sources.push(Oe(c)):"track"===d&&t.tracks.push(Oe(c))}return t},r.flexNotSupported_=function(){var e=m.default.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)},r.debug=function(e){if(void 0===e)return this.debugEnabled_;e?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},r.playbackRates=function(e){if(void 0===e)return this.cache_.playbackRates;!Array.isArray(e)||!e.every((function(e){return"number"==typeof e}))||(this.cache_.playbackRates=e,this.trigger("playbackrateschange"))},t}(zt);Br.names.forEach((function(e){var t=Br[e];ca.prototype[t.getterName]=function(){return this.tech_?this.tech_[t.getterName]():(this[t.privateName]=this[t.privateName]||new t.ListClass,this[t.privateName])}})),ca.prototype.crossorigin=ca.prototype.crossOrigin,ca.players={};var da=g.default.navigator;ca.prototype.options_={techOrder:Ur.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:da&&(da.languages&&da.languages[0]||da.userLanguage||da.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",normalizeAutoplay:!1,fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach((function(e){ca.prototype[e]=function(){return this.techGet_(e)}})),aa.forEach((function(e){ca.prototype["handleTech"+Ut(e)+"_"]=function(){return this.trigger(e)}})),zt.registerComponent("Player",ca);var ha="plugin",fa="activePlugins_",pa={},va=function(e){return pa.hasOwnProperty(e)},ga=function(e){return va(e)?pa[e]:void 0},ma=function(e,t){e[fa]=e[fa]||{},e[fa][t]=!0},ya=function(e,t,r){var i=(r?"before":"")+"pluginsetup";e.trigger(i,t),e.trigger(i+":"+t.name,t)},_a=function(e,t){var r=function(){ya(this,{name:e,plugin:t,instance:null},!0);var r=t.apply(this,arguments);return ma(this,e),ya(this,{name:e,plugin:t,instance:r}),r};return Object.keys(t).forEach((function(e){r[e]=t[e]})),r},Ta=function(e,t){return t.prototype.name=e,function(){ya(this,{name:e,plugin:t,instance:null},!0);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];var a=C.default(t,[this].concat(i));return this[e]=function(){return a},ya(this,a.getEventHash()),a}},ba=function(){function e(t){if(this.constructor===e)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,this.log||(this.log=this.player.log.createLogger(this.name)),Ft(this),delete this.trigger,Bt(this,this.constructor.defaultState),ma(t,this.name),this.dispose=this.dispose.bind(this),t.on("dispose",this.dispose)}var t=e.prototype;return t.version=function(){return this.constructor.VERSION},t.getEventHash=function(e){return void 0===e&&(e={}),e.name=this.name,e.plugin=this.constructor,e.instance=this,e},t.trigger=function(e,t){return void 0===t&&(t={}),gt(this.eventBusEl_,e,this.getEventHash(t))},t.handleStateChanged=function(e){},t.dispose=function(){var e=this.name,t=this.player;this.trigger("dispose"),this.off(),t.off("dispose",this.dispose),t[fa][e]=!1,this.player=this.state=null,t[e]=Ta(e,pa[e])},e.isBasic=function(t){var r="string"==typeof t?ga(t):t;return"function"==typeof r&&!e.prototype.isPrototypeOf(r.prototype)},e.registerPlugin=function(t,r){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+typeof t+".");if(va(t))H.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(ca.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof r)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+typeof r+".");return pa[t]=r,t!==ha&&(e.isBasic(r)?ca.prototype[t]=_a(t,r):ca.prototype[t]=Ta(t,r)),r},e.deregisterPlugin=function(e){if(e===ha)throw new Error("Cannot de-register base plugin.");va(e)&&(delete pa[e],delete ca.prototype[e])},e.getPlugins=function(e){var t;return void 0===e&&(e=Object.keys(pa)),e.forEach((function(e){var r=ga(e);r&&((t=t||{})[e]=r)})),t},e.getPluginVersion=function(e){var t=ga(e);return t&&t.VERSION||""},e}();ba.getPlugin=ga,ba.BASE_PLUGIN_NAME=ha,ba.registerPlugin(ha,ba),ca.prototype.usingPlugin=function(e){return!!this[fa]&&!0===this[fa][e]},ca.prototype.hasPlugin=function(e){return!!va(e)};var Ea=function(e,t){void 0===t&&(t={});var r=function(){e.apply(this,arguments)},i={};for(var n in"object"==typeof t?(t.constructor!==Object.prototype.constructor&&(r=t.constructor),i=t):"function"==typeof t&&(r=t),w.default(r,e),e&&(r.super_=e),i)i.hasOwnProperty(n)&&(r.prototype[n]=i[n]);return r},Sa=function(e){return 0===e.indexOf("#")?e.slice(1):e};function ka(e,t,r){var i=ka.getPlayer(e);if(i)return t&&H.warn('Player "'+e+'" is already initialised. Options will not be applied.'),r&&i.ready(r),i;var n="string"==typeof e?Xe("#"+Sa(e)):e;if(!Ee(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");(!n.ownerDocument.defaultView||!n.ownerDocument.body.contains(n))&&H.warn("The element supplied is not included in the DOM"),t=t||{},x("beforesetup").forEach((function(e){var r=e(n,Gt(t));Y(r)&&!Array.isArray(r)?t=Gt(t,r):H.error("please return an object in beforesetup hooks")}));var a=zt.getComponent("Player");return i=new a(n,t,r),x("setup").forEach((function(e){return e(i)})),i}if(ka.hooks_=L,ka.hooks=x,ka.hook=D,ka.hookOnce=I,ka.removeHook=R,!0!==g.default.VIDEOJS_NO_DYNAMIC_STYLE&&be()){var Ca=Xe(".vjs-styles-defaults");if(!Ca){Ca=it("vjs-styles-defaults");var wa=Xe("head");wa&&wa.insertBefore(Ca,wa.firstChild),nt(Ca,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    ")}}et(1,ka),ka.VERSION=A,ka.options=ca.prototype.options_,ka.getPlayers=function(){return ca.players},ka.getPlayer=function(e){var t,r=ca.players;if("string"==typeof e){var i=Sa(e),n=r[i];if(n)return n;t=Xe("#"+i)}else t=e;if(Ee(t)){var a=t,s=a.player,o=a.playerId;if(s||r[o])return s||r[o]}},ka.getAllPlayers=function(){return Object.keys(ca.players).map((function(e){return ca.players[e]})).filter(Boolean)},ka.players=ca.players,ka.getComponent=zt.getComponent,ka.registerComponent=function(e,t){Ur.isTech(t)&&H.warn("The "+e+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),zt.registerComponent.call(zt,e,t)},ka.getTech=Ur.getTech,ka.registerTech=Ur.registerTech,ka.use=Vr,Object.defineProperty(ka,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(ka.middleware,"TERMINATOR",{value:Kr,writeable:!1,enumerable:!0}),ka.browser=me,ka.TOUCH_ENABLED=he,ka.extend=Ea,ka.mergeOptions=Gt,ka.bind=Et,ka.registerPlugin=ba.registerPlugin,ka.deregisterPlugin=ba.deregisterPlugin,ka.plugin=function(e,t){return H.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),ba.registerPlugin(e,t)},ka.getPlugins=ba.getPlugins,ka.getPlugin=ba.getPlugin,ka.getPluginVersion=ba.getPluginVersion,ka.addLanguage=function(e,t){var r;return e=(""+e).toLowerCase(),ka.options.languages=Gt(ka.options.languages,((r={})[e]=t,r)),ka.options.languages[e]},ka.log=H,ka.createLogger=G,ka.createTimeRange=ka.createTimeRanges=Jt,ka.formatTime=Ai,ka.setFormatTime=Ci,ka.resetFormatTime=wi,ka.parseUrl=br,ka.isCrossOrigin=kr,ka.EventTarget=Ct,ka.on=pt,ka.one=mt,ka.off=vt,ka.trigger=gt,ka.xhr=S.default,ka.TextTrack=Lr,ka.AudioTrack=xr,ka.VideoTrack=Dr,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach((function(e){ka[e]=function(){return H.warn("videojs."+e+"() is deprecated; use videojs.dom."+e+"() instead"),Je[e].apply(null,arguments)}})),ka.computedStyle=Q,ka.dom=Je,ka.url=Cr,ka.defineLazyProperty=ia,ka.addLanguage("en",{"Non-Fullscreen":"Exit Fullscreen"}),e.exports=ka},288:(e,t,r)=>{!function(){var t;"undefined"!=typeof self&&self,t=function(e){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,r){!function(){var t;t=function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=16)}([function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(t,r(6))},function(e,t){function r(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function i(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}function n(e,t){var r=M(e)||f(e)?i(e.length,String):[],n=r.length,a=!!n;for(var s in e)!t&&!x.call(e,s)||a&&("length"==s||u(s,n))||r.push(s);return r}function a(e,t,r){var i=e[t];x.call(e,t)&&h(i,r)&&(void 0!==r||t in e)||(e[t]=r)}function s(e){if(!d(e))return I(e);var t=[];for(var r in Object(e))x.call(e,r)&&"constructor"!=r&&t.push(r);return t}function o(e,t){return t=O(void 0===t?e.length-1:t,0),function(){for(var i=arguments,n=-1,a=O(i.length-t,0),s=Array(a);++n<a;)s[n]=i[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=i[n];return o[t]=s,r(e,this,o)}}function l(e,t,r,i){r||(r={});for(var n=-1,s=t.length;++n<s;){var o=t[n],l=i?i(r[o],e[o],o,r,e):void 0;a(r,o,void 0===l?e[o]:l)}return r}function u(e,t){return!!(t=null==t?S:t)&&("number"==typeof e||A.test(e))&&e>-1&&e%1==0&&e<t}function c(e,t,r){if(!y(r))return!1;var i=typeof t;return!!("number"==i?p(r)&&u(t,r.length):"string"==i&&t in r)&&h(r[t],e)}function d(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||L)}function h(e,t){return e===t||e!==e&&t!==t}function f(e){return v(e)&&x.call(e,"callee")&&(!R.call(e,"callee")||D.call(e)==k)}function p(e){return null!=e&&m(e.length)&&!g(e)}function v(e){return _(e)&&p(e)}function g(e){var t=y(e)?D.call(e):"";return t==C||t==w}function m(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=S}function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function _(e){return!!e&&"object"==typeof e}function T(e){return p(e)?n(e):s(e)}var b,E,S=9007199254740991,k="[object Arguments]",C="[object Function]",w="[object GeneratorFunction]",A=/^(?:0|[1-9]\d*)$/,L=Object.prototype,x=L.hasOwnProperty,D=L.toString,R=L.propertyIsEnumerable,I=(b=Object.keys,E=Object,function(e){return b(E(e))}),O=Math.max,P=!R.call({valueOf:1},"valueOf"),M=Array.isArray,F=function(e){return o((function(t,r){var i=-1,n=r.length,a=n>1?r[n-1]:void 0,s=n>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(n--,a):void 0,s&&c(r[0],r[1],s)&&(a=n<3?void 0:a,n=1),t=Object(t);++i<n;){var o=r[i];o&&e(t,o)}return t}))}((function(e,t){if(P||d(t)||p(t))l(t,T(t),e);else for(var r in t)x.call(t,r)&&a(e,r,t[r])}));e.exports=F},function(e,t,r){"use strict";function i(e,t,r){r=void 0===r?1:r,e[t]=e[t]||0,e[t]+=r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(0),a=(i=n)&&i.__esModule?i:{default:i},s={now:function(){var e=a.default.performance,t=e&&e.timing;return t&&"number"==typeof t.navigationStart&&"function"==typeof e.now?t.navigationStart+e.now():Date.now()}};t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(18),a=(i=n)&&i.__esModule?i:{default:i},s=a.default.methodFactory;a.default.methodFactory=function(e,t,r){var i=s(e,t,r);return function(){for(var e=["[mux]"],t=0;t<arguments.length;t++)e.push(arguments[t]);i.apply(void 0,e)}},a.default.setLevel(a.default.getLevel()),t.default=a.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return a(e)[0]},n=function(e){return a(e)[1]},a=function(e){if("string"!=typeof e||""===e)return["localhost"];var t=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,r=(e.match(t)||[])[4],i=void 0;return r&&(i=(r.match(/[^\.]+\.[^\.]+$/)||[])[0]),[r,i]};t.extractHostnameAndDomain=a,t.extractHostname=i,t.extractDomain=n},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(i){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},n=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)};t.generateUUID=i,t.generateShortID=n},function(e,t,r){"use strict";function i(e){var t={};return(e=e||"").trim().split(/[\r\n]+/).forEach((function(e){if(e){var r=e.split(": "),i=r.shift();i&&n.indexOf(i.toLowerCase())>=0&&(t[i]=r.join(": "))}})),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n=["x-cdn","content-type"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findMediaElement=t.getMuxPlayerId=void 0;var i=r(7),n=function(e){return e&&void 0!==e.nodeName?(e.muxId||(e.muxId=e.id||(0,i.generateShortID)()),e.muxId):e},a=function(e){var t=void 0;return e&&void 0!==e.nodeName?e=n(t=e):t=document.querySelector(e),[t,e,t&&t.nodeName?t.nodeName.toLowerCase():""]};t.getMuxPlayerId=n,t.findMediaElement=a},function(e,t,r){"use strict";function i(){return"1"===(s.default.doNotTrack||s.default.navigator&&(s.default.navigator.doNotTrack||s.default.navigator.msDoNotTrack))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(0),s=(n=a)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(0),a=(i=n)&&i.__esModule?i:{default:i},s={exists:function(){var e=a.default.performance;return void 0!==(e&&e.timing)},domContentLoadedEventEnd:function(){var e=a.default.performance,t=e&&e.timing;return t&&t.domContentLoadedEventEnd},navigationStart:function(){var e=a.default.performance,t=e&&e.timing;return t&&t.navigationStart}};t.default=s},function(e,t,r){"use strict";var i=r(42),n=r(43),a=r(14);e.exports={formats:a,parse:n,stringify:i}},function(e,t,r){"use strict";var i=Object.prototype.hasOwnProperty,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var i=[],n=0;n<t.length;++n)void 0!==t[n]&&i.push(t[n]);r.obj[r.prop]=i}}return t};t.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(r[i]=e[i]);return r},t.merge=function(e,r,n){if(!r)return e;if("object"!=typeof r){if(Array.isArray(e))e.push(r);else{if("object"!=typeof e)return[e,r];(n.plainObjects||n.allowPrototypes||!i.call(Object.prototype,r))&&(e[r]=!0)}return e}if("object"!=typeof e)return[e].concat(r);var a=e;return Array.isArray(e)&&!Array.isArray(r)&&(a=t.arrayToObject(e,n)),Array.isArray(e)&&Array.isArray(r)?(r.forEach((function(r,a){i.call(e,a)?e[a]&&"object"==typeof e[a]?e[a]=t.merge(e[a],r,n):e.push(r):e[a]=r})),e):Object.keys(r).reduce((function(e,a){var s=r[a];return i.call(e,a)?e[a]=t.merge(e[a],s,n):e[a]=s,e}),a)},t.assign=function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",i=0;i<t.length;++i){var a=t.charCodeAt(i);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?r+=t.charAt(i):a<128?r+=n[a]:a<2048?r+=n[192|a>>6]+n[128|63&a]:a<55296||a>=57344?r+=n[224|a>>12]+n[128|a>>6&63]+n[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&t.charCodeAt(i)),r+=n[240|a>>18]+n[128|a>>12&63]+n[128|a>>6&63]+n[128|63&a])}return r},t.compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var n=t[i],s=n.obj[n.prop],o=Object.keys(s),l=0;l<o.length;++l){var u=o[l],c=s[u];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(t.push({obj:s,prop:u}),r.push(c))}return a(t)},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},function(e,t,r){"use strict";var i=String.prototype.replace,n=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return i.call(e,n,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function a(e){var t={},r={};return Object.keys(e).forEach((function(i){var n=!1;if(e.hasOwnProperty(i)&&void 0!==e[i]){var a=i.split("_"),o=a[0],c=l[o];c||(s.default.info("Data key word `"+a[0]+"` not expected in "+i),c=o+"_"),a.splice(1).forEach((function(e){"url"===e&&(n=!0),u[e]?c+=u[e]:Number(e)&&Math.floor(Number(e))===Number(e)?c+=e:(s.default.info("Data key word `"+e+"` not expected in "+i),c+="_"+e+"_")})),n?r[c]=e[i]:t[c]=e[i]}})),(0,o.default)(t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s=i(r(4)),o=i(r(1)),l=n({a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"}),u=n({ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"})},function(e,t,r){"use strict";e.exports=r(17).default},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(r(0)),s=r(9),o=i(r(4)),l=i(r(10)),u=i(r(3)),c=i(r(19)),d=i(r(50)),h=i(r(51)),f={},p=function e(t){var r=arguments;"string"==typeof t?e.hasOwnProperty(t)?a.default.setTimeout((function(){r=Array.prototype.splice.call(r,1),e[t].apply(null,r)}),0):o.default.warn("`"+t+"` is an unknown task"):"function"==typeof t?a.default.setTimeout((function(){t(e)}),0):o.default.warn("`"+t+"` is invalid.")};p.loaded=u.default.now(),p.NAME="mux-embed",p.VERSION="4.2.0",p.API_VERSION="2.1",p.PLAYER_TRACKED=!1,p.monitor=function(e,t){return(0,d.default)(p,e,t)},p.destroyMonitor=function(e){var t=(0,s.findMediaElement)(e),r=n(t,1)[0];r&&r.mux&&"function"==typeof r.mux.destroy?r.mux.destroy():o.default.error("A video element monitor for `"+e+"` has not been initialized via `mux.monitor`.")},p.addHLSJS=function(e,t){var r=(0,s.getMuxPlayerId)(e);f[r]?f[r].addHLSJS(t):o.default.error("A monitor for `"+r+"` has not been initialized.")},p.addDashJS=function(e,t){var r=(0,s.getMuxPlayerId)(e);f[r]?f[r].addDashJS(t):o.default.error("A monitor for `"+r+"` has not been initialized.")},p.removeHLSJS=function(e){var t=(0,s.getMuxPlayerId)(e);f[t]?f[t].removeHLSJS():o.default.error("A monitor for `"+t+"` has not been initialized.")},p.removeDashJS=function(e){var t=(0,s.getMuxPlayerId)(e);f[t]?f[t].removeDashJS():o.default.error("A monitor for `"+t+"` has not been initialized.")},p.init=function(e,t){(0,l.default)()&&t&&t.respectDoNotTrack&&o.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var r=(0,s.getMuxPlayerId)(e);f[r]=new c.default(p,r,t)},p.emit=function(e,t,r){var i=(0,s.getMuxPlayerId)(e);f[i]?(f[i].emit(t,r),"destroy"===t&&delete f[i]):o.default.error("A monitor for `"+i+"` has not been initialized.")},void 0!==a.default&&"function"==typeof a.default.addEventListener&&a.default.addEventListener("unload",(function(){p.WINDOW_UNLOADING=!0}),!1),p.checkDoNotTrack=l.default,p.log=o.default,p.utils=h.default,t.default=p},function(e,t,r){var i,n;!function(a,s){"use strict";void 0!==(n="function"==typeof(i=s)?i.call(t,r,t,e):i)&&(e.exports=n)}(0,(function(){"use strict";function e(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(i){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function t(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function r(r){return"debug"===r&&(r="log"),typeof console!==l&&("trace"===r&&u?t:void 0!==console[r]?e(console,r):void 0!==console.log?e(console,"log"):o)}function i(e,t){for(var r=0;r<c.length;r++){var i=c[r];this[i]=r<e?o:this.methodFactory(i,e,t)}this.log=this.debug}function n(e,t,r){return function(){typeof console!==l&&(i.call(this,t,r),this[e].apply(this,arguments))}}function a(e,t,i){return r(e)||n.apply(this,arguments)}function s(e,t,r){function n(e){var t=(c[e]||"silent").toUpperCase();if(typeof window!==l&&d){try{return void(window.localStorage[d]=t)}catch(r){}try{window.document.cookie=encodeURIComponent(d)+"="+t+";"}catch(r){}}}function s(){var e;if(typeof window!==l&&d){try{e=window.localStorage[d]}catch(i){}if(typeof e===l)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(d)+"=");-1!==r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(i){}return void 0===u.levels[e]&&(e=void 0),e}}var o,u=this,d="loglevel";"string"==typeof e?d+=":"+e:"symbol"==typeof e&&(d=void 0),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=r||a,u.getLevel=function(){return o},u.setLevel=function(t,r){if("string"==typeof t&&void 0!==u.levels[t.toUpperCase()]&&(t=u.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(o=t,!1!==r&&n(t),i.call(u,t,e),typeof console===l&&t<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){s()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var h=s();null==h&&(h=null==t?"WARN":t),u.setLevel(h,!1)}var o=function(){},l="undefined",u=typeof window!==l&&typeof window.navigator!==l&&/Trident\/|MSIE /.test(window.navigator.userAgent),c=["trace","debug","info","warn","error"],d=new s,h={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new s(e,d.getLevel(),d.methodFactory)),t};var f=typeof window!==l?window.log:void 0;return d.noConflict=function(){return typeof window!==l&&window.log===d&&(window.log=f),d},d.getLoggers=function(){return h},d.default=d,d}))},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(r(4)),s=i(r(1)),o=r(7),l=r(5),u=i(r(0)),c=i(r(11)),d=i(r(2)),h=i(r(20)),f=r(25),p=r(26),v=i(r(27)),g=i(r(28)),m=i(r(29)),y=i(r(30)),_=i(r(31)),T=i(r(32)),b=i(r(33)),E=i(r(34)),S=i(r(35)),k=i(r(36)),C=i(r(37)),w=i(r(38)),A=i(r(39)),L=i(r(40)),x=i(r(49)),D=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],R=function(e,t,r){var i=this;this.DOM_CONTENT_LOADED_EVENT_END=c.default.domContentLoadedEventEnd(),this.NAVIGATION_START=c.default.navigationStart();var n={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(e){return e}};this.mux=e,this.id=t,(r=(0,s.default)(n,r)).data=r.data||{},r.data.property_key&&(r.data.env_key=r.data.property_key,delete r.data.property_key),a.default.setLevel(r.debug?"debug":"warn"),this.getPlayheadTime=r.getPlayheadTime,this.getStateData=r.getStateData||function(){},this.getAdData=r.getAdData||function(){},this.minimumRebufferDuration=r.minimumRebufferDuration,this.sustainedRebufferThreshold=r.sustainedRebufferThreshold,this.playbackHeartbeatTime=r.playbackHeartbeatTime,this.disableRebufferTracking=r.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=r.errorTranslator,this.playbackEventDispatcher=new L.default(e,r.data.env_key,r),this.data={player_instance_id:(0,o.generateUUID)(),mux_sample_rate:r.sampleRate,beacon_domain:r.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(e,t){t=(0,s.default)({viewer_time:this.mux.utils.now()},t),this.oldEmit(e,t)};var l=function(){void 0===this.data.view_start&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",(function(e,t){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,s.default)(this.data,t),this._initializeViewData(),this.one("play",l),this.one("adbreakstart",l)}));var d=function(e){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",e)}.bind(this);this.on("videochange",(function(e,t){d(t)})),this.on("programchange",(function(e,t){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),d((0,s.default)(t,{view_program_changed:!0})),l(),this.emit("play"),this.emit("playing")})),this.on("destroy",this.destroy);var h=this.destroy.bind(this);void 0!==u.default&&"function"==typeof u.default.addEventListener&&u.default.addEventListener("unload",h,!1),this.on("destroy",(function(){void 0!==u.default&&"function"==typeof u.default.removeEventListener&&u.default.removeEventListener("unload",h)})),this.on("playerready",(function(e,t){(0,s.default)(this.data,t)})),D.forEach((function(e){i.on(e,(function(t,r){0!==e.indexOf("ad")&&this._updateStateData(),(0,s.default)(this.data,r),this._sanitizeData()})),i.on("after"+e,(function(){("error"!==e||this.viewErrored)&&this.send(e)}))})),this.on("viewend",(function(e,t){(0,s.default)(i.data,t)}));var f=function(e){var t=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=t-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};this.one("playerready",f),m.default.apply(this),A.default.apply(this),k.default.apply(this),T.default.apply(this),g.default.apply(this),S.default.apply(this),y.default.apply(this),_.default.apply(this),C.default.apply(this),b.default.apply(this),E.default.apply(this),w.default.apply(this),x.default.apply(this),r.hlsjs&&this.addHLSJS(r),r.dashjs&&this.addDashJS(r),this.emit("viewinit",r.data)};(0,s.default)(R.prototype,v.default.prototype),(0,s.default)(R.prototype,T.default.prototype),(0,s.default)(R.prototype,k.default.prototype),(0,s.default)(R.prototype,g.default.prototype),(0,s.default)(R.prototype,y.default.prototype),(0,s.default)(R.prototype,_.default.prototype),(0,s.default)(R.prototype,C.default.prototype),(0,s.default)(R.prototype,b.default.prototype),(0,s.default)(R.prototype,E.default.prototype),R.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,void 0!==this.data.view_start&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),u.default.clearTimeout(this._heartBeatTimeout))},R.prototype.send=function(e){var t=(0,s.default)({},this.data);if(1===t.player_error_code&&(delete t.player_error_code,delete t.player_error_message),t.player_source_duration===1/0||t.video_source_duration===1/0?t.video_source_is_live=!0:(t.player_source_duration>0||t.video_source_duration>0)&&(t.video_source_is_live=!1),t.video_source_url=t.video_source_url||t.player_source_url,t.video_source_url){var r=(0,l.extractHostnameAndDomain)(t.video_source_url),i=n(r,2),a=i[0],o=i[1];t.video_source_domain=o,t.video_source_hostname=a}delete t.ad_request_id,this.playbackEventDispatcher.send(e,t),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},R.prototype._updateStateData=function(){(0,s.default)(this.data,this.getStateData()),this.getPlayheadTime&&(this.data.player_playhead_time=this.getPlayheadTime()),this._sanitizeData()},R.prototype._sanitizeData=function(){var e=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach((function(t){var r=parseInt(e.data[t],10);e.data[t]=isNaN(r)?void 0:r})),["player_source_url","video_source_url"].forEach((function(t){if(e.data[t]){var r=e.data[t].toLowerCase();0!==r.indexOf("data:")&&0!==r.indexOf("blob:")||(e.data[t]="MSE style URL")}}))},R.prototype._resetVideoData=function(e,t){var r=this;Object.keys(this.data).forEach((function(e){0===e.indexOf("video_")&&delete r.data[e]}))},R.prototype._resetViewData=function(){var e=this;Object.keys(this.data).forEach((function(t){0===t.indexOf("view_")&&delete e.data[t]})),this.data.view_sequence_number=1},R.prototype._resetErrorData=function(e,t){delete this.data.player_error_code,delete this.data.player_error_message},R.prototype._initializeViewData=function(){var e=this,t=this.data.view_id=(0,o.generateUUID)();this.data.video_id||(this.data.video_id=(0,h.default)(this.data.player_source_url));var r=function(){t===e.data.view_id&&(0,d.default)(e.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",r):r()},R.prototype._restartHeartBeat=function(){var e=this;u.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=u.default.setTimeout((function(){e.data.player_is_paused||e.emit("hb")}),1e4))},R.prototype.addHLSJS=function(e){return e.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=e.hlsjs,void(0,f.monitorHlsJs)(this.mux,this.id,e.hlsjs,{},e.Hls||u.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},R.prototype.removeHLSJS=function(){this.hlsjs&&((0,f.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},R.prototype.addDashJS=function(e){return e.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=e.dashjs,void(0,p.monitorDashJS)(this.mux,this.id,e.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},R.prototype.removeDashJS=function(){this.dashjs&&((0,p.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},t.default=R},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=a.default.createElement("a");t.href=e;var r=t.pathname.replace(/\.[^\/.]+$/,"");return s.default.encode(t.host+r).split("=")[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(r(21)),s=i(r(23))},function(e,t,r){(function(t){var i,n=void 0!==t?t:"undefined"!=typeof window?window:{},a=r(22);"undefined"!=typeof document?i=document:(i=n["__GLOBAL_DOCUMENT_CACHE@4"])||(i=n["__GLOBAL_DOCUMENT_CACHE@4"]=a),e.exports=i}).call(t,r(6))},function(e,t){},function(e,t,r){(function(e,i){var n;!function(i){var a=("object"==typeof e&&e&&e.exports,function(e){this.message=e});a.prototype=new Error,a.prototype.name="InvalidCharacterError";var s=function(e){throw new a(e)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=/[\t\n\f\r ]/g,u={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&s("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r=e.length%3,i="",n=-1,a=e.length-r;++n<a;)t=(e.charCodeAt(n)<<16)+(e.charCodeAt(++n)<<8)+e.charCodeAt(++n),i+=o.charAt(t>>18&63)+o.charAt(t>>12&63)+o.charAt(t>>6&63)+o.charAt(63&t);return 2==r?(t=(e.charCodeAt(n)<<8)+e.charCodeAt(++n),i+=o.charAt(t>>10)+o.charAt(t>>4&63)+o.charAt(t<<2&63)+"="):1==r&&(t=e.charCodeAt(n),i+=o.charAt(t>>2)+o.charAt(t<<4&63)+"=="),i},decode:function(e){var t=(e=String(e).replace(l,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&s("Invalid character: the string to be decoded is not correctly encoded.");for(var r,i,n=0,a="",u=-1;++u<t;)i=o.indexOf(e.charAt(u)),r=n%4?64*r+i:i,n++%4&&(a+=String.fromCharCode(255&r>>(-2*n&6)));return a},version:"0.1.0"};void 0!==(n=function(){return u}.call(t,r,t,e))&&(e.exports=n)}()}).call(t,r(24)(e),r(6))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringHlsJs=t.monitorHlsJs=void 0;var n=i(r(8)),a=i(r(11)),s=r(5),o=function(e){if(!e)return{};var t=a.default.navigationStart(),r=e.loading,i=r?r.start:e.trequest,n=r?r.first:e.tfirst,s=r?r.end:e.tload;return{bytesLoaded:e.total,requestStart:Math.round(t+i),responseStart:Math.round(t+n),responseEnd:Math.round(t+s)}},l=function(e){if(e&&"function"==typeof e.getAllResponseHeaders)return(0,n.default)(e.getAllResponseHeaders())},u=function(e,t,r){var i=arguments[4],n=e.log;if(a.default.exists()){var u=function(r,i){return e.emit(t,r,i)},c=function(e,t){var r=t.levels,i=t.audioTracks,n=t.url,a=t.stats,c=t.networkDetails,d={},h={};r.forEach((function(e,t){d[t]={width:e.width,height:e.height,bitrate:e.bitrate,attrs:e.attrs}})),i.forEach((function(e,t){h[t]={name:e.name,language:e.lang,bitrate:e.bitrate}}));var f=o(a),p=f.bytesLoaded,v=f.requestStart,g=f.responseStart,m=f.responseEnd;u("requestcompleted",{request_event_type:e,request_bytes_loaded:p,request_start:v,request_response_start:g,request_response_end:m,request_type:"manifest",request_hostname:(0,s.extractHostname)(n),request_response_headers:l(c),request_rendition_lists:{media:d,audio:h,video:{}}})};r.on(i.Events.MANIFEST_LOADED,c);var d=function(e,t){var r=t.details,i=t.level,n=t.networkDetails,a=t.stats,c=o(a),d=c.bytesLoaded,h=c.requestStart,f=c.responseStart,p=c.responseEnd;u("requestcompleted",{request_event_type:e,request_bytes_loaded:d,request_start:h,request_response_start:f,request_response_end:p,request_current_level:i,request_type:"manifest",request_hostname:(0,s.extractHostname)(r.url),request_response_headers:l(n)})};r.on(i.Events.LEVEL_LOADED,d);var h=function(e,t){var r=t.details,i=t.networkDetails,n=t.stats,a=o(n),c=a.bytesLoaded,d=a.requestStart,h=a.responseStart,f=a.responseEnd;u("requestcompleted",{request_event_type:e,request_bytes_loaded:c,request_start:d,request_response_start:h,request_response_end:f,request_type:"manifest",request_hostname:(0,s.extractHostname)(r.url),request_response_headers:l(i)})};r.on(i.Events.AUDIO_TRACK_LOADED,h);var f=function(e,t){var i=t.stats,n=t.networkDetails,a=t.frag,c=o(i),d={request_event_type:e,request_bytes_loaded:c.bytesLoaded,request_start:c.requestStart,request_response_start:c.responseStart,request_response_end:c.responseEnd,request_hostname:n?(0,s.extractHostname)(n.responseURL):void 0,request_response_headers:l(n),request_media_duration:a.duration};"main"===a.type?(d.request_type="media",d.request_current_level=a.level,d.request_video_width=(r.levels[a.level]||{}).width,d.request_video_height=(r.levels[a.level]||{}).height):d.request_type=a.type,u("requestcompleted",d)};r.on(i.Events.FRAG_LOADED,f);var p=function(e,t){var r=t.details,n=t.response,a=t.context,o=t.frag;if(r===i.ErrorDetails.MANIFEST_LOAD_ERROR||r===i.ErrorDetails.MANIFEST_LOAD_TIMEOUT||r===i.ErrorDetails.FRAG_LOAD_ERROR||r===i.ErrorDetails.FRAG_LOAD_TIMEOUT||r===i.ErrorDetails.LEVEL_LOAD_ERROR||r===i.ErrorDetails.LEVEL_LOAD_TIMEOUT){var l=o&&o.url||a&&a.url||"";u("requestfailed",{request_error:r,request_url:l,request_hostname:(0,s.extractHostname)(l),request_type:r===i.ErrorDetails.FRAG_LOAD_ERROR||r===i.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:n&&n.code,request_error_text:n&&n.text})}};r.on(i.Events.ERROR,p);var v=function(e,t){var r=t.frag,i=r&&r._url||"";u("requestcanceled",{request_cancel:e,request_url:i,request_type:"media",request_hostname:(0,s.extractHostname)(i)})};r.on(i.Events.FRAG_LOAD_EMERGENCY_ABORTED,v);var g=function(e,t){var i=t.level,a=r.levels.find((function(e){return e.level===i}));if(a&&a.attrs&&a.attrs.BANDWIDTH){var s=a.attrs.BANDWIDTH;s?u("renditionchange",{video_source_bitrate:s,video_source_width:a.width,video_source_height:a.height}):n.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};r.on(i.Events.LEVEL_SWITCHED,g),r._stopMuxMonitor=function(){r.off(i.Events.MANIFEST_LOADED,c),r.off(i.Events.LEVEL_LOADED,d),r.off(i.Events.AUDIO_TRACK_LOADED,h),r.off(i.Events.FRAG_LOADED,f),r.off(i.Events.ERROR,p),r.off(i.Events.FRAG_LOAD_EMERGENCY_ABORTED,v),r.off(i.Events.LEVEL_SWITCHED,g),r.off(i.Events.DESTROYING,r._stopMuxMonitor),delete r._stopMuxMonitor},r.on(i.Events.DESTROYING,r._stopMuxMonitor)}else n.warn("performance timing not supported. Not tracking HLS.js.")},c=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()};t.monitorHlsJs=u,t.stopMonitoringHlsJs=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopMonitoringDashJS=t.monitorDashJS=void 0;var n=i(r(0)),a=i(r(8)),s=r(5),o=function(e,t){if(!e||"function"!=typeof e.getRequests)return{};var r=e.getRequests({state:"executed"});if(0===r.length)return{};var i=r[r.length-1],n=(0,s.extractHostname)(i.url),o=i.bytesLoaded,l=new Date(i.requestStartDate).getTime(),u=new Date(i.firstByteDate).getTime(),c=new Date(i.requestEndDate).getTime(),d=isNaN(i.duration)?0:i.duration,h="function"==typeof t.getMetricsFor?t.getMetricsFor(i.mediaType).HttpList:t.getDashMetrics().getHttpRequests(i.mediaType),f=void 0;return h.length>0&&(f=(0,a.default)(h[h.length-1]._responseHeaders||"")),{requestStart:l,requestResponseStart:u,requestResponseEnd:c,requestBytesLoaded:o,requestResponseHeaders:f,requestMediaDuration:d,requestHostname:n}},l=function(e,t){var r=t.getQualityFor(e),i=t.getCurrentTrackFor(e).bitrateList;return i?{currentLevel:r,renditionWidth:i[r].width||null,renditionHeight:i[r].height||null,renditionBitrate:i[r].bandwidth}:{}},u=function(e,t,r){var i=e.log;if(r&&r.on){var a=function(r,i){return e.emit(t,r,i)},u=function(e){var t=e.type,r=(e.data||{}).url;a("requestcompleted",{request_event_type:t,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,s.extractHostname)(r)})};r.on("manifestLoaded",u);var c={},d=function(e){var t=e.type,i=e.fragmentModel,n=(e.chunk||{}).mediaInfo||{},s=n.type,l=n.bitrateList,u={};(l=l||[]).forEach((function(e,t){u[t]={},u[t].width=e.width,u[t].height=e.height,u[t].bitrate=e.bandwidth,u[t].attrs={}})),"video"===s?c.video=u:"audio"===s?c.audio=u:c.media=u;var d=o(i,r),h=d.requestStart,f=d.requestResponseStart,p=d.requestResponseEnd,v=d.requestResponseHeaders,g=d.requestMediaDuration,m=d.requestHostname;a("requestcompleted",{request_event_type:t,request_start:h,request_response_start:f,request_response_end:p,request_bytes_loaded:-1,request_type:s+"_init",request_response_headers:v,request_hostname:m,request_media_duration:g,request_rendition_lists:c})};r.on("initFragmentLoaded",d);var h=function(e){var t=e.type,i=e.fragmentModel,n=e.chunk||{},s=n.mediaInfo,u=n.start,c=(s||{}).type,d=o(i,r),h=d.requestStart,f=d.requestResponseStart,p=d.requestResponseEnd,v=d.requestBytesLoaded,g=d.requestResponseHeaders,m=d.requestMediaDuration,y=d.requestHostname,_=l(c,r),T=_.currentLevel,b=_.renditionWidth,E=_.renditionHeight,S=_.renditionBitrate;a("requestcompleted",{request_event_type:t,request_start:h,request_response_start:f,request_response_end:p,request_bytes_loaded:v,request_type:c,request_response_headers:g,request_hostname:y,request_media_start_time:u,request_media_duration:m,request_current_level:T,request_labeled_bitrate:S,request_video_width:b,request_video_height:E})};r.on("mediaFragmentLoaded",h);var f={video:void 0,audio:void 0,totalBitrate:void 0},p=function(){if(f.video&&"number"==typeof f.video.bitrate){if(!f.video.width||!f.video.height)return void i.warn("have bitrate info for video but missing width/height");var e=f.video.bitrate;return f.audio&&"number"==typeof f.audio.bitrate&&(e+=f.audio.bitrate),e!==f.totalBitrate?(f.totalBitrate=e,{video_source_bitrate:e,video_source_height:f.video.height,video_source_width:f.video.width}):void 0}},v=function(e,t,n){if("number"==typeof e.newQuality){var s=e.mediaType;if("audio"===s||"video"===s){var o=r.getBitrateInfoListFor(s).find((function(t){return t.qualityIndex===e.newQuality}));if(!o||"number"!=typeof o.bitrate)return void i.warn("missing bitrate info for "+s);f[s]=o;var l=p();l&&a("renditionchange",l)}}else i.warn("missing evt.newQuality in qualityChangeRendered event",e)};r.on("qualityChangeRendered",v);var g=function(e){var t=e.error,r=e.event,i=(r=r||{}).request||{},o=n.default.event&&n.default.event.currentTarget||{};a("requestfailed",{request_error:t+"_"+r.id+"_"+i.type,request_url:r.url,request_hostname:(0,s.extractHostname)(r.url),request_type:i.mediaType,request_error_code:o.status,request_error_type:o.statusText})};r.on("error",g),r._stopMuxMonitor=function(){r.off("manifestLoaded",u),r.off("initFragmentLoaded",d),r.off("mediaFragmentLoaded",h),r.off("qualityChangeRendered",v),r.off("error",g),delete r._stopMuxMonitor}}else i.warn("Invalid dash.js player reference. Monitoring blocked.")},c=function(e){e&&"function"==typeof e._stopMuxMonitor&&e._stopMuxMonitor()};t.monitorDashJS=u,t.stopMonitoringDashJS=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){},n=0;i.prototype.on=function(e,t,r){return t._eventEmitterGuid=t._eventEmitterGuid||++n,this._listeners=this._listeners||{},this._listeners[e]=this._listeners[e]||[],r&&(t=t.bind(r)),this._listeners[e].push(t),t},i.prototype.off=function(e,t){var r=this._listeners&&this._listeners[e];r&&r.forEach((function(e,i){e._eventEmitterGuid===t._eventEmitterGuid&&r.splice(i,1)}))},i.prototype.one=function(e,t,r){var i=this;t._eventEmitterGuid=t._eventEmitterGuid||++n;var a=function n(){i.off(e,n),t.apply(r||this,arguments)};a._eventEmitterGuid=t._eventEmitterGuid,this.on(e,a)},i.prototype.emit=function(e,t){var r=this;if(this._listeners){t=t||{};var i=this._listeners["before*"]||[],n=this._listeners[e]||[],a=this._listeners["after"+e]||[],s=function(t,i){(t=t.slice()).forEach((function(t){t.call(r,{type:e},i)}))};s(i,t),s(n,t),s(a,t)}},t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(0),a=(i=n)&&i.__esModule?i:{default:i},s=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",(function(){this._playheadShouldBeProgressing=!0})),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",(function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()})),this.on("timeupdate",(function(){null!==this._playbackHeartbeatInterval&&this.emit("playbackheartbeat")})),this.on("devicesleep",(function(e,t){null!==this._playbackHeartbeatInterval&&(a.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:t.viewer_time}),this._playbackHeartbeatInterval=null)}))};s.prototype._startPlaybackHeartbeatInterval=function(){var e=this;null===this._playbackHeartbeatInterval&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=a.default.setInterval((function(){e.emit("playbackheartbeat")}),this.playbackHeartbeatTime))},s.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,null!==this._playbackHeartbeatInterval&&(a.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},t.default=s},function(e,t,r){"use strict";function i(){var e=this;this.on("viewinit",(function(){e.viewErrored=!1})),this.on("error",(function(){try{var t=e.errorTranslator({player_error_code:e.data.player_error_code,player_error_message:e.data.player_error_message});t?(e.data.player_error_code=t.player_error_code,e.data.player_error_message=t.player_error_message,e.viewErrored=!0):(delete e.data.player_error_code,delete e.data.player_error_message)}catch(r){e.mux.log.warn("Exception in error translator callback.",r),e.viewErrored=!0}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(2),a=(i=n)&&i.__esModule?i:{default:i},s=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};s.prototype._updateWatchTime=function(e,t){var r=t.viewer_time;null===this._watchTimeTrackerLastCheckedTime&&(this._watchTimeTrackerLastCheckedTime=r),(0,a.default)(this.data,"view_watch_time",r-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=r},s.prototype._clearWatchTimeState=function(e,t){this._updateWatchTime(e,t),this._watchTimeTrackerLastCheckedTime=null},t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(2),a=(i=n)&&i.__esModule?i:{default:i},s=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};s.prototype._updatePlaybackTime=function(){var e=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&e>this._playbackTimeTrackerLastPlayheadPosition){var t=e-this._playbackTimeTrackerLastPlayheadPosition;t<=1e3&&(0,a.default)(this.data,"view_content_playback_time",t)}this._playbackTimeTrackerLastPlayheadPosition=e},s.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",(function(){this.off("timeupdate",this._updatePlayheadTime)}))};i.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=void 0===this.data.view_max_playhead_position?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},i.prototype._updatePlayheadTime=function(e,t){if(t.player_playhead_time)this.data.player_playhead_time=t.player_playhead_time,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var r=this.getPlayheadTime();void 0!==r&&(this.data.player_playhead_time=r,this._updateMaxPlayheadPosition())}},t.default=i},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(3)),a=i(r(2)),s=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",(function(){this._cleanupRebufferTracker(null,{viewer_time:n.default.now()})}))};s.prototype._checkIfRebuffering=function(e,t){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(e,t);if(null===this._lastCheckedTime)return this._prepareRebufferTrackerState(t.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(e,t,!0);var r=t.viewer_time-this._lastPlayheadTimeUpdatedTime;r>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,a.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(r),this.emit("rebufferstart"))),this._lastCheckedTime=t.viewer_time}},s.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},s.prototype._prepareRebufferTrackerState=function(e){this._lastCheckedTime=e,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=e},s.prototype._cleanupRebufferTracker=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(t.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:t.viewer_time});else{if(null===this._lastCheckedTime)return void this._updateRebufferMetrics();var i=this.data.player_playhead_time-this._lastPlayheadTime,n=t.viewer_time-this._lastPlayheadTimeUpdatedTime;i>0&&n-i>this.minimumRebufferDuration?((0,a.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(n-i),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+n-i})):this._updateRebufferMetrics()}r?this._prepareRebufferTrackerState(t.viewer_time):this._clearRebufferTrackerState()}},s.prototype._updateRebufferMetrics=function(e){e>0&&(0,a.default)(this.data,"view_rebuffer_duration",e),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(3),a=(i=n)&&i.__esModule?i:{default:i},s=function(){this.on("viewinit",(function(){var e=this.data,t=e.view_id;if(!e.view_program_changed){var r=function(e,r){var i=r.viewer_time;"playing"===e.type&&void 0===this.data.view_time_to_first_frame?this.calculateTimeToFirstFrame(i||a.default.now(),t):"adplaying"!==e.type||void 0!==this.data.view_time_to_first_frame&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(i||a.default.now(),t)};this.one("playing",r),this.one("adplaying",r),this.one("viewend",(function(){this.off("playing",r),this.off("adplaying",r)}))}}))};s.prototype.calculateTimeToFirstFrame=function(e,t){t===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:e}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},t.default=s},function(e,t,r){"use strict";function i(){var e=this;this.on("viewinit",(function(){this._lastPlayheadPosition=-1}));var t=["playing","hb"];["pause","rebufferstart","seeking","error","adbreakstart","hb"].forEach((function(t){e.on(t,(function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var e=this.data.player_playhead_time-this._lastPlayheadPosition;if(e<0)return void(this._lastPlayheadPosition=-1);var t=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),r=Math.max(0,t-1),i=Math.max(0,1-t);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,r),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,i),(0,s.default)(this.data,"view_total_content_playback_time",e),(0,s.default)(this.data,"view_total_upscaling",r*e),(0,s.default)(this.data,"view_total_downscaling",i*e)}this._lastPlayheadPosition=-1}))})),t.forEach((function(t){e.on(t,(function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(2),s=(n=a)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(){this.isSeeking=!1,this.on("seeking",(function(e,t){(0,o.default)(this.data,t),this._lastSeekingTime=a.default.now(),!1===this.isSeeking&&(this.isSeeking=!0,this.send("seeking"))})),this.on("seeked",(function(){this.isSeeking=!1;var e=this._lastSeekingTime||a.default.now(),t=a.default.now()-e;(0,s.default)(this.data,"view_seek_count",1),(0,s.default)(this.data,"view_seek_duration",t);var r=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(r,t)})),this.on("viewend",(function(){this.isSeeking=!1}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(r(3)),s=i(r(2)),o=i(r(1))},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(r(2)),s=r(5),o=i(r(1)),l=function(e,t){e.push(t),e.sort((function(e,t){return e.viewer_time-t.viewer_time}))},u=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],c=function(){var e=this;this.on("viewinit",(function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0})),u.forEach((function(t){return e.on(t,e._updateAdData)}));var t=function(){e.isAdBreak=!1};this.on("adbreakstart",(function(){this.isAdBreak=!0})),this.on("play",t),this.on("playing",t),this.on("viewend",t),this.on("adrequest",(function(e,t){t=(0,o.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},t),l(this._adRequests,t),(0,a.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,a.default)(this.data,"view_preroll_request_count"))})),this.on("adresponse",(function(e,t){t=(0,o.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},t),l(this._adResponses,t);var r=this.findAdRequest(t.ad_request_id);r&&(0,a.default)(this.data,"view_ad_request_time",Math.max(0,t.viewer_time-r.viewer_time))})),this.on("adplay",(function(e,t){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,a.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,t.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,t.viewer_time-this.data.view_start)),this._prerollPlayTime=t.viewer_time)})),this.on("adplaying",(function(e,t){this.inPrerollPosition()&&void 0===this.data.view_preroll_load_time&&void 0!==this._prerollPlayTime&&(this.data.view_preroll_load_time=t.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=t.viewer_time-this._prerollPlayTime)})),this.on("adended",(function(){this._wouldBeNewAdPlay=!0})),this.on("aderror",(function(){this._wouldBeNewAdPlay=!0}))};c.prototype.inPrerollPosition=function(){return void 0===this.data.view_content_playback_time||this.data.view_content_playback_time<=1e3},c.prototype.findAdRequest=function(e){for(var t=0;t<this._adRequests.length;t++)if(this._adRequests[t].ad_request_id===e)return this._adRequests[t]},c.prototype._updateAdData=function(e,t){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&t.ad_tag_url){var r=(0,s.extractHostnameAndDomain)(t.ad_tag_url),i=n(r,2),a=i[0],o=i[1];this.data.view_preroll_ad_tag_domain=o,this.data.view_preroll_ad_tag_hostname=a}if(!this.data.view_preroll_ad_asset_hostname&&t.ad_asset_url){var l=(0,s.extractHostnameAndDomain)(t.ad_asset_url),u=n(l,2),c=u[0],d=u[1];this.data.view_preroll_ad_asset_domain=d,this.data.view_preroll_ad_asset_hostname=c}}},t.default=c},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(){var e=this,t=void 0,r=void 0,i=function(){e.disableRebufferTracking||((0,s.default)(e.data,"view_waiting_rebuffer_count",1),t=a.default.now(),r=window.setInterval((function(){if(t){var r=a.default.now();(0,s.default)(e.data,"view_waiting_rebuffer_duration",r-t),t=r}}),250))},n=function(){e.disableRebufferTracking||t&&((0,s.default)(e.data,"view_waiting_rebuffer_duration",a.default.now()-t),t=!1,window.clearInterval(r))},o=!1,l=function(){o=!0},u=function(){o=!1,n()};this.on("waiting",(function(){o&&i()})),this.on("playing",(function(){n(),l()})),this.on("pause",u),this.on("seeking",u)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(r(3)),s=i(r(2))},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(){var e=this;this.one("playbackheartbeat",o),this.on("playbackheartbeatend",(function(){e.off("before*",l),e.one("playbackheartbeat",o)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(r(1)),s=i(r(3)),o=function(){this.lastWallClockTime=s.default.now(),this.on("before*",l)},l=function(e){var t=s.default.now(),r=this.lastWallClockTime;this.lastWallClockTime=t,t-r>3e4&&(this.emit("devicesleep",{viewer_time:r}),(0,a.default)(this.data,{viewer_time:r}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:t}),(0,a.default)(this.data,{viewer_time:t}),this.send("devicewake"))}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(r(0)),s=r(41),o=i(r(4)),l=i(r(45)),u=i(r(10)),c=i(r(46)),d=i(r(15)),h=i(r(47)),f=i(r(1)),p=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],v=["viewstart","error","ended","viewend"],g=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.mux=e,this.envKey=t,this.eventQueue=new h.default((0,l.default)(t,r.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=r.sampleRate,this.disableCookies=r.disableCookies,this.respectDoNotTrack=r.respectDoNotTrack;var i=r.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:i.name,viewer_application_version:i.version,viewer_application_engine:i.layout,viewer_device_name:i.product,viewer_device_category:"",viewer_device_manufacturer:i.manufacturer,viewer_os_family:i.os&&i.os.family,viewer_os_architecture:i.os&&i.os.architecture,viewer_os_version:i.os&&i.os.version};var n=(0,c.default)();n&&(this.pageLevelData=(0,f.default)(this.pageLevelData,{viewer_connection_type:n})),void 0!==a.default&&a.default.location&&a.default.location.href&&(this.pageLevelData.page_url=a.default.location.href),this.viewerData=this.disableCookies?{}:(0,s.getAndUpdateViewerData)()};g.prototype.send=function(e,t){if(e){if(this.respectDoNotTrack&&(0,u.default)())return o.default.info("Not sending `"+e+"` because Do Not Track is enabled");if(!t||"object"!==(void 0===t?"undefined":n(t)))return o.default.error("A data object was expected in send() but was not provided");var r=this.disableCookies?{}:(0,s.getAndUpdateSessionData)(),i={};(0,f.default)(i,this.pageLevelData),(0,f.default)(i,t),(0,f.default)(i,r),(0,f.default)(i,this.viewerData),i.event=e,i.env_key=this.envKey,i.user_id&&(i.viewer_user_id=i.user_id,delete i.user_id);var a=i.mux_sample_number>=this.sampleRate,l=this._deduplicateBeaconData(e,i),c=(0,d.default)(l);if(this.lastEventTime=this.mux.utils.now(),a)return o.default.info("Not sending event due to sample rate restriction",e,i,c);if(!this.envKey)return o.default.info("Not sending event due to missing environment key",e,i,c);if(!this.rateLimited)if(o.default.info("Sending event",e,i,c),this.rateLimited=!this.eventQueue.queueEvent(e,c),this.mux.WINDOW_UNLOADING&&"viewend"===e)this.eventQueue.destroy(!0);else if(v.indexOf(e)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return i.event="eventrateexceeded",c=(0,d.default)(i),this.eventQueue.queueEvent(i.event,c),o.default.error("Beaconing disabled due to rate limit.")}},g.prototype.destroy=function(){this.eventQueue.destroy(!1)};var m=function(e,t,r,i){return!(!e||0!==t.indexOf("request_")||"request_response_headers"!==t&&"object"===(void 0===r?"undefined":n(r))&&"object"===(void 0===i?"undefined":n(i))&&Object.keys(r||{}).length===Object.keys(i||{}).length)},y=function(e,t){return"renditionchange"===e&&0===t.indexOf("video_source_")};g.prototype._deduplicateBeaconData=function(e,t){var r=this,i={},n=t.view_id;if(!n||"viewstart"===e||"viewend"===e||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)i=(0,f.default)({},t),n&&(this.previousBeaconData=i),n&&"viewend"===e&&(this.previousBeaconData=null);else{var a=0===e.indexOf("request");Object.keys(t).forEach((function(n){var s=t[n];(s!==r.previousBeaconData[n]||p.indexOf(n)>-1||m(a,n,s,r.previousBeaconData[n])||y(e,n))&&(i[n]=s,r.previousBeaconData[n]=s)}))}return i},t.default=g},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateSessionData=t.getAndUpdateViewerData=void 0;var n=i(r(12)),a=i(r(44)),s=r(7),o=i(r(3)),l=function(){var e=void 0;try{e=n.default.parse(a.default.get("muxData")||"")}catch(t){e={}}return e},u=function(e){try{a.default.set("muxData",n.default.stringify(e),{expires:7300})}catch(t){}},c=function(){var e=l();return e.mux_viewer_id=e.mux_viewer_id||(0,s.generateUUID)(),e.msn=e.msn||Math.random(),u(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},d=function(){var e=l(),t=o.default.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=(0,s.generateUUID)(),e.sst=t),e.sex=t+15e5,u(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}};t.getAndUpdateViewerData=c,t.getAndUpdateSessionData=d},function(e,t,r){"use strict";var i=r(13),n=r(14),a={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Date.prototype.toISOString,o={delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,serializeDate:function(e){return s.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(t,r,n,a,s,l,u,c,d,h,f,p){var v=t;if("function"==typeof u)v=u(r,v);else if(v instanceof Date)v=h(v);else if(null===v){if(a)return l&&!p?l(r,o.encoder):r;v=""}if("string"==typeof v||"number"==typeof v||"boolean"==typeof v||i.isBuffer(v))return l?[f(p?r:l(r,o.encoder))+"="+f(l(v,o.encoder))]:[f(r)+"="+f(String(v))];var g,m=[];if(void 0===v)return m;if(Array.isArray(u))g=u;else{var y=Object.keys(v);g=c?y.sort(c):y}for(var _=0;_<g.length;++_){var T=g[_];s&&null===v[T]||(m=Array.isArray(v)?m.concat(e(v[T],n(r,T),n,a,s,l,u,c,d,h,f,p)):m.concat(e(v[T],r+(d?"."+T:"["+T+"]"),n,a,s,l,u,c,d,h,f,p)))}return m};e.exports=function(e,t){var r=e,s=t?i.assign({},t):{};if(null!==s.encoder&&void 0!==s.encoder&&"function"!=typeof s.encoder)throw new TypeError("Encoder has to be a function.");var u=void 0===s.delimiter?o.delimiter:s.delimiter,c="boolean"==typeof s.strictNullHandling?s.strictNullHandling:o.strictNullHandling,d="boolean"==typeof s.skipNulls?s.skipNulls:o.skipNulls,h="boolean"==typeof s.encode?s.encode:o.encode,f="function"==typeof s.encoder?s.encoder:o.encoder,p="function"==typeof s.sort?s.sort:null,v=void 0!==s.allowDots&&s.allowDots,g="function"==typeof s.serializeDate?s.serializeDate:o.serializeDate,m="boolean"==typeof s.encodeValuesOnly?s.encodeValuesOnly:o.encodeValuesOnly;if(void 0===s.format)s.format=n.default;else if(!Object.prototype.hasOwnProperty.call(n.formatters,s.format))throw new TypeError("Unknown format option provided.");var y,_,T=n.formatters[s.format];"function"==typeof s.filter?r=(_=s.filter)("",r):Array.isArray(s.filter)&&(y=_=s.filter);var b,E=[];if("object"!=typeof r||null===r)return"";b=s.arrayFormat in a?s.arrayFormat:"indices"in s?s.indices?"indices":"repeat":"indices";var S=a[b];y||(y=Object.keys(r)),p&&y.sort(p);for(var k=0;k<y.length;++k){var C=y[k];d&&null===r[C]||(E=E.concat(l(r[C],C,S,c,d,h?f:null,_,p,v,g,T,m)))}var w=E.join(u),A=!0===s.addQueryPrefix?"?":"";return w.length>0?A+w:""}},function(e,t,r){"use strict";var i=r(13),n=Object.prototype.hasOwnProperty,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:i.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},s=function(e,t){for(var r={},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,s=t.parameterLimit===1/0?void 0:t.parameterLimit,o=i.split(t.delimiter,s),l=0;l<o.length;++l){var u,c,d=o[l],h=d.indexOf("]="),f=-1===h?d.indexOf("="):h+1;-1===f?(u=t.decoder(d,a.decoder),c=t.strictNullHandling?null:""):(u=t.decoder(d.slice(0,f),a.decoder),c=t.decoder(d.slice(f+1),a.decoder)),n.call(r,u)?r[u]=[].concat(r[u]).concat(c):r[u]=c}return r},o=function(e,t,r){for(var i=t,n=e.length-1;n>=0;--n){var a,s=e[n];if("[]"===s)a=(a=[]).concat(i);else{a=r.plainObjects?Object.create(null):{};var o="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(o,10);!isNaN(l)&&s!==o&&String(l)===o&&l>=0&&r.parseArrays&&l<=r.arrayLimit?(a=[])[l]=i:a[o]=i}i=a}return i},l=function(e,t,r){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(i),l=s?i.slice(0,s.index):i,u=[];if(l){if(!r.plainObjects&&n.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var c=0;null!==(s=a.exec(i))&&c<r.depth;){if(c+=1,!r.plainObjects&&n.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+i.slice(s.index)+"]"),o(u,t,r)}};e.exports=function(e,t){var r=t?i.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||i.isRegExp(r.delimiter)?r.delimiter:a.delimiter,r.depth="number"==typeof r.depth?r.depth:a.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:a.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:a.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:a.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:a.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:a.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:a.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:a.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof e?s(e,r):e,o=r.plainObjects?Object.create(null):{},u=Object.keys(n),c=0;c<u.length;++c){var d=u[c],h=l(d,n[d],r);o=i.merge(o,h,r)}return i.compact(o)}},function(e,t,r){"use strict";var i,n,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s){var o=!1;if(void 0!==(n="function"==typeof(i=s)?i.call(t,r,t,e):i)&&(e.exports=n),o=!0,"object"===a(t)&&(e.exports=s(),o=!0),!o){var l=window.Cookies,u=window.Cookies=s();u.noConflict=function(){return window.Cookies=l,u}}}((function(){function e(r){function i(e,n,a){var s;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(a=t({path:"/"},i.defaults,a)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*a.expires),a.expires=o}try{s=JSON.stringify(n),/^[\{\[]/.test(s)&&(n=s)}catch(p){}return n=r.write?r.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[e,"=",n,a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}e||(s={});for(var l=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,c=0;c<l.length;c++){var d=l[c].split("="),h=d.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{var f=d[0].replace(u,decodeURIComponent);if(h=r.read?r.read(h,f):r(h,f)||h.replace(u,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(p){}if(e===f){s=h;break}e||(s[f]=h)}catch(p){}}return s}}return i.set=i,i.get=function(e){return i.call(i,e)},i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(e,r){i(e,"",t(r,{expires:-1}))},i.withConverter=e,i}var t=function(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t};return e((function(){}))}))},function(e,t,r){"use strict";function i(e,t){return t=t||"litix.io",(e=e||"").match(/^[a-z0-9]+$/)?"https://"+e+"."+t:"https://img.litix.io/a.gif"}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r(0),a=(i=n)&&i.__esModule?i:{default:i},s=function(){var e=void 0;switch(o()){case"cellular":e="cellular";break;case"ethernet":e="wired";break;case"wifi":e="wifi";break;case void 0:break;default:e="other"}return e},o=function(){var e=a.default.navigator,t=e&&(e.connection||e.mozConnection||e.webkitConnection);return t&&t.type};t.default=s},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(0)),a=i(r(4)),s=i(r(48)),o=i(r(1)),l=i(r(15)),u=!!n.default.XMLHttpRequest&&"withCredentials"in new n.default.XMLHttpRequest,c={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},d=function(e,t){this._beaconUrl=e||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,o.default)({},c,t)};d.prototype.queueEvent=function(e,t){var r=(0,o.default)({},t);return u?(this._eventQueue.length<=this._options.maxQueueLength||"eventrateexceeded"===e)&&(this._eventQueue.push(r),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(s.default.send(this._beaconUrl,r),!0)},d.prototype.flushEvents=function(){u&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},d.prototype.destroy=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.destroyed=!0,e?this._clearBeaconQueue():this.flushEvents(),n.default.clearTimeout(this._sendTimeout)},d.prototype._clearBeaconQueue=function(){var e=n.default.navigator,t=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,r=this._eventQueue.slice(t);if(t>0&&(0,o.default)(r[r.length-1],(0,l.default)({mux_view_message:"event queue truncated"})),e.sendBeacon)e.sendBeacon(this._beaconUrl,JSON.stringify({events:r}));else if(n.default.XMLHttpRequest){var i=new n.default.XMLHttpRequest;i.open("POST",this._beaconUrl),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify({events:r}))}else s.default.send(this._beaconUrl,r[r.length-1])},d.prototype._sendBeaconQueue=function(){var e=this;if(n.default.XMLHttpRequest&&!this._postInFlight){var t=new n.default.XMLHttpRequest,r=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?(e._eventQueue=r.concat(e._eventQueue),e._failureCount+=1,a.default.info("Error sending beacon: "+t.status),a.default.info(t.responseText)):e._failureCount=0,e._postInFlight=!1)},t.open("POST",this._beaconUrl),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify({events:r}))}},d.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var e=Math.pow(2,this._failureCount-1);return(1+(e*=Math.random()))*this._options.baseTimeBetweenBeacons},d.prototype._startBeaconSending=function(){var e=this;n.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=n.default.setTimeout((function(){e._eventQueue.length&&e._sendBeaconQueue(),e._startBeaconSending()}),this._getNextBeaconTime()))},t.default=d},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(12)),a=i(r(0)),s={send:function(e,t){function r(){i.src=o+(s?"&rc="+s:"")}var i=new Image,s=0,o=e+"?"+n.default.stringify(t);return i.addEventListener("error",(function(){s>3||a.default.setTimeout((function(){s++,r()}),5e3*s)})),r(),i}};t.default=s},function(e,t,r){"use strict";function i(){function e(e,t){var r=t.request_start,l=t.request_response_start,u=t.request_response_end,c=t.request_bytes_loaded;s++;var d=void 0,h=void 0;if(l?(d=l-r,h=u-l):h=u-r,h>0&&c>0){var f=c/h*8e3;o++,n+=c,a+=h,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,f),this.data.view_average_request_throughput=n/a*8e3,this.data.view_request_count=s,d>0&&(i+=d,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,d),this.data.view_average_request_latency=i/o)}}function t(e,t){s++,l++,this.data.view_request_count=s,this.data.view_request_failed_count=l}function r(e,t){s++,u++,this.data.view_request_count=s,this.data.view_request_canceled_count=u}var i=0,n=0,a=0,s=0,o=0,l=0,u=0;this.on("requestcompleted",e),this.on("requestfailed",t),this.on("requestcanceled",r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";function i(e,t,r){var i=(0,u.findMediaElement)(t),s=a(i,3),o=s[0],h=s[1],f=s[2],p=e.log,v=e.utils.getComputedStyle,g=e.utils.secondsToMs,m={automaticErrorTracking:!0};if(!o)return p.error("No element was found with the `"+h+"` query selector.");if("video"!==f&&"audio"!==f)return p.error("The element of `"+h+"` was not a media element.");(r=(0,l.default)(m,r)).data=(0,l.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.2.0"},r.data),r.getPlayheadTime=function(){return g(o.currentTime)},r.getStateData=function(){var e=this.hlsjs&&this.hlsjs.url,t=this.dashjs&&n("function"===this.dashjs.getSource)&&this.dashjs.getSource();return{player_is_paused:o.paused,player_playhead_time:g(o.currentTime),player_width:parseInt(v(o,"width")),player_height:parseInt(v(o,"height")),player_autoplay_on:o.autoplay,player_preload_on:o.preload,video_poster_url:o.poster,video_source_url:e||t||o.currentSrc,video_source_duration:g(o.duration),video_source_height:o.videoHeight,video_source_width:o.videoWidth}},o.mux=o.mux||{},o.mux.deleted=!1,o.mux.emit=function(t,r){e.emit(h,t,r)};var y=function(){p.error("The monitor for this video element has already been destroyed.")};o.mux.destroy=function(){Object.keys(o.mux.listeners).forEach((function(e){o.removeEventListener(e,o.mux.listeners[e],!1)})),delete o.mux.listeners,o.mux.destroy=y,o.mux.swapElement=y,o.mux.emit=y,o.mux.addHLSJS=y,o.mux.addDashJS=y,o.mux.removeHLSJS=y,o.mux.removeDashJS=y,o.mux.deleted=!0,e.emit(h,"destroy")},o.mux.swapElement=function(t){var r=(0,u.findMediaElement)(t),i=a(r,3),n=i[0],s=i[1],c=i[2];return n?"video"!==c&&"audio"!==c?e.log.error("The element of `"+s+"` was not a media element."):(n.muxId=o.muxId,delete o.muxId,n.mux=n.mux||{},n.mux.listeners=(0,l.default)({},o.mux.listeners),delete o.mux.listeners,Object.keys(n.mux.listeners).forEach((function(e){o.removeEventListener(e,n.mux.listeners[e],!1),n.addEventListener(e,n.mux.listeners[e],!1)})),n.mux.swapElement=o.mux.swapElement,n.mux.destroy=o.mux.destroy,delete o.mux,void(o=n)):e.log.error("No element was found with the `"+s+"` query selector.")},o.mux.addHLSJS=function(t){e.addHLSJS(h,t)},o.mux.addDashJS=function(t){e.addDashJS(h,t)},o.mux.removeHLSJS=function(){e.removeHLSJS(h)},o.mux.removeDashJS=function(){e.removeDashJS(h)},e.init(h,r),e.emit(h,"playerready"),o.paused||(e.emit(h,"play"),o.readyState>2&&e.emit(h,"playing")),o.mux.listeners={},c.forEach((function(t){("error"!==t||r.automaticErrorTracking)&&(o.mux.listeners[t]=function(){var r={};"error"===t&&(r.player_error_code=o.error&&o.error.code,r.player_error_message=o.error&&d[o.error.code]),e.emit(h,t,r)},o.addEventListener(t,o.mux.listeners[t],!1))}))}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=i;var s,o=r(1),l=(s=o)&&s.__esModule?s:{default:s},u=r(9),c=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],d={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(52)),a=i(r(2)),s=i(r(53)),o=i(r(54)),l=i(r(1)),u=i(r(8)),c=r(5),d=i(r(3)),h={};h.safeCall=n.default,h.safeIncrement=a.default,h.getComputedStyle=s.default,h.secondsToMs=o.default,h.assign=l.default,h.headersStringToObject=u.default,h.extractHostnameAndDomain=c.extractHostnameAndDomain,h.extractHostname=c.extractHostname,h.now=d.default.now,t.default=h},function(e,t,r){"use strict";function i(e,t,r,i){var n=i;if(e&&"function"==typeof e[t])try{n=e[t].apply(e,r)}catch(a){s.default.info("safeCall error",a)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(4),s=(n=a)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";function i(e,t){if(e&&t&&s.default&&"function"==typeof s.default.getComputedStyle){var r=void 0;return o&&o.has(e)&&(r=o.get(e)),r||(r=s.default.getComputedStyle(e,null),o&&o.set(e,r)),r.getPropertyValue(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(0),s=(n=a)&&n.__esModule?n:{default:n},o=void 0;s.default&&s.default.WeakMap&&(o=new WeakMap)},function(e,t,r){"use strict";function i(e){return Math.floor(1e3*e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i}])},e.exports=t()}()},function(e,t,r){"use strict";function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return{}},a=!1;e.on("adstart",(function(){a=!0})),e.on("adend",(function(){a=!1})),e.on("adserror",(function(){a=!1}));var l=function(){var i=o(t.currentTime()),l=function r(){var l=s.default.utils.now(),u=o(t.currentTime());if(a){if(u>i){var c=n();c.viewer_time=l-Math.max(0,u-i),t.off("timeupdate",r),e.mux.emit("adplaying",c)}}else t.off("timeupdate",r)};t.on("timeupdate",l);var u=function e(){t.off("timeupdate",l),r.forEach((function(r){t.off(r,e)}))};r.forEach((function(e){t.on(e,u)}))};i.forEach((function(e){t.on(e,l)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(0),s=(n=a)&&n.__esModule?n:{default:n},o=s.default.utils.secondsToMs},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){if(a.default.IS_IE8)return!1;var t=this,r=t.id();(e=p({automaticErrorTracking:!0},e)).data=p({player_software_name:"Video.js",player_software_version:a.default.VERSION||"< 4.11",player_mux_plugin_name:"videojs-mux",player_mux_plugin_version:"4.2.0"},e.data),e.getPlayheadTime=function(){return m(t.currentTime())},e.getStateData=function(){var e=v(t,"videoHeight"),r=v(t,"videoWidth");if(void 0===r||void 0===e){var i=t.el().firstChild;i&&"VIDEO"===i.nodeName.toUpperCase()&&(e=i.videoHeight,r=i.videoWidth)}return{player_is_paused:v(t,"paused"),player_is_fullscreen:v(t,"isFullscreen"),player_autoplay_on:!!v(t,"autoplay"),player_preload_on:v(t,"preload"),player_width:g(t.el(),"width"),player_height:g(t.el(),"height"),player_language_code:v(t,"language"),video_poster_url:v(t,"poster"),video_source_url:v(t,"currentSrc"),video_source_mime_type:v(t,"currentType")&&v(t,"currentType").toLowerCase(),video_source_duration:m(v(t,"duration")||0),video_source_height:e,video_source_width:r}},t.mux=function(){f.error("[videojs-mux] The plugin was initialized more than once.")},t.mux.emit=function(e,t){s.default.emit(r,e,t)},t.mux.addHLSJS=function(e){s.default.addHLSJS(r,e)},t.mux.log=f,t.mux.utils=s.default.utils,s.default.init(r,e);var i=!1,n=function(){i||t.mux.emit("playerready"),i=!0};t.ready((function(){t.addClass("vjs-mux"),o.default.setTimeout(n,0)}));var h=!1;t.one("play",n),y.forEach((function(r){("error"!==r||e.automaticErrorTracking)&&t.on(r,(function(){if(!h){var e={};if("error"===r){var i=v(t,"error");e.player_error_code=i&&i.code,e.player_error_message=i&&i.message}t.mux.emit(r,e)}}))}));var _=!1;t.on("play",(function(){_=!0})),t.on("pause",(function(){_=!1})),t.on("adstart",(function(){h=!0,_&&t.mux.emit("pause"),t.mux.emit("adbreakstart")})),t.on("adend",(function(){t.mux.emit("adbreakend"),h=!1,v(t,"paused")||(t.mux.emit("play"),_=!0,t.onceux&&t.mux.emit("playing"))})),t.ima&&(0,l.default)(t),t.onceux&&(0,d.default)(t),t.ima3&&"function"==typeof t.ima3.ready&&(0,u.default)(t),t.FreeWheelPlugin&&t.FreeWheelPlugin.VERSION&&(0,c.default)(t),t.on("dispose",(function(){t.mux.emit("destroy")}))}var a=i(r(3)),s=i(r(0)),o=i(r(4)),l=i(r(6)),u=i(r(7)),c=i(r(8)),d=i(r(9)),h=i(r(10)),f=s.default.log,p=s.default.utils.assign,v=s.default.utils.safeCall,g=s.default.utils.getComputedStyle,m=s.default.utils.secondsToMs,y=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"];(a.default.registerPlugin||a.default.plugin||function(){s.default.log.error("No valid method to register videojs plugin available.")})("mux",n),(0,h.default)(a.default)},function(t,r){t.exports=e},function(e,t,r){(function(t){var r;r="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},e.exports=r}).call(t,r(5))},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(i){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function i(e){var t=function(t){var r="function"==typeof(t=t||{}).getAdData?t.getAdData():{},i="function"==typeof t.getAd?t.getAd():{},n="function"==typeof i.getMediaUrl?i.getMediaUrl():r.mediaUrl,a=e.ima.settings||{},s={};return n&&(s.ad_asset_url=n),a.adTagUrl&&(s.ad_tag_url=a.adTagUrl),s},r=void 0,i=void 0,n=void 0,a=void 0,s=void 0,o=void 0;try{var l=window.google.ima.AdEvent.Type;r=l.LOADED,i=l.STARTED,n=l.COMPLETE,a=l.PAUSED,s=l.RESUMED,o=l.SKIPPED}catch(c){r="loaded",i="start",n="complete",a="pause",s="resume",o="skip"}var u=0;e.mux.triggerAdRequest=function(){u++,e.mux.emit("adrequest",t())},e.on("adsready",(function(){var l=e.ima.addEventListener||function(){};l(r,(function(r){var i=t(r);u>0&&(u--,e.mux.emit("adresponse",i)),e.mux.emit("adplay",i)})),l(i,(function(r){var i=t(r);e.mux.emit("adplaying",i)})),l(s,(function(r){var i=t(r);e.mux.emit("adplay",i),e.mux.emit("adplaying",i)})),l(a,(function(r){var i=t(r);e.mux.emit("adpause",i)})),l(n,(function(r){var i=t(r);e.mux.emit("adended",i)})),l(o,(function(r){var i=t(r);e.mux.emit("adended",i)})),e.on("adserror",(function(){u>0&&(u--,e.mux.emit("adresponse")),e.mux.emit("aderror")}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";function i(e){if("string"!=typeof e)return!1;var t=e.split(".").map((function(e){return parseInt(e)})),r=t[0],i=t[1];return r>2||2===r&&i>=3}function n(e){var t=function(){var t=e.ima3.currentAd,r=e.ima3.settings,i={};return t&&(i.ad_asset_url=t.mediaUrl),r&&(i.ad_tag_url=r.serverUrl),i};if(i(e.ima3.version)){var r=0,n=function(){r>0&&(r--,e.mux.emit("adresponse",t()))};e.on("ads-request",(function(){r++,e.mux.emit("adrequest",t())})),e.on("ads-load",(function(){n(),e.mux.emit("adplay",t())})),e.on("adserror",(function(){n(),e.mux.emit("aderror")})),e.on("ads-play",(function(){e.mux.emit("adplay",t())})),e.on("ads-pause",(function(){e.mux.emit("adpause",t())})),e.on("ads-ad-ended",(function(){e.mux.emit("adended",t())}))}e.ima3.ready((function(){if(e.ima3.adPlayer){i(e.ima3.version)||(e.ima3.adPlayer.on("play",(function(){e.mux.emit("adplay")})),e.ima3.adPlayer.on("pause",(function(){e.mux.emit("adpause")})),e.ima3.adPlayer.on("ended",(function(){e.mux.emit("adended")})));var r=["pause","ended","adserror"],n=["play"];(0,o.default)(e,e.ima3.adPlayer,r,n,t)}else e.mux.log("Legacy IMA3 plugin found, ad events may not track correctly."),e.on("ads-ad-started",(function(){e.mux.emit("adplaying",t())})),e.on("ads-play",(function(){e.mux.emit("adplaying",t())}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.brightcoveImaAdsEventsSupported=i,t.default=n;var a,s=r(1),o=(a=s)&&a.__esModule?a:{default:a}},function(e,t,r){"use strict";function i(e){var t=function(t){var r=e.FreeWheelPlugin,i={};switch(t){case"adplay":case"adplaying":case"adpause":i.ad_asset_url=e.currentSrc()}return r&&(i.ad_tag_url="html5"===r.tech.toLowerCase()?r.settings.Html5.serverUrl:r.settings.Flash.serverUrl),i};e.on("ads-request",(function(){e.mux.emit("adrequest",t("adrequest"))})),e.on("ads-load",(function(){e.mux.emit("adresponse",t("adresponse"))})),e.on("adserror",(function(){e.mux.emit("aderror")})),e.on("ads-ad-started",(function(){e.mux.emit("adplay",t("adplay")),e.mux.emit("adplaying",t("adplaying"))})),e.on("ads-play",(function(){e.mux.emit("adplay",t("adplay")),e.mux.emit("adplaying",t("adplaying"))})),e.on("ads-pause",(function(){e.mux.emit("adpause",t("adpause"))})),e.on("ads-ad-ended",(function(){e.mux.emit("adended",t("adended"))})),e.on("adend",(function(){e.mux.emit("play")}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,r){"use strict";function i(e){var t=["onceux-linearad-pause","onceux-linearad-skipped","onceux-linearad-complete","adserror"],r=["adstart","onceux-linearad-resume"];(0,s.default)(e,e,t,r),e.on("adstart",(function(){e.mux.emit("adplay")})),e.on("onceux-linearad-start",(function(t){t.linearAd&&t.linearAd.index>0&&(e.mux.emit("adplay"),e.mux.emit("adplaying"))})),e.on("onceux-linearad-resume",(function(){e.mux.emit("adplay")})),e.on("onceux-linearad-pause",(function(){e.mux.emit("adpause")})),e.on("onceux-linearad-complete",(function(){e.mux.emit("adended")})),e.on("onceux-linearad-skipped",(function(){e.mux.emit("adended")}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n,a=r(1),s=(n=a)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";function i(e){if(!u&&"function"==typeof e.getTech){for(var t=(e.getTech("Html5")||{}).sourceHandlers,r=0;r<t.length;r++)!function(r){var i=t[r],a=i.handleSource;i.handleSource=function(t,r){var i=a(t,r,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(i&&"function"==typeof i.xhr)try{var s=e.VERSION.split("."),u=n(s,2),c=u[0],d=u[1];c=parseInt(c),d=parseInt(d);var h=c>=7&&d>=4?i.player().id():i.player_.el_.parentNode.id;(0,o.default)(e(h),i.xhr),(0,l.trackRenditionChanges)(e(h))}catch(f){}return i}}(r);u=!0}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=i;var a,s=r(11),o=(a=s)&&a.__esModule?a:{default:a},l=r(13),u=!1},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){var r,i=function(t,r,i){var n=(0,a.default)(e,t,r);return function(){try{n()}catch(e){}try{i()}catch(e){}}},n=function(e){return function(t){var r=s.default.utils.now();try{e(t)}catch(n){}try{t.onreadystatechange=i(t,r,t.onreadystatechange||function(){})}catch(n){}}};t.beforeRequest=(r=t.beforeRequest||function(e){return e},function(e){var t=r(e);return t.beforeSend=n(t.beforeSend||function(){}),t})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var a=i(r(12)),s=i(r(0))},function(e,t,r){"use strict";function i(e,t,r){var i=e.mux.utils.extractHostnameAndDomain,a=e.mux.utils.headersStringToObject,s=function(e){var t=e["content-type"];return t?t.match(/^audio\/mpegurl/i)?"manifest":t.match(/^audio.*/i)?"audio":t.match(/^video.*/)?"video":t.match(/^application\/x-mpegurl/i)||t.match(/^application\/vnd.apple.mpegurl/i)||t.match(/^application\/dash+xml/i)?"manifest":"unknown":"unknown"},l=0;return function(){var u=t.readyState;if(u>=2){if(l=l||o.default.utils.now(),4!==u)return;if(t.status>=200&&t.status<300){var c=o.default.utils.now(),d="arraybuffer"===t.responseType?t.response.byteLength:t.responseText.length,h=i(t.responseURL),f=n(h,1)[0],p=a(t.getAllResponseHeaders?t.getAllResponseHeaders():""),v=s(p),g={request_start:r,request_response_start:l,request_response_end:c,request_bytes_loaded:d,request_hostname:f,request_response_headers:p,request_type:v};e.mux.emit("requestcompleted",g)}else e.mux.emit("requestfailed")}}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],i=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){n=!0,a=l}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.default=i;var a,s=r(0),o=(a=s)&&a.__esModule?a:{default:a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){for(var t=e.textTracks(),r=void 0,i=0;i<t.length;i++)"segment-metadata"===t[i].label&&(r=t[i]);return r},n=function(e){var t=i(e),r=void 0;t&&t.on&&t.on("cuechange",(function(){try{var t=e.tech({IWillNotUseThisInPlugins:!0}),i=(t.vhs||t.hls).playlists.media().attributes.BANDWIDTH;r!==i&&e.mux.emit("renditionchange",{video_source_bitrate:i}),r=i}catch(n){e.mux&&e.mux.log&&e.mux.log.warn&&e.mux.log.warn("Cannot retrieve BANDWIDTH information from player: "+n)}}))};t.getSegmentMetadataTrack=i,t.trackRenditionChanges=n}])},e.exports=t(r(207))}()},497:(e,t,r)=>{var i=r(697),n=e.exports={WebVTT:r(13),VTTCue:r(190),VTTRegion:r(146)};i.vttjs=n,i.WebVTT=n.WebVTT;var a=n.VTTCue,s=n.VTTRegion,o=i.VTTCue,l=i.VTTRegion;n.shim=function(){i.VTTCue=a,i.VTTRegion=s},n.restore=function(){i.VTTCue=o,i.VTTRegion=l},i.VTTCue||n.shim()},13:(e,t,r)=>{var i=r(675),n=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function a(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function s(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}var r=e.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}function o(){this.values=n(null)}function l(e,t,r,i){var n=i?e.split(i):[e];for(var a in n)if("string"==typeof n[a]){var s=n[a].split(r);2===s.length&&t(s[0],s[1])}}function u(e,t,r){var i=e;function n(){var t=s(e);if(null===t)throw new a(a.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function u(e,t){var i=new o;l(e,(function(e,t){switch(e){case"region":for(var n=r.length-1;n>=0;n--)if(r[n].id===t){i.set(e,r[n].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];i.integer(e,s),i.percent(e,s)&&i.set("snapToLines",!1),i.alt(e,s,["auto"]),2===a.length&&i.alt("lineAlign",a[1],["start","center","end"]);break;case"position":a=t.split(","),i.percent(e,a[0]),2===a.length&&i.alt("positionAlign",a[1],["start","center","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","center","end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");try{t.line=i.get("line","auto")}catch(n){}t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100);try{t.align=i.get("align","center")}catch(n){t.align=i.get("align","middle")}try{t.position=i.get("position","auto")}catch(n){t.position=i.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},t.align)}t.positionAlign=i.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},t.align)}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=n(),c(),"--\x3e"!==e.substr(0,3))throw new a(a.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),c(),t.endTime=n(),c(),u(e,t)}a.prototype=n(Error.prototype),a.prototype.constructor=a,a.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},o.prototype={set:function(e,t){!this.get(e)&&""!==t&&(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t),t>=0&&t<=100))&&(this.set(e,t),!0)}};var c=i.createElement&&i.createElement("textarea"),d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},h={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},f={v:"title",lang:"lang"},p={rt:"ruby"};function v(e,t){function r(){if(!t)return null;function e(e){return t=t.substr(e.length),e}var r=t.match(/^([^<]*)(<[^>]*>?)?/);return e(r[1]?r[1]:r[2])}function i(e){return c.innerHTML=e,e=c.textContent,c.textContent="",e}function n(e,t){return!p[t.localName]||p[t.localName]===e.localName}function a(t,r){var i=d[t];if(!i)return null;var n=e.document.createElement(i),a=f[t];return a&&r&&(n[a]=r.trim()),n}for(var o,l=e.document.createElement("div"),u=l,v=[];null!==(o=r());)if("<"!==o[0])u.appendChild(e.document.createTextNode(i(o)));else{if("/"===o[1]){v.length&&v[v.length-1]===o.substr(2).replace(">","")&&(v.pop(),u=u.parentNode);continue}var g,m=s(o.substr(1,o.length-2));if(m){g=e.document.createProcessingInstruction("timestamp",m),u.appendChild(g);continue}var y=o.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y||!(g=a(y[1],y[3]))||!n(u,g))continue;if(y[2]){var _=y[2].split(".");_.forEach((function(e){var t=/^bg_/.test(e),r=t?e.slice(3):e;if(h.hasOwnProperty(r)){var i=t?"background-color":"color",n=h[r];g.style[i]=n}})),g.className=_.join(" ")}v.push(y[1]),u.appendChild(g),u=g}return l}var g=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function m(e){for(var t=0;t<g.length;t++){var r=g[t];if(e>=r[0]&&e<=r[1])return!0}return!1}function y(e){var t=[],r="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var r=t.childNodes.length-1;r>=0;r--)e.push(t.childNodes[r])}function n(e){if(!e||!e.length)return null;var t=e.pop(),r=t.textContent||t.innerText;if(r){var a=r.match(/^.*(\n|\r)/);return a?(e.length=0,a[0]):r}return"ruby"===t.tagName?n(e):t.childNodes?(i(e,t),n(e)):void 0}for(i(t,e);r=n(t);)for(var a=0;a<r.length;a++)if(m(r.charCodeAt(a)))return"rtl";return"ltr"}function _(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,r=t.textTrackList,i=0,n=0;n<r.length&&r[n]!==t;n++)"showing"===r[n].mode&&i++;return-1*++i}function T(){}function b(e,t,r){T.call(this),this.cue=t,this.cueDiv=v(e,t.text);var i={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(i,this.cueDiv),this.div=e.document.createElement("div"),i={direction:y(this.cueDiv),writingMode:""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===t.align?"center":t.align,font:r.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(i),this.div.appendChild(this.cueDiv);var n=0;switch(t.positionAlign){case"start":n=t.position;break;case"center":n=t.position-t.size/2;break;case"end":n=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(n,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(n,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function E(e){var t,r,i,n;if(e.div){r=e.div.offsetHeight,i=e.div.offsetWidth,n=e.div.offsetTop;var a=(a=e.div.childNodes)&&(a=a[0])&&a.getClientRects&&a.getClientRects();e=e.div.getBoundingClientRect(),t=a?Math.max(a[0]&&a[0].height||0,e.height/a.length):0}this.left=e.left,this.right=e.right,this.top=e.top||n,this.height=e.height||r,this.bottom=e.bottom||n+(e.height||r),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight}function S(e,t,r,i){function n(e,t){for(var n,a=new E(e),s=1,o=0;o<t.length;o++){for(;e.overlapsOppositeAxis(r,t[o])||e.within(r)&&e.overlapsAny(i);)e.move(t[o]);if(e.within(r))return e;var l=e.intersectPercentage(r);s>l&&(n=new E(e),s=l),e=new E(a)}return n||a}var a=new E(t),s=t.cue,o=_(s),l=[];if(s.snapToLines){var u;switch(s.vertical){case"":l=["+y","-y"],u="height";break;case"rl":l=["+x","-x"],u="width";break;case"lr":l=["-x","+x"],u="width"}var c=a.lineHeight,d=c*Math.round(o),h=r[u]+c,f=l[0];Math.abs(d)>h&&(d=d<0?-1:1,d*=Math.ceil(h/c)*c),o<0&&(d+=""===s.vertical?r.height:r.width,l=l.reverse()),a.move(f,d)}else{var p=a.lineHeight/r.height*100;switch(s.lineAlign){case"center":o-=p/2;break;case"end":o-=p}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(o,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(o,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(o,"%")})}l=["+y","-x","+x","-y"],a=new E(t)}var v=n(a,l);t.move(v.toCSSCompatValues(r))}function k(){}T.prototype.applyStyles=function(e,t){for(var r in t=t||this.div,e)e.hasOwnProperty(r)&&(t.style[r]=e[r])},T.prototype.formatStyle=function(e,t){return 0===e?0:e+t},b.prototype=n(T.prototype),b.prototype.constructor=b,E.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},E.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},E.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},E.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},E.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},E.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},E.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},E.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,r=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||r}},k.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},k.convertCueToDOMTree=function(e,t){return e&&t?v(e,t):null};var C=.05,w="sans-serif",A="1.5%";k.processCues=function(e,t,r){if(!e||!t||!r)return null;for(;r.firstChild;)r.removeChild(r.firstChild);var i=e.document.createElement("div");function n(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin=A,r.appendChild(i),n(t)){var a=[],s=E.getSimpleBoxPosition(i),o={font:Math.round(s.height*C*100)/100+"px "+w};!function(){for(var r,n,l=0;l<t.length;l++)n=t[l],r=new b(e,n,o),i.appendChild(r.div),S(e,r,s,a),n.displayState=r.div,a.push(E.getSimpleBoxPosition(r))}()}else for(var l=0;l<t.length;l++)i.appendChild(t[l].displayState)},k.Parser=function(e,t,r){r||(r=t,t={}),t||(t={}),this.window=e,this.vttjs=t,this.state="INITIAL",this.buffer="",this.decoder=r||new TextDecoder("utf8"),this.regionList=[]},k.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof a))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function r(){for(var e=t.buffer,r=0;r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var i=e.substr(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.substr(r),i}function i(e){var r=new o;if(l(e,(function(e,t){switch(e){case"id":r.set(e,t);break;case"width":r.percent(e,t);break;case"lines":r.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var n=new o;if(n.percent("x",i[0]),n.percent("y",i[1]),!n.has("x")||!n.has("y"))break;r.set(e+"X",n.get("x")),r.set(e+"Y",n.get("y"));break;case"scroll":r.alt(e,t,["up"])}}),/=/,/\s/),r.has("id")){var i=new(t.vttjs.VTTRegion||t.window.VTTRegion);i.width=r.get("width",100),i.lines=r.get("lines",3),i.regionAnchorX=r.get("regionanchorX",0),i.regionAnchorY=r.get("regionanchorY",100),i.viewportAnchorX=r.get("viewportanchorX",0),i.viewportAnchorY=r.get("viewportanchorY",100),i.scroll=r.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:r.get("id"),region:i})}}function n(e){var r=new o;l(e,(function(e,t){switch(e){case"MPEGT":r.integer(e+"S",t);break;case"LOCA":r.set(e+"L",s(t))}}),/[^\d]:/,/,/),t.ontimestampmap&&t.ontimestampmap({MPEGTS:r.get("MPEGTS"),LOCAL:r.get("LOCAL")})}function c(e){e.match(/X-TIMESTAMP-MAP/)?l(e,(function(e,t){"X-TIMESTAMP-MAP"===e&&n(t)}),/=/):l(e,(function(e,t){"Region"===e&&i(t)}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var d;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var h=(d=r()).match(/^WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new a(a.Errors.BadSignature);t.state="HEADER"}for(var f=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(f?f=!1:d=r(),t.state){case"HEADER":/:/.test(d)?c(d):d||(t.state="ID");continue;case"NOTE":d||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){t.state="NOTE";break}if(!d)continue;t.cue=new(t.vttjs.VTTCue||t.window.VTTCue)(0,0,"");try{t.cue.align="center"}catch(v){t.cue.align="middle"}if(t.state="CUE",-1===d.indexOf("--\x3e")){t.cue.id=d;continue}case"CUE":try{u(d,t.cue,t.regionList)}catch(v){t.reportOrThrowError(v),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var p=-1!==d.indexOf("--\x3e");if(!d||p&&(f=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=d.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":d||(t.state="ID");continue}}}catch(v){t.reportOrThrowError(v),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new a(a.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.exports=k},190:e=>{var t="auto",r={"":1,lr:1,rl:1},i={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function n(e){return"string"==typeof e&&!!r[e.toLowerCase()]&&e.toLowerCase()}function a(e){return"string"==typeof e&&!!i[e.toLowerCase()]&&e.toLowerCase()}function s(e,r,i){this.hasBeenReset=!1;var s="",o=!1,l=e,u=r,c=i,d=null,h="",f=!0,p="auto",v="start",g="auto",m="auto",y=100,_="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return s},set:function(e){s=""+e}},pauseOnExit:{enumerable:!0,get:function(){return o},set:function(e){o=!!e}},startTime:{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");u=e,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return c},set:function(e){c=""+e,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return d},set:function(e){d=e,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return h},set:function(e){var t=n(e);if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");h=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return f},set:function(e){f=!!e,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return p},set:function(e){if("number"!=typeof e&&e!==t)throw new SyntaxError("Line: an invalid number or illegal string was specified.");p=e,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return v},set:function(e){var t=a(e);t?(v=t,this.hasBeenReset=!0):console.warn("lineAlign: an invalid or illegal string was specified.")}},position:{enumerable:!0,get:function(){return g},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");g=e,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return m},set:function(e){var t=a(e);t?(m=t,this.hasBeenReset=!0):console.warn("positionAlign: an invalid or illegal string was specified.")}},size:{enumerable:!0,get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");y=e,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return _},set:function(e){var t=a(e);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");_=t,this.hasBeenReset=!0}}}),this.displayState=void 0}s.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.exports=s},146:e=>{var t={"":!0,up:!0};function r(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function i(e){return"number"==typeof e&&e>=0&&e<=100}function n(){var e=100,t=3,n=0,a=100,s=0,o=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!i(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return t},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");t=e}},regionAnchorY:{enumerable:!0,get:function(){return a},set:function(e){if(!i(e))throw new Error("RegionAnchorX must be between 0 and 100.");a=e}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(e){if(!i(e))throw new Error("RegionAnchorY must be between 0 and 100.");n=e}},viewportAnchorY:{enumerable:!0,get:function(){return o},set:function(e){if(!i(e))throw new Error("ViewportAnchorY must be between 0 and 100.");o=e}},viewportAnchorX:{enumerable:!0,get:function(){return s},set:function(e){if(!i(e))throw new Error("ViewportAnchorX must be between 0 and 100.");s=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var t=r(e);!1===t?console.warn("Scroll: an invalid or illegal string was specified."):l=t}}})}e.exports=n},18:(e,t,r)=>{e.exports=r(393).default},393:(e,t,r)=>{"use strict";r.d(t,{default:()=>J});var i=r(207),n=r.n(i),a=r(675),s=r.n(a);function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var u=function e(t){var r=this;if(n().browser.IS_IE8)for(var i in r=s().createElement("custom"),e.prototype)"constructor"!==i&&(r[i]=e.prototype[i]);return r.id=t.id,r.label=r.id,r.width=t.width,r.height=t.height,r.bitrate=t.bandwidth,r.enabled_=t.enabled,Object.defineProperty(r,"enabled",{get:function(){return r.enabled_()},set:function(e){r.enabled_(e)}}),r},c=function(e){function t(){var r,i=l(l(r=e.call(this)||this));if(n().browser.IS_IE8)for(var a in i=s().createElement("custom"),t.prototype)"constructor"!==a&&(i[a]=t.prototype[a]);return i.levels_=[],i.selectedIndex_=-1,Object.defineProperty(i,"selectedIndex",{get:function(){return i.selectedIndex_}}),Object.defineProperty(i,"length",{get:function(){return i.levels_.length}}),i||l(r)}o(t,e);var r=t.prototype;return r.addQualityLevel=function(e){var t=this.getQualityLevelById(e.id);if(t)return t;var r=this.levels_.length;return t=new u(e),""+r in this||Object.defineProperty(this,r,{get:function(){return this.levels_[r]}}),this.levels_.push(t),this.trigger({qualityLevel:t,type:"addqualitylevel"}),t},r.removeQualityLevel=function(e){for(var t=null,r=0,i=this.length;r<i;r++)if(this[r]===e){t=this.levels_.splice(r,1)[0],this.selectedIndex_===r?this.selectedIndex_=-1:this.selectedIndex_>r&&this.selectedIndex_--;break}return t&&this.trigger({qualityLevel:e,type:"removequalitylevel"}),t},r.getQualityLevelById=function(e){for(var t=0,r=this.length;t<r;t++){var i=this[t];if(i.id===e)return i}return null},r.dispose=function(){this.selectedIndex_=-1,this.levels_.length=0},t}(n().EventTarget);for(var d in c.prototype.allowedEvents_={change:"change",addqualitylevel:"addqualitylevel",removequalitylevel:"removequalitylevel"},c.prototype.allowedEvents_)c.prototype["on"+d]=null;var h="2.1.0",f=n().registerPlugin||n().plugin,p=function(e,t){var r=e.qualityLevels,i=new c,n=function t(){i.dispose(),e.qualityLevels=r,e.off("dispose",t)};return e.on("dispose",n),e.qualityLevels=function(){return i},e.qualityLevels.VERSION=h,i},v=function(e){return p(this,n().mergeOptions({},e))};f("qualityLevels",v),v.VERSION=h;var g="1.1.6";function m(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var _=n().getComponent("MenuItem"),T=n().getComponent("Component"),b=function(e){function t(t,r){return r.selectable=!0,r.multiSelectable=!1,e.call(this,t,r)||this}m(t,e);var r=t.prototype;return r.handleClick=function(){var t=this.options_;console.log("Changing quality to:",t.label),e.prototype.handleClick.call(this);for(var r=this.player().qualityLevels(),i=0;i<r.length;i++)t.index==r.length||t.index==i?r[i].enabled=!0:r[i].enabled=!1},r.update=function(){var e=this.player().qualityLevels().selectedIndex;this.selected(this.options_.index==e)},t}(_);T.registerComponent("SourceMenuItem",b);var E=n().getComponent("MenuButton"),S=function(e){function t(t,r){var i;i=e.call(this,t,r)||this,E.apply(y(i),arguments);var a=i.player().qualityLevels();if(r&&r.default)if("low"==r.default)for(var s=0;s<a.length;s++)a[s].enabled=0==s;else if(r.default="high")for(s=0;s<a.length;s++)a[s].enabled=s==a.length-1;return i.player().qualityLevels().on(["change","addqualitylevel"],n().bind(y(i),i.update)),i}m(t,e);var r=t.prototype;return r.createEl=function(){return n().dom.createEl("div",{className:"vjs-http-source-selector vjs-menu-button vjs-menu-button-popup vjs-control vjs-button"})},r.buildCSSClass=function(){return E.prototype.buildCSSClass.call(this)+" vjs-icon-cog"},r.update=function(){return E.prototype.update.call(this)},r.createItems=function(){for(var e=[],t=this.player().qualityLevels(),r=[],i=0;i<t.length;i++){var n=t.length-(i+1),a=n===t.selectedIndex,s=""+n,o=n;t[n].height?(s=t[n].height+"p",o=parseInt(t[n].height,10)):t[n].bitrate&&(s=Math.floor(t[n].bitrate/1e3)+" kbps",o=parseInt(t[n].bitrate,10)),!(r.indexOf(s)>=0)&&(r.push(s),e.push(new b(this.player_,{label:s,index:n,selected:a,sortVal:o})))}return t.length>1&&e.push(new b(this.player_,{label:"Auto",index:t.length,selected:!1,sortVal:99999})),e.sort((function(e,t){return e.options_.sortVal<t.options_.sortVal?1:e.options_.sortVal>t.options_.sortVal?-1:0})),e},t}(E),k={},C=n().registerPlugin||n().plugin,w=function(e,t){if(e.addClass("vjs-http-source-selector"),console.log("videojs-http-source-selector initialized!"),console.log("player.techName_:"+e.techName_),"Html5"!=e.techName_)return!1;e.on(["loadedmetadata"],(function(t){if(e.qualityLevels(),n().log("loadmetadata event"),"undefined"==e.videojs_http_source_selector_initialized||1==e.videojs_http_source_selector_initialized)console.log("player.videojs_http_source_selector_initialized == true");else{console.log("player.videojs_http_source_selector_initialized == false"),e.videojs_http_source_selector_initialized=!0;var r=e.controlBar,i=r.getChild("fullscreenToggle").el();r.el().insertBefore(r.addChild("SourceMenuButton").el(),i)}}))},A=function(e){var t=this;this.ready((function(){w(t,n().mergeOptions(k,e))})),n().registerComponent("SourceMenuButton",S),n().registerComponent("SourceMenuItem",b)};C("httpSourceSelector",A),A.VERSION=g;var L=r(199),x=r.n(L),D=Object.defineProperty,R=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,P=(e,t,r)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,M=(e,t)=>{for(var r in t||(t={}))I.call(t,r)&&P(e,r,t[r]);if(R)for(var r of R(t))O.call(t,r)&&P(e,r,t[r]);return e},F=(e,t,r)=>(P(e,"symbol"!=typeof t?t+"":t,r),r);class N{constructor(e,t,r={}){const i=n().getTech("Tech").prototype.error;this.source=e,this.tech=t,this.player=n().getPlayer(this.tech.options().playerId),this._html5TechError=this.tech.error,this.tech.error=i,this.el=t.el(),this.hls=new(x())(M({backBufferLength:30,liveDurationInfinity:!0},r.hls)),this.tech.hlsjs=this.hls,this.player.qualityLevels&&this.setupQualityLevels(),this.setupEventHandlers(),this.setupHls(),this.mediaElErrorHandler_=()=>this.tech.error(this.el.error)}dispose(){this.el.removeEventListener("error",this.mediaElErrorHandler_),this.tech.error=this._html5TechError,this.hls.destroy(),delete this.tech.hlsjs}setupEventHandlers(){const e={MEDIA_ERR_CUSTOM:0,MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4,MEDIA_ERR_ENCRYPTED:5},t={[x().ErrorTypes.NETWORK_ERROR]:e.MEDIA_ERR_NETWORK,[x().ErrorTypes.MEDIA_ERROR]:e.MEDIA_ERR_DECODE,[x().ErrorTypes.MUX_ERROR]:e.MEDIA_ERR_DECODE,[x().ErrorTypes.KEY_SYSTEM_ERROR]:e.MEDIA_ERR_ENCRYPTED,DEFAULT:e.MEDIA_ERR_CUSTOM};Object.values(x().Events).forEach((e=>{e!==x().Events.ERROR?this.hls.on(e,((t,r)=>{this.tech.trigger(e,r)})):this.hls.on(e,((e,r)=>{var i;const{type:n,fatal:a}=r;if(!a)return;const s=null!=(i=t[n])?i:t.DEFAULT;this.tech.error({code:s,hlsError:r})}))})),this.el.addEventListener("error",this.mediaElErrorHandler_)}setupHls(){x().isSupported()?(this.hls.attachMedia(this.el),this.hls.loadSource(this.source.src)):this.el.canPlayType("application/vnd.apple.mpegurl")?this.el.src=this.source.src:console.log("[videojs-mux-kit] Error: browser does not support MSE nor Hls natively")}setupQualityLevels(){const e=this.player.qualityLevels();let t;const r=()=>{let e;for(e=t.length-1;e>0&&!t[e];e--);return e},i=()=>r()===this.hls.levels.length-1,n=(e,t)=>{const n=r();i()?this.hls.autoLevelCapping=-1:this.hls.autoLevelCapping=n,t&&this.hls.currentLevel!==e&&(this.hls.currentLevel=e,a())},a=(t,r)=>{let i=this.hls.currentLevel;e.selectedIndex_=i,e.trigger({type:"change",selectedIndex:i})};this.tech.on(x().Events.MANIFEST_LOADED,((r,i)=>{if(t=new Array(this.hls.levels.length).fill(!0),-1!==this.hls.autoLevelCapping)for(let e=this.hls.maxAutoLevel;e<this.hls.levels.length;e++)t[e]=!1;this.hls.levels.forEach(((r,i)=>{e.addQualityLevel({id:i,width:r.width,height:r.height,bitrate:r.bitrate,enabled:e=>{t[i]=e,n(i,e)}})})),e.selectedIndex_=this.hls.currentLevel,e.trigger({type:"change",selectedIndex:this.hls.currentLevel})})),this.tech.on(x().Events.LEVEL_SWITCHED,a)}}F(N,"hlsTypeRE",/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i),F(N,"hlsExtRE",/\.m3u8/i);const B={canHandleSource:e=>e.skipHlsJs?"":N.hlsTypeRE.test(e.type)?"probably":N.hlsExtRE.test(e.src)?"maybe":"",handleSource:(e,t,r={})=>new N(e,t,r),canPlayType:e=>N.hlsTypeRE.test(e)?"probably":""};n().getTech("Html5").registerSourceHandler(B,0);const j={i8:"0.11.1"};function U(e){var t,r;if(null==(r=null==(t=e.tech_)?void 0:t.sourceHandler_)?void 0:r.hls){const t=e.tech_.sourceHandler_.hls;e.mux.addHLSJS({hlsjs:t,Hls:x()})}}function H(e,t){var r,i,n,a,s;if(null==(r=null==e?void 0:e.dataset)?void 0:r.setup){let t=e.dataset.setup;t=JSON.parse(t),t&&(null==(n=null==(i=null==t?void 0:t.plugins)?void 0:i.mux)?void 0:n.data)&&(t=G(t),t=JSON.stringify(t),e.dataset.setup=t)}return(null==(s=null==(a=null==t?void 0:t.plugins)?void 0:a.mux)?void 0:s.data)&&(t=G(t)),t}function G(e){var t;return e.plugins.mux.data.player_software_name="vjs-mux-kit-"+(null==(t=n())?void 0:t.VERSION.split(".")[0])+("function"==typeof x()?"-hlsjs":"-vhs"),e.plugins.mux.data.player_software_version=j.i8,e}function K(e){var t,r;null==(r=null==(t=e.tech_)?void 0:t.sourceHandler_)||r.hls.on(x().Events.MANIFEST_LOADED,(function(t,r){if(r.subtitles){let t;for(t=0;t<r.subtitles.length;t++)e.addRemoteTextTrack({kind:r.subtitles[t].type,label:r.subtitles[t].name,srclang:r.subtitles[t].lang,default:r.subtitles[t].default},!1)}})),e.remoteTextTracks().addEventListener("change",(t=>{let r,i=e.remoteTextTracks(),n=!1;for(r=0;r<i.length;r++)"showing"===i[r].mode&&(e.tech_.sourceHandler_.hls.subtitleTrack=r,n=!0);!0!==n&&(e.tech_.sourceHandler_.hls.subtitleTrack=-1)}))}r(288);const V={},q={},W=n().registerPlugin||n().plugin,z=(e,t)=>{e.addClass("vjs-vtt-thumbnails"),e.vttThumbnails=new X(e,t)},Y=function(e){this.ready((()=>{z(this,n().mergeOptions(V,e))}))};class X{constructor(e,t){return this.player=e,this.options=t,this.listenForDurationChange(),this.initializeThumbnails(),this.registeredEvents={},this}src(e){this.resetPlugin(),this.options.src=e,this.initializeThumbnails()}detach(){this.resetPlugin()}resetPlugin(){this.thumbnailHolder&&this.thumbnailHolder.parentNode.removeChild(this.thumbnailHolder),this.progressBar&&(this.progressBar.removeEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.removeEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave),this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove)),delete this.registeredEvents.progressBarMouseEnter,delete this.registeredEvents.progressBarMouseLeave,delete this.registeredEvents.progressBarMouseMove,delete this.progressBar,delete this.vttData,delete this.thumbnailHolder,delete this.lastStyle}listenForDurationChange(){this.player.on("durationchange",(()=>{}))}initializeThumbnails(){if(!this.options.src)return;const e=this.getBaseUrl(),t=this.getFullyQualifiedUrl(this.options.src,e);this.getVttFile(t).then((e=>{this.vttData=this.processVtt(e),this.setupThumbnailElement()}))}getBaseUrl(){return[window.location.protocol,"//",window.location.hostname,window.location.port?":"+window.location.port:"",window.location.pathname].join("").split(/([^\/]*)$/gi).shift()}getVttFile(e){return new Promise(((t,r)=>{const i=new XMLHttpRequest;i.data={resolve:t},i.addEventListener("load",this.vttFileLoaded),i.open("GET",e),i.overrideMimeType("text/plain; charset=utf-8"),i.send()}))}vttFileLoaded(){this.data.resolve(this.responseText)}setupThumbnailElement(e){let t=null;this.options.showTimestamp||(t=this.player.$(".vjs-mouse-display"));const r=document.createElement("div");r.setAttribute("class","vjs-vtt-thumbnail-display"),this.progressBar=this.player.$(".vjs-progress-control"),this.progressBar.appendChild(r),this.thumbnailHolder=r,t&&!this.options.showTimestamp&&t.classList.add("vjs-hidden"),this.registeredEvents.progressBarMouseEnter=()=>this.onBarMouseenter(),this.registeredEvents.progressBarMouseLeave=()=>this.onBarMouseleave(),this.progressBar.addEventListener("mouseenter",this.registeredEvents.progressBarMouseEnter),this.progressBar.addEventListener("mouseleave",this.registeredEvents.progressBarMouseLeave)}onBarMouseenter(){this.mouseMoveCallback=e=>{this.onBarMousemove(e)},this.registeredEvents.progressBarMouseMove=this.mouseMoveCallback,this.progressBar.addEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.showThumbnailHolder()}onBarMouseleave(){this.registeredEvents.progressBarMouseMove&&this.progressBar.removeEventListener("mousemove",this.registeredEvents.progressBarMouseMove),this.hideThumbnailHolder()}getXCoord(e,t){const r=e.getBoundingClientRect(),i=document.documentElement;return t-(r.left+(window.pageXOffset||i.scrollLeft||0))}onBarMousemove(e){this.updateThumbnailStyle(n().dom.getPointerPosition(this.progressBar,e).x,this.progressBar.offsetWidth)}getStyleForTime(e){for(let t=0;t<this.vttData.length;++t){const r=this.vttData[t];if(e>=r.start&&e<r.end){if(r.css.url&&!q[r.css.url]){const e=new Image;e.src=r.css.url,q[r.css.url]=e}return r.css}}}showThumbnailHolder(){this.thumbnailHolder.style.opacity="1"}hideThumbnailHolder(){this.thumbnailHolder.style.opacity="0"}updateThumbnailStyle(e,t){const r=e*this.player.duration(),i=this.getStyleForTime(r);if(!i)return this.hideThumbnailHolder();const n=e*t,a=parseInt(i.width,10),s=a>>1,o=t-(n+s),l=n-s;if(l>0&&o>0?this.thumbnailHolder.style.transform="translateX("+(n-s)+"px)":l<=0?this.thumbnailHolder.style.transform="translateX(0px)":o<=0&&(this.thumbnailHolder.style.transform="translateX("+(t-a)+"px)"),!this.lastStyle||this.lastStyle!==i){this.lastStyle=i;for(const e in i)i.hasOwnProperty(e)&&(this.thumbnailHolder.style[e]=i[e])}}processVtt(e){const t=[];return e.split(/[\r\n][\r\n]/i).forEach((e=>{if(e.match(/([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?( ?--> ?)([0-9]{2}:)?([0-9]{2}:)?[0-9]{2}(.[0-9]{3})?[\r\n]{1}.*/gi)){const r=e.split(/[\r\n]/i),i=r[0].split(/ ?--> ?/i),n=i[0],a=i[1],s=r[1],o=this.getVttCss(s);t.push({start:this.getSecondsFromTimestamp(n),end:this.getSecondsFromTimestamp(a),css:o})}})),t}getFullyQualifiedUrl(e,t){return e.indexOf("//")>=0?e:0===t.indexOf("//")?[t.replace(/\/$/gi,""),this.trim(e,"/")].join("/"):t.indexOf("//")>0?[this.trim(t,"/"),this.trim(e,"/")].join("/"):e}getPropsFromDef(e){const t=e.split(/#xywh=/i),r=t[0],i=t[1].match(/[0-9]+/gi);return{x:i[0],y:i[1],w:i[2],h:i[3],image:r}}getVttCss(e){const t={};let r;if(r=this.options.src.indexOf("//")>=0?this.options.src.split(/([^\/]*)$/gi).shift():this.getBaseUrl()+this.options.src.split(/([^\/]*)$/gi).shift(),!(e=this.getFullyQualifiedUrl(e,r)).match(/#xywh=/i))return t.background='url("'+e+'")',t;const i=this.getPropsFromDef(e);return t.background='url("'+i.image+'") no-repeat -'+i.x+"px -"+i.y+"px",t.width=i.w+"px",t.height=i.h+"px",t.url=i.image,t}deconstructTimestamp(e){const t=e.split("."),r=t[0].split(":");return{milliseconds:parseInt(t[1],10)||0,seconds:parseInt(r.pop(),10)||0,minutes:parseInt(r.pop(),10)||0,hours:parseInt(r.pop(),10)||0}}getSecondsFromTimestamp(e){const t=this.deconstructTimestamp(e);return parseInt(3600*t.hours+60*t.minutes+t.seconds+t.milliseconds/1e3,10)}trim(e,t){let r=[" ","\n","\r","\t","\f","\v","\xa0","\u2000","\u2001","\u2002","\u2003","\u2004","\u2005","\u2006","\u2007","\u2008","\u2009","\u200a","\u200b","\u2028","\u2029","\u3000"].join(""),i=0,n=0;for(e+="",t&&(r=(t+"").replace(/([[\]().?/*{}+$^:])/g,"$1")),i=e.length,n=0;n<i;n++)if(-1===r.indexOf(e.charAt(n))){e=e.substring(n);break}for(i=e.length,n=i-1;n>=0;n--)if(-1===r.indexOf(e.charAt(n))){e=e.substring(0,n+1);break}return-1===r.indexOf(e.charAt(0))?e:""}}function Q(e){e.timelineHoverPreviews=function(t){let r=(null==t?void 0:t.enabled)||!1,i=(null==t?void 0:t.src)||null;return r||"function"!=typeof e.vttThumbnails.detach?"function"==typeof e.vttThumbnails&&null!==i?(e.vttThumbnails({src:i}),void(e.options().timelineHoverPreviewsUrl=i)):"function"==typeof e.vttThumbnails.src&&null!==i?(e.vttThumbnails.src(i),void(e.options().timelineHoverPreviewsUrl=i)):void 0:(e.vttThumbnails.detach(),void(e.options().timelineHoverPreviewsUrl=null))}}W("vttThumbnails",Y),n().hook("beforesetup",(function(e,t){return t=H(e,t)})),n().hook("setup",(function(e){Q(e),e.options().timelineHoverPreviewsUrl&&e.timelineHoverPreviews({enabled:!0,src:e.options().timelineHoverPreviewsUrl})})),n().use("video/mux",(e=>({setSource({src:t},r){if(e.options().timelineHoverPreviews){let r=`https://image.mux.com/${t.split("?",1)[0]}/storyboard.vtt`;e.timelineHoverPreviews({enabled:!0,src:r})}r(null,{src:`https://stream.mux.com/${t}`,type:"application/x-mpegurl"}),e.mux&&e.mux.addHLSJS&&U(e),"undefined"!=typeof K&&K(e)}})));const J=n()},893:()=>{}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,r),a.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(18)})()}}]);
//# sourceMappingURL=071c3687-634c57f1f0279de1.js.map